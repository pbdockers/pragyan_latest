{"version":3,"file":"6579.f6bc01761639aac032d0.entry.js","mappings":"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","sources":["webpack://superset/./src/SqlLab/utils/newQueryTabName.ts","webpack://superset/./src/SqlLab/actions/sqlLab.js","webpack://superset/./src/components/Chart/chartAction.js","webpack://superset/./src/components/ErrorBoundary/index.jsx","webpack://superset/./src/dashboard/actions/dashboardFilters.js","webpack://superset/./src/dashboard/actions/dashboardLayout.js","webpack://superset/./src/dashboard/util/dropOverflowsParent.js","webpack://superset/./src/dashboard/util/isInDifferentFilterScopes.js","webpack://superset/./src/dashboard/util/getOverwriteItems.ts","webpack://superset/./src/dashboard/actions/dashboardState.js","webpack://superset/./src/dashboard/util/serializeFilterScopes.js","webpack://superset/./src/dashboard/actions/hydrate.js","webpack://superset/./src/dashboard/util/getEmptyLayout.js","webpack://superset/./src/dashboard/util/findFirstParentContainer.js","webpack://superset/./src/dashboard/reducers/dashboardFilters.js","webpack://superset/./src/dashboard/reducers/sliceEntities.js","webpack://superset/./src/dashboard/util/activeDashboardFilters.js","webpack://superset/./src/dashboard/util/getComponentWidthFromDrop.js","webpack://superset/./src/dashboard/util/getDetailedComponentWidth.js","webpack://superset/./src/dashboard/util/getFilterConfigsFromFormdata.js","webpack://superset/./src/dashboard/util/newComponentFactory.js","webpack://superset/./src/dashboard/util/serializeActiveFilterValues.js","webpack://superset/./src/dashboard/util/updateComponentParentsList.js","webpack://superset/./src/explore/actions/saveModalActions.js","webpack://superset/./src/explore/components/controls/CheckboxControl.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilter/index.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterOption/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/adhocFilterType.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterControl/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetric.js","webpack://superset/./src/explore/components/controls/MetricControl/FilterDefinitionOption.jsx","webpack://superset/./src/explore/components/controls/MetricControl/adhocMetricType.js","webpack://superset/./src/explore/components/controls/MetricControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/savedMetricType.js","webpack://superset/./src/explore/components/controls/SelectControl.jsx","webpack://superset/./src/explore/components/controls/SpatialControl.jsx","webpack://superset/./src/explore/components/controls/TextAreaControl.jsx","webpack://superset/./src/explore/controls.jsx","webpack://superset/./src/explore/exploreUtils/index.js","webpack://superset/./src/explore/store.js","webpack://superset/./src/modules/AnnotationTypes.js","webpack://superset/./src/reports/actions/reports.js","webpack://superset/./src/utils/datasourceUtils.js","webpack://superset/./src/utils/dates.js","webpack://superset/./src/utils/hostNamesConfig.js","webpack://superset/./src/components/DeprecatedSelect/WindowedSelect/WindowedMenuList.tsx","webpack://superset/./src/components/DeprecatedSelect/WindowedSelect/windowed.tsx","webpack://superset/./src/components/DeprecatedSelect/WindowedSelect/index.tsx","webpack://superset/./src/components/DeprecatedSelect/styles.tsx","webpack://superset/./src/components/DeprecatedSelect/DeprecatedSelect.tsx","webpack://superset/./src/components/DeprecatedSelect/utils.ts","webpack://superset/./src/components/DeprecatedSelect/OnPasteSelect.jsx","webpack://superset/./src/components/DeprecatedSelect/NativeSelect.tsx","webpack://superset/./src/visualizations/FilterBox/FilterBox.jsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/CertifiedIconWithTooltip.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnOption.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_derived.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_boolean.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_abc.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_num.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/ColumnTypeLabel.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/InfoTooltipWithTrigger.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/MetricOption.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/SQLPopover.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/Tooltip.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/labelUtils.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/constants.ts","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlHeader.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/RadioButtonControl.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/index.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/Select.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/controls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/ControlFormItem.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/constants.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigPopover.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigItem.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/types.ts","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/index.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigControl.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/dndControls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/mixins.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/sharedControls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/types.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/D3Formatting.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/defineSavedMetrics.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/expandControlConfig.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/utils/getStandardizedControls.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/getTemporalColumns.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/selectOptions.ts","webpack://superset/./packages/superset-ui-core/src/chart/registries/ChartBuildQueryRegistrySingleton.ts","webpack://superset/./packages/superset-ui-core/src/chart/registries/ChartControlPanelRegistrySingleton.ts","webpack://superset/./packages/superset-ui-core/src/chart/registries/ChartMetadataRegistrySingleton.ts","webpack://superset/./packages/superset-ui-core/src/chart/types/Base.ts","webpack://superset/./packages/superset-ui-core/src/color/CategoricalColorNamespace.ts","webpack://superset/./packages/superset-ui-core/src/color/CategoricalColorScale.ts","webpack://superset/./packages/superset-ui-core/src/color/SharedLabelColorSingleton.ts","webpack://superset/./packages/superset-ui-core/src/color/stringifyAndTrim.ts","webpack://superset/./packages/superset-ui-core/src/color/utils.ts","webpack://superset/./packages/superset-ui-core/src/components/SafeMarkdown.tsx","webpack://superset/./packages/superset-ui-core/src/components/constants.ts","webpack://superset/./packages/superset-ui-core/src/dynamic-plugins/shared-modules.ts","webpack://superset/./packages/superset-ui-core/src/hooks/usePrevious/usePrevious.ts","webpack://superset/./packages/superset-ui-core/src/models/TypedRegistry.ts","webpack://superset/./packages/superset-ui-core/src/query/DatasourceKey.ts","webpack://superset/./packages/superset-ui-core/src/query/buildQueryContext.ts","webpack://superset/./packages/superset-ui-core/src/query/processFilters.ts","webpack://superset/./packages/superset-ui-core/src/query/buildQueryObject.ts","webpack://superset/./packages/superset-ui-core/src/query/extractExtras.ts","webpack://superset/./packages/superset-ui-core/src/query/processExtraFormData.ts","webpack://superset/./packages/superset-ui-core/src/query/constants.ts","webpack://superset/./packages/superset-ui-core/src/query/convertFilter.ts","webpack://superset/./packages/superset-ui-core/src/query/extractQueryFields.ts","webpack://superset/./packages/superset-ui-core/src/query/getColumnLabel.ts","webpack://superset/./packages/superset-ui-core/src/query/getMetricLabel.ts","webpack://superset/./packages/superset-ui-core/src/query/getXAxis.ts","webpack://superset/./packages/superset-ui-core/src/query/normalizeTimeColumn.ts","webpack://superset/./packages/superset-ui-core/src/query/types/AdvancedAnalytics.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Column.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Dashboard.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Datasource.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Filter.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Metric.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Operator.ts","webpack://superset/./packages/superset-ui-core/src/query/types/QueryFormData.ts","webpack://superset/./packages/superset-ui-core/src/query/types/QueryResponse.ts","webpack://superset/./packages/superset-ui-core/src/ui-overrides/ExtensionsRegistry.ts","webpack://superset/./packages/superset-ui-core/src/utils/featureFlags.ts","webpack://superset/./packages/superset-ui-core/src/utils/html.tsx","webpack://superset/./packages/superset-ui-core/src/utils/isDefined.ts","webpack://superset/./packages/superset-ui-core/src/utils/isEqualArray.ts","webpack://superset/./packages/superset-ui-core/src/utils/removeDuplicates.ts","webpack://superset/./packages/superset-ui-core/src/validator/legacyValidateInteger.ts","webpack://superset/./packages/superset-ui-core/src/validator/legacyValidateNumber.ts","webpack://superset/./packages/superset-ui-core/src/validator/validateNonEmpty.ts","webpack://superset/./packages/superset-ui-core/src/validator/validateNumber.ts","webpack://superset/./src/SqlLab/components/SaveDatasetModal/index.tsx","webpack://superset/./src/SqlLab/constants.ts","webpack://superset/./src/SqlLab/types.ts","webpack://superset/./src/SqlLab/utils/sqlKeywords.ts","webpack://superset/./src/components/Alert/index.tsx","webpack://superset/./src/components/AsyncAceEditor/index.tsx","webpack://superset/./src/components/AsyncEsmComponent/index.tsx","webpack://superset/./src/components/Chart/chartReducer.ts","webpack://superset/./src/components/Checkbox/CheckboxIcons.tsx","webpack://superset/./src/components/Checkbox/Checkbox.tsx","webpack://superset/./src/components/Collapse/index.tsx","webpack://superset/./src/components/Datasource/ChangeDatasourceModal.tsx","webpack://superset/./src/components/Datasource/DatasourceModal.tsx","webpack://superset/./src/components/DatePicker/index.tsx","webpack://superset/./src/components/DynamicPlugins/index.tsx","webpack://superset/./src/components/EmptyState/index.tsx","webpack://superset/./src/components/ErrorMessage/ErrorMessageWithStackTrace.tsx","webpack://superset/./src/components/FacePile/index.tsx","webpack://superset/./src/components/FacePile/utils.tsx","webpack://superset/./src/components/Form/FormItem.tsx","webpack://superset/./src/components/Form/FormLabel.tsx","webpack://superset/./src/assets/images/icons/error.svg?d566","webpack://superset/./src/components/Form/LabeledErrorBoundInput.tsx","webpack://superset/./src/components/Form/Form.tsx","webpack://superset/./src/components/InfoTooltip/index.tsx","webpack://superset/./src/components/Input/index.tsx","webpack://superset/./src/components/Menu/index.tsx","webpack://superset/./src/components/ModalTrigger/index.tsx","webpack://superset/./src/components/Popover/Popover.tsx","webpack://superset/./src/components/PopoverSection/index.tsx","webpack://superset/./src/components/Radio/index.tsx","webpack://superset/./src/components/WarningIconWithTooltip/index.tsx","webpack://superset/./src/dashboard/actions/dashboardInfo.ts","webpack://superset/./src/dashboard/actions/datasources.ts","webpack://superset/./src/dashboard/actions/nativeFilters.ts","webpack://superset/./src/dashboard/actions/sliceEntities.ts","webpack://superset/./src/dashboard/components/nativeFilters/FiltersConfigModal/utils.ts","webpack://superset/./src/dashboard/components/nativeFilters/utils.ts","webpack://superset/./src/dashboard/constants.ts","webpack://superset/./src/dashboard/reducers/nativeFilters.ts","webpack://superset/./src/dashboard/types.ts","webpack://superset/./src/dashboard/util/componentTypes.ts","webpack://superset/./src/dashboard/util/constants.ts","webpack://superset/./src/dashboard/util/crossFilters.ts","webpack://superset/./src/dashboard/util/extractUrlParams.ts","webpack://superset/./src/dashboard/util/findParentId.ts","webpack://superset/./src/dashboard/util/getChartIdsInFilterScope.ts","webpack://superset/./src/dashboard/util/getDashboardFilterKey.ts","webpack://superset/./src/dashboard/util/getLocationHash.ts","webpack://superset/./src/types/bootstrapTypes.ts","webpack://superset/./src/dashboard/util/permissionUtils.ts","webpack://superset/./src/dataMask/actions.ts","webpack://superset/./src/dataMask/reducer.ts","webpack://superset/./src/explore/actions/datasourcesActions.ts","webpack://superset/./src/explore/actions/exploreActions.ts","webpack://superset/./src/explore/actions/hydrateExplore.ts","webpack://superset/./src/explore/components/controls/CustomListItem/index.tsx","webpack://superset/./src/explore/components/controls/AnnotationLayerControl/index.jsx","webpack://superset/./src/explore/components/controls/BoundsControl.tsx","webpack://superset/./src/explore/components/controls/CollectionControl/index.jsx","webpack://superset/./src/explore/components/controls/ColorPickerControl.jsx","webpack://superset/./src/explore/components/controls/ViewQueryModalFooter.tsx","webpack://superset/./src/explore/components/controls/DatasourceControl/index.jsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricEditPopoverTitle.tsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricPopoverTrigger.tsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricOption.jsx","webpack://superset/./src/explore/components/controls/MetricControl/MetricDefinitionValue.jsx","webpack://superset/./src/explore/components/controls/MetricControl/MetricsControl.jsx","webpack://superset/./src/explore/components/controls/FixedOrMetricControl/index.jsx","webpack://superset/./src/explore/components/controls/SelectAsyncControl/index.tsx","webpack://superset/./src/components/Slider/index.tsx","webpack://superset/./src/explore/components/controls/TimeSeriesColumnControl/index.jsx","webpack://superset/./src/explore/components/controls/ViewportControl.jsx","webpack://superset/./src/explore/components/controls/VizTypeControl/FastVizSwitcher.tsx","webpack://superset/./src/explore/components/controls/VizTypeControl/index.tsx","webpack://superset/./src/components/FormRow/index.jsx","webpack://superset/./src/explore/components/controls/FilterBoxItemControl/index.jsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/types.ts","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/FormattingPopoverContent.tsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/FormattingPopover.tsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/ConditionalFormattingControl.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndSelectLabel.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/Option.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/OptionWrapper.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/utils/optionSelector.ts","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/ColumnSelectPopover.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/useResizeButton.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndColumnSelectPopoverTitle.jsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/ColumnSelectPopoverTrigger.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndColumnSelect.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndAdhocFilterOption.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndFilterSelect.tsx","webpack://superset/./src/explore/components/DatasourcePanel/types.ts","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndMetricSelect.tsx","webpack://superset/./src/explore/components/controls/index.js","webpack://superset/./src/explore/components/controls/HiddenControl.tsx","webpack://superset/./src/explore/components/controls/SliderControl.tsx","webpack://superset/./src/explore/components/controls/XAxisSortControl.tsx","webpack://superset/./src/explore/components/Control.tsx","webpack://superset/./src/explore/components/ControlHeader.tsx","webpack://superset/./src/explore/components/ControlRow.tsx","webpack://superset/./src/explore/components/DataTableControl/index.tsx","webpack://superset/./src/explore/components/DataTableControl/utils.ts","webpack://superset/./src/explore/components/DndItemType.ts","webpack://superset/./src/explore/components/ExploreContentPopover.tsx","webpack://superset/./src/explore/components/RowCountLabel/index.tsx","webpack://superset/./src/explore/components/controls/ColorSchemeControl/ColorSchemeLabel.tsx","webpack://superset/./src/explore/components/controls/ColorSchemeControl/index.tsx","webpack://superset/./src/explore/components/controls/ControlPopover/ControlPopover.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CommonFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CalendarFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CustomFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/DateFunctionTooltip.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/AdvancedFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/DateLabel.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/types.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/dateFilterUtils.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/constants.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/dateParser.ts","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/useAdvancedDataTypes.ts","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/types.ts","webpack://superset/./src/explore/components/controls/FilterControl/utils/useGetTimeRangeLabel.tsx","webpack://superset/./src/explore/components/controls/FilterControl/utils/useDatePickerInAdhocFilter.tsx","webpack://superset/./src/explore/components/controls/FilterControl/utils/translateToSQL.ts","webpack://superset/./src/explore/components/controls/OptionControls/index.tsx","webpack://superset/./src/explore/components/controls/TextControl/index.tsx","webpack://superset/./src/explore/components/controls/ViewQuery.tsx","webpack://superset/./src/explore/components/controls/VizTypeControl/VizTypeGallery.tsx","webpack://superset/./src/explore/components/optionRenderers.tsx","webpack://superset/./src/explore/constants.ts","webpack://superset/./src/explore/controlPanels/sections.tsx","webpack://superset/./src/explore/controlUtils/getSectionsToRender.ts","webpack://superset/./src/explore/controlUtils/getControlConfig.ts","webpack://superset/./src/explore/controlUtils/getControlState.ts","webpack://superset/./src/explore/controlUtils/getFormDataFromControls.ts","webpack://superset/./src/explore/controlUtils/getControlValuesCompatibleWithDatasource.ts","webpack://superset/./src/explore/controlUtils/standardizedFormData.ts","webpack://superset/./src/explore/exploreUtils/formData.ts","webpack://superset/./src/features/datasets/constants.ts","webpack://superset/./src/features/home/types.ts","webpack://superset/./src/hooks/apiResources/apiResources.ts","webpack://superset/./src/hooks/apiResources/queryApi.ts","webpack://superset/./src/logger/LogUtils.ts","webpack://superset/./src/logger/actions/index.ts","webpack://superset/./src/middleware/asyncEvent.ts","webpack://superset/./src/utils/findPermission.ts","webpack://superset/./src/utils/getDatasourceUid.ts","webpack://superset/./src/utils/localStorageHelpers.ts","webpack://superset/./src/utils/safeStringify.ts","webpack://superset/./src/utils/textUtils.ts","webpack://superset/./src/utils/urlUtils.ts","webpack://superset/./src/views/CRUD/hooks.ts","webpack://superset/./src/views/CRUD/types.ts","webpack://superset/./src/views/CRUD/utils.tsx","webpack://superset/./src/dashboard/util/componentIsResizable.ts","webpack://superset/./src/dashboard/util/shouldWrapChildInRow.js","webpack://superset/./src/dashboard/util/newEntitiesFromDrop.js","webpack://superset/./src/dashboard/reducers/dashboardLayout.js","webpack://superset/./src/dashboard/util/dnd-reorder.js","webpack://superset/./src/dashboard/reducers/undoableDashboardLayout.js","webpack://superset/./src/utils/DebouncedMessageQueue.js","webpack://superset/./src/middleware/loggerMiddleware.js","webpack://superset/./src/views/store.ts","webpack://superset/./src/dashboard/reducers/datasources.ts","webpack://superset/./src/explore/reducers/datasourcesReducer.ts","webpack://superset/./src/dashboard/reducers/dashboardInfo.js","webpack://superset/./src/dashboard/reducers/dashboardState.js","webpack://superset/./src/reports/reducers/reports.js","webpack://superset/./src/explore/reducers/saveModalReducer.js","webpack://superset/./src/explore/reducers/exploreReducer.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '@superset-ui/core';\nimport { QueryEditor } from '../types';\n\nconst untitledQueryRegex = /^Untitled Query (\\d+)$/; // Literal notation isn't recompiled\nconst untitledQuery = 'Untitled Query ';\n\nexport const newQueryTabName = (\n  queryEditors: QueryEditor[],\n  initialTitle = `${untitledQuery}1`,\n): string => {\n  const resultTitle = t(initialTitle);\n\n  if (queryEditors.length > 0) {\n    const mappedUntitled = queryEditors.filter(qe =>\n      qe.name?.match(untitledQueryRegex),\n    );\n    const untitledQueryNumbers = mappedUntitled.map(\n      qe => +qe.name.replace(untitledQuery, ''),\n    );\n    if (untitledQueryNumbers.length > 0) {\n      // When there are query tabs open, and at least one is called \"Untitled Query #\"\n      // Where # is a valid number\n      const largestNumber: number = Math.max(...untitledQueryNumbers);\n      return t('%s%s', untitledQuery, largestNumber + 1);\n    }\n    return resultTitle;\n  }\n\n  return resultTitle;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport rison from 'rison';\nimport { FeatureFlag, SupersetClient, t } from '@superset-ui/core';\nimport invert from 'lodash/invert';\nimport mapKeys from 'lodash/mapKeys';\nimport { isFeatureEnabled } from 'src/featureFlags';\n\nimport { now } from 'src/utils/dates';\nimport {\n  addDangerToast as addDangerToastAction,\n  addInfoToast as addInfoToastAction,\n  addSuccessToast as addSuccessToastAction,\n  addWarningToast as addWarningToastAction,\n} from 'src/components/MessageToasts/actions';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport COMMON_ERR_MESSAGES from 'src/utils/errorMessages';\nimport { LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY } from 'src/logger/LogUtils';\nimport { logEvent } from 'src/logger/actions';\nimport { newQueryTabName } from '../utils/newQueryTabName';\n\nexport const RESET_STATE = 'RESET_STATE';\nexport const ADD_QUERY_EDITOR = 'ADD_QUERY_EDITOR';\nexport const UPDATE_QUERY_EDITOR = 'UPDATE_QUERY_EDITOR';\nexport const QUERY_EDITOR_SAVED = 'QUERY_EDITOR_SAVED';\nexport const CLONE_QUERY_TO_NEW_TAB = 'CLONE_QUERY_TO_NEW_TAB';\nexport const REMOVE_QUERY_EDITOR = 'REMOVE_QUERY_EDITOR';\nexport const MERGE_TABLE = 'MERGE_TABLE';\nexport const REMOVE_TABLES = 'REMOVE_TABLES';\nexport const END_QUERY = 'END_QUERY';\nexport const REMOVE_QUERY = 'REMOVE_QUERY';\nexport const EXPAND_TABLE = 'EXPAND_TABLE';\nexport const COLLAPSE_TABLE = 'COLLAPSE_TABLE';\nexport const QUERY_EDITOR_SETDB = 'QUERY_EDITOR_SETDB';\nexport const QUERY_EDITOR_SET_SCHEMA = 'QUERY_EDITOR_SET_SCHEMA';\nexport const QUERY_EDITOR_SET_TITLE = 'QUERY_EDITOR_SET_TITLE';\nexport const QUERY_EDITOR_SET_AUTORUN = 'QUERY_EDITOR_SET_AUTORUN';\nexport const QUERY_EDITOR_SET_SQL = 'QUERY_EDITOR_SET_SQL';\nexport const QUERY_EDITOR_SET_QUERY_LIMIT = 'QUERY_EDITOR_SET_QUERY_LIMIT';\nexport const QUERY_EDITOR_SET_TEMPLATE_PARAMS =\n  'QUERY_EDITOR_SET_TEMPLATE_PARAMS';\nexport const QUERY_EDITOR_SET_SELECTED_TEXT = 'QUERY_EDITOR_SET_SELECTED_TEXT';\nexport const QUERY_EDITOR_SET_FUNCTION_NAMES =\n  'QUERY_EDITOR_SET_FUNCTION_NAMES';\nexport const QUERY_EDITOR_PERSIST_HEIGHT = 'QUERY_EDITOR_PERSIST_HEIGHT';\nexport const QUERY_EDITOR_TOGGLE_LEFT_BAR = 'QUERY_EDITOR_TOGGLE_LEFT_BAR';\nexport const MIGRATE_QUERY_EDITOR = 'MIGRATE_QUERY_EDITOR';\nexport const MIGRATE_TAB_HISTORY = 'MIGRATE_TAB_HISTORY';\nexport const MIGRATE_TABLE = 'MIGRATE_TABLE';\nexport const MIGRATE_QUERY = 'MIGRATE_QUERY';\n\nexport const SET_DATABASES = 'SET_DATABASES';\nexport const SET_ACTIVE_QUERY_EDITOR = 'SET_ACTIVE_QUERY_EDITOR';\nexport const LOAD_QUERY_EDITOR = 'LOAD_QUERY_EDITOR';\nexport const SET_TABLES = 'SET_TABLES';\nexport const SET_ACTIVE_SOUTHPANE_TAB = 'SET_ACTIVE_SOUTHPANE_TAB';\nexport const REFRESH_QUERIES = 'REFRESH_QUERIES';\nexport const SET_USER_OFFLINE = 'SET_USER_OFFLINE';\nexport const RUN_QUERY = 'RUN_QUERY';\nexport const START_QUERY = 'START_QUERY';\nexport const STOP_QUERY = 'STOP_QUERY';\nexport const REQUEST_QUERY_RESULTS = 'REQUEST_QUERY_RESULTS';\nexport const QUERY_SUCCESS = 'QUERY_SUCCESS';\nexport const QUERY_FAILED = 'QUERY_FAILED';\nexport const CLEAR_INACTIVE_QUERIES = 'CLEAR_INACTIVE_QUERIES';\nexport const CLEAR_QUERY_RESULTS = 'CLEAR_QUERY_RESULTS';\nexport const REMOVE_DATA_PREVIEW = 'REMOVE_DATA_PREVIEW';\nexport const CHANGE_DATA_PREVIEW_ID = 'CHANGE_DATA_PREVIEW_ID';\n\nexport const COST_ESTIMATE_STARTED = 'COST_ESTIMATE_STARTED';\nexport const COST_ESTIMATE_RETURNED = 'COST_ESTIMATE_RETURNED';\nexport const COST_ESTIMATE_FAILED = 'COST_ESTIMATE_FAILED';\n\nexport const CREATE_DATASOURCE_STARTED = 'CREATE_DATASOURCE_STARTED';\nexport const CREATE_DATASOURCE_SUCCESS = 'CREATE_DATASOURCE_SUCCESS';\nexport const CREATE_DATASOURCE_FAILED = 'CREATE_DATASOURCE_FAILED';\n\nexport const addInfoToast = addInfoToastAction;\nexport const addSuccessToast = addSuccessToastAction;\nexport const addDangerToast = addDangerToastAction;\nexport const addWarningToast = addWarningToastAction;\n\nexport const CtasEnum = {\n  TABLE: 'TABLE',\n  VIEW: 'VIEW',\n};\nconst ERR_MSG_CANT_LOAD_QUERY = t(\"The query couldn't be loaded\");\n\n// a map of SavedQuery field names to the different names used client-side,\n// because for now making the names consistent is too complicated\n// so it might as well only happen in one place\nconst queryClientMapping = {\n  id: 'remoteId',\n  db_id: 'dbId',\n  label: 'name',\n  template_parameters: 'templateParams',\n};\nconst queryServerMapping = invert(queryClientMapping);\n\n// uses a mapping like those above to convert object key names to another style\nconst fieldConverter = mapping => obj =>\n  mapKeys(obj, (value, key) => (key in mapping ? mapping[key] : key));\n\nexport const convertQueryToServer = fieldConverter(queryServerMapping);\nexport const convertQueryToClient = fieldConverter(queryClientMapping);\n\nexport function getUpToDateQuery(rootState, queryEditor, key) {\n  const {\n    sqlLab: { unsavedQueryEditor },\n  } = rootState;\n  const id = key ?? queryEditor.id;\n  return {\n    ...queryEditor,\n    ...(id === unsavedQueryEditor.id && unsavedQueryEditor),\n  };\n}\n\nexport function resetState() {\n  return { type: RESET_STATE };\n}\n\nexport function updateQueryEditor(alterations) {\n  return { type: UPDATE_QUERY_EDITOR, alterations };\n}\n\nexport function scheduleQuery(query) {\n  return dispatch =>\n    SupersetClient.post({\n      endpoint: '/savedqueryviewapi/api/create',\n      postPayload: query,\n      stringify: false,\n    })\n      .then(() =>\n        dispatch(\n          addSuccessToast(\n            t(\n              'Your query has been scheduled. To see details of your query, navigate to Saved queries',\n            ),\n          ),\n        ),\n      )\n      .catch(() =>\n        dispatch(addDangerToast(t('Your query could not be scheduled'))),\n      );\n}\n\nexport function estimateQueryCost(queryEditor) {\n  return (dispatch, getState) => {\n    const { dbId, schema, sql, selectedText, templateParams } =\n      getUpToDateQuery(getState(), queryEditor);\n    const requestSql = selectedText || sql;\n\n    const postPayload = {\n      database_id: dbId,\n      schema,\n      sql: requestSql,\n      template_params: JSON.parse(templateParams || '{}'),\n    };\n\n    return Promise.all([\n      dispatch({ type: COST_ESTIMATE_STARTED, query: queryEditor }),\n      SupersetClient.post({\n        endpoint: '/api/v1/sqllab/estimate/',\n        body: JSON.stringify(postPayload),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(({ json }) =>\n          dispatch({ type: COST_ESTIMATE_RETURNED, query: queryEditor, json }),\n        )\n        .catch(response =>\n          getClientErrorObject(response).then(error => {\n            const message =\n              error.error ||\n              error.statusText ||\n              t('Failed at retrieving results');\n            return dispatch({\n              type: COST_ESTIMATE_FAILED,\n              query: queryEditor,\n              error: message,\n            });\n          }),\n        ),\n    ]);\n  };\n}\n\nexport function clearInactiveQueries(interval) {\n  return { type: CLEAR_INACTIVE_QUERIES, interval };\n}\n\nexport function startQuery(query) {\n  Object.assign(query, {\n    id: query.id ? query.id : shortid.generate(),\n    progress: 0,\n    startDttm: now(),\n    state: query.runAsync ? 'pending' : 'running',\n    cached: false,\n  });\n  return { type: START_QUERY, query };\n}\n\nexport function querySuccess(query, results) {\n  return function (dispatch) {\n    const sqlEditorId = results?.query?.sqlEditorId;\n    const sync =\n      sqlEditorId &&\n      !query.isDataPreview &&\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${sqlEditorId}`),\n            postPayload: { latest_query_id: query.id },\n          })\n        : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_SUCCESS, query, results }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while storing the latest query id in the backend. ' +\n                'Please contact your administrator if this problem persists.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryFailed(query, msg, link, errors) {\n  return function (dispatch) {\n    const sync =\n      !query.isDataPreview &&\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${query.sqlEditorId}`),\n            postPayload: { latest_query_id: query.id },\n          })\n        : Promise.resolve();\n\n    const eventData = {\n      has_err: true,\n      start_offset: query.startDttm,\n      ts: new Date().getTime(),\n    };\n    errors?.forEach(({ error_type: errorType, extra }) => {\n      const messages = extra?.issue_codes?.map(({ message }) => message) || [\n        errorType,\n      ];\n      messages.forEach(message => {\n        dispatch(\n          logEvent(LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY, {\n            ...eventData,\n            error_type: errorType,\n            error_details: message,\n          }),\n        );\n      });\n    });\n\n    return (\n      sync\n        .catch(() =>\n          dispatch(\n            addDangerToast(\n              t(\n                'An error occurred while storing the latest query id in the backend. ' +\n                  'Please contact your administrator if this problem persists.',\n              ),\n            ),\n          ),\n        )\n        // We should always show the error message, even if we couldn't sync the\n        // state to the backend\n        .then(() => dispatch({ type: QUERY_FAILED, query, msg, link, errors }))\n    );\n  };\n}\n\nexport function stopQuery(query) {\n  return { type: STOP_QUERY, query };\n}\n\nexport function clearQueryResults(query) {\n  return { type: CLEAR_QUERY_RESULTS, query };\n}\n\nexport function removeDataPreview(table) {\n  return { type: REMOVE_DATA_PREVIEW, table };\n}\n\nexport function requestQueryResults(query) {\n  return { type: REQUEST_QUERY_RESULTS, query };\n}\n\nexport function fetchQueryResults(query, displayLimit) {\n  return function (dispatch) {\n    dispatch(requestQueryResults(query));\n\n    const queryParams = rison.encode({\n      key: query.resultsKey,\n      rows: displayLimit || null,\n    });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/sqllab/results/?q=${queryParams}`,\n      parseMethod: 'json-bigint',\n    })\n      .then(({ json }) => dispatch(querySuccess(query, json)))\n      .catch(response =>\n        getClientErrorObject(response).then(error => {\n          const message =\n            error.error ||\n            error.statusText ||\n            t('Failed at retrieving results');\n\n          return dispatch(\n            queryFailed(query, message, error.link, error.errors),\n          );\n        }),\n      );\n  };\n}\n\nexport function runQuery(query) {\n  return function (dispatch) {\n    dispatch(startQuery(query));\n    const postPayload = {\n      client_id: query.id,\n      database_id: query.dbId,\n      json: true,\n      runAsync: query.runAsync,\n      schema: query.schema,\n      sql: query.sql,\n      sql_editor_id: query.sqlEditorId,\n      tab: query.tab,\n      tmp_table_name: query.tempTable,\n      select_as_cta: query.ctas,\n      ctas_method: query.ctas_method,\n      templateParams: query.templateParams,\n      queryLimit: query.queryLimit,\n      expand_data: true,\n    };\n\n    const search = window.location.search || '';\n    return SupersetClient.post({\n      endpoint: `/api/v1/sqllab/execute/${search}`,\n      body: JSON.stringify(postPayload),\n      headers: { 'Content-Type': 'application/json' },\n      parseMethod: 'json-bigint',\n    })\n      .then(({ json }) => {\n        if (!query.runAsync) {\n          dispatch(querySuccess(query, json));\n        }\n      })\n      .catch(response =>\n        getClientErrorObject(response).then(error => {\n          let message =\n            error.error ||\n            error.message ||\n            error.statusText ||\n            t('Unknown error');\n          if (message.includes('CSRF token')) {\n            message = t(COMMON_ERR_MESSAGES.SESSION_TIMED_OUT);\n          }\n          dispatch(queryFailed(query, message, error.link, error.errors));\n        }),\n      );\n  };\n}\n\nexport function runQueryFromSqlEditor(\n  database,\n  queryEditor,\n  defaultQueryLimit,\n  tempTable,\n  ctas,\n  ctasMethod,\n) {\n  return function (dispatch, getState) {\n    const qe = getUpToDateQuery(getState(), queryEditor, queryEditor.id);\n    const query = {\n      dbId: qe.dbId,\n      sql: qe.selectedText || qe.sql,\n      sqlEditorId: qe.id,\n      tab: qe.name,\n      schema: qe.schema,\n      tempTable,\n      templateParams: qe.templateParams,\n      queryLimit: qe.queryLimit || defaultQueryLimit,\n      runAsync: database ? database.allow_run_async : false,\n      ctas,\n      ctas_method: ctasMethod,\n      updateTabState: !qe.selectedText,\n    };\n    dispatch(runQuery(query));\n  };\n}\n\nexport function reRunQuery(query) {\n  // run Query with a new id\n  return function (dispatch) {\n    dispatch(runQuery({ ...query, id: shortid.generate() }));\n  };\n}\n\nexport function postStopQuery(query) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/api/v1/query/stop',\n      body: JSON.stringify({ client_id: query.id }),\n      headers: { 'Content-Type': 'application/json' },\n    })\n      .then(() => dispatch(stopQuery(query)))\n      .then(() => dispatch(addSuccessToast(t('Query was stopped.'))))\n      .catch(() =>\n        dispatch(addDangerToast(t('Failed at stopping query. %s', query.id))),\n      );\n  };\n}\n\nexport function setDatabases(databases) {\n  return { type: SET_DATABASES, databases };\n}\n\nfunction migrateTable(table, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI('/tableschemaview/'),\n    postPayload: { table: { ...table, queryEditorId } },\n  })\n    .then(({ json }) => {\n      const newTable = {\n        ...table,\n        id: json.id,\n        queryEditorId,\n      };\n      return dispatch({ type: MIGRATE_TABLE, oldTable: table, newTable });\n    })\n    .catch(() =>\n      dispatch(\n        addWarningToast(\n          t(\n            'Unable to migrate table schema state to backend. Superset will retry ' +\n              'later. Please contact your administrator if this problem persists.',\n          ),\n        ),\n      ),\n    );\n}\n\nfunction migrateQuery(queryId, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI(`/tabstateview/${queryEditorId}/migrate_query`),\n    postPayload: { queryId },\n  })\n    .then(() => dispatch({ type: MIGRATE_QUERY, queryId, queryEditorId }))\n    .catch(() =>\n      dispatch(\n        addWarningToast(\n          t(\n            'Unable to migrate query state to backend. Superset will retry later. ' +\n              'Please contact your administrator if this problem persists.',\n          ),\n        ),\n      ),\n    );\n}\n\nexport function migrateQueryEditorFromLocalStorage(\n  queryEditor,\n  tables,\n  queries,\n) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/tabstateview/',\n      postPayload: { queryEditor },\n    })\n      .then(({ json }) => {\n        const newQueryEditor = {\n          ...queryEditor,\n          id: json.id.toString(),\n        };\n        dispatch({\n          type: MIGRATE_QUERY_EDITOR,\n          oldQueryEditor: queryEditor,\n          newQueryEditor,\n        });\n        dispatch({\n          type: MIGRATE_TAB_HISTORY,\n          oldId: queryEditor.id,\n          newId: newQueryEditor.id,\n        });\n        return Promise.all([\n          ...tables.map(table =>\n            migrateTable(table, newQueryEditor.id, dispatch),\n          ),\n          ...queries.map(query =>\n            migrateQuery(query.id, newQueryEditor.id, dispatch),\n          ),\n        ]);\n      })\n      .catch(() =>\n        dispatch(\n          addWarningToast(\n            t(\n              'Unable to migrate query editor state to backend. Superset will retry ' +\n                'later. Please contact your administrator if this problem persists.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function addQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: '/tabstateview/',\n          postPayload: { queryEditor },\n        })\n      : Promise.resolve({ json: { id: shortid.generate() } });\n\n    return sync\n      .then(({ json }) => {\n        const newQueryEditor = {\n          ...queryEditor,\n          id: json.id.toString(),\n        };\n        return dispatch({\n          type: ADD_QUERY_EDITOR,\n          queryEditor: newQueryEditor,\n        });\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'Unable to add a new tab to the backend. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function addNewQueryEditor() {\n  return function (dispatch, getState) {\n    const {\n      sqlLab: {\n        queryEditors,\n        tabHistory,\n        unsavedQueryEditor,\n        defaultDbId,\n        databases,\n      },\n      common,\n    } = getState();\n    const activeQueryEditor = queryEditors.find(\n      qe => qe.id === tabHistory[tabHistory.length - 1],\n    );\n    const dbIds = Object.values(databases).map(database => database.id);\n    const firstDbId = dbIds.length > 0 ? Math.min(...dbIds) : undefined;\n    const { dbId, schema, queryLimit, autorun } = {\n      ...queryEditors[0],\n      ...activeQueryEditor,\n      ...(unsavedQueryEditor.id === activeQueryEditor?.id &&\n        unsavedQueryEditor),\n    };\n    const warning = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? ''\n      : t(\n          '-- Note: Unless you save your query, these tabs will NOT persist if you clear your cookies or change browsers.\\n\\n',\n        );\n\n    const name = newQueryTabName(queryEditors || []);\n\n    return dispatch(\n      addQueryEditor({\n        dbId: dbId || defaultDbId || firstDbId,\n        schema: schema ?? null,\n        autorun: autorun ?? false,\n        sql: `${warning}SELECT ...`,\n        queryLimit: queryLimit || common.conf.DEFAULT_SQLLAB_LIMIT,\n        name,\n      }),\n    );\n  };\n}\n\nexport function cloneQueryToNewTab(query, autorun) {\n  return function (dispatch, getState) {\n    const state = getState();\n    const { queryEditors, tabHistory } = state.sqlLab;\n    const sourceQueryEditor = queryEditors.find(\n      qe => qe.id === tabHistory[tabHistory.length - 1],\n    );\n    const queryEditor = {\n      name: t('Copy of %s', sourceQueryEditor.name),\n      dbId: query.dbId ? query.dbId : null,\n      schema: query.schema ? query.schema : null,\n      autorun,\n      sql: query.sql,\n      queryLimit: sourceQueryEditor.queryLimit,\n      maxRow: sourceQueryEditor.maxRow,\n      templateParams: sourceQueryEditor.templateParams,\n    };\n    return dispatch(addQueryEditor(queryEditor));\n  };\n}\n\nexport function setActiveQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}/activate`),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: SET_ACTIVE_QUERY_EDITOR, queryEditor }))\n      .catch(response => {\n        if (response.status !== 404) {\n          return dispatch(\n            addDangerToast(\n              t(\n                'An error occurred while setting the active tab. Please contact ' +\n                  'your administrator.',\n              ),\n            ),\n          );\n        }\n        return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n      });\n  };\n}\n\nexport function loadQueryEditor(queryEditor) {\n  return { type: LOAD_QUERY_EDITOR, queryEditor };\n}\n\nexport function setTables(tableSchemas) {\n  const tables = tableSchemas\n    .filter(tableSchema => tableSchema.description !== null)\n    .map(tableSchema => {\n      const {\n        columns,\n        selectStar,\n        primaryKey,\n        foreignKeys,\n        indexes,\n        dataPreviewQueryId,\n      } = tableSchema.description;\n      return {\n        dbId: tableSchema.database_id,\n        queryEditorId: tableSchema.tab_state_id.toString(),\n        schema: tableSchema.schema,\n        name: tableSchema.table,\n        expanded: tableSchema.expanded,\n        id: tableSchema.id,\n        dataPreviewQueryId,\n        columns,\n        selectStar,\n        primaryKey,\n        foreignKeys,\n        indexes,\n        isMetadataLoading: false,\n        isExtraMetadataLoading: false,\n      };\n    });\n  return { type: SET_TABLES, tables };\n}\n\nexport function switchQueryEditor(queryEditor, displayLimit) {\n  return function (dispatch) {\n    if (\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n      queryEditor &&\n      !queryEditor.loaded\n    ) {\n      SupersetClient.get({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      })\n        .then(({ json }) => {\n          const loadedQueryEditor = {\n            id: json.id.toString(),\n            loaded: true,\n            name: json.label,\n            sql: json.sql,\n            selectedText: null,\n            latestQueryId: json.latest_query?.id,\n            autorun: json.autorun,\n            dbId: json.database_id,\n            templateParams: json.template_params,\n            schema: json.schema,\n            queryLimit: json.query_limit,\n            remoteId: json.saved_query?.id,\n            validationResult: {\n              id: null,\n              errors: [],\n              completed: false,\n            },\n            hideLeftBar: json.hide_left_bar,\n          };\n          dispatch(loadQueryEditor(loadedQueryEditor));\n          dispatch(setTables(json.table_schemas || []));\n          dispatch(setActiveQueryEditor(loadedQueryEditor));\n          if (json.latest_query && json.latest_query.resultsKey) {\n            dispatch(fetchQueryResults(json.latest_query, displayLimit));\n          }\n        })\n        .catch(response => {\n          if (response.status !== 404) {\n            return dispatch(\n              addDangerToast(t('An error occurred while fetching tab state')),\n            );\n          }\n          return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n        });\n    } else {\n      dispatch(setActiveQueryEditor(queryEditor));\n    }\n  };\n}\n\nexport function setActiveSouthPaneTab(tabId) {\n  return { type: SET_ACTIVE_SOUTHPANE_TAB, tabId };\n}\n\nexport function toggleLeftBar(queryEditor) {\n  const hideLeftBar = !queryEditor.hideLeftBar;\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { hide_left_bar: hideLeftBar },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_TOGGLE_LEFT_BAR,\n          queryEditor,\n          hideLeftBar,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while hiding the left bar. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.delete({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing tab. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeAllOtherQueryEditors(queryEditor) {\n  return function (dispatch, getState) {\n    const { sqlLab } = getState();\n    sqlLab.queryEditors?.forEach(otherQueryEditor => {\n      if (otherQueryEditor.id !== queryEditor.id) {\n        dispatch(removeQueryEditor(otherQueryEditor));\n      }\n    });\n  };\n}\n\nexport function removeQuery(query) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.delete({\n          endpoint: encodeURI(\n            `/tabstateview/${query.sqlEditorId}/query/${query.id}`,\n          ),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_QUERY, query }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing query. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetDb(queryEditor, dbId) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { database_id: dbId },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_EDITOR_SETDB, queryEditor, dbId }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab database ID. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetSchema(queryEditor, schema) {\n  return function (dispatch) {\n    const sync =\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n      typeof queryEditor === 'object'\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n            postPayload: { schema },\n          })\n        : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_SCHEMA,\n          queryEditor: queryEditor || {},\n          schema,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab schema. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetAutorun(queryEditor, autorun) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { autorun },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({ type: QUERY_EDITOR_SET_AUTORUN, queryEditor, autorun }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab autorun. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetTitle(queryEditor, name, id) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${id}`),\n          postPayload: { label: name },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_TITLE,\n          queryEditor: { ...queryEditor, id },\n          name,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab name. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function saveQuery(query, clientId) {\n  const { id, ...payload } = convertQueryToServer(query);\n\n  return dispatch =>\n    SupersetClient.post({\n      endpoint: '/api/v1/saved_query/',\n      jsonPayload: convertQueryToServer(payload),\n    })\n      .then(result => {\n        const savedQuery = convertQueryToClient({\n          id: result.json.id,\n          ...result.json.result,\n        });\n        dispatch({\n          type: QUERY_EDITOR_SAVED,\n          query,\n          clientId,\n          result: savedQuery,\n        });\n        dispatch(queryEditorSetTitle(query, query.name, clientId));\n        return savedQuery;\n      })\n      .catch(() =>\n        dispatch(addDangerToast(t('Your query could not be saved'))),\n      );\n}\n\nexport const addSavedQueryToTabState =\n  (queryEditor, savedQuery) => dispatch => {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: `/tabstateview/${queryEditor.id}`,\n          postPayload: { saved_query_id: savedQuery.remoteId },\n        })\n      : Promise.resolve();\n\n    return sync\n      .catch(() => {\n        dispatch(addDangerToast(t('Your query was not properly saved')));\n      })\n      .then(() => {\n        dispatch(addSuccessToast(t('Your query was saved')));\n      });\n  };\n\nexport function updateSavedQuery(query, clientId) {\n  const { id, ...payload } = convertQueryToServer(query);\n\n  return dispatch =>\n    SupersetClient.put({\n      endpoint: `/api/v1/saved_query/${query.remoteId}`,\n      jsonPayload: convertQueryToServer(payload),\n    })\n      .then(() => {\n        dispatch(addSuccessToast(t('Your query was updated')));\n        dispatch(queryEditorSetTitle(query, query.name, clientId));\n      })\n      .catch(e => {\n        const message = t('Your query could not be updated');\n        // eslint-disable-next-line no-console\n        console.error(message, e);\n        dispatch(addDangerToast(message));\n      })\n      .then(() => dispatch(updateQueryEditor(query)));\n}\n\nexport function queryEditorSetSql(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SQL, queryEditor, sql };\n}\n\nexport function queryEditorSetAndSaveSql(targetQueryEditor, sql) {\n  return function (dispatch, getState) {\n    const queryEditor = getUpToDateQuery(getState(), targetQueryEditor);\n    // saved query and set tab state use this action\n    dispatch(queryEditorSetSql(queryEditor, sql));\n    if (isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)) {\n      return SupersetClient.put({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n        postPayload: { sql, latest_query_id: queryEditor.latestQueryId },\n      }).catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while storing your query in the backend. To ' +\n                'avoid losing your changes, please save your query using the ' +\n                '\"Save Query\" button.',\n            ),\n          ),\n        ),\n      );\n    }\n    return Promise.resolve();\n  };\n}\n\nexport function queryEditorSetQueryLimit(queryEditor, queryLimit) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { query_limit: queryLimit },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_QUERY_LIMIT,\n          queryEditor,\n          queryLimit,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab name. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetTemplateParams(queryEditor, templateParams) {\n  return function (dispatch) {\n    dispatch({\n      type: QUERY_EDITOR_SET_TEMPLATE_PARAMS,\n      queryEditor,\n      templateParams,\n    });\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { template_params: templateParams },\n        })\n      : Promise.resolve();\n\n    return sync.catch(() =>\n      dispatch(\n        addDangerToast(\n          t(\n            'An error occurred while setting the tab template parameters. ' +\n              'Please contact your administrator.',\n          ),\n        ),\n      ),\n    );\n  };\n}\n\nexport function queryEditorSetSelectedText(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SELECTED_TEXT, queryEditor, sql };\n}\n\nexport function mergeTable(table, query, prepend) {\n  return { type: MERGE_TABLE, table, query, prepend };\n}\n\nexport function addTable(queryEditor, tableName, schemaName) {\n  return function (dispatch, getState) {\n    const query = getUpToDateQuery(getState(), queryEditor, queryEditor.id);\n    const table = {\n      dbId: query.dbId,\n      queryEditorId: query.id,\n      schema: schemaName,\n      name: tableName,\n    };\n    dispatch(\n      mergeTable(\n        {\n          ...table,\n          id: shortid.generate(),\n          expanded: true,\n        },\n        null,\n        true,\n      ),\n    );\n  };\n}\n\nexport function runTablePreviewQuery(newTable) {\n  return function (dispatch, getState) {\n    const {\n      sqlLab: { databases },\n    } = getState();\n    const database = databases[newTable.dbId];\n    const { dbId } = newTable;\n\n    if (database && !database.disable_data_preview) {\n      const dataPreviewQuery = {\n        id: shortid.generate(),\n        dbId,\n        sql: newTable.selectStar,\n        tableName: newTable.name,\n        sqlEditorId: null,\n        tab: '',\n        runAsync: database.allow_run_async,\n        ctas: false,\n        isDataPreview: true,\n      };\n      return Promise.all([\n        dispatch(\n          mergeTable(\n            {\n              id: newTable.id,\n              dbId: newTable.dbId,\n              schema: newTable.schema,\n              name: newTable.name,\n              queryEditorId: newTable.queryEditorId,\n              dataPreviewQueryId: dataPreviewQuery.id,\n            },\n            dataPreviewQuery,\n          ),\n        ),\n        dispatch(runQuery(dataPreviewQuery)),\n      ]);\n    }\n    return Promise.resolve();\n  };\n}\n\nexport function syncTable(table, tableMetadata) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI('/tableschemaview/'),\n          postPayload: { table: { ...tableMetadata, ...table } },\n        })\n      : Promise.resolve({ json: { id: table.id } });\n\n    return sync\n      .then(({ json: resultJson }) => {\n        const newTable = { ...table, id: resultJson.id };\n        dispatch(\n          mergeTable({\n            ...newTable,\n            expanded: true,\n            initialized: true,\n          }),\n        );\n        if (!table.dataPreviewQueryId) {\n          dispatch(runTablePreviewQuery({ ...tableMetadata, ...newTable }));\n        }\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while fetching table metadata. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function changeDataPreviewId(oldQueryId, newQuery) {\n  return { type: CHANGE_DATA_PREVIEW_ID, oldQueryId, newQuery };\n}\n\nexport function reFetchQueryResults(query) {\n  return function (dispatch) {\n    const newQuery = {\n      id: shortid.generate(),\n      dbId: query.dbId,\n      sql: query.sql,\n      tableName: query.tableName,\n      sqlEditorId: null,\n      tab: '',\n      runAsync: false,\n      ctas: false,\n      queryLimit: query.queryLimit,\n      isDataPreview: query.isDataPreview,\n    };\n    dispatch(runQuery(newQuery));\n    dispatch(changeDataPreviewId(query.id, newQuery));\n  };\n}\n\nexport function expandTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n          postPayload: { expanded: true },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: EXPAND_TABLE, table }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while expanding the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function collapseTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n          postPayload: { expanded: false },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: COLLAPSE_TABLE, table }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while collapsing the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeTables(tables) {\n  return function (dispatch) {\n    const tablesToRemove = tables?.filter(Boolean) ?? [];\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? Promise.all(\n          tablesToRemove.map(table =>\n            SupersetClient.delete({\n              endpoint: encodeURI(`/tableschemaview/${table.id}`),\n            }),\n          ),\n        )\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_TABLES, tables: tablesToRemove }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function refreshQueries(alteredQueries) {\n  return { type: REFRESH_QUERIES, alteredQueries };\n}\n\nexport function setUserOffline(offline) {\n  return { type: SET_USER_OFFLINE, offline };\n}\n\nexport function persistEditorHeight(queryEditor, northPercent, southPercent) {\n  return {\n    type: QUERY_EDITOR_PERSIST_HEIGHT,\n    queryEditor,\n    northPercent,\n    southPercent,\n  };\n}\n\nexport function popStoredQuery(urlId) {\n  return function (dispatch) {\n    return SupersetClient.get({ endpoint: `/kv/${urlId}` })\n      .then(({ json }) =>\n        dispatch(\n          addQueryEditor({\n            name: json.name ? json.name : t('Shared query'),\n            dbId: json.dbId ? parseInt(json.dbId, 10) : null,\n            schema: json.schema ? json.schema : null,\n            autorun: json.autorun ? json.autorun : false,\n            sql: json.sql ? json.sql : 'SELECT ...',\n            templateParams: json.templateParams,\n          }),\n        ),\n      )\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popSavedQuery(saveQueryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/savedqueryviewapi/api/get/${saveQueryId}`,\n    })\n      .then(({ json }) => {\n        const queryEditorProps = {\n          ...convertQueryToClient(json.result),\n          loaded: true,\n          autorun: false,\n        };\n        return dispatch(addQueryEditor(queryEditorProps));\n      })\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popQuery(queryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/query/${queryId}`,\n    })\n      .then(({ json }) => {\n        const queryData = json.result;\n        const queryEditorProps = {\n          dbId: queryData.database.id,\n          schema: queryData.schema,\n          sql: queryData.sql,\n          name: t('Copy of %s', queryData.tab_name),\n          autorun: false,\n        };\n        return dispatch(addQueryEditor(queryEditorProps));\n      })\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popDatasourceQuery(datasourceKey, sql) {\n  return function (dispatch) {\n    const QUERY_TEXT = t('Query');\n    const datasetId = datasourceKey.split('__')[0];\n    return SupersetClient.get({\n      endpoint: `/api/v1/dataset/${datasetId}?q=(keys:!(none))`,\n    })\n      .then(({ json }) =>\n        dispatch(\n          addQueryEditor({\n            name: `${QUERY_TEXT} ${json.result.name}`,\n            dbId: json.result.database.id,\n            schema: json.result.schema,\n            autorun: sql !== undefined,\n            sql: sql || json.result.select_star,\n          }),\n        ),\n      )\n      .catch(() =>\n        dispatch(addDangerToast(t(\"The datasource couldn't be loaded\"))),\n      );\n  };\n}\nexport function createDatasourceStarted() {\n  return { type: CREATE_DATASOURCE_STARTED };\n}\nexport function createDatasourceSuccess(data) {\n  const datasource = `${data.id}__table`;\n  return { type: CREATE_DATASOURCE_SUCCESS, datasource };\n}\nexport function createDatasourceFailed(err) {\n  return { type: CREATE_DATASOURCE_FAILED, err };\n}\n\nexport function createDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    const { dbId, schema, datasourceName, sql } = vizOptions;\n    return SupersetClient.post({\n      endpoint: '/api/v1/dataset/',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        database: dbId,\n        schema,\n        sql,\n        table_name: datasourceName,\n        is_managed_externally: false,\n        external_url: null,\n      }),\n    })\n      .then(({ json }) => {\n        dispatch(createDatasourceSuccess(json));\n\n        return Promise.resolve(json);\n      })\n      .catch(error => {\n        getClientErrorObject(error).then(e => {\n          dispatch(addDangerToast(e.error));\n        });\n        dispatch(\n          createDatasourceFailed(\n            t('An error occurred while creating the data source'),\n          ),\n        );\n\n        return Promise.reject();\n      });\n  };\n}\n\nexport function createCtasDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    return SupersetClient.post({\n      endpoint: '/api/v1/dataset/get_or_create/',\n      jsonPayload: vizOptions,\n    })\n      .then(({ json }) => {\n        dispatch(createDatasourceSuccess(json.result));\n\n        return json.result;\n      })\n      .catch(() => {\n        const errorMsg = t('An error occurred while creating the data source');\n        dispatch(createDatasourceFailed(errorMsg));\n        return Promise.reject(new Error(errorMsg));\n      });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint no-undef: 'error' */\n/* eslint no-param-reassign: [\"error\", { \"props\": false }] */\nimport moment from 'moment';\nimport { FeatureFlag, isDefined, SupersetClient, t } from '@superset-ui/core';\nimport { getControlsState } from 'src/explore/store';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport {\n  getAnnotationJsonUrl,\n  getExploreUrl,\n  getLegacyEndpointType,\n  buildV1ChartDataPayload,\n  getQuerySettings,\n  getChartDataUri,\n} from 'src/explore/exploreUtils';\nimport { requiresQuery } from 'src/modules/AnnotationTypes';\n\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { logEvent } from 'src/logger/actions';\nimport { Logger, LOG_ACTIONS_LOAD_CHART } from 'src/logger/LogUtils';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { allowCrossDomain as domainShardingEnabled } from 'src/utils/hostNamesConfig';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { waitForAsyncData } from 'src/middleware/asyncEvent';\n\nexport const CHART_UPDATE_STARTED = 'CHART_UPDATE_STARTED';\nexport function chartUpdateStarted(queryController, latestQueryFormData, key) {\n  return {\n    type: CHART_UPDATE_STARTED,\n    queryController,\n    latestQueryFormData,\n    key,\n  };\n}\n\nexport const CHART_UPDATE_SUCCEEDED = 'CHART_UPDATE_SUCCEEDED';\nexport function chartUpdateSucceeded(queriesResponse, key) {\n  return { type: CHART_UPDATE_SUCCEEDED, queriesResponse, key };\n}\n\nexport const CHART_UPDATE_STOPPED = 'CHART_UPDATE_STOPPED';\nexport function chartUpdateStopped(key) {\n  return { type: CHART_UPDATE_STOPPED, key };\n}\n\nexport const CHART_UPDATE_FAILED = 'CHART_UPDATE_FAILED';\nexport function chartUpdateFailed(queriesResponse, key) {\n  return { type: CHART_UPDATE_FAILED, queriesResponse, key };\n}\n\nexport const CHART_RENDERING_FAILED = 'CHART_RENDERING_FAILED';\nexport function chartRenderingFailed(error, key, stackTrace) {\n  return { type: CHART_RENDERING_FAILED, error, key, stackTrace };\n}\n\nexport const CHART_RENDERING_SUCCEEDED = 'CHART_RENDERING_SUCCEEDED';\nexport function chartRenderingSucceeded(key) {\n  return { type: CHART_RENDERING_SUCCEEDED, key };\n}\n\nexport const REMOVE_CHART = 'REMOVE_CHART';\nexport function removeChart(key) {\n  return { type: REMOVE_CHART, key };\n}\n\nexport const ANNOTATION_QUERY_SUCCESS = 'ANNOTATION_QUERY_SUCCESS';\nexport function annotationQuerySuccess(annotation, queryResponse, key) {\n  return { type: ANNOTATION_QUERY_SUCCESS, annotation, queryResponse, key };\n}\n\nexport const ANNOTATION_QUERY_STARTED = 'ANNOTATION_QUERY_STARTED';\nexport function annotationQueryStarted(annotation, queryController, key) {\n  return { type: ANNOTATION_QUERY_STARTED, annotation, queryController, key };\n}\n\nexport const ANNOTATION_QUERY_FAILED = 'ANNOTATION_QUERY_FAILED';\nexport function annotationQueryFailed(annotation, queryResponse, key) {\n  return { type: ANNOTATION_QUERY_FAILED, annotation, queryResponse, key };\n}\n\nexport const DYNAMIC_PLUGIN_CONTROLS_READY = 'DYNAMIC_PLUGIN_CONTROLS_READY';\nexport const dynamicPluginControlsReady = () => (dispatch, getState) => {\n  const state = getState();\n  const controlsState = getControlsState(\n    state.explore,\n    state.explore.form_data,\n  );\n  dispatch({\n    type: DYNAMIC_PLUGIN_CONTROLS_READY,\n    key: controlsState.slice_id.value,\n    controlsState,\n  });\n};\n\nconst legacyChartDataRequest = async (\n  formData,\n  resultFormat,\n  resultType,\n  force,\n  method = 'POST',\n  requestParams = {},\n  parseMethod,\n) => {\n  const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n  const allowDomainSharding =\n    // eslint-disable-next-line camelcase\n    domainShardingEnabled && requestParams?.dashboard_id;\n  const url = getExploreUrl({\n    formData,\n    endpointType,\n    force,\n    allowDomainSharding,\n    method,\n    requestParams: requestParams.dashboard_id\n      ? { dashboard_id: requestParams.dashboard_id }\n      : {},\n  });\n  const querySettings = {\n    ...requestParams,\n    url,\n    postPayload: { form_data: formData },\n    parseMethod,\n  };\n\n  const clientMethod =\n    'GET' && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)\n      ? SupersetClient.get\n      : SupersetClient.post;\n  return clientMethod(querySettings).then(({ json, response }) =>\n    // Make the legacy endpoint return a payload that corresponds to the\n    // V1 chart data endpoint response signature.\n    ({\n      response,\n      json: { result: [json] },\n    }),\n  );\n};\n\nconst v1ChartDataRequest = async (\n  formData,\n  resultFormat,\n  resultType,\n  force,\n  requestParams,\n  setDataMask,\n  ownState,\n  parseMethod,\n) => {\n  const payload = buildV1ChartDataPayload({\n    formData,\n    resultType,\n    resultFormat,\n    force,\n    setDataMask,\n    ownState,\n  });\n\n  // The dashboard id is added to query params for tracking purposes\n  const { slice_id: sliceId } = formData;\n  const { dashboard_id: dashboardId } = requestParams;\n\n  const qs = {};\n  if (sliceId !== undefined) qs.form_data = `{\"slice_id\":${sliceId}}`;\n  if (dashboardId !== undefined) qs.dashboard_id = dashboardId;\n  if (force !== false) qs.force = force;\n\n  const allowDomainSharding =\n    // eslint-disable-next-line camelcase\n    domainShardingEnabled && requestParams?.dashboard_id;\n  const url = getChartDataUri({\n    path: '/api/v1/chart/data',\n    qs,\n    allowDomainSharding,\n  }).toString();\n\n  const querySettings = {\n    ...requestParams,\n    url,\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(payload),\n    parseMethod,\n  };\n\n  return SupersetClient.post(querySettings);\n};\n\nexport async function getChartDataRequest({\n  formData,\n  setDataMask = () => {},\n  resultFormat = 'json',\n  resultType = 'full',\n  force = false,\n  method = 'POST',\n  requestParams = {},\n  ownState = {},\n}) {\n  let querySettings = {\n    ...requestParams,\n  };\n\n  if (domainShardingEnabled) {\n    querySettings = {\n      ...querySettings,\n      mode: 'cors',\n      credentials: 'include',\n    };\n  }\n\n  const [useLegacyApi, parseMethod] = getQuerySettings(formData);\n  if (useLegacyApi) {\n    return legacyChartDataRequest(\n      formData,\n      resultFormat,\n      resultType,\n      force,\n      method,\n      querySettings,\n      parseMethod,\n    );\n  }\n  return v1ChartDataRequest(\n    formData,\n    resultFormat,\n    resultType,\n    force,\n    querySettings,\n    setDataMask,\n    ownState,\n    parseMethod,\n  );\n}\n\nexport function runAnnotationQuery({\n  annotation,\n  timeout = 60,\n  formData = null,\n  key,\n  isDashboardRequest = false,\n  force = false,\n}) {\n  return function (dispatch, getState) {\n    const sliceKey = key || Object.keys(getState().charts)[0];\n    // make a copy of formData, not modifying original formData\n    const fd = {\n      ...(formData || getState().charts[sliceKey].latestQueryFormData),\n    };\n\n    if (!requiresQuery(annotation.sourceType)) {\n      return Promise.resolve();\n    }\n\n    const granularity = fd.time_grain_sqla || fd.granularity;\n    fd.time_grain_sqla = granularity;\n    fd.granularity = granularity;\n    const overridesKeys = Object.keys(annotation.overrides);\n    if (overridesKeys.includes('since') || overridesKeys.includes('until')) {\n      annotation.overrides = {\n        ...annotation.overrides,\n        time_range: null,\n      };\n    }\n    const sliceFormData = Object.keys(annotation.overrides).reduce(\n      (d, k) => ({\n        ...d,\n        [k]: annotation.overrides[k] || fd[k],\n      }),\n      {},\n    );\n\n    if (!isDashboardRequest && fd) {\n      const hasExtraFilters = fd.extra_filters && fd.extra_filters.length > 0;\n      sliceFormData.extra_filters = hasExtraFilters\n        ? fd.extra_filters\n        : undefined;\n    }\n\n    const url = getAnnotationJsonUrl(annotation.value, force);\n    const controller = new AbortController();\n    const { signal } = controller;\n\n    dispatch(annotationQueryStarted(annotation, controller, sliceKey));\n\n    const annotationIndex = fd?.annotation_layers?.findIndex(\n      it => it.name === annotation.name,\n    );\n    if (annotationIndex >= 0) {\n      fd.annotation_layers[annotationIndex].overrides = sliceFormData;\n    }\n\n    return SupersetClient.post({\n      url,\n      signal,\n      timeout: timeout * 1000,\n      headers: { 'Content-Type': 'application/json' },\n      jsonPayload: buildV1ChartDataPayload({\n        formData: fd,\n        force,\n        resultFormat: 'json',\n        resultType: 'full',\n      }),\n    })\n      .then(({ json }) => {\n        const data = json?.result?.[0]?.annotation_data?.[annotation.name];\n        return dispatch(annotationQuerySuccess(annotation, { data }, sliceKey));\n      })\n      .catch(response =>\n        getClientErrorObject(response).then(err => {\n          if (err.statusText === 'timeout') {\n            dispatch(\n              annotationQueryFailed(\n                annotation,\n                { error: 'Query timeout' },\n                sliceKey,\n              ),\n            );\n          } else if ((err.error || '').toLowerCase().includes('no data')) {\n            dispatch(annotationQuerySuccess(annotation, err, sliceKey));\n          } else if (err.statusText !== 'abort') {\n            dispatch(annotationQueryFailed(annotation, err, sliceKey));\n          }\n        }),\n      );\n  };\n}\n\nexport const TRIGGER_QUERY = 'TRIGGER_QUERY';\nexport function triggerQuery(value = true, key) {\n  return { type: TRIGGER_QUERY, value, key };\n}\n\n// this action is used for forced re-render without fetch data\nexport const RENDER_TRIGGERED = 'RENDER_TRIGGERED';\nexport function renderTriggered(value, key) {\n  return { type: RENDER_TRIGGERED, value, key };\n}\n\nexport const UPDATE_QUERY_FORM_DATA = 'UPDATE_QUERY_FORM_DATA';\nexport function updateQueryFormData(value, key) {\n  return { type: UPDATE_QUERY_FORM_DATA, value, key };\n}\n\n// in the sql lab -> explore flow, user can inline edit chart title,\n// then the chart will be assigned a new slice_id\nexport const UPDATE_CHART_ID = 'UPDATE_CHART_ID';\nexport function updateChartId(newId, key = 0) {\n  return { type: UPDATE_CHART_ID, newId, key };\n}\n\nexport const ADD_CHART = 'ADD_CHART';\nexport function addChart(chart, key) {\n  return { type: ADD_CHART, chart, key };\n}\n\nexport function exploreJSON(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  method,\n  dashboardId,\n  ownState,\n) {\n  return async dispatch => {\n    const logStart = Logger.getTimestamp();\n    const controller = new AbortController();\n\n    const requestParams = {\n      signal: controller.signal,\n      timeout: timeout * 1000,\n    };\n    if (dashboardId) requestParams.dashboard_id = dashboardId;\n\n    const setDataMask = dataMask => {\n      dispatch(updateDataMask(formData.slice_id, dataMask));\n    };\n    const chartDataRequest = getChartDataRequest({\n      setDataMask,\n      formData,\n      resultFormat: 'json',\n      resultType: 'full',\n      force,\n      method,\n      requestParams,\n      ownState,\n    });\n\n    dispatch(chartUpdateStarted(controller, formData, key));\n\n    const chartDataRequestCaught = chartDataRequest\n      .then(({ response, json }) => {\n        if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n          // deal with getChartDataRequest transforming the response data\n          const result = 'result' in json ? json.result : json;\n          const [useLegacyApi] = getQuerySettings(formData);\n          switch (response.status) {\n            case 200:\n              // Query results returned synchronously, meaning query was already cached.\n              return Promise.resolve(result);\n            case 202:\n              // Query is running asynchronously and we must await the results\n              if (useLegacyApi) {\n                return waitForAsyncData(result[0]);\n              }\n              return waitForAsyncData(result);\n            default:\n              throw new Error(\n                `Received unexpected response status (${response.status}) while fetching chart data`,\n              );\n          }\n        }\n\n        return json.result;\n      })\n      .then(queriesResponse => {\n        queriesResponse.forEach(resultItem =>\n          dispatch(\n            logEvent(LOG_ACTIONS_LOAD_CHART, {\n              slice_id: key,\n              applied_filters: resultItem.applied_filters,\n              is_cached: resultItem.is_cached,\n              force_refresh: force,\n              row_count: resultItem.rowcount,\n              datasource: formData.datasource,\n              start_offset: logStart,\n              ts: new Date().getTime(),\n              duration: Logger.getTimestamp() - logStart,\n              has_extra_filters:\n                formData.extra_filters && formData.extra_filters.length > 0,\n              viz_type: formData.viz_type,\n              data_age: resultItem.is_cached\n                ? moment(new Date()).diff(moment.utc(resultItem.cached_dttm))\n                : null,\n            }),\n          ),\n        );\n        return dispatch(chartUpdateSucceeded(queriesResponse, key));\n      })\n      .catch(response => {\n        if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n          return dispatch(chartUpdateFailed([response], key));\n        }\n\n        const appendErrorLog = (errorDetails, isCached) => {\n          dispatch(\n            logEvent(LOG_ACTIONS_LOAD_CHART, {\n              slice_id: key,\n              has_err: true,\n              is_cached: isCached,\n              error_details: errorDetails,\n              datasource: formData.datasource,\n              start_offset: logStart,\n              ts: new Date().getTime(),\n              duration: Logger.getTimestamp() - logStart,\n            }),\n          );\n        };\n        if (response.name === 'AbortError') {\n          appendErrorLog('abort');\n          return dispatch(chartUpdateStopped(key));\n        }\n        return getClientErrorObject(response).then(parsedResponse => {\n          if (response.statusText === 'timeout') {\n            appendErrorLog('timeout');\n          } else {\n            appendErrorLog(parsedResponse.error, parsedResponse.is_cached);\n          }\n          return dispatch(chartUpdateFailed([parsedResponse], key));\n        });\n      });\n\n    // only retrieve annotations when calling the legacy API\n    const [useLegacyApi] = getQuerySettings(formData);\n    const annotationLayers = useLegacyApi\n      ? formData.annotation_layers || []\n      : [];\n    const isDashboardRequest = dashboardId > 0;\n\n    return Promise.all([\n      chartDataRequestCaught,\n      dispatch(triggerQuery(false, key)),\n      dispatch(updateQueryFormData(formData, key)),\n      ...annotationLayers.map(annotation =>\n        dispatch(\n          runAnnotationQuery({\n            annotation,\n            timeout,\n            formData,\n            key,\n            isDashboardRequest,\n            force,\n          }),\n        ),\n      ),\n    ]);\n  };\n}\n\nexport const GET_SAVED_CHART = 'GET_SAVED_CHART';\nexport function getSavedChart(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  dashboardId,\n  ownState,\n) {\n  /*\n   * Perform a GET request to `/explore_json`.\n   *\n   * This will return the payload of a saved chart, optionally filtered by\n   * ad-hoc or extra filters from dashboards. Eg:\n   *\n   *  GET  /explore_json?{\"chart_id\":1}\n   *  GET  /explore_json?{\"chart_id\":1,\"extra_filters\":\"...\"}\n   *\n   */\n  return exploreJSON(\n    formData,\n    force,\n    timeout,\n    key,\n    'GET',\n    dashboardId,\n    ownState,\n  );\n}\n\nexport const POST_CHART_FORM_DATA = 'POST_CHART_FORM_DATA';\nexport function postChartFormData(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  dashboardId,\n  ownState,\n) {\n  /*\n   * Perform a POST request to `/explore_json`.\n   *\n   * This will post the form data to the endpoint, returning a new chart.\n   *\n   */\n  return exploreJSON(\n    formData,\n    force,\n    timeout,\n    key,\n    'POST',\n    dashboardId,\n    ownState,\n  );\n}\n\nexport function redirectSQLLab(formData) {\n  return dispatch => {\n    getChartDataRequest({ formData, resultFormat: 'json', resultType: 'query' })\n      .then(({ json }) => {\n        const redirectUrl = '/superset/sqllab/';\n        const payload = {\n          datasourceKey: formData.datasource,\n          sql: json.result[0].query,\n        };\n        SupersetClient.postForm(redirectUrl, {\n          form_data: safeStringify(payload),\n        });\n      })\n      .catch(() =>\n        dispatch(addDangerToast(t('An error occurred while loading the SQL'))),\n      );\n  };\n}\n\nexport function refreshChart(chartKey, force, dashboardId) {\n  return (dispatch, getState) => {\n    const chart = (getState().charts || {})[chartKey];\n    const timeout =\n      getState().dashboardInfo.common.conf.SUPERSET_WEBSERVER_TIMEOUT;\n\n    if (\n      !chart.latestQueryFormData ||\n      Object.keys(chart.latestQueryFormData).length === 0\n    ) {\n      return;\n    }\n    dispatch(\n      postChartFormData(\n        chart.latestQueryFormData,\n        force,\n        timeout,\n        chart.id,\n        dashboardId,\n        getState().dataMask[chart.id]?.ownState,\n      ),\n    );\n  };\n}\n\nexport const getDatasourceSamples = async (\n  datasourceType,\n  datasourceId,\n  force,\n  jsonPayload,\n  perPage,\n  page,\n) => {\n  try {\n    const searchParams = {\n      force,\n      datasource_type: datasourceType,\n      datasource_id: datasourceId,\n    };\n\n    if (isDefined(perPage) && isDefined(page)) {\n      searchParams.per_page = perPage;\n      searchParams.page = page;\n    }\n\n    const response = await SupersetClient.post({\n      endpoint: '/datasource/samples',\n      jsonPayload,\n      searchParams,\n    });\n\n    return response.json.result;\n  } catch (err) {\n    const clientError = await getClientErrorObject(err);\n    throw new Error(\n      clientError.message || clientError.error || t('Sorry, an error occurred'),\n      { cause: err },\n    );\n  }\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\n\nconst propTypes = {\n  children: PropTypes.node.isRequired,\n  onError: PropTypes.func,\n  showMessage: PropTypes.bool,\n};\nconst defaultProps = {\n  onError: () => {},\n  showMessage: true,\n};\n\nexport default class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { error: null, info: null };\n  }\n\n  componentDidCatch(error, info) {\n    if (this.props.onError) this.props.onError(error, info);\n    this.setState({ error, info });\n  }\n\n  render() {\n    const { error, info } = this.state;\n    if (error) {\n      const firstLine = error.toString();\n      const message = (\n        <span>\n          <strong>{t('Unexpected error')}</strong>\n          {firstLine ? `: ${firstLine}` : ''}\n        </span>\n      );\n      if (this.props.showMessage) {\n        return (\n          <ErrorMessageWithStackTrace\n            subtitle={message}\n            copyText={message}\n            stackTrace={info ? info.componentStack : null}\n          />\n        );\n      }\n      return null;\n    }\n    return this.props.children;\n  }\n}\nErrorBoundary.propTypes = propTypes;\nErrorBoundary.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\n// util function to make sure filter is a valid slice in current dashboard\nfunction isValidFilter(getState, chartId) {\n  return getState().dashboardState.sliceIds.includes(chartId);\n}\n\nexport const ADD_FILTER = 'ADD_FILTER';\nexport function addFilter(chartId, component, form_data) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: ADD_FILTER, chartId, component, form_data });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const REMOVE_FILTER = 'REMOVE_FILTER';\nexport function removeFilter(chartId) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: REMOVE_FILTER, chartId });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const CHANGE_FILTER = 'CHANGE_FILTER';\nexport function changeFilter(chartId, newSelectedValues, merge) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      const components = getState().dashboardLayout.present;\n      return dispatch({\n        type: CHANGE_FILTER,\n        chartId,\n        newSelectedValues,\n        merge,\n        components,\n      });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const UPDATE_DIRECT_PATH_TO_FILTER = 'UPDATE_DIRECT_PATH_TO_FILTER';\nexport function updateDirectPathToFilter(chartId, path) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: UPDATE_DIRECT_PATH_TO_FILTER, chartId, path });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const UPDATE_LAYOUT_COMPONENTS = 'UPDATE_LAYOUT_COMPONENTS';\nexport function updateLayoutComponents(components) {\n  return dispatch => {\n    dispatch({ type: UPDATE_LAYOUT_COMPONENTS, components });\n  };\n}\n\nexport const UPDATE_DASHBOARD_FILTERS_SCOPE = 'UPDATE_DASHBOARD_FILTERS_SCOPE';\nexport function updateDashboardFiltersScope(scopes) {\n  return dispatch => {\n    dispatch({ type: UPDATE_DASHBOARD_FILTERS_SCOPE, scopes });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport { t } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\nimport { TABS_TYPE, ROW_TYPE } from 'src/dashboard/util/componentTypes';\nimport {\n  DASHBOARD_ROOT_ID,\n  NEW_COMPONENTS_SOURCE_ID,\n  DASHBOARD_HEADER_ID,\n} from 'src/dashboard/util/constants';\nimport dropOverflowsParent from 'src/dashboard/util/dropOverflowsParent';\nimport findParentId from 'src/dashboard/util/findParentId';\nimport isInDifferentFilterScopes from 'src/dashboard/util/isInDifferentFilterScopes';\nimport { updateLayoutComponents } from './dashboardFilters';\nimport { setUnsavedChanges } from './dashboardState';\n\n// Component CRUD -------------------------------------------------------------\nexport const UPDATE_COMPONENTS = 'UPDATE_COMPONENTS';\n\n// this is a helper that takes an action as input and dispatches\n// an additional setUnsavedChanges(true) action after the dispatch in the case\n// that dashboardState.hasUnsavedChanges is false.\nfunction setUnsavedChangesAfterAction(action) {\n  return (...args) =>\n    (dispatch, getState) => {\n      const result = action(...args);\n      if (typeof result === 'function') {\n        dispatch(result(dispatch, getState));\n      } else {\n        dispatch(result);\n      }\n\n      const { dashboardLayout, dashboardState } = getState();\n\n      const isComponentLevelEvent =\n        result.type === UPDATE_COMPONENTS &&\n        result.payload &&\n        result.payload.nextComponents;\n      // trigger dashboardFilters state update if dashboard layout is changed.\n      if (!isComponentLevelEvent) {\n        const components = dashboardLayout.present;\n        dispatch(updateLayoutComponents(components));\n      }\n\n      if (!dashboardState.hasUnsavedChanges) {\n        dispatch(setUnsavedChanges(true));\n      }\n    };\n}\n\nexport const updateComponents = setUnsavedChangesAfterAction(\n  nextComponents => ({\n    type: UPDATE_COMPONENTS,\n    payload: {\n      nextComponents,\n    },\n  }),\n);\n\nexport function updateDashboardTitle(text) {\n  return (dispatch, getState) => {\n    const { dashboardLayout } = getState();\n    dispatch(\n      updateComponents({\n        [DASHBOARD_HEADER_ID]: {\n          ...dashboardLayout.present[DASHBOARD_HEADER_ID],\n          meta: {\n            text,\n          },\n        },\n      }),\n    );\n  };\n}\n\nexport const DASHBOARD_TITLE_CHANGED = 'DASHBOARD_TITLE_CHANGED';\n\n// call this one when it's not an undo-able action\nexport function dashboardTitleChanged(text) {\n  return {\n    type: DASHBOARD_TITLE_CHANGED,\n    text,\n  };\n}\n\nexport const DELETE_COMPONENT = 'DELETE_COMPONENT';\nexport const deleteComponent = setUnsavedChangesAfterAction((id, parentId) => ({\n  type: DELETE_COMPONENT,\n  payload: {\n    id,\n    parentId,\n  },\n}));\n\nexport const CREATE_COMPONENT = 'CREATE_COMPONENT';\nexport const createComponent = setUnsavedChangesAfterAction(dropResult => ({\n  type: CREATE_COMPONENT,\n  payload: {\n    dropResult,\n  },\n}));\n\n// Tabs -----------------------------------------------------------------------\nexport const CREATE_TOP_LEVEL_TABS = 'CREATE_TOP_LEVEL_TABS';\nexport const createTopLevelTabs = setUnsavedChangesAfterAction(dropResult => ({\n  type: CREATE_TOP_LEVEL_TABS,\n  payload: {\n    dropResult,\n  },\n}));\n\nexport const DELETE_TOP_LEVEL_TABS = 'DELETE_TOP_LEVEL_TABS';\nexport const deleteTopLevelTabs = setUnsavedChangesAfterAction(() => ({\n  type: DELETE_TOP_LEVEL_TABS,\n  payload: {},\n}));\n\n// Resize ---------------------------------------------------------------------\nexport const RESIZE_COMPONENT = 'RESIZE_COMPONENT';\nexport function resizeComponent({ id, width, height }) {\n  return (dispatch, getState) => {\n    const { dashboardLayout: undoableLayout } = getState();\n    const { present: dashboard } = undoableLayout;\n    const component = dashboard[id];\n    const widthChanged = width && component.meta.width !== width;\n    const heightChanged = height && component.meta.height !== height;\n    if (component && (widthChanged || heightChanged)) {\n      // update the size of this component\n      const updatedComponents = {\n        [id]: {\n          ...component,\n          meta: {\n            ...component.meta,\n            width: width || component.meta.width,\n            height: height || component.meta.height,\n          },\n        },\n      };\n\n      dispatch(updateComponents(updatedComponents));\n    }\n  };\n}\n\n// Drag and drop --------------------------------------------------------------\nexport const MOVE_COMPONENT = 'MOVE_COMPONENT';\nconst moveComponent = setUnsavedChangesAfterAction(dropResult => ({\n  type: MOVE_COMPONENT,\n  payload: {\n    dropResult,\n  },\n}));\n\nexport const HANDLE_COMPONENT_DROP = 'HANDLE_COMPONENT_DROP';\nexport function handleComponentDrop(dropResult) {\n  return (dispatch, getState) => {\n    const overflowsParent = dropOverflowsParent(\n      dropResult,\n      getState().dashboardLayout.present,\n    );\n\n    if (overflowsParent) {\n      return dispatch(\n        addWarningToast(\n          t(\n            `There is not enough space for this component. Try decreasing its width, or increasing the destination width.`,\n          ),\n        ),\n      );\n    }\n\n    const { source, destination } = dropResult;\n    const droppedOnRoot = destination && destination.id === DASHBOARD_ROOT_ID;\n    const isNewComponent = source.id === NEW_COMPONENTS_SOURCE_ID;\n    const dashboardRoot = getState().dashboardLayout.present[DASHBOARD_ROOT_ID];\n    const rootChildId =\n      dashboardRoot && dashboardRoot.children ? dashboardRoot.children[0] : '';\n\n    if (droppedOnRoot) {\n      dispatch(createTopLevelTabs(dropResult));\n    } else if (destination && isNewComponent) {\n      dispatch(createComponent(dropResult));\n    } else if (\n      // Add additional allow-to-drop logic for tag/tags source.\n      // We only allow\n      // - top-level tab => top-level tab: rearrange top-level tab order\n      // - nested tab => top-level tab: allow row tab become top-level tab\n      // Dashboard does not allow top-level tab become nested tab, to avoid\n      // nested tab inside nested tab.\n      source.type === TABS_TYPE &&\n      destination.type === TABS_TYPE &&\n      source.id === rootChildId &&\n      destination.id !== rootChildId\n    ) {\n      return dispatch(\n        addWarningToast(t('Can not move top level tab into nested tabs')),\n      );\n    } else if (\n      destination &&\n      source &&\n      !(\n        // ensure it has moved\n        (destination.id === source.id && destination.index === source.index)\n      )\n    ) {\n      dispatch(moveComponent(dropResult));\n    }\n\n    // call getState() again down here in case redux state is stale after\n    // previous dispatch(es)\n    const { dashboardFilters, dashboardLayout: undoableLayout } = getState();\n\n    // if we moved a child from a Tab or Row parent and it was the only child, delete the parent.\n    if (!isNewComponent) {\n      const { present: layout } = undoableLayout;\n      const sourceComponent = layout[source.id] || {};\n      const destinationComponent = layout[destination.id] || {};\n      if (\n        (sourceComponent.type === TABS_TYPE ||\n          sourceComponent.type === ROW_TYPE) &&\n        sourceComponent.children &&\n        sourceComponent.children.length === 0\n      ) {\n        const parentId = findParentId({\n          childId: source.id,\n          layout,\n        });\n        dispatch(deleteComponent(source.id, parentId));\n      }\n\n      // show warning if item has been moved between different scope\n      if (\n        isInDifferentFilterScopes({\n          dashboardFilters,\n          source: (sourceComponent.parents || []).concat(source.id),\n          destination: (destinationComponent.parents || []).concat(\n            destination.id,\n          ),\n        })\n      ) {\n        dispatch(\n          addWarningToast(\n            t('This chart has been moved to a different filter scope.'),\n          ),\n        );\n      }\n    }\n\n    return null;\n  };\n}\n\n// Undo redo ------------------------------------------------------------------\nexport function undoLayoutAction() {\n  return (dispatch, getState) => {\n    dispatch(UndoActionCreators.undo());\n\n    const { dashboardLayout, dashboardState } = getState();\n\n    if (\n      dashboardLayout.past.length === 0 &&\n      !dashboardState.maxUndoHistoryExceeded &&\n      !dashboardState.updatedColorScheme\n    ) {\n      dispatch(setUnsavedChanges(false));\n    }\n  };\n}\n\nexport const redoLayoutAction = setUnsavedChangesAfterAction(\n  UndoActionCreators.redo,\n);\n\n// Update component parents list ----------------------------------------------\nexport const UPDATE_COMPONENTS_PARENTS_LIST = 'UPDATE_COMPONENTS_PARENTS_LIST';\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport getComponentWidthFromDrop from './getComponentWidthFromDrop';\n\nexport default function doesChildOverflowParent(dropResult, layout) {\n  const childWidth = getComponentWidthFromDrop({ dropResult, layout });\n  return typeof childWidth === 'number' && childWidth < 0;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function isInDifferentFilterScopes({\n  dashboardFilters = {},\n  source = [],\n  destination = [],\n}) {\n  const sourceSet = new Set(source);\n  const destinationSet = new Set(destination);\n\n  const allScopes = [].concat(\n    ...Object.values(dashboardFilters).map(({ scopes }) =>\n      [].concat(...Object.values(scopes).map(({ scope }) => scope)),\n    ),\n  );\n  return allScopes.some(tab => destinationSet.has(tab) !== sourceSet.has(tab));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { JsonObject } from '@superset-ui/core';\nimport { OVERWRITE_INSPECT_FIELDS } from 'src/dashboard/constants';\n\nconst JSON_KEYS = new Set(['json_metadata', 'position_json']);\n\nfunction extractValue(object: JsonObject, keyPath: string) {\n  return keyPath.split('.').reduce((obj: JsonObject, key: string) => {\n    const value = obj?.[key];\n    return JSON_KEYS.has(key) && value ? JSON.parse(value) : value;\n  }, object);\n}\n\nexport default function getOverwriteItems(prev: JsonObject, next: JsonObject) {\n  return OVERWRITE_INSPECT_FIELDS.map(keyPath => ({\n    keyPath,\n    ...(keyPath.split('.').find(key => JSON_KEYS.has(key))\n      ? {\n          oldValue:\n            JSON.stringify(extractValue(prev, keyPath), null, 2) || '{}',\n          newValue:\n            JSON.stringify(extractValue(next, keyPath), null, 2) || '{}',\n        }\n      : {\n          oldValue: extractValue(prev, keyPath) || '',\n          newValue: extractValue(next, keyPath) || '',\n        }),\n  })).filter(({ oldValue, newValue }) => oldValue !== newValue);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport rison from 'rison';\nimport {\n  ensureIsArray,\n  FeatureFlag,\n  getSharedLabelColor,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport {\n  addChart,\n  removeChart,\n  refreshChart,\n} from 'src/components/Chart/chartAction';\nimport { chart as initChart } from 'src/components/Chart/chartReducer';\nimport { applyDefaultFormData } from 'src/explore/store';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport {\n  SAVE_TYPE_OVERWRITE,\n  SAVE_TYPE_OVERWRITE_CONFIRMED,\n} from 'src/dashboard/util/constants';\nimport {\n  getCrossFiltersConfiguration,\n  isCrossFiltersEnabled,\n} from 'src/dashboard/util/crossFilters';\nimport {\n  addSuccessToast,\n  addWarningToast,\n  addDangerToast,\n} from 'src/components/MessageToasts/actions';\nimport serializeActiveFilterValues from 'src/dashboard/util/serializeActiveFilterValues';\nimport serializeFilterScopes from 'src/dashboard/util/serializeFilterScopes';\nimport { getActiveFilters } from 'src/dashboard/util/activeDashboardFilters';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { logEvent } from 'src/logger/actions';\nimport { LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA } from 'src/logger/LogUtils';\nimport { UPDATE_COMPONENTS_PARENTS_LIST } from './dashboardLayout';\nimport {\n  saveChartConfiguration,\n  dashboardInfoChanged,\n  SAVE_CHART_CONFIG_COMPLETE,\n} from './dashboardInfo';\nimport { fetchDatasourceMetadata } from './datasources';\nimport {\n  addFilter,\n  removeFilter,\n  updateDirectPathToFilter,\n} from './dashboardFilters';\nimport { SET_FILTER_CONFIG_COMPLETE } from './nativeFilters';\nimport getOverwriteItems from '../util/getOverwriteItems';\n\nexport const SET_UNSAVED_CHANGES = 'SET_UNSAVED_CHANGES';\nexport function setUnsavedChanges(hasUnsavedChanges) {\n  return { type: SET_UNSAVED_CHANGES, payload: { hasUnsavedChanges } };\n}\n\nexport const ADD_SLICE = 'ADD_SLICE';\nexport function addSlice(slice) {\n  return { type: ADD_SLICE, slice };\n}\n\nexport const REMOVE_SLICE = 'REMOVE_SLICE';\nexport function removeSlice(sliceId) {\n  return { type: REMOVE_SLICE, sliceId };\n}\n\nexport const TOGGLE_FAVE_STAR = 'TOGGLE_FAVE_STAR';\nexport function toggleFaveStar(isStarred) {\n  return { type: TOGGLE_FAVE_STAR, isStarred };\n}\n\nexport function fetchFaveStar(id) {\n  return function fetchFaveStarThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/dashboard/favorite_status/?q=${rison.encode([id])}`,\n    })\n      .then(({ json }) => {\n        dispatch(toggleFaveStar(!!json?.result?.[0]?.value));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'There was an issue fetching the favorite status of this dashboard.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function saveFaveStar(id, isStarred) {\n  return function saveFaveStarThunk(dispatch) {\n    const endpoint = `/api/v1/dashboard/${id}/favorites/`;\n    const apiCall = isStarred\n      ? SupersetClient.delete({\n          endpoint,\n        })\n      : SupersetClient.post({ endpoint });\n\n    return apiCall\n      .then(() => {\n        dispatch(toggleFaveStar(!isStarred));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(t('There was an issue favoriting this dashboard.')),\n        ),\n      );\n  };\n}\n\nexport const TOGGLE_PUBLISHED = 'TOGGLE_PUBLISHED';\nexport function togglePublished(isPublished) {\n  return { type: TOGGLE_PUBLISHED, isPublished };\n}\n\nexport function savePublished(id, isPublished) {\n  return function savePublishedThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: `/api/v1/dashboard/${id}`,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        published: isPublished,\n      }),\n    })\n      .then(() => {\n        dispatch(\n          addSuccessToast(\n            isPublished\n              ? t('This dashboard is now published')\n              : t('This dashboard is now hidden'),\n          ),\n        );\n        dispatch(togglePublished(isPublished));\n      })\n      .catch(() => {\n        dispatch(\n          addDangerToast(\n            t('You do not have permissions to edit this dashboard.'),\n          ),\n        );\n      });\n  };\n}\n\nexport const TOGGLE_EXPAND_SLICE = 'TOGGLE_EXPAND_SLICE';\nexport function toggleExpandSlice(sliceId) {\n  return { type: TOGGLE_EXPAND_SLICE, sliceId };\n}\n\nexport const UPDATE_CSS = 'UPDATE_CSS';\nexport function updateCss(css) {\n  return { type: UPDATE_CSS, css };\n}\n\nexport const SET_EDIT_MODE = 'SET_EDIT_MODE';\nexport function setEditMode(editMode) {\n  return { type: SET_EDIT_MODE, editMode };\n}\n\nexport const ON_CHANGE = 'ON_CHANGE';\nexport function onChange() {\n  return { type: ON_CHANGE };\n}\n\nexport const ON_SAVE = 'ON_SAVE';\nexport function onSave(lastModifiedTime) {\n  return { type: ON_SAVE, lastModifiedTime };\n}\n\nexport const SET_REFRESH_FREQUENCY = 'SET_REFRESH_FREQUENCY';\nexport function setRefreshFrequency(refreshFrequency, isPersistent = false) {\n  return { type: SET_REFRESH_FREQUENCY, refreshFrequency, isPersistent };\n}\n\nexport function saveDashboardRequestSuccess(lastModifiedTime) {\n  return dispatch => {\n    dispatch(onSave(lastModifiedTime));\n    // clear layout undo history\n    dispatch(UndoActionCreators.clearHistory());\n  };\n}\n\nexport const SET_OVERRIDE_CONFIRM = 'SET_OVERRIDE_CONFIRM';\nexport function setOverrideConfirm(overwriteConfirmMetadata) {\n  return {\n    type: SET_OVERRIDE_CONFIRM,\n    overwriteConfirmMetadata,\n  };\n}\n\nexport const SAVE_DASHBOARD_STARTED = 'SAVE_DASHBOARD_STARTED';\nexport function saveDashboardStarted() {\n  return { type: SAVE_DASHBOARD_STARTED };\n}\n\nexport const SAVE_DASHBOARD_FINISHED = 'SAVE_DASHBOARD_FINISHED';\nexport function saveDashboardFinished() {\n  return { type: SAVE_DASHBOARD_FINISHED };\n}\n\nexport function saveDashboardRequest(data, id, saveType) {\n  return (dispatch, getState) => {\n    dispatch({ type: UPDATE_COMPONENTS_PARENTS_LIST });\n    dispatch(saveDashboardStarted());\n\n    const { dashboardFilters, dashboardLayout } = getState();\n    const layout = dashboardLayout.present;\n    Object.values(dashboardFilters).forEach(filter => {\n      const { chartId } = filter;\n      const componentId = filter.directPathToFilter.slice().pop();\n      const directPathToFilter = (layout[componentId]?.parents || []).slice();\n      directPathToFilter.push(componentId);\n      dispatch(updateDirectPathToFilter(chartId, directPathToFilter));\n    });\n    // serialize selected values for each filter field, grouped by filter id\n    const serializedFilters = serializeActiveFilterValues(getActiveFilters());\n    // serialize filter scope for each filter field, grouped by filter id\n    const serializedFilterScopes = serializeFilterScopes(dashboardFilters);\n    const {\n      certified_by,\n      certification_details,\n      css,\n      dashboard_title,\n      owners,\n      roles,\n      slug,\n    } = data;\n\n    const hasId = item => item.id !== undefined;\n    const metadataCrossFiltersEnabled = data.metadata?.cross_filters_enabled;\n    // making sure the data is what the backend expects\n    const cleanedData = {\n      ...data,\n      certified_by: certified_by || '',\n      certification_details:\n        certified_by && certification_details ? certification_details : '',\n      css: css || '',\n      dashboard_title: dashboard_title || t('[ untitled dashboard ]'),\n      owners: ensureIsArray(owners).map(o => (hasId(o) ? o.id : o)),\n      roles: !isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)\n        ? undefined\n        : ensureIsArray(roles).map(r => (hasId(r) ? r.id : r)),\n      slug: slug || null,\n      metadata: {\n        ...data.metadata,\n        color_namespace: data.metadata?.color_namespace || undefined,\n        color_scheme: data.metadata?.color_scheme || '',\n        color_scheme_domain: data.metadata?.color_scheme_domain || [],\n        expanded_slices: data.metadata?.expanded_slices || {},\n        label_colors: data.metadata?.label_colors || {},\n        shared_label_colors: data.metadata?.shared_label_colors || {},\n        refresh_frequency: data.metadata?.refresh_frequency || 0,\n        timed_refresh_immune_slices:\n          data.metadata?.timed_refresh_immune_slices || [],\n        // cross-filters should be enabled by default\n        cross_filters_enabled: isCrossFiltersEnabled(\n          metadataCrossFiltersEnabled,\n        ),\n      },\n    };\n\n    const handleChartConfiguration = () => {\n      const {\n        dashboardLayout,\n        charts,\n        dashboardInfo: { metadata },\n      } = getState();\n      return getCrossFiltersConfiguration(\n        dashboardLayout.present,\n        metadata,\n        charts,\n      );\n    };\n\n    const onCopySuccess = response => {\n      const lastModifiedTime = response.json.result.last_modified_time;\n      if (lastModifiedTime) {\n        dispatch(saveDashboardRequestSuccess(lastModifiedTime));\n      }\n      if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n        const { chartConfiguration, globalChartConfiguration } =\n          handleChartConfiguration();\n        dispatch(\n          saveChartConfiguration({\n            chartConfiguration,\n            globalChartConfiguration,\n          }),\n        );\n      }\n      dispatch(saveDashboardFinished());\n      dispatch(addSuccessToast(t('This dashboard was saved successfully.')));\n      return response;\n    };\n\n    const onUpdateSuccess = response => {\n      const updatedDashboard = response.json.result;\n      const lastModifiedTime = response.json.last_modified_time;\n      // syncing with the backend transformations of the metadata\n      if (updatedDashboard.json_metadata) {\n        const metadata = JSON.parse(updatedDashboard.json_metadata);\n        dispatch(\n          dashboardInfoChanged({\n            metadata,\n          }),\n        );\n        if (metadata.chart_configuration) {\n          dispatch({\n            type: SAVE_CHART_CONFIG_COMPLETE,\n            chartConfiguration: metadata.chart_configuration,\n          });\n        }\n        if (metadata.native_filter_configuration) {\n          dispatch({\n            type: SET_FILTER_CONFIG_COMPLETE,\n            filterConfig: metadata.native_filter_configuration,\n          });\n        }\n      }\n      if (lastModifiedTime) {\n        dispatch(saveDashboardRequestSuccess(lastModifiedTime));\n      }\n      dispatch(saveDashboardFinished());\n      // redirect to the new slug or id\n      window.history.pushState(\n        { event: 'dashboard_properties_changed' },\n        '',\n        `/superset/dashboard/${slug || id}/`,\n      );\n\n      dispatch(addSuccessToast(t('This dashboard was saved successfully.')));\n      dispatch(setOverrideConfirm(undefined));\n      return response;\n    };\n\n    const onError = async response => {\n      const { error, message } = await getClientErrorObject(response);\n      let errorText = t('Sorry, an unknown error occurred');\n\n      if (error) {\n        errorText = t(\n          'Sorry, there was an error saving this dashboard: %s',\n          error,\n        );\n      }\n      if (typeof message === 'string' && message === 'Forbidden') {\n        errorText = t('You do not have permission to edit this dashboard');\n      }\n      dispatch(saveDashboardFinished());\n      dispatch(addDangerToast(errorText));\n    };\n\n    if (\n      [SAVE_TYPE_OVERWRITE, SAVE_TYPE_OVERWRITE_CONFIRMED].includes(saveType)\n    ) {\n      let chartConfiguration = {};\n      let globalChartConfiguration = {};\n      if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n        ({ chartConfiguration, globalChartConfiguration } =\n          handleChartConfiguration());\n      }\n      const updatedDashboard =\n        saveType === SAVE_TYPE_OVERWRITE_CONFIRMED\n          ? data\n          : {\n              certified_by: cleanedData.certified_by,\n              certification_details: cleanedData.certification_details,\n              css: cleanedData.css,\n              dashboard_title: cleanedData.dashboard_title,\n              slug: cleanedData.slug,\n              owners: cleanedData.owners,\n              roles: cleanedData.roles,\n              json_metadata: safeStringify({\n                ...(cleanedData?.metadata || {}),\n                default_filters: safeStringify(serializedFilters),\n                filter_scopes: serializedFilterScopes,\n                chart_configuration: chartConfiguration,\n                global_chart_configuration: globalChartConfiguration,\n              }),\n            };\n\n      const updateDashboard = () =>\n        SupersetClient.put({\n          endpoint: `/api/v1/dashboard/${id}`,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(updatedDashboard),\n        })\n          .then(response => onUpdateSuccess(response))\n          .catch(response => onError(response));\n      return new Promise((resolve, reject) => {\n        if (\n          !isFeatureEnabled(FeatureFlag.CONFIRM_DASHBOARD_DIFF) ||\n          saveType === SAVE_TYPE_OVERWRITE_CONFIRMED\n        ) {\n          // skip overwrite precheck\n          resolve();\n          return;\n        }\n\n        // precheck for overwrite items\n        SupersetClient.get({\n          endpoint: `/api/v1/dashboard/${id}`,\n        }).then(response => {\n          const dashboard = response.json.result;\n          const overwriteConfirmItems = getOverwriteItems(\n            dashboard,\n            updatedDashboard,\n          );\n          if (overwriteConfirmItems.length > 0) {\n            dispatch(\n              setOverrideConfirm({\n                updatedAt: dashboard.changed_on,\n                updatedBy: dashboard.changed_by_name,\n                overwriteConfirmItems,\n                dashboardId: id,\n                data: updatedDashboard,\n              }),\n            );\n            return reject(overwriteConfirmItems);\n          }\n          return resolve();\n        });\n      })\n        .then(updateDashboard)\n        .catch(overwriteConfirmItems => {\n          const errorText = t('Please confirm the overwrite values.');\n          dispatch(\n            logEvent(LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA, {\n              dashboard_id: id,\n              items: overwriteConfirmItems,\n            }),\n          );\n          dispatch(addDangerToast(errorText));\n        });\n    }\n    // changing the data as the endpoint requires\n    if ('positions' in cleanedData && !('positions' in cleanedData.metadata)) {\n      cleanedData.metadata.positions = cleanedData.positions;\n    }\n    cleanedData.metadata.default_filters = safeStringify(serializedFilters);\n    cleanedData.metadata.filter_scopes = serializedFilterScopes;\n    const copyPayload = {\n      dashboard_title: cleanedData.dashboard_title,\n      css: cleanedData.css,\n      duplicate_slices: cleanedData.duplicate_slices,\n      json_metadata: JSON.stringify(cleanedData.metadata),\n    };\n\n    return SupersetClient.post({\n      endpoint: `/api/v1/dashboard/${id}/copy/`,\n      jsonPayload: copyPayload,\n    })\n      .then(response => onCopySuccess(response))\n      .catch(response => onError(response));\n  };\n}\n\nexport function fetchCharts(\n  chartList = [],\n  force = false,\n  interval = 0,\n  dashboardId,\n) {\n  return (dispatch, getState) => {\n    if (!interval) {\n      chartList.forEach(chartKey =>\n        dispatch(refreshChart(chartKey, force, dashboardId)),\n      );\n      return;\n    }\n\n    const { metadata: meta } = getState().dashboardInfo;\n    const refreshTime = Math.max(interval, meta.stagger_time || 5000); // default 5 seconds\n    if (typeof meta.stagger_refresh !== 'boolean') {\n      meta.stagger_refresh =\n        meta.stagger_refresh === undefined\n          ? true\n          : meta.stagger_refresh === 'true';\n    }\n    const delay = meta.stagger_refresh\n      ? refreshTime / (chartList.length - 1)\n      : 0;\n    chartList.forEach((chartKey, i) => {\n      setTimeout(\n        () => dispatch(refreshChart(chartKey, force, dashboardId)),\n        delay * i,\n      );\n    });\n  };\n}\n\nconst refreshCharts = (chartList, force, interval, dashboardId, dispatch) =>\n  new Promise(resolve => {\n    dispatch(fetchCharts(chartList, force, interval, dashboardId));\n    resolve();\n  });\n\nexport const ON_FILTERS_REFRESH = 'ON_FILTERS_REFRESH';\nexport function onFiltersRefresh() {\n  return { type: ON_FILTERS_REFRESH };\n}\n\nexport const ON_FILTERS_REFRESH_SUCCESS = 'ON_FILTERS_REFRESH_SUCCESS';\nexport function onFiltersRefreshSuccess() {\n  return { type: ON_FILTERS_REFRESH_SUCCESS };\n}\n\nexport const ON_REFRESH_SUCCESS = 'ON_REFRESH_SUCCESS';\nexport function onRefreshSuccess() {\n  return { type: ON_REFRESH_SUCCESS };\n}\n\nexport const ON_REFRESH = 'ON_REFRESH';\nexport function onRefresh(\n  chartList = [],\n  force = false,\n  interval = 0,\n  dashboardId,\n) {\n  return dispatch => {\n    dispatch({ type: ON_REFRESH });\n    refreshCharts(chartList, force, interval, dashboardId, dispatch).then(\n      () => {\n        dispatch(onRefreshSuccess());\n        dispatch(onFiltersRefresh());\n      },\n    );\n  };\n}\n\nexport const SHOW_BUILDER_PANE = 'SHOW_BUILDER_PANE';\nexport function showBuilderPane() {\n  return { type: SHOW_BUILDER_PANE };\n}\n\nexport function addSliceToDashboard(id, component) {\n  return (dispatch, getState) => {\n    const { sliceEntities } = getState();\n    const selectedSlice = sliceEntities.slices[id];\n    if (!selectedSlice) {\n      return dispatch(\n        addWarningToast(\n          'Sorry, there is no chart definition associated with the chart trying to be added.',\n        ),\n      );\n    }\n    const form_data = {\n      ...selectedSlice.form_data,\n      slice_id: selectedSlice.slice_id,\n    };\n    const newChart = {\n      ...initChart,\n      id,\n      form_data: applyDefaultFormData(form_data),\n    };\n\n    return Promise.all([\n      dispatch(addChart(newChart, id)),\n      dispatch(fetchDatasourceMetadata(form_data.datasource)),\n    ]).then(() => {\n      dispatch(addSlice(selectedSlice));\n\n      if (selectedSlice && selectedSlice.viz_type === 'filter_box') {\n        dispatch(addFilter(id, component, selectedSlice.form_data));\n      }\n    });\n  };\n}\n\nexport function removeSliceFromDashboard(id) {\n  return (dispatch, getState) => {\n    const sliceEntity = getState().sliceEntities.slices[id];\n    if (sliceEntity && sliceEntity.viz_type === 'filter_box') {\n      dispatch(removeFilter(id));\n    }\n\n    dispatch(removeSlice(id));\n    dispatch(removeChart(id));\n    getSharedLabelColor().removeSlice(id);\n  };\n}\n\nexport const SET_COLOR_SCHEME = 'SET_COLOR_SCHEME';\nexport function setColorScheme(colorScheme) {\n  return { type: SET_COLOR_SCHEME, colorScheme };\n}\n\nexport const SET_DIRECT_PATH = 'SET_DIRECT_PATH';\nexport function setDirectPathToChild(path) {\n  return { type: SET_DIRECT_PATH, path };\n}\n\nexport const SET_ACTIVE_TABS = 'SET_ACTIVE_TABS';\nexport function setActiveTabs(tabId, prevTabId) {\n  return { type: SET_ACTIVE_TABS, tabId, prevTabId };\n}\n\nexport const SET_FOCUSED_FILTER_FIELD = 'SET_FOCUSED_FILTER_FIELD';\nexport function setFocusedFilterField(chartId, column) {\n  return { type: SET_FOCUSED_FILTER_FIELD, chartId, column };\n}\n\nexport const UNSET_FOCUSED_FILTER_FIELD = 'UNSET_FOCUSED_FILTER_FIELD';\nexport function unsetFocusedFilterField(chartId, column) {\n  return { type: UNSET_FOCUSED_FILTER_FIELD, chartId, column };\n}\n\nexport const SET_FULL_SIZE_CHART_ID = 'SET_FULL_SIZE_CHART_ID';\nexport function setFullSizeChartId(chartId) {\n  return { type: SET_FULL_SIZE_CHART_ID, chartId };\n}\n\n// Undo history ---------------------------------------------------------------\nexport const SET_MAX_UNDO_HISTORY_EXCEEDED = 'SET_MAX_UNDO_HISTORY_EXCEEDED';\nexport function setMaxUndoHistoryExceeded(maxUndoHistoryExceeded = true) {\n  return {\n    type: SET_MAX_UNDO_HISTORY_EXCEEDED,\n    payload: { maxUndoHistoryExceeded },\n  };\n}\n\nexport function maxUndoHistoryToast() {\n  return (dispatch, getState) => {\n    const { dashboardLayout } = getState();\n    const historyLength = dashboardLayout.past.length;\n\n    return dispatch(\n      addWarningToast(\n        t(\n          'You have used all %(historyLength)s undo slots and will not be able to fully undo subsequent actions. You may save your current state to reset the history.',\n          { historyLength },\n        ),\n      ),\n    );\n  };\n}\n\nexport const SET_DATASETS_STATUS = 'SET_DATASETS_STATUS';\nexport function setDatasetsStatus(status) {\n  return {\n    type: SET_DATASETS_STATUS,\n    status,\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function serializeFilterScopes(dashboardFilters) {\n  return Object.values(dashboardFilters).reduce((map, { chartId, scopes }) => {\n    const scopesById = Object.keys(scopes).reduce(\n      (scopesByColumn, column) => ({\n        ...scopesByColumn,\n        [column]: scopes[column],\n      }),\n      {},\n    );\n\n    return {\n      ...map,\n      [chartId]: scopesById,\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport { FeatureFlag } from '@superset-ui/core';\nimport { chart } from 'src/components/Chart/chartReducer';\nimport { initSliceEntities } from 'src/dashboard/reducers/sliceEntities';\nimport { getInitialState as getInitialNativeFilterState } from 'src/dashboard/reducers/nativeFilters';\nimport { applyDefaultFormData } from 'src/explore/store';\nimport { buildActiveFilters } from 'src/dashboard/util/activeDashboardFilters';\nimport { findPermission } from 'src/utils/findPermission';\nimport { canUserEditDashboard } from 'src/dashboard/util/permissionUtils';\nimport {\n  getCrossFiltersConfiguration,\n  isCrossFiltersEnabled,\n} from 'src/dashboard/util/crossFilters';\nimport {\n  DASHBOARD_FILTER_SCOPE_GLOBAL,\n  dashboardFilter,\n} from 'src/dashboard/reducers/dashboardFilters';\nimport {\n  DASHBOARD_HEADER_ID,\n  GRID_DEFAULT_CHART_WIDTH,\n  GRID_COLUMN_COUNT,\n  DASHBOARD_ROOT_ID,\n} from 'src/dashboard/util/constants';\nimport {\n  DASHBOARD_HEADER_TYPE,\n  CHART_TYPE,\n  ROW_TYPE,\n} from 'src/dashboard/util/componentTypes';\nimport findFirstParentContainerId from 'src/dashboard/util/findFirstParentContainer';\nimport getEmptyLayout from 'src/dashboard/util/getEmptyLayout';\nimport getFilterConfigsFromFormdata from 'src/dashboard/util/getFilterConfigsFromFormdata';\nimport getLocationHash from 'src/dashboard/util/getLocationHash';\nimport newComponentFactory from 'src/dashboard/util/newComponentFactory';\nimport { TIME_RANGE } from 'src/visualizations/FilterBox/FilterBox';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport { isFeatureEnabled } from '../../featureFlags';\nimport extractUrlParams from '../util/extractUrlParams';\nimport { updateColorSchema } from './dashboardInfo';\nimport updateComponentParentsList from '../util/updateComponentParentsList';\nimport { FilterBarOrientation } from '../types';\n\nexport const HYDRATE_DASHBOARD = 'HYDRATE_DASHBOARD';\n\nexport const hydrateDashboard =\n  ({ history, dashboard, charts, dataMask, activeTabs }) =>\n  (dispatch, getState) => {\n    const { user, common, dashboardState } = getState();\n    const { metadata, position_data: positionData } = dashboard;\n    const regularUrlParams = extractUrlParams('regular');\n    const reservedUrlParams = extractUrlParams('reserved');\n    const editMode = reservedUrlParams.edit === 'true';\n\n    let preselectFilters = {};\n\n    charts.forEach(chart => {\n      // eslint-disable-next-line no-param-reassign\n      chart.slice_id = chart.form_data.slice_id;\n    });\n    try {\n      // allow request parameter overwrite dashboard metadata\n      preselectFilters =\n        getUrlParam(URL_PARAMS.preselectFilters) ||\n        JSON.parse(metadata.default_filters);\n    } catch (e) {\n      //\n    }\n\n    if (metadata?.shared_label_colors) {\n      updateColorSchema(metadata, metadata?.shared_label_colors);\n    }\n\n    // Priming the color palette with user's label-color mapping provided in\n    // the dashboard's JSON metadata\n    if (metadata?.label_colors) {\n      updateColorSchema(metadata, metadata?.label_colors);\n    }\n\n    // new dash: position_json could be {} or null\n    const layout =\n      positionData && Object.keys(positionData).length > 0\n        ? positionData\n        : getEmptyLayout();\n\n    // create a lookup to sync layout names with slice names\n    const chartIdToLayoutId = {};\n    Object.values(layout).forEach(layoutComponent => {\n      if (layoutComponent.type === CHART_TYPE) {\n        chartIdToLayoutId[layoutComponent.meta.chartId] = layoutComponent.id;\n      }\n    });\n\n    // find root level chart container node for newly-added slices\n    const parentId = findFirstParentContainerId(layout);\n    const parent = layout[parentId];\n    let newSlicesContainer;\n    let newSlicesContainerWidth = 0;\n\n    const filterScopes = metadata?.filter_scopes || {};\n\n    const chartQueries = {};\n    const dashboardFilters = {};\n    const slices = {};\n    const sliceIds = new Set();\n    const slicesFromExploreCount = new Map();\n\n    charts.forEach(slice => {\n      const key = slice.slice_id;\n      const formData = {\n        ...slice.form_data,\n        url_params: {\n          ...slice.form_data.url_params,\n          ...regularUrlParams,\n        },\n      };\n      chartQueries[key] = {\n        ...chart,\n        id: key,\n        form_data: applyDefaultFormData(formData),\n      };\n\n      slices[key] = {\n        slice_id: key,\n        slice_url: slice.slice_url,\n        slice_name: slice.slice_name,\n        form_data: slice.form_data,\n        viz_type: slice.form_data.viz_type,\n        datasource: slice.form_data.datasource,\n        description: slice.description,\n        description_markeddown: slice.description_markeddown,\n        owners: slice.owners,\n        modified: slice.modified,\n        changed_on: new Date(slice.changed_on).getTime(),\n      };\n\n      sliceIds.add(key);\n\n      // if there are newly added slices from explore view, fill slices into 1 or more rows\n      if (!chartIdToLayoutId[key] && layout[parentId]) {\n        if (\n          newSlicesContainerWidth === 0 ||\n          newSlicesContainerWidth + GRID_DEFAULT_CHART_WIDTH > GRID_COLUMN_COUNT\n        ) {\n          newSlicesContainer = newComponentFactory(\n            ROW_TYPE,\n            (parent.parents || []).slice(),\n          );\n          layout[newSlicesContainer.id] = newSlicesContainer;\n          parent.children.push(newSlicesContainer.id);\n          newSlicesContainerWidth = 0;\n        }\n\n        const chartHolder = newComponentFactory(\n          CHART_TYPE,\n          {\n            chartId: slice.slice_id,\n          },\n          (newSlicesContainer.parents || []).slice(),\n        );\n\n        const count = (slicesFromExploreCount.get(slice.slice_id) ?? 0) + 1;\n        chartHolder.id = `${CHART_TYPE}-explore-${slice.slice_id}-${count}`;\n        slicesFromExploreCount.set(slice.slice_id, count);\n\n        layout[chartHolder.id] = chartHolder;\n        newSlicesContainer.children.push(chartHolder.id);\n        chartIdToLayoutId[chartHolder.meta.chartId] = chartHolder.id;\n        newSlicesContainerWidth += GRID_DEFAULT_CHART_WIDTH;\n      }\n\n      // build DashboardFilters for interactive filter features\n      if (slice.form_data.viz_type === 'filter_box') {\n        const configs = getFilterConfigsFromFormdata(slice.form_data);\n        let { columns } = configs;\n        const { labels } = configs;\n        if (preselectFilters[key]) {\n          Object.keys(columns).forEach(col => {\n            if (preselectFilters[key][col]) {\n              columns = {\n                ...columns,\n                [col]: preselectFilters[key][col],\n              };\n            }\n          });\n        }\n\n        const scopesByChartId = Object.keys(columns).reduce((map, column) => {\n          const scopeSettings = {\n            ...filterScopes[key],\n          };\n          const { scope, immune } = {\n            ...DASHBOARD_FILTER_SCOPE_GLOBAL,\n            ...scopeSettings[column],\n          };\n\n          return {\n            ...map,\n            [column]: {\n              scope,\n              immune,\n            },\n          };\n        }, {});\n\n        const componentId = chartIdToLayoutId[key];\n        const directPathToFilter = (layout[componentId].parents || []).slice();\n        directPathToFilter.push(componentId);\n        dashboardFilters[key] = {\n          ...dashboardFilter,\n          chartId: key,\n          componentId,\n          datasourceId: slice.form_data.datasource,\n          filterName: slice.slice_name,\n          directPathToFilter,\n          columns,\n          labels,\n          scopes: scopesByChartId,\n          isDateFilter: Object.keys(columns).includes(TIME_RANGE),\n        };\n      }\n\n      // sync layout names with current slice names in case a slice was edited\n      // in explore since the layout was updated. name updates go through layout for undo/redo\n      // functionality and python updates slice names based on layout upon dashboard save\n      const layoutId = chartIdToLayoutId[key];\n      if (layoutId && layout[layoutId]) {\n        layout[layoutId].meta.sliceName = slice.slice_name;\n      }\n    });\n\n    // make sure that parents tree is built\n    if (\n      Object.values(layout).some(\n        element => element.id !== DASHBOARD_ROOT_ID && !element.parents,\n      )\n    ) {\n      updateComponentParentsList({\n        currentComponent: layout[DASHBOARD_ROOT_ID],\n        layout,\n      });\n    }\n\n    buildActiveFilters({\n      dashboardFilters,\n      components: layout,\n    });\n\n    // store the header as a layout component so we can undo/redo changes\n    layout[DASHBOARD_HEADER_ID] = {\n      id: DASHBOARD_HEADER_ID,\n      type: DASHBOARD_HEADER_TYPE,\n      meta: {\n        text: dashboard.dashboard_title,\n      },\n    };\n\n    const dashboardLayout = {\n      past: [],\n      present: layout,\n      future: [],\n    };\n\n    // Searches for a focused_chart parameter in the URL to automatically focus a chart\n    const focusedChartId = getUrlParam(URL_PARAMS.dashboardFocusedChart);\n    let focusedChartLayoutId;\n    if (focusedChartId) {\n      // Converts focused_chart to dashboard layout id\n      const found = Object.values(dashboardLayout.present).find(\n        element => element.meta?.chartId === focusedChartId,\n      );\n      focusedChartLayoutId = found?.id;\n      // Removes the focused_chart parameter from the URL\n      const params = new URLSearchParams(window.location.search);\n      params.delete(URL_PARAMS.dashboardFocusedChart.name);\n      history.replace({\n        search: params.toString(),\n      });\n    }\n\n    // find direct link component and path from root\n    const directLinkComponentId = focusedChartLayoutId || getLocationHash();\n    let directPathToChild = dashboardState.directPathToChild || [];\n    if (layout[directLinkComponentId]) {\n      directPathToChild = (layout[directLinkComponentId].parents || []).slice();\n      directPathToChild.push(directLinkComponentId);\n    }\n\n    const nativeFilters = getInitialNativeFilterState({\n      filterConfig: metadata?.native_filter_configuration || [],\n    });\n\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n      const { chartConfiguration, globalChartConfiguration } =\n        getCrossFiltersConfiguration(\n          dashboardLayout.present,\n          metadata,\n          chartQueries,\n        );\n      metadata.chart_configuration = chartConfiguration;\n      metadata.global_chart_configuration = globalChartConfiguration;\n    }\n\n    const { roles } = user;\n    const canEdit = canUserEditDashboard(dashboard, user);\n    const crossFiltersEnabled = isCrossFiltersEnabled(\n      metadata.cross_filters_enabled,\n    );\n\n    return dispatch({\n      type: HYDRATE_DASHBOARD,\n      data: {\n        sliceEntities: { ...initSliceEntities, slices, isLoading: false },\n        charts: chartQueries,\n        // read-only data\n        dashboardInfo: {\n          ...dashboard,\n          metadata,\n          userId: user.userId ? String(user.userId) : null, // legacy, please use state.user instead\n          dash_edit_perm: canEdit,\n          dash_save_perm: findPermission('can_write', 'Dashboard', roles),\n          dash_share_perm: findPermission(\n            'can_share_dashboard',\n            'Superset',\n            roles,\n          ),\n          superset_can_explore: findPermission(\n            'can_explore',\n            'Superset',\n            roles,\n          ),\n          superset_can_share: findPermission(\n            'can_share_chart',\n            'Superset',\n            roles,\n          ),\n          superset_can_csv: findPermission('can_csv', 'Superset', roles),\n          common: {\n            // legacy, please use state.common instead\n            flash_messages: common?.flash_messages,\n            conf: common?.conf,\n          },\n          filterBarOrientation:\n            (isFeatureEnabled(FeatureFlag.HORIZONTAL_FILTER_BAR) &&\n              metadata.filter_bar_orientation) ||\n            FilterBarOrientation.VERTICAL,\n          crossFiltersEnabled,\n        },\n        dataMask,\n        dashboardFilters,\n        nativeFilters,\n        dashboardState: {\n          preselectNativeFilters: getUrlParam(URL_PARAMS.nativeFilters),\n          sliceIds: Array.from(sliceIds),\n          directPathToChild,\n          directPathLastUpdated: Date.now(),\n          focusedFilterField: null,\n          expandedSlices: metadata?.expanded_slices || {},\n          refreshFrequency: metadata?.refresh_frequency || 0,\n          // dashboard viewers can set refresh frequency for the current visit,\n          // only persistent refreshFrequency will be saved to backend\n          shouldPersistRefreshFrequency: false,\n          css: dashboard.css || '',\n          colorNamespace: metadata?.color_namespace || null,\n          colorScheme: metadata?.color_scheme || null,\n          editMode: canEdit && editMode,\n          isPublished: dashboard.published,\n          hasUnsavedChanges: false,\n          dashboardIsSaving: false,\n          maxUndoHistoryExceeded: false,\n          lastModifiedTime: dashboard.changed_on,\n          isRefreshing: false,\n          isFiltersRefreshing: false,\n          activeTabs: activeTabs || dashboardState?.activeTabs || [],\n          datasetsStatus: ResourceStatus.LOADING,\n        },\n        dashboardLayout,\n      },\n    });\n  };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DASHBOARD_ROOT_TYPE, DASHBOARD_GRID_TYPE } from './componentTypes';\n\nimport {\n  DASHBOARD_GRID_ID,\n  DASHBOARD_ROOT_ID,\n  DASHBOARD_VERSION_KEY,\n} from './constants';\n\nexport default function getEmptyLayout() {\n  return {\n    [DASHBOARD_VERSION_KEY]: 'v2',\n    [DASHBOARD_ROOT_ID]: {\n      type: DASHBOARD_ROOT_TYPE,\n      id: DASHBOARD_ROOT_ID,\n      children: [DASHBOARD_GRID_ID],\n    },\n    [DASHBOARD_GRID_ID]: {\n      type: DASHBOARD_GRID_TYPE,\n      id: DASHBOARD_GRID_ID,\n      children: [],\n      parents: [DASHBOARD_ROOT_ID],\n    },\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { TABS_TYPE } from './componentTypes';\nimport { DASHBOARD_ROOT_ID } from './constants';\n\nexport default function findFirstParentContainerId(layout = {}) {\n  // DASHBOARD_GRID_TYPE or TABS_TYPE?\n  let parent = layout[DASHBOARD_ROOT_ID];\n  if (\n    parent &&\n    parent.children.length &&\n    layout[parent.children[0]].type === TABS_TYPE\n  ) {\n    const tabs = layout[parent.children[0]];\n    parent = layout[tabs.children[0]];\n  } else {\n    parent = layout[parent.children[0]];\n  }\n\n  return parent.id;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  ADD_FILTER,\n  REMOVE_FILTER,\n  CHANGE_FILTER,\n  UPDATE_DIRECT_PATH_TO_FILTER,\n  UPDATE_LAYOUT_COMPONENTS,\n  UPDATE_DASHBOARD_FILTERS_SCOPE,\n} from '../actions/dashboardFilters';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\nimport { TIME_RANGE } from '../../visualizations/FilterBox/FilterBox';\nimport { DASHBOARD_ROOT_ID } from '../util/constants';\nimport getFilterConfigsFromFormdata from '../util/getFilterConfigsFromFormdata';\nimport { buildActiveFilters } from '../util/activeDashboardFilters';\nimport { getChartIdAndColumnFromFilterKey } from '../util/getDashboardFilterKey';\n\nexport const DASHBOARD_FILTER_SCOPE_GLOBAL = {\n  scope: [DASHBOARD_ROOT_ID],\n  immune: [],\n};\n\nexport const dashboardFilter = {\n  chartId: null,\n  componentId: null,\n  filterName: null,\n  datasourceId: null,\n  directPathToFilter: [],\n  isDateFilter: false,\n  isInstantFilter: true,\n  columns: {},\n  labels: {},\n  scopes: {},\n};\n\nconst CHANGE_FILTER_VALUE_ACTIONS = [ADD_FILTER, REMOVE_FILTER, CHANGE_FILTER];\n\nexport default function dashboardFiltersReducer(dashboardFilters = {}, action) {\n  const actionHandlers = {\n    [ADD_FILTER]() {\n      const { chartId, component, form_data } = action;\n      const { columns, labels } = getFilterConfigsFromFormdata(form_data);\n      const scopes = Object.keys(columns).reduce(\n        (map, column) => ({\n          ...map,\n          [column]: DASHBOARD_FILTER_SCOPE_GLOBAL,\n        }),\n        {},\n      );\n      const directPathToFilter = component\n        ? (component.parents || []).slice().concat(component.id)\n        : [];\n\n      const newFilter = {\n        ...dashboardFilter,\n        chartId,\n        componentId: component.id,\n        datasourceId: form_data.datasource,\n        filterName: component.meta.sliceName,\n        directPathToFilter,\n        columns,\n        labels,\n        scopes,\n        isInstantFilter: !!form_data.instant_filtering,\n        isDateFilter: Object.keys(columns).includes(TIME_RANGE),\n      };\n\n      return newFilter;\n    },\n\n    [CHANGE_FILTER](state) {\n      const { newSelectedValues, merge } = action;\n      const updatedColumns = Object.keys(newSelectedValues).reduce(\n        (columns, name) => {\n          // override existed column value, or add new column name\n          if (!merge || !(name in columns)) {\n            return {\n              ...columns,\n              [name]: newSelectedValues[name],\n            };\n          }\n\n          return {\n            ...columns,\n            [name]: [...columns[name], ...newSelectedValues[name]],\n          };\n        },\n        { ...state.columns },\n      );\n\n      return {\n        ...state,\n        columns: updatedColumns,\n      };\n    },\n\n    [UPDATE_DIRECT_PATH_TO_FILTER](state) {\n      const { path } = action;\n      return {\n        ...state,\n        directPathToFilter: path,\n      };\n    },\n  };\n\n  if (action.type === UPDATE_LAYOUT_COMPONENTS) {\n    buildActiveFilters({\n      dashboardFilters,\n      components: action.components,\n    });\n    return dashboardFilters;\n  }\n  if (action.type === UPDATE_DASHBOARD_FILTERS_SCOPE) {\n    const allDashboardFiltersScope = action.scopes;\n    // update filter scope for each filter field\n    const updatedFilters = Object.entries(allDashboardFiltersScope).reduce(\n      (map, entry) => {\n        const [filterKey, { scope, immune }] = entry;\n        const { chartId, column } = getChartIdAndColumnFromFilterKey(filterKey);\n        const scopes = {\n          ...map[chartId].scopes,\n          [column]: {\n            scope,\n            immune,\n          },\n        };\n        return {\n          ...map,\n          [chartId]: {\n            ...map[chartId],\n            scopes,\n          },\n        };\n      },\n      dashboardFilters,\n    );\n\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n    return updatedFilters;\n  }\n  if (action.type === REMOVE_FILTER) {\n    const { chartId } = action;\n    const { [chartId]: deletedFilter, ...updatedFilters } = dashboardFilters;\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n\n    return updatedFilters;\n  }\n  if (action.type === HYDRATE_DASHBOARD) {\n    return action.data.dashboardFilters;\n  }\n\n  if (action.type in actionHandlers) {\n    const updatedFilters = {\n      ...dashboardFilters,\n      [action.chartId]: actionHandlers[action.type](\n        dashboardFilters[action.chartId],\n      ),\n    };\n    if (CHANGE_FILTER_VALUE_ACTIONS.includes(action.type)) {\n      buildActiveFilters({ dashboardFilters: updatedFilters });\n    }\n\n    return updatedFilters;\n  }\n\n  return dashboardFilters;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nimport {\n  FETCH_ALL_SLICES_FAILED,\n  FETCH_ALL_SLICES_STARTED,\n  ADD_SLICES,\n  SET_SLICES,\n} from '../actions/sliceEntities';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport const initSliceEntities = {\n  slices: {},\n  isLoading: true,\n  errorMessage: null,\n  lastUpdated: 0,\n};\n\nexport default function sliceEntitiesReducer(\n  state = initSliceEntities,\n  action,\n) {\n  const actionHandlers = {\n    [HYDRATE_DASHBOARD]() {\n      return {\n        ...action.data.sliceEntities,\n      };\n    },\n    [FETCH_ALL_SLICES_STARTED]() {\n      return {\n        ...state,\n        isLoading: true,\n      };\n    },\n    [ADD_SLICES]() {\n      return {\n        ...state,\n        isLoading: false,\n        slices: { ...state.slices, ...action.payload.slices },\n        lastUpdated: new Date().getTime(),\n      };\n    },\n    [SET_SLICES]() {\n      return {\n        isLoading: false,\n        slices: { ...action.payload.slices },\n        lastUpdated: new Date().getTime(),\n      };\n    },\n    [FETCH_ALL_SLICES_FAILED]() {\n      return {\n        ...state,\n        isLoading: false,\n        lastUpdated: new Date().getTime(),\n        errorMessage:\n          action.payload.error || t('Could not fetch all saved charts'),\n      };\n    },\n  };\n\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { isEmpty } from 'lodash';\nimport { mapValues, flow, keyBy } from 'lodash/fp';\nimport {\n  getChartIdAndColumnFromFilterKey,\n  getDashboardFilterKey,\n} from './getDashboardFilterKey';\nimport { CHART_TYPE } from './componentTypes';\nimport { DASHBOARD_FILTER_SCOPE_GLOBAL } from '../reducers/dashboardFilters';\n\nlet allFilterBoxChartIds = [];\nlet activeFilters = {};\nlet appliedFilterValuesByChart = {};\nlet allComponents = {};\n\n// output: { [id_column]: { values, scope } }\nexport function getActiveFilters() {\n  return activeFilters;\n}\n\n// currently filter_box is a chart,\n// when selecting filter scopes, they have to be out pulled out in a few places.\n// after we make filter_box a dashboard build-in component, will not need this check anymore.\nexport function isFilterBox(chartId) {\n  return allFilterBoxChartIds.includes(chartId);\n}\n\n// this function is to find all filter values applied to a chart,\n// it goes through all active filters and their scopes.\n// return: { [column]: array of selected values }\nexport function getAppliedFilterValues(chartId, filters) {\n  // use cached data if possible\n  if (!(chartId in appliedFilterValuesByChart)) {\n    const applicableFilters = Object.entries(filters || activeFilters).filter(\n      ([, { scope: chartIds }]) => chartIds.includes(chartId),\n    );\n    appliedFilterValuesByChart[chartId] = flow(\n      keyBy(\n        ([filterKey]) => getChartIdAndColumnFromFilterKey(filterKey).column,\n      ),\n      mapValues(([, { values }]) => values),\n    )(applicableFilters);\n  }\n  return appliedFilterValuesByChart[chartId];\n}\n\n// Legacy - getChartIdsInFilterBoxScope is used only by\n// components and functions related to filter box\n// Please use src/dashboard/util/getChartIdsInFilterScope instead\nexport function getChartIdsInFilterBoxScope({ filterScope }) {\n  function traverse(chartIds = [], component = {}, immuneChartIds = []) {\n    if (!component) {\n      return;\n    }\n\n    if (\n      component.type === CHART_TYPE &&\n      component.meta &&\n      component.meta.chartId &&\n      !immuneChartIds.includes(component.meta.chartId)\n    ) {\n      chartIds.push(component.meta.chartId);\n    } else if (component.children) {\n      component.children.forEach(child =>\n        traverse(chartIds, allComponents[child], immuneChartIds),\n      );\n    }\n  }\n\n  const chartIds = [];\n  const { scope: scopeComponentIds, immune: immuneChartIds } =\n    filterScope || DASHBOARD_FILTER_SCOPE_GLOBAL;\n  scopeComponentIds.forEach(componentId =>\n    traverse(chartIds, allComponents[componentId], immuneChartIds),\n  );\n\n  return chartIds;\n}\n\n// non-empty filter fields in dashboardFilters,\n// activeFilters map contains selected values and filter scope.\n// values: array of selected values\n// scope: array of chartIds that applicable to the filter field.\nexport function buildActiveFilters({ dashboardFilters = {}, components = {} }) {\n  allFilterBoxChartIds = Object.values(dashboardFilters).map(\n    filter => filter.chartId,\n  );\n\n  // clear cache\n  if (!isEmpty(components)) {\n    allComponents = components;\n  }\n  appliedFilterValuesByChart = {};\n  activeFilters = Object.values(dashboardFilters).reduce((result, filter) => {\n    const { chartId, columns, scopes } = filter;\n    const nonEmptyFilters = {};\n\n    Object.keys(columns).forEach(column => {\n      if (\n        Array.isArray(columns[column])\n          ? columns[column].length\n          : columns[column] !== undefined\n      ) {\n        // remove filter itself\n        const scope = getChartIdsInFilterBoxScope({\n          filterScope: scopes[column],\n        }).filter(id => chartId !== id);\n\n        nonEmptyFilters[getDashboardFilterKey({ chartId, column })] = {\n          values: columns[column],\n          scope,\n        };\n      }\n    });\n\n    return {\n      ...result,\n      ...nonEmptyFilters,\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { NEW_COMPONENTS_SOURCE_ID } from './constants';\nimport findParentId from './findParentId';\nimport getDetailedComponentWidth from './getDetailedComponentWidth';\nimport newComponentFactory from './newComponentFactory';\n\nexport default function getComponentWidthFromDrop({\n  dropResult,\n  layout: components,\n}) {\n  const { source, destination, dragging } = dropResult;\n\n  const isNewComponent = source.id === NEW_COMPONENTS_SOURCE_ID;\n  const component = isNewComponent\n    ? newComponentFactory(dragging.type)\n    : components[dragging.id] || {};\n\n  // moving a component within the same container shouldn't change its width\n  if (source.id === destination.id) {\n    return component.meta.width;\n  }\n\n  const { width: draggingWidth, minimumWidth: minDraggingWidth } =\n    getDetailedComponentWidth({\n      component,\n      components,\n    });\n\n  const { width: destinationWidth, occupiedWidth: draggingOccupiedWidth } =\n    getDetailedComponentWidth({\n      id: destination.id,\n      components,\n    });\n\n  let destinationCapacity = Number(destinationWidth - draggingOccupiedWidth);\n\n  if (Number.isNaN(destinationCapacity)) {\n    const { width: grandparentWidth, occupiedWidth: grandparentOccupiedWidth } =\n      getDetailedComponentWidth({\n        id: findParentId({\n          childId: destination.id,\n          layout: components,\n        }),\n        components,\n      });\n\n    destinationCapacity = Number(grandparentWidth - grandparentOccupiedWidth);\n  }\n\n  if (\n    Number.isNaN(destinationCapacity) ||\n    Number.isNaN(Number(draggingWidth))\n  ) {\n    return draggingWidth;\n  }\n  if (destinationCapacity >= draggingWidth) {\n    return draggingWidth;\n  }\n  if (destinationCapacity >= minDraggingWidth) {\n    return destinationCapacity;\n  }\n\n  return -1;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport findParentId from './findParentId';\nimport { GRID_MIN_COLUMN_COUNT, GRID_COLUMN_COUNT } from './constants';\nimport {\n  ROW_TYPE,\n  COLUMN_TYPE,\n  MARKDOWN_TYPE,\n  CHART_TYPE,\n  DYNAMIC_TYPE,\n} from './componentTypes';\n\nfunction getTotalChildWidth({ id, components }) {\n  const component = components[id];\n  if (!component) return 0;\n\n  let width = 0;\n\n  (component.children || []).forEach(childId => {\n    const child = components[childId] || {};\n    width += (child.meta || {}).width || 0;\n  });\n\n  return width;\n}\n\nexport default function getDetailedComponentWidth({\n  // pass either an id, or a component\n  id,\n  component: passedComponent,\n  components = {},\n}) {\n  const result = {\n    width: undefined,\n    occupiedWidth: undefined,\n    minimumWidth: undefined,\n  };\n\n  const component = passedComponent || components[id];\n  if (!component) return result;\n\n  // note these remain as undefined if the component has no defined width\n  result.width = (component.meta || {}).width;\n  result.occupiedWidth = result.width;\n\n  if (component.type === ROW_TYPE) {\n    // not all rows have width 12, e\n    result.width =\n      getDetailedComponentWidth({\n        id: findParentId({\n          childId: component.id,\n          layout: components,\n        }),\n        components,\n      }).width || GRID_COLUMN_COUNT;\n    result.occupiedWidth = getTotalChildWidth({ id: component.id, components });\n    result.minimumWidth = result.occupiedWidth || GRID_MIN_COLUMN_COUNT;\n  } else if (component.type === COLUMN_TYPE) {\n    // find the width of the largest child, only rows count\n    result.minimumWidth = GRID_MIN_COLUMN_COUNT;\n    result.occupiedWidth = 0;\n    (component.children || []).forEach(childId => {\n      // rows don't have widths, so find the width of its children\n      if (components[childId].type === ROW_TYPE) {\n        result.minimumWidth = Math.max(\n          result.minimumWidth,\n          getTotalChildWidth({ id: childId, components }),\n        );\n      }\n    });\n  } else if (\n    component.type === DYNAMIC_TYPE ||\n    component.type === MARKDOWN_TYPE ||\n    component.type === CHART_TYPE\n  ) {\n    result.minimumWidth = GRID_MIN_COLUMN_COUNT;\n  }\n\n  return result;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\n\nexport default function getFilterConfigsFromFormdata(form_data = {}) {\n  const {\n    date_filter,\n    filter_configs = [],\n    show_sqla_time_column,\n    show_sqla_time_granularity,\n  } = form_data;\n  let configs = filter_configs.reduce(\n    ({ columns, labels }, config) => {\n      let defaultValues = config[FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE];\n\n      // treat empty string as null (no default value)\n      if (defaultValues === '') {\n        defaultValues = null;\n      }\n\n      // defaultValue could be ; separated values,\n      // could be null or ''\n      if (defaultValues && config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE]) {\n        defaultValues = config.defaultValue.split(';');\n      }\n\n      const updatedColumns = {\n        ...columns,\n        [config.column]: config.vals || defaultValues,\n      };\n      const updatedLabels = {\n        ...labels,\n        [config.column]: config.label,\n      };\n\n      return {\n        columns: updatedColumns,\n        labels: updatedLabels,\n      };\n    },\n    { columns: {}, labels: {} },\n  );\n\n  if (date_filter) {\n    let updatedColumns = {\n      ...configs.columns,\n      [TIME_FILTER_MAP.time_range]: form_data.time_range,\n    };\n    const updatedLabels = {\n      ...configs.labels,\n      ...Object.entries(TIME_FILTER_MAP).reduce(\n        (map, [key, value]) => ({\n          ...map,\n          [value]: TIME_FILTER_LABELS[key],\n        }),\n        {},\n      ),\n    };\n\n    if (show_sqla_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.time_grain_sqla]: form_data.time_grain_sqla,\n      };\n    }\n\n    if (show_sqla_time_column) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity_sqla]: form_data.granularity_sqla,\n      };\n    }\n\n    configs = {\n      ...configs,\n      columns: updatedColumns,\n      labels: updatedLabels,\n    };\n  }\n  return configs;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport { t } from '@superset-ui/core';\n\nimport {\n  CHART_TYPE,\n  COLUMN_TYPE,\n  DIVIDER_TYPE,\n  HEADER_TYPE,\n  MARKDOWN_TYPE,\n  ROW_TYPE,\n  TABS_TYPE,\n  TAB_TYPE,\n  DYNAMIC_TYPE,\n} from './componentTypes';\n\nimport {\n  MEDIUM_HEADER,\n  BACKGROUND_TRANSPARENT,\n  GRID_DEFAULT_CHART_WIDTH,\n  GRID_COLUMN_COUNT,\n} from './constants';\n\nconst typeToDefaultMetaData = {\n  [CHART_TYPE]: { width: GRID_DEFAULT_CHART_WIDTH, height: 50 },\n  [COLUMN_TYPE]: {\n    width: GRID_DEFAULT_CHART_WIDTH,\n    background: BACKGROUND_TRANSPARENT,\n  },\n  [DIVIDER_TYPE]: null,\n  [HEADER_TYPE]: {\n    text: t('New header'),\n    headerSize: MEDIUM_HEADER,\n    background: BACKGROUND_TRANSPARENT,\n  },\n  [MARKDOWN_TYPE]: { width: GRID_DEFAULT_CHART_WIDTH, height: 50 },\n  [ROW_TYPE]: { background: BACKGROUND_TRANSPARENT },\n  [TABS_TYPE]: null,\n  [TAB_TYPE]: {\n    text: '',\n    defaultText: t('Tab title'),\n    placeholder: t('Tab title'),\n  },\n  [DYNAMIC_TYPE]: {\n    width: GRID_COLUMN_COUNT,\n    background: BACKGROUND_TRANSPARENT,\n  },\n};\n\nfunction uuid(type) {\n  return `${type}-${shortid.generate()}`;\n}\n\nexport default function entityFactory(type, meta, parents = []) {\n  return {\n    type,\n    id: uuid(type),\n    children: [],\n    parents,\n    meta: {\n      ...typeToDefaultMetaData[type],\n      ...meta,\n    },\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getChartIdAndColumnFromFilterKey } from './getDashboardFilterKey';\n\n// input: { [id_column1]: values, [id_column2]: values }\n// output: { id: { column1: values, column2: values } }\nexport default function serializeActiveFilterValues(activeFilters) {\n  return Object.entries(activeFilters).reduce((map, entry) => {\n    const [filterKey, { values }] = entry;\n    const { chartId, column } = getChartIdAndColumnFromFilterKey(filterKey);\n    const entryByChartId = {\n      ...map[chartId],\n      [column]: values,\n    };\n    return {\n      ...map,\n      [chartId]: entryByChartId,\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { logging } from '@superset-ui/core';\n\nexport default function updateComponentParentsList({\n  currentComponent,\n  layout = {},\n}) {\n  if (currentComponent && layout) {\n    if (layout[currentComponent.id]) {\n      const parentsList = Array.isArray(currentComponent.parents)\n        ? currentComponent.parents.slice()\n        : [];\n\n      parentsList.push(currentComponent.id);\n\n      if (Array.isArray(currentComponent.children)) {\n        currentComponent.children.forEach(childId => {\n          if (layout[childId]) {\n            // eslint-disable-next-line no-param-reassign\n            layout[childId] = {\n              ...layout[childId],\n              parents: parentsList,\n            };\n            updateComponentParentsList({\n              currentComponent: layout[childId],\n              layout,\n            });\n          } else {\n            logging.warn(\n              `The current layout does not contain a component with the id: ${childId}.  Skipping this component`,\n            );\n          }\n        });\n      }\n    } else {\n      logging.warn(\n        `The current layout does not contain a component with the id: ${currentComponent?.id}.  Skipping this component`,\n      );\n    }\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { SupersetClient, t } from '@superset-ui/core';\nimport { addSuccessToast } from 'src/components/MessageToasts/actions';\nimport { isEmpty } from 'lodash';\nimport { buildV1ChartDataPayload } from '../exploreUtils';\n\nconst ADHOC_FILTER_REGEX = /^adhoc_filters/;\n\nexport const FETCH_DASHBOARDS_SUCCEEDED = 'FETCH_DASHBOARDS_SUCCEEDED';\nexport function fetchDashboardsSucceeded(choices) {\n  return { type: FETCH_DASHBOARDS_SUCCEEDED, choices };\n}\n\nexport const FETCH_DASHBOARDS_FAILED = 'FETCH_DASHBOARDS_FAILED';\nexport function fetchDashboardsFailed(userId) {\n  return { type: FETCH_DASHBOARDS_FAILED, userId };\n}\n\nexport const SET_SAVE_CHART_MODAL_VISIBILITY =\n  'SET_SAVE_CHART_MODAL_VISIBILITY';\nexport function setSaveChartModalVisibility(isVisible) {\n  return { type: SET_SAVE_CHART_MODAL_VISIBILITY, isVisible };\n}\n\nexport const SAVE_SLICE_FAILED = 'SAVE_SLICE_FAILED';\nexport function saveSliceFailed() {\n  return { type: SAVE_SLICE_FAILED };\n}\nexport const SAVE_SLICE_SUCCESS = 'SAVE_SLICE_SUCCESS';\nexport function saveSliceSuccess(data) {\n  return { type: SAVE_SLICE_SUCCESS, data };\n}\n\nexport const REMOVE_SAVE_MODAL_ALERT = 'REMOVE_SAVE_MODAL_ALERT';\nexport function removeSaveModalAlert() {\n  return { type: REMOVE_SAVE_MODAL_ALERT };\n}\n\nconst extractAddHocFiltersFromFormData = formDataToHandle =>\n  Object.entries(formDataToHandle).reduce(\n    (acc, [key, value]) =>\n      ADHOC_FILTER_REGEX.test(key)\n        ? { ...acc, [key]: value?.filter(f => !f.isExtra) }\n        : acc,\n    {},\n  );\n\nexport const getSlicePayload = (\n  sliceName,\n  formDataWithNativeFilters,\n  dashboards,\n  owners,\n  formDataFromSlice = {},\n) => {\n  let adhocFilters = extractAddHocFiltersFromFormData(\n    formDataWithNativeFilters,\n  );\n\n  // Retain adhoc_filters from the slice if no adhoc_filters are present\n  // after overwriting a chart.  This ensures the dashboard can continue\n  // to filter the chart. Before, any time range filter applied in the dashboard\n  // would end up as an extra filter and when overwriting the chart the original\n  // time range adhoc_filter was lost\n  if (isEmpty(adhocFilters?.adhoc_filters) && !isEmpty(formDataFromSlice)) {\n    adhocFilters = extractAddHocFiltersFromFormData(formDataFromSlice);\n  }\n\n  if (\n    isEmpty(adhocFilters?.adhoc_filters) &&\n    isEmpty(formDataFromSlice) &&\n    formDataWithNativeFilters?.adhoc_filters?.length > 0\n  ) {\n    adhocFilters.adhoc_filters = [\n      {\n        ...formDataWithNativeFilters.adhoc_filters[0],\n        comparator: 'No filter',\n      },\n    ];\n  }\n\n  const formData = {\n    ...formDataWithNativeFilters,\n    ...adhocFilters,\n    dashboards,\n  };\n\n  const [datasourceId, datasourceType] = formData.datasource.split('__');\n  const payload = {\n    params: JSON.stringify(formData),\n    slice_name: sliceName,\n    viz_type: formData.viz_type,\n    datasource_id: parseInt(datasourceId, 10),\n    datasource_type: datasourceType,\n    dashboards,\n    owners,\n    query_context: JSON.stringify(\n      buildV1ChartDataPayload({\n        formData,\n        force: false,\n        resultFormat: 'json',\n        resultType: 'full',\n        setDataMask: null,\n        ownState: null,\n      }),\n    ),\n  };\n  return payload;\n};\n\nconst addToasts = (isNewSlice, sliceName, addedToDashboard) => {\n  const toasts = [];\n  if (isNewSlice) {\n    toasts.push(addSuccessToast(t('Chart [%s] has been saved', sliceName)));\n  } else {\n    toasts.push(\n      addSuccessToast(t('Chart [%s] has been overwritten', sliceName)),\n    );\n  }\n\n  if (addedToDashboard) {\n    if (addedToDashboard.new) {\n      toasts.push(\n        addSuccessToast(\n          t(\n            'Dashboard [%s] just got created and chart [%s] was added to it',\n            addedToDashboard.title,\n            sliceName,\n          ),\n        ),\n      );\n    } else {\n      toasts.push(\n        addSuccessToast(\n          t(\n            'Chart [%s] was added to dashboard [%s]',\n            sliceName,\n            addedToDashboard.title,\n          ),\n        ),\n      );\n    }\n  }\n\n  return toasts;\n};\n\n//  Update existing slice\nexport const updateSlice =\n  (slice, sliceName, dashboards, addedToDashboard) =>\n  async (dispatch, getState) => {\n    const { slice_id: sliceId, owners, form_data: formDataFromSlice } = slice;\n    const {\n      explore: {\n        form_data: { url_params: _, ...formData },\n      },\n    } = getState();\n    try {\n      const response = await SupersetClient.put({\n        endpoint: `/api/v1/chart/${sliceId}`,\n        jsonPayload: getSlicePayload(\n          sliceName,\n          formData,\n          dashboards,\n          owners,\n          formDataFromSlice,\n        ),\n      });\n\n      dispatch(saveSliceSuccess());\n      addToasts(false, sliceName, addedToDashboard).map(dispatch);\n      return response.json;\n    } catch (error) {\n      dispatch(saveSliceFailed());\n      throw error;\n    }\n  };\n\n//  Create new slice\nexport const createSlice =\n  (sliceName, dashboards, addedToDashboard) => async (dispatch, getState) => {\n    const {\n      explore: {\n        form_data: { url_params: _, ...formData },\n      },\n    } = getState();\n    try {\n      const response = await SupersetClient.post({\n        endpoint: `/api/v1/chart/`,\n        jsonPayload: getSlicePayload(sliceName, formData, dashboards),\n      });\n\n      dispatch(saveSliceSuccess());\n      addToasts(true, sliceName, addedToDashboard).map(dispatch);\n      return response.json;\n    } catch (error) {\n      dispatch(saveSliceFailed());\n      throw error;\n    }\n  };\n\n//  Create new dashboard\nexport const createDashboard = dashboardName => async dispatch => {\n  try {\n    const response = await SupersetClient.post({\n      endpoint: `/api/v1/dashboard/`,\n      jsonPayload: { dashboard_title: dashboardName },\n    });\n\n    return response.json;\n  } catch (error) {\n    dispatch(saveSliceFailed());\n    throw error;\n  }\n};\n\n//  Get dashboards the slice is added to\nexport const getSliceDashboards = slice => async dispatch => {\n  try {\n    const response = await SupersetClient.get({\n      endpoint: `/api/v1/chart/${slice.slice_id}?q=${rison.encode({\n        columns: ['dashboards.id'],\n      })}`,\n    });\n\n    return response.json.result.dashboards.map(({ id }) => id);\n  } catch (error) {\n    dispatch(saveSliceFailed());\n    throw error;\n  }\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { styled, css } from '@superset-ui/core';\nimport ControlHeader from '../ControlHeader';\nimport Checkbox from '../../../components/Checkbox';\n\nconst propTypes = {\n  value: PropTypes.bool,\n  label: PropTypes.string,\n  onChange: PropTypes.func,\n};\n\nconst defaultProps = {\n  value: false,\n  onChange: () => {},\n};\n\nconst CheckBoxControlWrapper = styled.div`\n  ${({ theme }) => css`\n    .ControlHeader label {\n      color: ${theme.colors.grayscale.dark1};\n    }\n    span[role='checkbox'] {\n      padding-right: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\nexport default class CheckboxControl extends React.Component {\n  onChange() {\n    this.props.onChange(!this.props.value);\n  }\n\n  renderCheckbox() {\n    return (\n      <Checkbox\n        onChange={this.onChange.bind(this)}\n        checked={!!this.props.value}\n      />\n    );\n  }\n\n  render() {\n    if (this.props.label) {\n      return (\n        <CheckBoxControlWrapper>\n          <ControlHeader\n            {...this.props}\n            leftNode={this.renderCheckbox()}\n            onClick={this.onChange.bind(this)}\n          />\n        </CheckBoxControlWrapper>\n      );\n    }\n    return this.renderCheckbox();\n  }\n}\nCheckboxControl.propTypes = propTypes;\nCheckboxControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  CUSTOM_OPERATORS,\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport { translateToSql } from '../utils/translateToSQL';\nimport { CLAUSES, EXPRESSION_TYPES } from '../types';\n\nconst CUSTOM_OPERATIONS = [...CUSTOM_OPERATORS].map(\n  op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n);\n\nexport default class AdhocFilter {\n  constructor(adhocFilter) {\n    this.expressionType = adhocFilter.expressionType || EXPRESSION_TYPES.SIMPLE;\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      this.subject = adhocFilter.subject;\n      this.operator = adhocFilter.operator?.toUpperCase();\n      this.operatorId = adhocFilter.operatorId;\n      this.comparator = adhocFilter.comparator;\n      if (\n        [Operators.IS_TRUE, Operators.IS_FALSE].indexOf(\n          adhocFilter.operatorId,\n        ) >= 0\n      ) {\n        this.comparator = adhocFilter.operatorId === Operators.IS_TRUE;\n      }\n      if (\n        [Operators.IS_NULL, Operators.IS_NOT_NULL].indexOf(\n          adhocFilter.operatorId,\n        ) >= 0\n      ) {\n        this.comparator = null;\n      }\n      this.clause = adhocFilter.clause || CLAUSES.WHERE;\n      this.sqlExpression = null;\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      this.sqlExpression =\n        typeof adhocFilter.sqlExpression === 'string'\n          ? adhocFilter.sqlExpression\n          : translateToSql(adhocFilter, { useSimple: true });\n      this.clause = adhocFilter.clause;\n      if (\n        adhocFilter.operator &&\n        CUSTOM_OPERATIONS.indexOf(adhocFilter.operator) >= 0\n      ) {\n        this.subject = adhocFilter.subject;\n        this.operator = adhocFilter.operator;\n        this.operatorId = adhocFilter.operatorId;\n      } else {\n        this.subject = null;\n        this.operator = null;\n      }\n      this.comparator = null;\n    }\n    this.isExtra = !!adhocFilter.isExtra;\n    this.isNew = !!adhocFilter.isNew;\n    this.datasourceWarning = !!adhocFilter.datasourceWarning;\n\n    this.filterOptionName =\n      adhocFilter.filterOptionName ||\n      `filter_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocFilter({\n      ...this,\n      // all duplicated fields are not new (i.e. will not open popup automatically)\n      isNew: false,\n      ...nextFields,\n    });\n  }\n\n  equals(adhocFilter) {\n    return (\n      adhocFilter.expressionType === this.expressionType &&\n      adhocFilter.sqlExpression === this.sqlExpression &&\n      adhocFilter.operator === this.operator &&\n      adhocFilter.operatorId === this.operatorId &&\n      adhocFilter.comparator === this.comparator &&\n      adhocFilter.subject === this.subject\n    );\n  }\n\n  isValid() {\n    const nullCheckOperators = [Operators.IS_NOT_NULL, Operators.IS_NULL].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    const truthCheckOperators = [Operators.IS_TRUE, Operators.IS_FALSE].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      if (nullCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.operator && this.subject);\n      }\n      if (truthCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.subject && this.comparator !== null);\n      }\n      if (this.operator && this.subject && this.clause) {\n        if (Array.isArray(this.comparator)) {\n          if (this.comparator.length > 0) {\n            // A non-empty array of values ('IN' or 'NOT IN' clauses)\n            return true;\n          }\n        } else if (this.comparator !== null) {\n          // A value has been selected or typed\n          return true;\n        }\n      }\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return !!(this.sqlExpression && this.clause);\n    }\n    return false;\n  }\n\n  getDefaultLabel() {\n    const label = this.translateToSql();\n    return label.length < 43 ? label : `${label.substring(0, 40)}...`;\n  }\n\n  getTooltipTitle() {\n    return this.translateToSql();\n  }\n\n  translateToSql() {\n    return translateToSql(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { OptionControlLabel } from 'src/explore/components/controls/OptionControls';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { OptionSortType } from 'src/explore/types';\nimport { Operators } from 'src/explore/constants';\nimport { useGetTimeRangeLabel } from '../utils';\n\nexport interface AdhocFilterOptionProps {\n  adhocFilter: AdhocFilter;\n  onFilterEdit: () => void;\n  onRemoveFilter: () => void;\n  options: OptionSortType[];\n  sections: string[];\n  operators: Operators[];\n  datasource: Record<string, any>;\n  partitionColumn: string;\n  onMoveLabel: () => void;\n  onDropLabel: () => void;\n  index: number;\n}\n\nexport default function AdhocFilterOption({\n  adhocFilter,\n  options,\n  datasource,\n  onFilterEdit,\n  onRemoveFilter,\n  partitionColumn,\n  onMoveLabel,\n  onDropLabel,\n  index,\n  sections,\n  operators,\n}: AdhocFilterOptionProps) {\n  const { actualTimeRange, title } = useGetTimeRangeLabel(adhocFilter);\n\n  return (\n    <AdhocFilterPopoverTrigger\n      sections={sections}\n      operators={operators}\n      adhocFilter={adhocFilter}\n      options={options}\n      datasource={datasource}\n      onFilterEdit={onFilterEdit}\n      partitionColumn={partitionColumn}\n    >\n      <OptionControlLabel\n        label={actualTimeRange ?? adhocFilter.getDefaultLabel()}\n        tooltipTitle={title ?? adhocFilter.getTooltipTitle()}\n        onRemove={onRemoveFilter}\n        onMoveLabel={onMoveLabel}\n        onDropLabel={onDropLabel}\n        index={index}\n        type={DndItemType.FilterOption}\n        withCaret\n        isExtra={adhocFilter.isExtra}\n      />\n    </AdhocFilterPopoverTrigger>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { CLAUSES, EXPRESSION_TYPES } from './types';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SIMPLE]).isRequired,\n    clause: PropTypes.oneOf([CLAUSES.HAVING, CLAUSES.WHERE]).isRequired,\n    subject: PropTypes.string.isRequired,\n    comparator: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.arrayOf(PropTypes.string),\n    ]).isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SQL]).isRequired,\n    clause: PropTypes.oneOf([CLAUSES.WHERE, CLAUSES.HAVING]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  t,\n  logging,\n  SupersetClient,\n  withTheme,\n  ensureIsArray,\n} from '@superset-ui/core';\n\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport {\n  AddControlLabel,\n  AddIconButton,\n  HeaderContainer,\n  LabelsContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport Icons from 'src/components/Icons';\nimport Modal from 'src/components/Modal';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilterOption from 'src/explore/components/controls/FilterControl/AdhocFilterOption';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport adhocFilterType from 'src/explore/components/controls/FilterControl/adhocFilterType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport { CLAUSES, EXPRESSION_TYPES } from '../types';\n\nconst { warning } = Modal;\n\nconst selectedMetricType = PropTypes.oneOfType([\n  PropTypes.string,\n  adhocMetricType,\n]);\n\nconst propTypes = {\n  label: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  name: PropTypes.string,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  onChange: PropTypes.func,\n  value: PropTypes.arrayOf(adhocFilterType),\n  datasource: PropTypes.object,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  selectedMetrics: PropTypes.oneOfType([\n    selectedMetricType,\n    PropTypes.arrayOf(selectedMetricType),\n  ]),\n  isLoading: PropTypes.bool,\n  canDelete: PropTypes.func,\n};\n\nconst defaultProps = {\n  name: '',\n  onChange: () => {},\n  columns: [],\n  savedMetrics: [],\n  selectedMetrics: [],\n};\n\nfunction isDictionaryForAdhocFilter(value) {\n  return value && !(value instanceof AdhocFilter) && value.expressionType;\n}\n\nclass AdhocFilterControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.optionsForSelect = this.optionsForSelect.bind(this);\n    this.onRemoveFilter = this.onRemoveFilter.bind(this);\n    this.onNewFilter = this.onNewFilter.bind(this);\n    this.onFilterEdit = this.onFilterEdit.bind(this);\n    this.moveLabel = this.moveLabel.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.mapOption = this.mapOption.bind(this);\n    this.getMetricExpression = this.getMetricExpression.bind(this);\n    this.removeFilter = this.removeFilter.bind(this);\n\n    const filters = (this.props.value || []).map(filter =>\n      isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n    );\n\n    this.optionRenderer = option => <FilterDefinitionOption option={option} />;\n    this.valueRenderer = (adhocFilter, index) => (\n      <AdhocFilterOption\n        key={index}\n        index={index}\n        adhocFilter={adhocFilter}\n        onFilterEdit={this.onFilterEdit}\n        options={this.state.options}\n        sections={this.props.sections}\n        operators={this.props.operators}\n        datasource={this.props.datasource}\n        onRemoveFilter={e => {\n          e.stopPropagation();\n          this.onRemoveFilter(index);\n        }}\n        onMoveLabel={this.moveLabel}\n        onDropLabel={() => this.props.onChange(this.state.values)}\n        partitionColumn={this.state.partitionColumn}\n      />\n    );\n    this.state = {\n      values: filters,\n      options: this.optionsForSelect(this.props),\n      partitionColumn: null,\n    };\n  }\n\n  componentDidMount() {\n    const { datasource } = this.props;\n    if (datasource && datasource.type === 'table') {\n      const dbId = datasource.database?.id;\n      const {\n        datasource_name: name,\n        schema,\n        is_sqllab_view: isSqllabView,\n      } = datasource;\n\n      if (!isSqllabView && dbId && name && schema) {\n        SupersetClient.get({\n          endpoint: `/api/v1/database/${dbId}/table_extra/${name}/${schema}/`,\n        })\n          .then(({ json }) => {\n            if (json && json.partitions) {\n              const { partitions } = json;\n              // for now only show latest_partition option\n              // when table datasource has only 1 partition key.\n              if (\n                partitions &&\n                partitions.cols &&\n                Object.keys(partitions.cols).length === 1\n              ) {\n                this.setState({ partitionColumn: partitions.cols[0] });\n              }\n            }\n          })\n          .catch(error => {\n            logging.error('fetch extra_table_metadata:', error.statusText);\n          });\n      }\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (this.props.columns !== nextProps.columns) {\n      this.setState({ options: this.optionsForSelect(nextProps) });\n    }\n    if (this.props.value !== nextProps.value) {\n      this.setState({\n        values: (nextProps.value || []).map(filter =>\n          isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n        ),\n      });\n    }\n  }\n\n  removeFilter(index) {\n    const valuesCopy = [...this.state.values];\n    valuesCopy.splice(index, 1);\n    this.setState(prevState => ({\n      ...prevState,\n      values: valuesCopy,\n    }));\n    this.props.onChange(valuesCopy);\n  }\n\n  onRemoveFilter(index) {\n    const { canDelete } = this.props;\n    const { values } = this.state;\n    const result = canDelete?.(values[index], values);\n    if (typeof result === 'string') {\n      warning({ title: t('Warning'), content: result });\n      return;\n    }\n    this.removeFilter(index);\n  }\n\n  onNewFilter(newFilter) {\n    const mappedOption = this.mapOption(newFilter);\n    if (mappedOption) {\n      this.setState(\n        prevState => ({\n          ...prevState,\n          values: [...prevState.values, mappedOption],\n        }),\n        () => {\n          this.props.onChange(this.state.values);\n        },\n      );\n    }\n  }\n\n  onFilterEdit(changedFilter) {\n    this.props.onChange(\n      this.state.values.map(value => {\n        if (value.filterOptionName === changedFilter.filterOptionName) {\n          return changedFilter;\n        }\n        return value;\n      }),\n    );\n  }\n\n  onChange(opts) {\n    const options = (opts || [])\n      .map(option => this.mapOption(option))\n      .filter(option => option);\n    this.props.onChange(options);\n  }\n\n  getMetricExpression(savedMetricName) {\n    return this.props.savedMetrics.find(\n      savedMetric => savedMetric.metric_name === savedMetricName,\n    ).expression;\n  }\n\n  moveLabel(dragIndex, hoverIndex) {\n    const { values } = this.state;\n\n    const newValues = [...values];\n    [newValues[hoverIndex], newValues[dragIndex]] = [\n      newValues[dragIndex],\n      newValues[hoverIndex],\n    ];\n    this.setState({ values: newValues });\n  }\n\n  mapOption(option) {\n    // already a AdhocFilter, skip\n    if (option instanceof AdhocFilter) {\n      return option;\n    }\n    // via datasource saved metric\n    if (option.saved_metric_name) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        subject: this.getMetricExpression(option.saved_metric_name),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n        comparator: 0,\n        clause: CLAUSES.HAVING,\n      });\n    }\n    // has a custom label, meaning it's custom column\n    if (option.label) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        subject: new AdhocMetric(option).translateToSql(),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n        comparator: 0,\n        clause: CLAUSES.HAVING,\n      });\n    }\n    // add a new filter item\n    if (option.column_name) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n        subject: option.column_name,\n        operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.EQUALS].operation,\n        comparator: '',\n        clause: CLAUSES.WHERE,\n        isNew: true,\n      });\n    }\n    return null;\n  }\n\n  optionsForSelect(props) {\n    const options = [\n      ...props.columns,\n      ...ensureIsArray(props.selectedMetrics).map(\n        metric =>\n          metric &&\n          (typeof metric === 'string'\n            ? { saved_metric_name: metric }\n            : new AdhocMetric(metric)),\n      ),\n    ].filter(option => option);\n\n    return options\n      .reduce((results, option) => {\n        if (option.saved_metric_name) {\n          results.push({\n            ...option,\n            filterOptionName: option.saved_metric_name,\n          });\n        } else if (option.column_name) {\n          results.push({\n            ...option,\n            filterOptionName: `_col_${option.column_name}`,\n          });\n        } else if (option instanceof AdhocMetric) {\n          results.push({\n            ...option,\n            filterOptionName: `_adhocmetric_${option.label}`,\n          });\n        }\n        return results;\n      }, [])\n      .sort((a, b) =>\n        (a.saved_metric_name || a.column_name || a.label).localeCompare(\n          b.saved_metric_name || b.column_name || b.label,\n        ),\n      );\n  }\n\n  addNewFilterPopoverTrigger(trigger) {\n    return (\n      <AdhocFilterPopoverTrigger\n        operators={this.props.operators}\n        sections={this.props.sections}\n        adhocFilter={new AdhocFilter({})}\n        datasource={this.props.datasource}\n        options={this.state.options}\n        onFilterEdit={this.onNewFilter}\n        partitionColumn={this.state.partitionColumn}\n      >\n        {trigger}\n      </AdhocFilterPopoverTrigger>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div className=\"metrics-select\" data-test=\"adhoc-filter-control\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          {this.addNewFilterPopoverTrigger(\n            <AddIconButton data-test=\"add-filter-button\">\n              <Icons.PlusLarge\n                iconSize=\"s\"\n                iconColor={theme.colors.grayscale.light5}\n              />\n            </AddIconButton>,\n          )}\n        </HeaderContainer>\n        <LabelsContainer>\n          {this.state.values.length > 0\n            ? this.state.values.map((value, index) =>\n                this.valueRenderer(value, index),\n              )\n            : this.addNewFilterPopoverTrigger(\n                <AddControlLabel>\n                  <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n                  {t('Add filter')}\n                </AddControlLabel>,\n              )}\n        </LabelsContainer>\n      </div>\n    );\n  }\n}\n\nAdhocFilterControl.propTypes = propTypes;\nAdhocFilterControl.defaultProps = defaultProps;\n\nexport default withTheme(AdhocFilterControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  sqlaAutoGeneratedMetricRegex,\n  AGGREGATES,\n} from 'src/explore/constants';\n\nexport const EXPRESSION_TYPES = {\n  SIMPLE: 'SIMPLE',\n  SQL: 'SQL',\n};\n\nfunction inferSqlExpressionColumn(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstCloseParen = adhocMetric.sqlExpression.indexOf(')');\n    const indexPairedOpenParen = adhocMetric.sqlExpression\n      .substring(0, indexFirstCloseParen)\n      .lastIndexOf('(');\n    if (indexFirstCloseParen > 0 && indexPairedOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(\n        indexPairedOpenParen + 1,\n        indexFirstCloseParen,\n      );\n    }\n  }\n  return null;\n}\n\nfunction inferSqlExpressionAggregate(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstOpenParen = adhocMetric.sqlExpression.indexOf('(');\n    if (indexFirstOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(0, indexFirstOpenParen);\n    }\n  }\n  return null;\n}\n\nexport default class AdhocMetric {\n  constructor(adhocMetric) {\n    this.expressionType = adhocMetric.expressionType || EXPRESSION_TYPES.SIMPLE;\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      // try to be clever in the case of transitioning from Sql expression back to simple expression\n      const inferredColumn = inferSqlExpressionColumn(adhocMetric);\n      this.column =\n        adhocMetric.column ||\n        (inferredColumn && { column_name: inferredColumn });\n      this.aggregate =\n        adhocMetric.aggregate || inferSqlExpressionAggregate(adhocMetric);\n      this.sqlExpression = null;\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      this.sqlExpression = adhocMetric.sqlExpression;\n      this.column = null;\n      this.aggregate = null;\n    }\n    this.datasourceWarning = !!adhocMetric.datasourceWarning;\n    this.hasCustomLabel = !!(adhocMetric.hasCustomLabel && adhocMetric.label);\n    this.label = this.hasCustomLabel\n      ? adhocMetric.label\n      : this.getDefaultLabel();\n\n    this.optionName =\n      adhocMetric.optionName ||\n      `metric_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  getDefaultLabel() {\n    return this.translateToSql({ useVerboseName: true });\n  }\n\n  translateToSql(\n    params = { useVerboseName: false, transformCountDistinct: false },\n  ) {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      const aggregate = this.aggregate || '';\n      // eslint-disable-next-line camelcase\n      const column =\n        params.useVerboseName && this.column?.verbose_name\n          ? `(${this.column.verbose_name})`\n          : this.column?.column_name\n          ? `(${this.column.column_name})`\n          : '';\n      // transform from `count_distinct(column)` to `count(distinct column)`\n      if (\n        params.transformCountDistinct &&\n        aggregate === AGGREGATES.COUNT_DISTINCT &&\n        /^\\(.*\\)$/.test(column)\n      ) {\n        return `COUNT(DISTINCT ${column.slice(1, -1)})`;\n      }\n      return aggregate + column;\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return this.sqlExpression;\n    }\n    return '';\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocMetric({\n      ...this,\n      ...nextFields,\n    });\n  }\n\n  equals(adhocMetric) {\n    return (\n      adhocMetric.label === this.label &&\n      adhocMetric.expressionType === this.expressionType &&\n      adhocMetric.sqlExpression === this.sqlExpression &&\n      adhocMetric.aggregate === this.aggregate &&\n      (adhocMetric.column && adhocMetric.column.column_name) ===\n        (this.column && this.column.column_name)\n    );\n  }\n\n  isValid() {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      return !!(this.column && this.aggregate);\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return !!this.sqlExpression;\n    }\n    return false;\n  }\n\n  inferSqlExpressionAggregate() {\n    return inferSqlExpressionAggregate(this);\n  }\n\n  inferSqlExpressionColumn() {\n    return inferSqlExpressionColumn(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport columnType from './columnType';\nimport adhocMetricType from './adhocMetricType';\nimport { StyledColumnOption } from '../../optionRenderers';\n\nconst propTypes = {\n  option: PropTypes.oneOfType([\n    columnType,\n    PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n    adhocMetricType,\n  ]).isRequired,\n};\n\nexport default function FilterDefinitionOption({ option }) {\n  if (option.saved_metric_name) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.saved_metric_name, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  if (option.column_name) {\n    return <StyledColumnOption column={option} showType />;\n  }\n  if (option.label) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.label, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  return null;\n}\nFilterDefinitionOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nimport { AGGREGATES } from 'src/explore/constants';\nimport columnType from './columnType';\nimport { EXPRESSION_TYPES } from './AdhocMetric';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SIMPLE]).isRequired,\n    column: columnType.isRequired,\n    aggregate: PropTypes.oneOf(Object.keys(AGGREGATES)).isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SQL]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  metric_name: PropTypes.string,\n  verbose_name: PropTypes.string,\n  expression: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css, isEqualArray, t } from '@superset-ui/core';\nimport Select from 'src/components/Select/Select';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  ariaLabel: PropTypes.string,\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  mode: PropTypes.string,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  onSelect: PropTypes.func,\n  onDeselect: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  default: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  filterOption: PropTypes.func,\n  tokenSeparators: PropTypes.arrayOf(PropTypes.string),\n  notFoundContent: PropTypes.object,\n\n  // ControlHeader props\n  label: PropTypes.string,\n  renderTrigger: PropTypes.bool,\n  validationErrors: PropTypes.array,\n  rightNode: PropTypes.node,\n  leftNode: PropTypes.node,\n  onClick: PropTypes.func,\n  hovered: PropTypes.bool,\n  tooltipOnClick: PropTypes.func,\n  warning: PropTypes.string,\n  danger: PropTypes.string,\n};\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value',\n};\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: this.getOptions(props),\n    };\n    this.onChange = this.onChange.bind(this);\n    this.handleFilterOptions = this.handleFilterOptions.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      !isEqualArray(nextProps.choices, this.props.choices) ||\n      !isEqualArray(nextProps.options, this.props.options)\n    ) {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(val) {\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    const { valueKey } = this.props;\n    let onChangeVal = val;\n\n    if (Array.isArray(val)) {\n      const values = val.map(v =>\n        v?.[valueKey] !== undefined ? v[valueKey] : v,\n      );\n      onChangeVal = values;\n    }\n    if (typeof val === 'object' && val?.[valueKey] !== undefined) {\n      onChangeVal = val[valueKey];\n    }\n    this.props.onChange(onChangeVal, []);\n  }\n\n  getOptions(props) {\n    const { choices, optionRenderer, valueKey } = props;\n    let options = [];\n    if (props.options) {\n      options = props.options.map(o => ({\n        ...o,\n        value: o[valueKey],\n        label: o.label || o[valueKey],\n        customLabel: optionRenderer ? optionRenderer(o) : undefined,\n      }));\n    } else if (choices) {\n      // Accepts different formats of input\n      options = choices.map(c => {\n        if (Array.isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return {\n            value,\n            label,\n          };\n        }\n        if (Object.is(c)) {\n          return {\n            ...c,\n            value: c[valueKey],\n            label: c.label || c[valueKey],\n          };\n        }\n        return { value: c, label: c };\n      });\n    }\n    return options;\n  }\n\n  handleFilterOptions(text, option) {\n    const { filterOption } = this.props;\n    return filterOption({ data: option }, text);\n  }\n\n  render() {\n    const {\n      ariaLabel,\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      freeForm,\n      isLoading,\n      isMulti,\n      label,\n      multi,\n      name,\n      notFoundContent,\n      onFocus,\n      onSelect,\n      onDeselect,\n      placeholder,\n      showHeader,\n      tokenSeparators,\n      value,\n      // ControlHeader props\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    } = this.props;\n\n    const headerProps = {\n      name,\n      label,\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    };\n\n    const getValue = () => {\n      const currentValue =\n        value ||\n        (this.props.default !== undefined ? this.props.default : undefined);\n\n      // safety check - the value is intended to be undefined but null was used\n      if (\n        currentValue === null &&\n        !this.state.options.find(o => o.value === null)\n      ) {\n        return undefined;\n      }\n      return currentValue;\n    };\n\n    const selectProps = {\n      allowNewOptions: freeForm,\n      autoFocus,\n      ariaLabel:\n        ariaLabel || (typeof label === 'string' ? label : t('Select ...')),\n      allowClear: clearable,\n      disabled,\n      filterOption:\n        filterOption && typeof filterOption === 'function'\n          ? this.handleFilterOptions\n          : true,\n      header: showHeader && <ControlHeader {...headerProps} />,\n      loading: isLoading,\n      mode: this.props.mode || (isMulti || multi ? 'multiple' : 'single'),\n      name: `select-${name}`,\n      onChange: this.onChange,\n      onFocus,\n      onSelect,\n      onDeselect,\n      options: this.state.options,\n      placeholder,\n      sortComparator: this.props.sortComparator,\n      value: getValue(),\n      tokenSeparators,\n      notFoundContent,\n    };\n\n    return (\n      <div\n        css={theme => css`\n          .type-label {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          .Select__multi-value__label > span,\n          .Select__option > span,\n          .Select__single-value > span {\n            display: flex;\n            align-items: center;\n          }\n        `}\n      >\n        <Select {...selectProps} />\n      </div>\n    );\n  }\n}\n\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/components';\nimport { t } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport Popover from 'src/components/Popover';\nimport PopoverSection from 'src/components/PopoverSection';\nimport Checkbox from 'src/components/Checkbox';\nimport ControlHeader from '../ControlHeader';\nimport SelectControl from './SelectControl';\n\nconst spatialTypes = {\n  latlong: 'latlong',\n  delimited: 'delimited',\n  geohash: 'geohash',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  animation: PropTypes.bool,\n  choices: PropTypes.array,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  animation: true,\n  choices: [],\n};\n\nexport default class SpatialControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const v = props.value || {};\n    let defaultCol;\n    if (props.choices.length > 0) {\n      defaultCol = props.choices[0][0];\n    }\n    this.state = {\n      type: v.type || spatialTypes.latlong,\n      delimiter: v.delimiter || ',',\n      latCol: v.latCol || defaultCol,\n      lonCol: v.lonCol || defaultCol,\n      lonlatCol: v.lonlatCol || defaultCol,\n      reverseCheckbox: v.reverseCheckbox || false,\n      geohashCol: v.geohashCol || defaultCol,\n      value: null,\n      errors: [],\n    };\n    this.toggleCheckbox = this.toggleCheckbox.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.renderReverseCheckbox = this.renderReverseCheckbox.bind(this);\n  }\n\n  componentDidMount() {\n    this.onChange();\n  }\n\n  onChange() {\n    const { type } = this.state;\n    const value = { type };\n    const errors = [];\n    const errMsg = t('Invalid lat/long configuration.');\n    if (type === spatialTypes.latlong) {\n      value.latCol = this.state.latCol;\n      value.lonCol = this.state.lonCol;\n      if (!value.lonCol || !value.latCol) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.delimited) {\n      value.lonlatCol = this.state.lonlatCol;\n      value.delimiter = this.state.delimiter;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.lonlatCol || !value.delimiter) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.geohash) {\n      value.geohashCol = this.state.geohashCol;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.geohashCol) {\n        errors.push(errMsg);\n      }\n    }\n    this.setState({ value, errors });\n    this.props.onChange(value, errors);\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  toggleCheckbox() {\n    this.setState(\n      prevState => ({ reverseCheckbox: !prevState.reverseCheckbox }),\n      this.onChange,\n    );\n  }\n\n  renderLabelContent() {\n    if (this.state.errors.length > 0) {\n      return 'N/A';\n    }\n    if (this.state.type === spatialTypes.latlong) {\n      return `${this.state.lonCol} | ${this.state.latCol}`;\n    }\n    if (this.state.type === spatialTypes.delimited) {\n      return `${this.state.lonlatCol}`;\n    }\n    if (this.state.type === spatialTypes.geohash) {\n      return `${this.state.geohashCol}`;\n    }\n    return null;\n  }\n\n  renderSelect(name, type) {\n    return (\n      <SelectControl\n        ariaLabel={name}\n        name={name}\n        choices={this.props.choices}\n        value={this.state[name]}\n        clearable={false}\n        onFocus={() => {\n          this.setType(type);\n        }}\n        onChange={value => {\n          this.setState({ [name]: value }, this.onChange);\n        }}\n      />\n    );\n  }\n\n  renderReverseCheckbox() {\n    return (\n      <span>\n        {t('Reverse lat/long ')}\n        <Checkbox\n          checked={this.state.reverseCheckbox}\n          onChange={this.toggleCheckbox}\n        />\n      </span>\n    );\n  }\n\n  renderPopoverContent() {\n    return (\n      <div style={{ width: '300px' }}>\n        <PopoverSection\n          title={t('Longitude & Latitude columns')}\n          isSelected={this.state.type === spatialTypes.latlong}\n          onSelect={this.setType.bind(this, spatialTypes.latlong)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Longitude')}\n              {this.renderSelect('lonCol', spatialTypes.latlong)}\n            </Col>\n            <Col xs={24} md={12}>\n              {t('Latitude')}\n              {this.renderSelect('latCol', spatialTypes.latlong)}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Delimited long & lat single column')}\n          info={t(\n            'Multiple formats accepted, look the geopy.points ' +\n              'Python library for more details',\n          )}\n          isSelected={this.state.type === spatialTypes.delimited}\n          onSelect={this.setType.bind(this, spatialTypes.delimited)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Column')}\n              {this.renderSelect('lonlatCol', spatialTypes.delimited)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Geohash')}\n          isSelected={this.state.type === spatialTypes.geohash}\n          onSelect={this.setType.bind(this, spatialTypes.geohash)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Column')}\n              {this.renderSelect('geohashCol', spatialTypes.geohash)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          content={this.renderPopoverContent()}\n          placement=\"topLeft\" // so that popover doesn't move when label changes\n          trigger=\"click\"\n        >\n          <Label className=\"pointer\">{this.renderLabelContent()}</Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nSpatialControl.propTypes = propTypes;\nSpatialControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { TextArea } from 'src/components/Input';\nimport { t, withTheme } from '@superset-ui/core';\n\nimport Button from 'src/components/Button';\nimport { TextAreaEditor } from 'src/components/AsyncAceEditor';\nimport ModalTrigger from 'src/components/ModalTrigger';\n\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  name: PropTypes.string,\n  onChange: PropTypes.func,\n  initialValue: PropTypes.string,\n  height: PropTypes.number,\n  minLines: PropTypes.number,\n  maxLines: PropTypes.number,\n  offerEditInModal: PropTypes.bool,\n  language: PropTypes.oneOf([\n    null,\n    'json',\n    'html',\n    'sql',\n    'markdown',\n    'javascript',\n  ]),\n  aboveEditorSection: PropTypes.node,\n  readOnly: PropTypes.bool,\n  resize: PropTypes.oneOf([\n    null,\n    'block',\n    'both',\n    'horizontal',\n    'inline',\n    'none',\n    'vertical',\n  ]),\n  textAreaStyles: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  initialValue: '',\n  height: 250,\n  minLines: 3,\n  maxLines: 10,\n  offerEditInModal: true,\n  readOnly: false,\n  resize: null,\n  textAreaStyles: {},\n};\n\nclass TextAreaControl extends React.Component {\n  onControlChange(event) {\n    const { value } = event.target;\n    this.props.onChange(value);\n  }\n\n  onAreaEditorChange(value) {\n    this.props.onChange(value);\n  }\n\n  renderEditor(inModal = false) {\n    const minLines = inModal ? 40 : this.props.minLines || 12;\n    if (this.props.language) {\n      const style = {\n        border: `1px solid ${this.props.theme.colors.grayscale.light1}`,\n        minHeight: `${minLines}em`,\n        width: 'auto',\n        ...this.props.textAreaStyles,\n      };\n      if (this.props.resize) {\n        style.resize = this.props.resize;\n      }\n      if (this.props.readOnly) {\n        style.backgroundColor = '#f2f2f2';\n      }\n\n      return (\n        <TextAreaEditor\n          mode={this.props.language}\n          style={style}\n          minLines={minLines}\n          maxLines={inModal ? 1000 : this.props.maxLines}\n          editorProps={{ $blockScrolling: true }}\n          defaultValue={this.props.initialValue}\n          readOnly={this.props.readOnly}\n          key={this.props.name}\n          {...this.props}\n          onChange={this.onAreaEditorChange.bind(this)}\n        />\n      );\n    }\n    return (\n      <TextArea\n        placeholder={t('textarea')}\n        onChange={this.onControlChange.bind(this)}\n        defaultValue={this.props.initialValue}\n        disabled={this.props.readOnly}\n        style={{ height: this.props.height }}\n      />\n    );\n  }\n\n  renderModalBody() {\n    return (\n      <>\n        <div>{this.props.aboveEditorSection}</div>\n        {this.renderEditor(true)}\n      </>\n    );\n  }\n\n  render() {\n    const controlHeader = <ControlHeader {...this.props} />;\n    return (\n      <div>\n        {controlHeader}\n        {this.renderEditor()}\n        {this.props.offerEditInModal && (\n          <ModalTrigger\n            modalTitle={controlHeader}\n            triggerNode={\n              <Button buttonSize=\"small\" className=\"m-t-5\">\n                {t('Edit')} <strong>{this.props.language}</strong>{' '}\n                {t('in modal')}\n              </Button>\n            }\n            modalBody={this.renderModalBody(true)}\n            responsive\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nTextAreaControl.propTypes = propTypes;\nTextAreaControl.defaultProps = defaultProps;\n\nexport default withTheme(TextAreaControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * This file exports all controls available for use in the different visualization types\n *\n * While the React components located in `controls/components` represent different\n * types of controls (CheckboxControl, SelectControl, TextControl, ...), the controls here\n * represent instances of control types, that can be reused across visualization types.\n *\n * When controls are reused across viz types, their values are carried over as a user\n * changes the chart types.\n *\n * While the keys defined in the control itself get passed to the controlType as props,\n * here's a list of the keys that are common to all controls, and as a result define the\n * control interface:\n *\n * - type: the control type, referencing a React component of the same name\n * - label: the label as shown in the control's header\n * - description: shown in the info tooltip of the control's header\n * - default: the default value when opening a new chart, or changing visualization type\n * - renderTrigger: a bool that defines whether the visualization should be re-rendered\n     when changed. This should `true` for controls that only affect the rendering (client side)\n     and don't affect the query or backend data processing as those require to re run a query\n     and fetch the data\n * - validators: an array of functions that will receive the value of the component and\n     should return error messages when the value is not valid. The error message gets\n     bubbled up to the control header, section header and query panel header.\n * - warning: text shown as a tooltip on a warning icon in the control's header\n * - error: text shown as a tooltip on a error icon in the control's header\n * - mapStateToProps: a function that receives the App's state and return an object of k/v\n     to overwrite configuration at runtime. This is useful to alter a component based on\n     anything external to it, like another control's value. For instance it's possible to\n     show a warning based on the value of another component. It's also possible to bind\n     arbitrary data from the redux store to the component this way.\n * - tabOverride: set to 'data' if you want to force a renderTrigger to show up on the `Data`\n     tab, otherwise `renderTrigger: true` components will show up on the `Style` tab.\n *\n * Note that the keys defined in controls in this file that are not listed above represent\n * props specific for the React component defined as `type`. Also note that this module work\n * in tandem with `controlPanels/index.js` that defines how controls are composed into sections for\n * each and every visualization type.\n */\nimport React from 'react';\nimport {\n  t,\n  getCategoricalSchemeRegistry,\n  getSequentialSchemeRegistry,\n  legacyValidateInteger,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport { formatSelectOptions } from 'src/explore/exploreUtils';\nimport { TIME_FILTER_LABELS } from './constants';\nimport { StyledColumnOption } from './components/optionRenderers';\n\nconst categoricalSchemeRegistry = getCategoricalSchemeRegistry();\nconst sequentialSchemeRegistry = getSequentialSchemeRegistry();\n\nexport const PRIMARY_COLOR = { r: 0, g: 122, b: 135, a: 1 };\n\n// input choices & options\nexport const D3_FORMAT_OPTIONS = [\n  ['SMART_NUMBER', t('Adaptive formatting')],\n  ['~g', t('Original value')],\n  [',d', ',d (12345.432 => 12,345)'],\n  ['.1s', '.1s (12345.432 => 10k)'],\n  ['.3s', '.3s (12345.432 => 12.3k)'],\n  [',.1%', ',.1% (12345.432 => 1,234,543.2%)'],\n  ['.3%', '.3% (12345.432 => 1234543.200%)'],\n  ['.4r', '.4r (12345.432 => 12350)'],\n  [',.3f', ',.3f (12345.432 => 12,345.432)'],\n  ['+,', '+, (12345.432 => +12,345.432)'],\n  ['$,.2f', '$,.2f (12345.432 => $12,345.43)'],\n  ['DURATION', t('Duration in ms (66000 => 1m 6s)')],\n  ['DURATION_SUB', t('Duration in ms (100.40008 => 100ms 400s 80ns)')],\n];\n\nconst ROW_LIMIT_OPTIONS = [10, 50, 100, 250, 500, 1000, 5000, 10000, 50000];\n\nconst SERIES_LIMITS = [5, 10, 25, 50, 100, 500];\n\nexport const D3_FORMAT_DOCS =\n  'D3 format syntax: https://github.com/d3/d3-format';\n\nexport const D3_TIME_FORMAT_OPTIONS = [\n  ['smart_date', t('Adaptive formatting')],\n  ['%d/%m/%Y', '%d/%m/%Y | 14/01/2019'],\n  ['%m/%d/%Y', '%m/%d/%Y | 01/14/2019'],\n  ['%Y-%m-%d', '%Y-%m-%d | 2019-01-14'],\n  ['%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10'],\n  ['%d-%m-%Y %H:%M:%S', '%Y-%m-%d %H:%M:%S | 14-01-2019 01:32:10'],\n  ['%H:%M:%S', '%H:%M:%S | 01:32:10'],\n];\n\nconst timeColumnOption = {\n  verbose_name: 'Time',\n  column_name: '__timestamp',\n  description: t(\n    'A reference to the [Time] configuration, taking granularity into ' +\n      'account',\n  ),\n};\n\nconst groupByControl = {\n  type: 'SelectControl',\n  multi: true,\n  freeForm: true,\n  label: t('Dimensions'),\n  default: [],\n  includeTime: false,\n  description: t(\n    'One or many columns to group by. High cardinality groupings should include a series limit ' +\n      'to limit the number of fetched and rendered series.',\n  ),\n  optionRenderer: c => <StyledColumnOption column={c} showType />,\n  valueKey: 'column_name',\n  filterOption: ({ data: opt }, text) =>\n    (opt.column_name &&\n      opt.column_name.toLowerCase().indexOf(text.toLowerCase()) >= 0) ||\n    (opt.verbose_name &&\n      opt.verbose_name.toLowerCase().indexOf(text.toLowerCase()) >= 0),\n  mapStateToProps: (state, control) => {\n    const newState = {};\n    if (state.datasource) {\n      newState.options = state.datasource.columns.filter(c => c.groupby);\n      if (control && control.includeTime) {\n        newState.options.push(timeColumnOption);\n      }\n    }\n    return newState;\n  },\n};\n\nconst metrics = {\n  type: 'MetricsControl',\n  multi: true,\n  label: t('Metrics'),\n  validators: [validateNonEmpty],\n  mapStateToProps: state => {\n    const { datasource } = state;\n    return {\n      columns: datasource ? datasource.columns : [],\n      savedMetrics: datasource ? datasource.metrics : [],\n      datasource,\n    };\n  },\n  description: t('One or many metrics to display'),\n};\nconst metric = {\n  ...metrics,\n  multi: false,\n  label: t('Metric'),\n  description: t('Metric'),\n};\n\nexport function columnChoices(datasource) {\n  if (datasource && datasource.columns) {\n    return datasource.columns\n      .map(col => [col.column_name, col.verbose_name || col.column_name])\n      .sort((opt1, opt2) =>\n        opt1[1].toLowerCase() > opt2[1].toLowerCase() ? 1 : -1,\n      );\n  }\n  return [];\n}\n\nexport const controls = {\n  metrics,\n\n  metric,\n\n  datasource: {\n    type: 'DatasourceControl',\n    label: t('Dataset'),\n    default: null,\n    description: null,\n    mapStateToProps: ({ datasource }) => ({\n      datasource,\n      isEditable: !!datasource,\n    }),\n  },\n\n  viz_type: {\n    type: 'VizTypeControl',\n    default: 'table',\n    description: t('The type of visualization to display'),\n  },\n\n  color_picker: {\n    label: t('Fixed color'),\n    description: t('Use this to define a static color for all circles'),\n    type: 'ColorPickerControl',\n    default: PRIMARY_COLOR,\n    renderTrigger: true,\n  },\n\n  metric_2: {\n    ...metric,\n    label: t('Right axis metric'),\n    clearable: true,\n    description: t('Choose a metric for right axis'),\n  },\n\n  linear_color_scheme: {\n    type: 'ColorSchemeControl',\n    label: t('Linear color scheme'),\n    choices: () =>\n      sequentialSchemeRegistry.values().map(value => [value.id, value.label]),\n    default: sequentialSchemeRegistry.getDefaultKey(),\n    clearable: false,\n    description: '',\n    renderTrigger: true,\n    schemes: () => sequentialSchemeRegistry.getMap(),\n    isLinear: true,\n  },\n\n  secondary_metric: {\n    ...metric,\n    label: t('Color metric'),\n    default: null,\n    validators: [],\n    description: t('A metric to use for color'),\n  },\n\n  groupby: groupByControl,\n\n  columns: {\n    ...groupByControl,\n    label: t('Columns'),\n    description: t('One or many controls to pivot as columns'),\n  },\n\n  granularity: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: TIME_FILTER_LABELS.granularity,\n    default: 'P1D',\n    choices: [\n      [null, t('all')],\n      ['PT5S', t('5 seconds')],\n      ['PT30S', t('30 seconds')],\n      ['PT1M', t('1 minute')],\n      ['PT5M', t('5 minutes')],\n      ['PT30M', t('30 minutes')],\n      ['PT1H', t('1 hour')],\n      ['PT6H', t('6 hour')],\n      ['P1D', t('1 day')],\n      ['P7D', t('7 days')],\n      ['P1W', t('week')],\n      ['week_starting_sunday', t('week starting Sunday')],\n      ['week_ending_saturday', t('week ending Saturday')],\n      ['P1M', t('month')],\n      ['P3M', t('quarter')],\n      ['P1Y', t('year')],\n    ],\n    description: t(\n      'The time granularity for the visualization. Note that you ' +\n        'can type and use simple natural language as in `10 seconds`,' +\n        '`1 day` or `56 weeks`',\n    ),\n  },\n\n  granularity_sqla: {\n    type: 'SelectControl',\n    label: TIME_FILTER_LABELS.granularity_sqla,\n    description: t(\n      'The time column for the visualization. Note that you ' +\n        'can define arbitrary expression that return a DATETIME ' +\n        'column in the table. Also note that the ' +\n        'filter below is applied against this column or ' +\n        'expression',\n    ),\n    clearable: false,\n    optionRenderer: c => <StyledColumnOption column={c} showType />,\n    valueKey: 'column_name',\n    mapStateToProps: state => {\n      const props = {};\n      if (state.datasource) {\n        props.choices = state.datasource.granularity_sqla;\n        props.default = null;\n        if (state.datasource.main_dttm_col) {\n          props.default = state.datasource.main_dttm_col;\n        } else if (props.choices && props.choices.length > 0) {\n          props.default = props.choices[0].column_name;\n        }\n      }\n      return props;\n    },\n  },\n\n  time_grain_sqla: {\n    type: 'SelectControl',\n    label: TIME_FILTER_LABELS.time_grain_sqla,\n    default: 'P1D',\n    description: t(\n      'The time granularity for the visualization. This ' +\n        'applies a date transformation to alter ' +\n        'your time column and defines a new time granularity. ' +\n        'The options here are defined on a per database ' +\n        'engine basis in the Superset source code.',\n    ),\n    mapStateToProps: state => ({\n      choices: state.datasource ? state.datasource.time_grain_sqla : null,\n    }),\n  },\n\n  time_range: {\n    type: 'DateFilterControl',\n    freeForm: true,\n    label: TIME_FILTER_LABELS.time_range,\n    default: t('No filter'), // this value is translated, but the backend wouldn't understand a translated value?\n    description: t(\n      'The time range for the visualization. All relative times, e.g. \"Last month\", ' +\n        '\"Last 7 days\", \"now\", etc. are evaluated on the server using the server\\'s ' +\n        'local time (sans timezone). All tooltips and placeholder times are expressed ' +\n        'in UTC (sans timezone). The timestamps are then evaluated by the database ' +\n        \"using the engine's local timezone. Note one can explicitly set the timezone \" +\n        'per the ISO 8601 format if specifying either the start and/or end time.',\n    ),\n  },\n\n  row_limit: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Row limit'),\n    validators: [legacyValidateInteger],\n    default: 10000,\n    choices: formatSelectOptions(ROW_LIMIT_OPTIONS),\n    description: t('Limits the number of rows that get displayed.'),\n  },\n\n  limit: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Series limit'),\n    validators: [legacyValidateInteger],\n    choices: formatSelectOptions(SERIES_LIMITS),\n    clearable: true,\n    description: t(\n      'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n        'where subqueries are not supported) is applied to limit the number of series that get ' +\n        'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n        'column(s) though does increase the query complexity and cost.',\n    ),\n  },\n\n  timeseries_limit_metric: {\n    type: 'MetricsControl',\n    label: t('Sort by'),\n    default: null,\n    clearable: true,\n    description: t(\n      'Metric used to define how the top series are sorted if a series or row limit is present. ' +\n        'If undefined reverts to the first metric (where appropriate).',\n    ),\n    mapStateToProps: state => ({\n      columns: state.datasource ? state.datasource.columns : [],\n      savedMetrics: state.datasource ? state.datasource.metrics : [],\n      datasource: state.datasource,\n    }),\n  },\n\n  series: {\n    ...groupByControl,\n    label: t('Dimensions'),\n    multi: false,\n    default: null,\n    description: t(\n      'Defines the grouping of entities. ' +\n        'Each series is shown as a specific color on the chart and ' +\n        'has a legend toggle',\n    ),\n  },\n\n  entity: {\n    ...groupByControl,\n    label: t('Entity'),\n    default: null,\n    multi: false,\n    validators: [validateNonEmpty],\n    description: t('This defines the element to be plotted on the chart'),\n  },\n\n  x: {\n    ...metric,\n    label: t('X Axis'),\n    description: t('Metric assigned to the [X] axis'),\n    default: null,\n  },\n\n  y: {\n    ...metric,\n    label: t('Y Axis'),\n    default: null,\n    description: t('Metric assigned to the [Y] axis'),\n  },\n\n  size: {\n    ...metric,\n    label: t('Bubble size'),\n    default: null,\n  },\n\n  y_axis_format: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Y Axis Format'),\n    renderTrigger: true,\n    default: 'SMART_NUMBER',\n    choices: D3_FORMAT_OPTIONS,\n    description: D3_FORMAT_DOCS,\n    mapStateToProps: state => {\n      const showWarning =\n        state.controls &&\n        state.controls.comparison_type &&\n        state.controls.comparison_type.value === 'percentage';\n      return {\n        warning: showWarning\n          ? t(\n              'When `Calculation type` is set to \"Percentage change\", the Y ' +\n                'Axis Format is forced to `.1%`',\n            )\n          : null,\n        disabled: showWarning,\n      };\n    },\n  },\n\n  adhoc_filters: {\n    type: 'AdhocFilterControl',\n    label: t('Filters'),\n    default: null,\n    description: '',\n    mapStateToProps: state => ({\n      columns: state.datasource\n        ? state.datasource.columns.filter(c => c.filterable)\n        : [],\n      savedMetrics: state.datasource ? state.datasource.metrics : [],\n      datasource: state.datasource,\n    }),\n  },\n\n  color_scheme: {\n    type: 'ColorSchemeControl',\n    label: t('Color scheme'),\n    default: categoricalSchemeRegistry.getDefaultKey(),\n    renderTrigger: true,\n    choices: () => categoricalSchemeRegistry.keys().map(s => [s, s]),\n    description: t('The color scheme for rendering chart'),\n    schemes: () => categoricalSchemeRegistry.getMap(),\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useEffect } from 'react';\n/* eslint camelcase: 0 */\nimport URI from 'urijs';\nimport {\n  buildQueryContext,\n  ensureIsArray,\n  getChartBuildQueryRegistry,\n  getChartMetadataRegistry,\n  SupersetClient,\n} from '@superset-ui/core';\nimport { availableDomains } from 'src/utils/hostNamesConfig';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { optionLabel } from 'src/utils/common';\nimport { URL_PARAMS } from 'src/constants';\nimport {\n  MULTI_OPERATORS,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n  UNSAVED_CHART_ID,\n} from 'src/explore/constants';\nimport { DashboardStandaloneMode } from 'src/dashboard/util/constants';\n\nexport function getChartKey(explore) {\n  const { slice, form_data } = explore;\n  return slice?.slice_id ?? form_data?.slice_id ?? UNSAVED_CHART_ID;\n}\n\nlet requestCounter = 0;\nexport function getHostName(allowDomainSharding = false) {\n  let currentIndex = 0;\n  if (allowDomainSharding) {\n    currentIndex = requestCounter % availableDomains.length;\n    requestCounter += 1;\n\n    // if domain sharding is enabled, skip main domain for fetching chart API\n    // leave main domain free for other calls like fav star, save change, etc.\n    // to make dashboard be responsive when it's loading large number of charts\n    if (currentIndex === 0) {\n      currentIndex += 1;\n      requestCounter += 1;\n    }\n  }\n  return availableDomains[currentIndex];\n}\n\nexport function getAnnotationJsonUrl(slice_id, force) {\n  if (slice_id === null || slice_id === undefined) {\n    return null;\n  }\n\n  const uri = URI(window.location.search);\n  return uri\n    .pathname('/api/v1/chart/data')\n    .search({\n      form_data: safeStringify({ slice_id }),\n      force,\n    })\n    .toString();\n}\n\nexport function getURIDirectory(endpointType = 'base') {\n  // Building the directory part of the URI\n  if (\n    ['full', 'json', 'csv', 'query', 'results', 'samples'].includes(\n      endpointType,\n    )\n  ) {\n    return '/superset/explore_json/';\n  }\n  return '/explore/';\n}\n\nexport function mountExploreUrl(endpointType, extraSearch = {}, force = false) {\n  const uri = new URI('/');\n  const directory = getURIDirectory(endpointType);\n  const search = uri.search(true);\n  Object.keys(extraSearch).forEach(key => {\n    search[key] = extraSearch[key];\n  });\n  if (endpointType === URL_PARAMS.standalone.name) {\n    if (force) {\n      search.force = '1';\n    }\n    search.standalone = DashboardStandaloneMode.HIDE_NAV;\n  }\n  return uri.directory(directory).search(search).toString();\n}\n\nexport function getChartDataUri({ path, qs, allowDomainSharding = false }) {\n  // The search params from the window.location are carried through,\n  // but can be specified with curUrl (used for unit tests to spoof\n  // the window.location).\n  let uri = new URI({\n    protocol: window.location.protocol.slice(0, -1),\n    hostname: getHostName(allowDomainSharding),\n    port: window.location.port ? window.location.port : '',\n    path,\n  });\n  if (qs) {\n    uri = uri.search(qs);\n  }\n  return uri;\n}\n\n/**\n * This gets the minimal url for the given form data.\n * If there are dashboard overrides present in the form data,\n * they will not be included in the url.\n */\nexport function getExploreUrl({\n  formData,\n  endpointType = 'base',\n  force = false,\n  curUrl = null,\n  requestParams = {},\n  allowDomainSharding = false,\n  method = 'POST',\n}) {\n  if (!formData.datasource) {\n    return null;\n  }\n\n  // label_colors should not pollute the URL\n  // eslint-disable-next-line no-param-reassign\n  delete formData.label_colors;\n\n  let uri = getChartDataUri({ path: '/', allowDomainSharding });\n  if (curUrl) {\n    uri = URI(URI(curUrl).search());\n  }\n\n  const directory = getURIDirectory(endpointType);\n\n  // Building the querystring (search) part of the URI\n  const search = uri.search(true);\n  const { slice_id, extra_filters, adhoc_filters, viz_type } = formData;\n  if (slice_id) {\n    const form_data = { slice_id };\n    if (method === 'GET') {\n      form_data.viz_type = viz_type;\n      if (extra_filters && extra_filters.length) {\n        form_data.extra_filters = extra_filters;\n      }\n      if (adhoc_filters && adhoc_filters.length) {\n        form_data.adhoc_filters = adhoc_filters;\n      }\n    }\n    search.form_data = safeStringify(form_data);\n  }\n  if (force) {\n    search.force = 'true';\n  }\n  if (endpointType === 'csv') {\n    search.csv = 'true';\n  }\n  if (endpointType === URL_PARAMS.standalone.name) {\n    search.standalone = '1';\n  }\n  if (endpointType === 'query') {\n    search.query = 'true';\n  }\n  if (endpointType === 'results') {\n    search.results = 'true';\n  }\n  if (endpointType === 'samples') {\n    search.samples = 'true';\n  }\n  const paramNames = Object.keys(requestParams);\n  if (paramNames.length) {\n    paramNames.forEach(name => {\n      if (requestParams.hasOwnProperty(name)) {\n        search[name] = requestParams[name];\n      }\n    });\n  }\n  return uri.search(search).directory(directory).toString();\n}\n\nexport const getQuerySettings = formData => {\n  const vizMetadata = getChartMetadataRegistry().get(formData.viz_type);\n  return [\n    vizMetadata?.useLegacyApi ?? false,\n    vizMetadata?.parseMethod ?? 'json-bigint',\n  ];\n};\n\nexport const buildV1ChartDataPayload = ({\n  formData,\n  force,\n  resultFormat,\n  resultType,\n  setDataMask,\n  ownState,\n}) => {\n  const buildQuery =\n    getChartBuildQueryRegistry().get(formData.viz_type) ??\n    (buildQueryformData =>\n      buildQueryContext(buildQueryformData, baseQueryObject => [\n        {\n          ...baseQueryObject,\n        },\n      ]));\n  return buildQuery(\n    {\n      ...formData,\n      force,\n      result_format: resultFormat,\n      result_type: resultType,\n    },\n    {\n      ownState,\n      hooks: {\n        setDataMask,\n      },\n    },\n  );\n};\n\nexport const getLegacyEndpointType = ({ resultType, resultFormat }) =>\n  resultFormat === 'csv' ? resultFormat : resultType;\n\nexport const exportChart = ({\n  formData,\n  resultFormat = 'json',\n  resultType = 'full',\n  force = false,\n  ownState = {},\n}) => {\n  let url;\n  let payload;\n  const [useLegacyApi, parseMethod] = getQuerySettings(formData);\n  if (useLegacyApi) {\n    const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n    url = getExploreUrl({\n      formData,\n      endpointType,\n      allowDomainSharding: false,\n    });\n    payload = formData;\n  } else {\n    url = '/api/v1/chart/data';\n    payload = buildV1ChartDataPayload({\n      formData,\n      force,\n      resultFormat,\n      resultType,\n      ownState,\n      parseMethod,\n    });\n  }\n\n  SupersetClient.postForm(url, { form_data: safeStringify(payload) });\n};\n\nexport const exploreChart = (formData, requestParams) => {\n  const url = getExploreUrl({\n    formData,\n    endpointType: 'base',\n    allowDomainSharding: false,\n    requestParams,\n  });\n  SupersetClient.postForm(url, { form_data: safeStringify(formData) });\n};\n\nexport const useDebouncedEffect = (effect, delay, deps) => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const callback = useCallback(effect, deps);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      callback();\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [callback, delay]);\n};\n\nexport const getSimpleSQLExpression = (subject, operator, comparator) => {\n  const isMulti =\n    [...MULTI_OPERATORS]\n      .map(op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation)\n      .indexOf(operator) >= 0;\n  // If returned value is an object after changing dataset\n  let expression =\n    typeof subject === 'object' ? subject?.column_name ?? '' : subject ?? '';\n  if (subject && operator) {\n    expression += ` ${operator}`;\n    const firstValue =\n      isMulti && Array.isArray(comparator) ? comparator[0] : comparator;\n    const comparatorArray = ensureIsArray(comparator);\n    const isString =\n      firstValue !== undefined && Number.isNaN(Number(firstValue));\n    const quote = isString ? \"'\" : '';\n    const [prefix, suffix] = isMulti ? ['(', ')'] : ['', ''];\n    const formattedComparators = comparatorArray\n      .map(val => optionLabel(val))\n      .map(\n        val =>\n          `${quote}${isString ? String(val).replace(\"'\", \"''\") : val}${quote}`,\n      );\n    if (comparatorArray.length > 0) {\n      expression += ` ${prefix}${formattedComparators.join(', ')}${suffix}`;\n    }\n  }\n  return expression;\n};\n\nexport function formatSelectOptions(options) {\n  return options.map(opt => [opt, opt.toString()]);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { getChartControlPanelRegistry } from '@superset-ui/core';\nimport { getAllControlsState, getFormDataFromControls } from './controlUtils';\nimport { controls } from './controls';\n\nfunction handleDeprecatedControls(formData) {\n  // Reaffectation / handling of deprecated controls\n  /* eslint-disable no-param-reassign */\n\n  // y_axis_zero was a boolean forcing 0 to be part of the Y Axis\n  if (formData.y_axis_zero) {\n    formData.y_axis_bounds = [0, null];\n  }\n}\n\nexport function getControlsState(state, inputFormData) {\n  /*\n   * Gets a new controls object to put in the state. The controls object\n   * is similar to the configuration control with only the controls\n   * related to the current viz_type, materializes mapStateToProps functions,\n   * adds value keys coming from inputFormData passed here. This can't be an action creator\n   * just yet because it's used in both the explore and dashboard views.\n   * */\n  // Getting a list of active control names for the current viz\n  const formData = { ...inputFormData };\n  const vizType =\n    formData.viz_type || state.common?.conf.DEFAULT_VIZ_TYPE || 'table';\n\n  handleDeprecatedControls(formData);\n  const controlsState = getAllControlsState(\n    vizType,\n    state.datasource.type,\n    state,\n    formData,\n  );\n\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  if (controlPanelConfig.onInit) {\n    return controlPanelConfig.onInit(controlsState);\n  }\n\n  return controlsState;\n}\n\nexport function applyDefaultFormData(inputFormData) {\n  const datasourceType = inputFormData.datasource.split('__')[1];\n  const vizType = inputFormData.viz_type;\n  const controlsState = getAllControlsState(\n    vizType,\n    datasourceType,\n    null,\n    inputFormData,\n  );\n  const controlFormData = getFormDataFromControls(controlsState);\n\n  const formData = {};\n  Object.keys(controlsState)\n    .concat(Object.keys(inputFormData))\n    .forEach(controlName => {\n      if (inputFormData[controlName] === undefined) {\n        formData[controlName] = controlFormData[controlName];\n      } else {\n        formData[controlName] = inputFormData[controlName];\n      }\n    });\n\n  return formData;\n}\n\nconst defaultControls = { ...controls };\nObject.keys(controls).forEach(f => {\n  defaultControls[f].value = controls[f].default;\n});\n\nconst defaultState = {\n  controls: defaultControls,\n  form_data: getFormDataFromControls(defaultControls),\n};\n\nexport { defaultControls, defaultState };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nfunction extractTypes(metadata) {\n  return Object.keys(metadata).reduce((prev, key) => {\n    const result = prev;\n    result[key] = key;\n    return result;\n  }, {});\n}\n\nexport const ANNOTATION_TYPES_METADATA = {\n  FORMULA: {\n    value: 'FORMULA',\n    label: t('Formula'),\n  },\n  EVENT: {\n    value: 'EVENT',\n    label: t('Event'),\n    supportNativeSource: true,\n  },\n  INTERVAL: {\n    value: 'INTERVAL',\n    label: t('Interval'),\n    supportNativeSource: true,\n  },\n  TIME_SERIES: {\n    value: 'TIME_SERIES',\n    label: t('Time series'),\n  },\n};\n\nexport const ANNOTATION_TYPES = extractTypes(ANNOTATION_TYPES_METADATA);\n\nexport const DEFAULT_ANNOTATION_TYPE = ANNOTATION_TYPES.FORMULA;\n\nexport const ANNOTATION_SOURCE_TYPES_METADATA = {\n  NATIVE: {\n    value: 'NATIVE',\n    label: 'Superset annotation',\n  },\n};\n\nexport const ANNOTATION_SOURCE_TYPES = extractTypes(\n  ANNOTATION_SOURCE_TYPES_METADATA,\n);\n\nexport function requiresQuery(annotationSourceType) {\n  return !!annotationSourceType;\n}\n\nconst NATIVE_COLUMN_NAMES = {\n  timeColumn: 'start_dttm',\n  intervalEndColumn: 'end_dttm',\n  titleColumn: 'short_descr',\n  descriptionColumns: ['long_descr'],\n};\n\nexport function applyNativeColumns(annotation) {\n  if (annotation.sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n    return { ...annotation, ...NATIVE_COLUMN_NAMES };\n  }\n  return annotation;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport {\n  addDangerToast,\n  addSuccessToast,\n} from 'src/components/MessageToasts/actions';\nimport { isEmpty } from 'lodash';\n\nexport const SET_REPORT = 'SET_REPORT';\nexport function setReport(report, resourceId, creationMethod, filterField) {\n  return { type: SET_REPORT, report, resourceId, creationMethod, filterField };\n}\n\nexport function fetchUISpecificReport({\n  userId,\n  filterField,\n  creationMethod,\n  resourceId,\n}) {\n  const queryParams = rison.encode({\n    filters: [\n      {\n        col: filterField,\n        opr: 'eq',\n        value: resourceId,\n      },\n      {\n        col: 'creation_method',\n        opr: 'eq',\n        value: creationMethod,\n      },\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: userId,\n      },\n    ],\n  });\n  return function fetchUISpecificReportThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/report/?q=${queryParams}`,\n    })\n      .then(({ json }) => {\n        dispatch(setReport(json, resourceId, creationMethod, filterField));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'There was an issue fetching reports attached to this dashboard.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nconst structureFetchAction = (dispatch, getState) => {\n  const state = getState();\n  const { user, dashboardInfo, charts, explore } = state;\n  if (!isEmpty(dashboardInfo)) {\n    dispatch(\n      fetchUISpecificReport({\n        userId: user.userId,\n        filterField: 'dashboard_id',\n        creationMethod: 'dashboards',\n        resourceId: dashboardInfo.id,\n      }),\n    );\n  } else {\n    const [chartArr] = Object.keys(charts);\n    dispatch(\n      fetchUISpecificReport({\n        userId: explore.user?.userId || user?.userId,\n        filterField: 'chart_id',\n        creationMethod: 'charts',\n        resourceId: charts[chartArr].id,\n      }),\n    );\n  }\n};\n\nexport const ADD_REPORT = 'ADD_REPORT';\n\nexport const addReport = report => dispatch =>\n  SupersetClient.post({\n    endpoint: `/api/v1/report/`,\n    jsonPayload: report,\n  }).then(({ json }) => {\n    dispatch({ type: ADD_REPORT, json });\n    dispatch(addSuccessToast(t('The report has been created')));\n  });\n\nexport const EDIT_REPORT = 'EDIT_REPORT';\n\nexport const editReport = (id, report) => dispatch =>\n  SupersetClient.put({\n    endpoint: `/api/v1/report/${id}`,\n    jsonPayload: report,\n  }).then(({ json }) => {\n    dispatch({ type: EDIT_REPORT, json });\n    dispatch(addSuccessToast(t('Report updated')));\n  });\n\nexport function toggleActive(report, isActive) {\n  return function toggleActiveThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        active: isActive,\n      }),\n    })\n      .catch(() => {\n        dispatch(\n          addDangerToast(\n            t('We were unable to active or deactivate this report.'),\n          ),\n        );\n      })\n      .finally(() => {\n        dispatch(structureFetchAction);\n      });\n  };\n}\n\nexport const DELETE_REPORT = 'DELETE_REPORT';\n\nexport function deleteActiveReport(report) {\n  return function deleteActiveReportThunk(dispatch) {\n    return SupersetClient.delete({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n    })\n      .catch(() => {\n        dispatch(addDangerToast(t('Your report could not be deleted')));\n      })\n      .finally(() => {\n        dispatch({ type: DELETE_REPORT, report });\n        dispatch(addSuccessToast(t('Deleted: %s', report.name)));\n      });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const getDatasourceAsSaveableDataset = source => ({\n  columns: source.columns,\n  name: source?.datasource_name || source?.name || 'Untitled',\n  dbId: source?.database?.id || source?.dbId,\n  sql: source?.sql || '',\n  schema: source?.schema,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\n\nexport const fDuration = function (t1, t2, format = 'HH:mm:ss.SS') {\n  const diffSec = t2 - t1;\n  const duration = moment(new Date(diffSec));\n  return duration.utc().format(format);\n};\n\nexport const now = function () {\n  // seconds from EPOCH as a float\n  return moment().utc().valueOf();\n};\n\nexport const epochTimeXHoursAgo = function (h) {\n  return moment().subtract(h, 'hours').utc().valueOf();\n};\n\nexport const epochTimeXDaysAgo = function (d) {\n  return moment().subtract(d, 'days').utc().valueOf();\n};\n\nexport const epochTimeXYearsAgo = function (y) {\n  return moment().subtract(y, 'years').utc().valueOf();\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { initFeatureFlags } from 'src/featureFlags';\nimport getBootstrapData from './getBootstrapData';\n\nfunction getDomainsConfig() {\n  const appContainer = document.getElementById('app');\n  if (!appContainer) {\n    return [];\n  }\n\n  const availableDomains = new Set([window.location.hostname]);\n\n  // don't do domain sharding if a certain query param is set\n  const disableDomainSharding =\n    new URLSearchParams(window.location.search).get('disableDomainSharding') ===\n    '1';\n  if (disableDomainSharding) {\n    return Array.from(availableDomains);\n  }\n\n  const bootstrapData = getBootstrapData();\n  // this module is a little special, it may be loaded before index.jsx,\n  // where window.featureFlags get initialized\n  // eslint-disable-next-line camelcase\n  initFeatureFlags(bootstrapData.common.feature_flags);\n\n  if (\n    bootstrapData &&\n    bootstrapData.common &&\n    bootstrapData.common.conf &&\n    bootstrapData.common.conf.SUPERSET_WEBSERVER_DOMAINS\n  ) {\n    bootstrapData.common.conf.SUPERSET_WEBSERVER_DOMAINS.forEach(hostName => {\n      availableDomains.add(hostName);\n    });\n  }\n  return Array.from(availableDomains);\n}\n\nexport const availableDomains = getDomainsConfig();\n\nexport const allowCrossDomain = availableDomains.length > 1;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  Component,\n  FunctionComponent,\n  ReactElement,\n  RefObject,\n} from 'react';\nimport {\n  ListChildComponentProps,\n  FixedSizeList as WindowedList,\n} from 'react-window';\nimport {\n  OptionTypeBase,\n  OptionProps,\n  MenuListComponentProps,\n} from 'react-select';\nimport { ThemeConfig } from '../styles';\n\nexport type WindowedMenuListProps = {\n  selectProps: {\n    windowListRef?: RefObject<WindowedList>;\n    optionHeight?: number;\n  };\n};\n\n/**\n * MenuListComponentProps should always have `children` elements, as guaranteed\n * by https://github.com/JedWatson/react-select/blob/32ad5c040bdd96cd1ca71010c2558842d684629c/packages/react-select/src/Select.js#L1686-L1719\n *\n * `children` may also be `Component<NoticeProps<OptionType>>` if options are not\n * provided (e.g., when async list is still loading, or no results), but that's\n * not possible because this MenuList will only be rendered when\n * optionsLength > windowThreshold.\n *\n * If may also be `Component<GroupProps<OptionType>>[]` but we are not supporting\n * grouped options just yet.\n */\n\ntype MenuListPropsChildren<OptionType extends OptionTypeBase> =\n  | Component<OptionProps<OptionType>>[]\n  | ReactElement[];\n\nexport type MenuListProps<OptionType extends OptionTypeBase> =\n  MenuListComponentProps<OptionType> & {\n    children: MenuListPropsChildren<OptionType>;\n    // theme is not present with built-in @types/react-select, but is actually\n    // available via CommonProps.\n    theme?: ThemeConfig;\n    className?: string;\n  } & WindowedMenuListProps;\n\nconst DEFAULT_OPTION_HEIGHT = 30;\n\n/**\n * Get the index of the last selected option.\n */\nfunction getLastSelected(children: MenuListPropsChildren<any>) {\n  return Array.isArray(children)\n    ? children.findIndex(\n        ({ props: { isFocused = false } = {} }) => isFocused,\n      ) || 0\n    : -1;\n}\n\n/**\n * Calculate probable option height as set in theme configs\n */\nfunction detectHeight({ spacing: { baseUnit, lineHeight } }: ThemeConfig) {\n  // Option item expects 2 * baseUnit for each of top and bottom padding.\n  return baseUnit * 4 + lineHeight;\n}\n\nexport default function WindowedMenuList<OptionType extends OptionTypeBase>({\n  children,\n  ...props\n}: MenuListProps<OptionType>) {\n  const {\n    maxHeight,\n    selectProps,\n    theme,\n    getStyles,\n    cx,\n    innerRef,\n    isMulti,\n    className,\n  } = props;\n  const {\n    // Expose react-window VariableSizeList instance and HTML elements\n    windowListRef: windowListRef_,\n    windowListInnerRef,\n  } = selectProps;\n  const defaultWindowListRef = useRef<WindowedList>(null);\n  const windowListRef = windowListRef_ || defaultWindowListRef;\n\n  // try get default option height from theme configs\n  let { optionHeight } = selectProps;\n  if (!optionHeight) {\n    optionHeight = theme ? detectHeight(theme) : DEFAULT_OPTION_HEIGHT;\n  }\n\n  const itemCount = children.length;\n  const totalHeight = optionHeight * itemCount;\n\n  const Row: FunctionComponent<ListChildComponentProps> = ({\n    data,\n    index,\n    style,\n  }) => <div style={style}>{data[index]}</div>;\n\n  useEffect(() => {\n    const lastSelected = getLastSelected(children);\n    if (windowListRef.current && lastSelected) {\n      windowListRef.current.scrollToItem(lastSelected);\n    }\n  }, [children, windowListRef]);\n\n  return (\n    <WindowedList\n      css={getStyles('menuList', props)}\n      className={cx(\n        {\n          'menu-list': true,\n          'menu-list--is-multi': isMulti,\n        },\n        className,\n      )}\n      ref={windowListRef}\n      outerRef={innerRef}\n      innerRef={windowListInnerRef}\n      height={Math.min(totalHeight, maxHeight)}\n      width=\"100%\"\n      itemData={children}\n      itemCount={children.length}\n      itemSize={optionHeight}\n    >\n      {Row}\n    </WindowedList>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ComponentType,\n  FunctionComponent,\n  ReactElement,\n  forwardRef,\n} from 'react';\nimport Select, {\n  Props as SelectProps,\n  OptionTypeBase,\n  MenuListComponentProps,\n  components as defaultComponents,\n} from 'react-select';\nimport WindowedMenuList, { WindowedMenuListProps } from './WindowedMenuList';\n\nconst { MenuList: DefaultMenuList } = defaultComponents;\n\nexport const DEFAULT_WINDOW_THRESHOLD = 100;\n\nexport type WindowedSelectProps<OptionType extends OptionTypeBase> =\n  SelectProps<OptionType> & {\n    windowThreshold?: number;\n  } & WindowedMenuListProps['selectProps'];\n\nexport type WindowedSelectComponentType<OptionType extends OptionTypeBase> =\n  FunctionComponent<WindowedSelectProps<OptionType>>;\n\nexport function MenuList<OptionType extends OptionTypeBase>({\n  children,\n  ...props\n}: MenuListComponentProps<OptionType> & {\n  selectProps: WindowedSelectProps<OptionType>;\n}) {\n  const { windowThreshold = DEFAULT_WINDOW_THRESHOLD } = props.selectProps;\n  if (Array.isArray(children) && children.length > windowThreshold) {\n    return (\n      <WindowedMenuList {...props}>\n        {children as ReactElement[]}\n      </WindowedMenuList>\n    );\n  }\n  return <DefaultMenuList {...props}>{children}</DefaultMenuList>;\n}\n\n/**\n * Add \"windowThreshold\" option to a react-select component, turn the options\n * list into a virtualized list when appropriate.\n *\n * @param SelectComponent the React component to render Select\n */\nexport default function windowed<OptionType extends OptionTypeBase>(\n  SelectComponent: ComponentType<SelectProps<OptionType>>,\n): WindowedSelectComponentType<OptionType> {\n  const WindowedSelect = forwardRef(\n    (\n      props: WindowedSelectProps<OptionType>,\n      ref: React.RefObject<Select<OptionType>>,\n    ) => {\n      const { components: components_ = {}, ...restProps } = props;\n      const components = { ...components_, MenuList };\n      return (\n        <SelectComponent components={components} ref={ref} {...restProps} />\n      );\n    },\n  );\n  return WindowedSelect;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport Select from 'react-select';\nimport Creatable from 'react-select/creatable';\nimport AsyncCreatable from 'react-select/async-creatable';\nimport windowed from './windowed';\n\nexport * from './windowed';\n\nexport const WindowedSelect = windowed(Select);\nexport const WindowedCreatableSelect = windowed(Creatable);\nexport const WindowedAsyncCreatableSelect = windowed(AsyncCreatable);\nexport default WindowedSelect;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// Deprecated component\n/* eslint-disable theme-colors/no-literal-colors */\n\nimport React, { CSSProperties, ComponentType, ReactNode } from 'react';\nimport { SerializedStyles } from '@emotion/react';\nimport { SupersetTheme, css } from '@superset-ui/core';\nimport {\n  Styles,\n  Theme,\n  SelectComponentsConfig,\n  components as defaultComponents,\n  InputProps as ReactSelectInputProps,\n  Props as SelectProps,\n} from 'react-select';\nimport type { colors as reactSelectColors } from 'react-select/src/theme';\nimport type { DeepNonNullable } from 'react-select/src/components';\nimport { OptionType } from 'antd/lib/select';\nimport { SupersetStyledSelectProps } from './DeprecatedSelect';\n\nexport const DEFAULT_CLASS_NAME = 'Select';\nexport const DEFAULT_CLASS_NAME_PREFIX = 'Select';\n\ntype RecursivePartial<T> = {\n  [P in keyof T]?: RecursivePartial<T[P]>;\n};\n\nconst colors = (theme: SupersetTheme) => ({\n  primary: theme.colors.success.base,\n  danger: theme.colors.error.base,\n  warning: theme.colors.warning.base,\n  indicator: theme.colors.info.base,\n  almostBlack: theme.colors.grayscale.dark1,\n  grayDark: theme.colors.grayscale.dark1,\n  grayLight: theme.colors.grayscale.light2,\n  gray: theme.colors.grayscale.light1,\n  grayBg: theme.colors.grayscale.light4,\n  grayBgDarker: theme.colors.grayscale.light3,\n  grayBgDarkest: theme.colors.grayscale.light2,\n  grayHeading: theme.colors.grayscale.light1,\n  menuHover: theme.colors.grayscale.light3,\n  lightest: theme.colors.grayscale.light5,\n  darkest: theme.colors.grayscale.dark2,\n  grayBorder: theme.colors.grayscale.light2,\n  grayBorderLight: theme.colors.grayscale.light3,\n  grayBorderDark: theme.colors.grayscale.light1,\n  textDefault: theme.colors.grayscale.dark1,\n  textDarkest: theme.colors.grayscale.dark2,\n  dangerLight: theme.colors.error.light1,\n});\n\nexport type ThemeConfig = {\n  borderRadius: number;\n  // z-index for menu dropdown\n  // (the same as `@z-index-above-dashboard-charts + 1` in variables.less)\n  zIndex: number;\n  colors: {\n    // add known colors\n    [key in keyof typeof reactSelectColors]: string;\n  } & {\n    [key in keyof ReturnType<typeof colors>]: string;\n  } & {\n    [key: string]: string; // any other colors\n  };\n  spacing: Theme['spacing'] & {\n    // line height and font size must be pixels for easier computation\n    // of option item height in WindowedMenuList\n    lineHeight: number;\n    fontSize: number;\n    // other relative size must be string\n    minWidth: string;\n  };\n};\n\nexport type PartialThemeConfig = RecursivePartial<ThemeConfig>;\n\nexport const defaultTheme: (theme: SupersetTheme) => PartialThemeConfig =\n  theme => ({\n    borderRadius: theme.borderRadius,\n    zIndex: 11,\n    colors: colors(theme),\n    spacing: {\n      baseUnit: 3,\n      menuGutter: 0,\n      controlHeight: 34,\n      lineHeight: 19,\n      fontSize: 14,\n      minWidth: '6.5em',\n    },\n    weights: theme.typography.weights,\n  });\n\n// let styles accept serialized CSS, too\ntype CSSStyles = CSSProperties | SerializedStyles;\ntype styleFnWithSerializedStyles = (\n  base: CSSProperties,\n  state: any,\n) => CSSStyles | CSSStyles[];\n\nexport type StylesConfig = {\n  [key in keyof Styles]: styleFnWithSerializedStyles;\n};\nexport type PartialStylesConfig = Partial<StylesConfig>;\n\nexport const DEFAULT_STYLES: PartialStylesConfig = {\n  container: (\n    provider,\n    {\n      theme: {\n        spacing: { minWidth },\n      },\n    },\n  ) => [\n    provider,\n    css`\n      min-width: ${minWidth};\n    `,\n  ],\n  placeholder: provider => [\n    provider,\n    css`\n      white-space: nowrap;\n    `,\n  ],\n  indicatorSeparator: () => css`\n    display: none;\n  `,\n  indicatorsContainer: provider => [\n    provider,\n    css`\n      i {\n        width: 1em;\n        display: inline-block;\n      }\n    `,\n  ],\n  clearIndicator: provider => [\n    provider,\n    css`\n      padding: 4px 0 4px 6px;\n    `,\n  ],\n  control: (\n    provider,\n    { isFocused, menuIsOpen, theme: { borderRadius, colors } },\n  ) => {\n    const isPseudoFocused = isFocused && !menuIsOpen;\n    let borderColor = colors.grayBorder;\n    if (isPseudoFocused || menuIsOpen) {\n      borderColor = colors.grayBorderDark;\n    }\n    return [\n      provider,\n      css`\n        border-color: ${borderColor};\n        box-shadow: ${isPseudoFocused\n          ? 'inset 0 1px 1px rgba(0,0,0,.075), 0 0 0 3px rgba(0,0,0,.1)'\n          : 'none'};\n        border-radius: ${menuIsOpen\n          ? `${borderRadius}px ${borderRadius}px 0 0`\n          : `${borderRadius}px`};\n        &:hover {\n          border-color: ${borderColor};\n          box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);\n        }\n        flex-wrap: nowrap;\n        padding-left: 1px;\n      `,\n    ];\n  },\n  menu: (provider, { theme: { zIndex } }) => [\n    provider,\n    css`\n      padding-bottom: 2em;\n      z-index: ${zIndex}; /* override at least multi-page pagination */\n      width: auto;\n      min-width: 100%;\n      max-width: 80vw;\n      background: none;\n      box-shadow: none;\n      border: 0;\n    `,\n  ],\n  menuList: (provider, { theme: { borderRadius, colors } }) => [\n    provider,\n    css`\n      background: ${colors.lightest};\n      border-radius: 0 0 ${borderRadius}px ${borderRadius}px;\n      border: 1px solid ${colors.grayBorderDark};\n      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);\n      margin-top: -1px;\n      border-top-color: ${colors.grayBorderLight};\n      min-width: 100%;\n      width: auto;\n      border-radius: 0 0 ${borderRadius}px ${borderRadius}px;\n      padding-top: 0;\n      padding-bottom: 0;\n    `,\n  ],\n  option: (\n    provider,\n    {\n      isDisabled,\n      isFocused,\n      isSelected,\n      theme: {\n        colors,\n        spacing: { lineHeight, fontSize },\n        weights,\n      },\n    },\n  ) => {\n    let color = colors.textDefault;\n    let backgroundColor = colors.lightest;\n    if (isFocused) {\n      backgroundColor = colors.grayBgDarker;\n    } else if (isDisabled) {\n      color = '#ccc';\n    }\n    return [\n      provider,\n      css`\n        cursor: pointer;\n        line-height: ${lineHeight}px;\n        font-size: ${fontSize}px;\n        background-color: ${backgroundColor};\n        color: ${color};\n        font-weight: ${isSelected ? weights.bold : weights.normal};\n        white-space: nowrap;\n        &:hover:active {\n          background-color: ${colors.grayBg};\n        }\n      `,\n    ];\n  },\n  valueContainer: (\n    provider,\n    {\n      isMulti,\n      hasValue,\n      theme: {\n        spacing: { baseUnit },\n      },\n    },\n  ) => [\n    provider,\n    css`\n      padding-left: ${isMulti && hasValue ? 1 : baseUnit * 3}px;\n    `,\n  ],\n  multiValueLabel: (\n    provider,\n    {\n      theme: {\n        spacing: { baseUnit },\n      },\n    },\n  ) => ({\n    ...provider,\n    paddingLeft: baseUnit * 1.2,\n    paddingRight: baseUnit * 1.2,\n  }),\n  input: (provider, { selectProps }) => [\n    provider,\n    css`\n      margin-left: 0;\n      vertical-align: middle;\n      ${selectProps?.isMulti && selectProps?.value?.length\n        ? 'padding: 0 6px; width: 100%'\n        : 'padding: 0; flex: 1 1 auto;'};\n    `,\n  ],\n  menuPortal: base => ({\n    ...base,\n    zIndex: 1030, // must be same or higher of antd popover\n  }),\n};\n\nconst INPUT_TAG_BASE_STYLES = {\n  background: 'none',\n  border: 'none',\n  outline: 'none',\n  padding: 0,\n};\n\nexport type SelectComponentsType = Omit<\n  SelectComponentsConfig<any>,\n  'Input'\n> & {\n  Input: ComponentType<InputProps>;\n};\n\n// react-select is missing selectProps from their props type\n// so overwriting it here to avoid errors\nexport type InputProps = ReactSelectInputProps & {\n  placeholder?: ReactNode;\n  selectProps: SelectProps;\n  autoComplete?: string;\n  onPaste?: SupersetStyledSelectProps<OptionType>['onPaste'];\n  inputStyle?: object;\n};\n\nconst { ClearIndicator, DropdownIndicator, Option, Input, SelectContainer } =\n  defaultComponents as Required<DeepNonNullable<SelectComponentsType>>;\n\nexport const DEFAULT_COMPONENTS: SelectComponentsType = {\n  SelectContainer: ({ children, ...props }) => {\n    const {\n      selectProps: { assistiveText },\n    } = props;\n    return (\n      <div>\n        <SelectContainer {...props}>{children}</SelectContainer>\n        {assistiveText && (\n          <span\n            css={(theme: SupersetTheme) => ({\n              marginLeft: 3,\n              fontSize: theme.typography.sizes.s,\n              color: theme.colors.grayscale.light1,\n            })}\n          >\n            {assistiveText}\n          </span>\n        )}\n      </div>\n    );\n  },\n  Option: ({ children, innerProps, data, ...props }) => (\n    <Option\n      {...props}\n      data={data}\n      css={data?.style ? data.style : null}\n      innerProps={innerProps}\n    >\n      {children}\n    </Option>\n  ),\n  ClearIndicator: props => (\n    <ClearIndicator {...props}>\n      <i className=\"fa\"></i>\n    </ClearIndicator>\n  ),\n  DropdownIndicator: props => (\n    <DropdownIndicator {...props}>\n      <i\n        className={`fa fa-caret-${\n          props.selectProps.menuIsOpen ? 'up' : 'down'\n        }`}\n      />\n    </DropdownIndicator>\n  ),\n  Input: (props: InputProps) => {\n    const { getStyles } = props;\n    return (\n      <Input\n        {...props}\n        css={getStyles('input', props)}\n        autoComplete=\"chrome-off\"\n        inputStyle={INPUT_TAG_BASE_STYLES}\n      />\n    );\n  },\n};\n\nexport const VALUE_LABELED_STYLES: PartialStylesConfig = {\n  valueContainer: (\n    provider,\n    {\n      getValue,\n      theme: {\n        spacing: { baseUnit },\n      },\n      isMulti,\n    },\n  ) => ({\n    ...provider,\n    paddingLeft: getValue().length > 0 ? 1 : baseUnit * 3,\n    overflow: isMulti && getValue().length > 0 ? 'visible' : 'hidden',\n  }),\n  // render single value as is they are multi-value\n  singleValue: (provider, props) => {\n    const { getStyles } = props;\n    return {\n      ...getStyles('multiValue', props),\n      '.metric-option': getStyles('multiValueLabel', props),\n    };\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { SyntheticEvent, MutableRefObject, ComponentType } from 'react';\nimport { merge } from 'lodash';\nimport BasicSelect, {\n  OptionTypeBase,\n  MultiValueProps,\n  FormatOptionLabelMeta,\n  ValueType,\n  SelectComponentsConfig,\n  components as defaultComponents,\n  createFilter,\n  Props as SelectProps,\n} from 'react-select';\nimport Async from 'react-select/async';\nimport Creatable from 'react-select/creatable';\nimport AsyncCreatable from 'react-select/async-creatable';\n\nimport type { SelectComponents } from 'react-select/src/components';\nimport {\n  SortableContainer,\n  SortableElement,\n  SortableContainerProps,\n} from 'react-sortable-hoc';\nimport arrayMove from 'array-move';\nimport { useTheme } from '@superset-ui/core';\nimport { findValue } from './utils';\nimport {\n  WindowedSelectComponentType,\n  WindowedSelectProps,\n  WindowedSelect,\n  WindowedCreatableSelect,\n  WindowedAsyncCreatableSelect,\n} from './WindowedSelect';\nimport {\n  DEFAULT_CLASS_NAME,\n  DEFAULT_CLASS_NAME_PREFIX,\n  DEFAULT_STYLES,\n  DEFAULT_COMPONENTS,\n  VALUE_LABELED_STYLES,\n  PartialThemeConfig,\n  PartialStylesConfig,\n  SelectComponentsType,\n  InputProps,\n  defaultTheme,\n} from './styles';\n\ntype AnyReactSelect<OptionType extends OptionTypeBase> =\n  | BasicSelect<OptionType>\n  | Async<OptionType>\n  | Creatable<OptionType>\n  | AsyncCreatable<OptionType>;\n\nexport type SupersetStyledSelectProps<\n  OptionType extends OptionTypeBase,\n  T extends WindowedSelectProps<OptionType> = WindowedSelectProps<OptionType>,\n> = T & {\n  // additional props for easier usage or backward compatibility\n  labelKey?: string;\n  valueKey?: string;\n  assistiveText?: string;\n  multi?: boolean;\n  clearable?: boolean;\n  sortable?: boolean;\n  ignoreAccents?: boolean;\n  creatable?: boolean;\n  selectRef?:\n    | React.RefCallback<AnyReactSelect<OptionType>>\n    | MutableRefObject<AnyReactSelect<OptionType>>;\n  getInputValue?: (selectBalue: ValueType<OptionType>) => string | undefined;\n  optionRenderer?: (option: OptionType) => React.ReactNode;\n  valueRenderer?: (option: OptionType) => React.ReactNode;\n  valueRenderedAsLabel?: boolean;\n  // callback for paste event\n  onPaste?: (e: SyntheticEvent) => void;\n  forceOverflow?: boolean;\n  // for simpler theme overrides\n  themeConfig?: PartialThemeConfig;\n  stylesConfig?: PartialStylesConfig;\n};\n\nfunction styled<\n  OptionType extends OptionTypeBase,\n  SelectComponentType extends\n    | WindowedSelectComponentType<OptionType>\n    | ComponentType<\n        SelectProps<OptionType>\n      > = WindowedSelectComponentType<OptionType>,\n>(SelectComponent: SelectComponentType) {\n  type SelectProps = SupersetStyledSelectProps<OptionType>;\n  type Components = SelectComponents<OptionType>;\n\n  const SortableSelectComponent = SortableContainer(SelectComponent, {\n    withRef: true,\n  });\n\n  // default components for the given OptionType\n  const supersetDefaultComponents: SelectComponentsConfig<OptionType> =\n    DEFAULT_COMPONENTS;\n\n  const getSortableMultiValue = (MultiValue: Components['MultiValue']) =>\n    SortableElement((props: MultiValueProps<OptionType>) => {\n      const onMouseDown = (e: SyntheticEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n      };\n      const innerProps = { onMouseDown };\n      return <MultiValue {...props} innerProps={innerProps} />;\n    });\n\n  /**\n   * Superset styled `Select` component. Apply Superset themed stylesheets and\n   * consolidate props API for backward compatibility with react-select v1.\n   */\n  function StyledSelect(selectProps: SelectProps) {\n    let stateManager: AnyReactSelect<OptionType>; // reference to react-select StateManager\n    const {\n      // additional props for Superset Select\n      selectRef,\n      labelKey = 'label',\n      valueKey = 'value',\n      themeConfig,\n      stylesConfig = {},\n      optionRenderer,\n      valueRenderer,\n      // whether value is rendered as `option-label` in input,\n      // useful for AdhocMetric and AdhocFilter\n      valueRenderedAsLabel: valueRenderedAsLabel_,\n      onPaste,\n      multi = false, // same as `isMulti`, used for backward compatibility\n      clearable, // same as `isClearable`\n      sortable = true, // whether to enable drag & drop sorting\n      forceOverflow, // whether the dropdown should be forcefully overflowing\n\n      // react-select props\n      className = DEFAULT_CLASS_NAME,\n      classNamePrefix = DEFAULT_CLASS_NAME_PREFIX,\n      options,\n      value: value_,\n      components: components_,\n      isMulti: isMulti_,\n      isClearable: isClearable_,\n      minMenuHeight = 100, // apply different defaults\n      maxMenuHeight = 220,\n      filterOption,\n      ignoreAccents = false, // default is `true`, but it is slow\n\n      asText = (value: any) => String(value ?? ''),\n\n      getOptionValue = option =>\n        typeof option === 'string' ? option : option[valueKey],\n\n      getOptionLabel = option =>\n        typeof option === 'string'\n          ? option\n          : asText(option[labelKey]) || asText(option[valueKey]),\n\n      formatOptionLabel = (\n        option: OptionType,\n        { context }: FormatOptionLabelMeta<OptionType>,\n      ) => {\n        if (context === 'value') {\n          return valueRenderer ? valueRenderer(option) : getOptionLabel(option);\n        }\n        return optionRenderer ? optionRenderer(option) : getOptionLabel(option);\n      },\n\n      ...restProps\n    } = selectProps;\n\n    // `value` may be rendered values (strings), we want option objects\n    const value: OptionType[] = findValue(value_, options || [], valueKey);\n\n    // Add backward compatibility to v1 API\n    const isMulti = isMulti_ === undefined ? multi : isMulti_;\n    const isClearable = isClearable_ === undefined ? clearable : isClearable_;\n\n    // Sort is only applied when there are multiple selected values\n    const shouldAllowSort =\n      isMulti && sortable && Array.isArray(value) && value.length > 1;\n\n    const MaybeSortableSelect = shouldAllowSort\n      ? SortableSelectComponent\n      : SelectComponent;\n    const components = { ...supersetDefaultComponents, ...components_ };\n\n    // Make multi-select sortable as per https://react-select.netlify.app/advanced\n    if (shouldAllowSort) {\n      components.MultiValue = getSortableMultiValue(\n        components.MultiValue || defaultComponents.MultiValue,\n      );\n\n      const sortableContainerProps: Partial<SortableContainerProps> = {\n        getHelperDimensions: ({ node }) => node.getBoundingClientRect(),\n        axis: 'xy',\n        onSortEnd: ({ oldIndex, newIndex }) => {\n          const newValue = arrayMove(value, oldIndex, newIndex);\n          if (restProps.onChange) {\n            restProps.onChange(newValue, { action: 'set-value' });\n          }\n        },\n        distance: 4,\n      };\n      Object.assign(restProps, sortableContainerProps);\n    }\n\n    // When values are rendered as labels, adjust valueContainer padding\n    const valueRenderedAsLabel =\n      valueRenderedAsLabel_ === undefined ? isMulti : valueRenderedAsLabel_;\n    if (valueRenderedAsLabel && !stylesConfig.valueContainer) {\n      Object.assign(stylesConfig, VALUE_LABELED_STYLES);\n    }\n\n    // Handle onPaste event\n    if (onPaste) {\n      const Input =\n        (components.Input as SelectComponentsType['Input']) ||\n        (defaultComponents.Input as SelectComponentsType['Input']);\n      components.Input = (props: InputProps) => (\n        <Input {...props} onPaste={onPaste} />\n      );\n    }\n    // for CreaTable\n    if (SelectComponent === WindowedCreatableSelect) {\n      restProps.getNewOptionData = (inputValue: string, label: string) => ({\n        label: label || inputValue,\n        [valueKey]: inputValue,\n        isNew: true,\n      });\n    }\n\n    // handle forcing dropdown overflow\n    // use only when setting overflow:visible isn't possible on the container element\n    if (forceOverflow) {\n      Object.assign(restProps, {\n        closeMenuOnScroll: (e: Event) => {\n          // ensure menu is open\n          const menuIsOpen = (stateManager as BasicSelect<OptionType>)?.state\n            ?.menuIsOpen;\n          const target = e.target as HTMLElement;\n          return (\n            menuIsOpen &&\n            target &&\n            !target.classList?.contains('Select__menu-list')\n          );\n        },\n        menuPosition: 'fixed',\n      });\n    }\n\n    // Make sure always return StateManager for the refs.\n    // To get the real `Select` component, keep tap into `obj.select`:\n    //   - for normal <Select /> component: StateManager -> Select,\n    //   - for <Creatable />: StateManager -> Creatable -> Select\n    const setRef = (instance: any) => {\n      stateManager =\n        shouldAllowSort && instance && 'refs' in instance\n          ? instance.refs.wrappedInstance // obtain StateManger from SortableContainer\n          : instance;\n      if (typeof selectRef === 'function') {\n        selectRef(stateManager);\n      } else if (selectRef && 'current' in selectRef) {\n        selectRef.current = stateManager;\n      }\n    };\n\n    const theme = useTheme();\n\n    return (\n      <MaybeSortableSelect\n        ref={setRef}\n        className={className}\n        classNamePrefix={classNamePrefix}\n        isMulti={isMulti}\n        isClearable={isClearable}\n        options={options}\n        value={value}\n        minMenuHeight={minMenuHeight}\n        maxMenuHeight={maxMenuHeight}\n        filterOption={\n          // filterOption may be NULL\n          filterOption !== undefined\n            ? filterOption\n            : createFilter({ ignoreAccents })\n        }\n        styles={{ ...DEFAULT_STYLES, ...stylesConfig } as SelectProps['styles']}\n        // merge default theme from `react-select`, default theme for Superset,\n        // and the theme from props.\n        theme={reactSelectTheme =>\n          merge(reactSelectTheme, defaultTheme(theme), themeConfig)\n        }\n        formatOptionLabel={formatOptionLabel}\n        getOptionLabel={getOptionLabel}\n        getOptionValue={getOptionValue}\n        components={components}\n        {...restProps}\n      />\n    );\n  }\n\n  // React.memo makes sure the component does no rerender given the same props\n  return React.memo(StyledSelect);\n}\n\nexport const Select = styled(WindowedSelect);\nexport const CreatableSelect = styled(WindowedCreatableSelect);\nexport const AsyncCreatableSelect = styled(WindowedAsyncCreatableSelect);\nexport default Select;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  OptionTypeBase,\n  ValueType,\n  OptionsType,\n  GroupedOptionsType,\n} from 'react-select';\n\n/**\n * Find Option value that matches a possibly string value.\n *\n * Translate possible string values to `OptionType` objects, fallback to value\n * itself if cannot be found in the options list.\n *\n * Always returns an array.\n */\nexport function findValue<OptionType extends OptionTypeBase>(\n  value: ValueType<OptionType> | string,\n  options: GroupedOptionsType<OptionType> | OptionsType<OptionType> = [],\n  valueKey = 'value',\n): OptionType[] {\n  if (value === null || value === undefined || value === '') {\n    return [];\n  }\n  const isGroup = Array.isArray((options[0] || {}).options);\n  const flatOptions = isGroup\n    ? (options as GroupedOptionsType<OptionType>).flatMap(x => x.options || [])\n    : (options as OptionsType<OptionType>);\n\n  const find = (val: OptionType) => {\n    const realVal = (value || {}).hasOwnProperty(valueKey)\n      ? val[valueKey]\n      : val;\n    return (\n      flatOptions.find(x => x === realVal || x[valueKey] === realVal) || val\n    );\n  };\n\n  // If value is a single string, must return an Array so `cleanValue` won't be\n  // empty: https://github.com/JedWatson/react-select/blob/32ad5c040bdd96cd1ca71010c2558842d684629c/packages/react-select/src/utils.js#L64\n  return (Array.isArray(value) ? value : [value]).map(find);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components/DeprecatedSelect';\n\nexport default class OnPasteSelect extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onPaste = this.onPaste.bind(this);\n  }\n\n  onPaste(evt) {\n    if (!this.props.isMulti) {\n      return;\n    }\n    evt.preventDefault();\n    const clipboard = evt.clipboardData.getData('Text');\n    if (!clipboard) {\n      return;\n    }\n    const regex = `[${this.props.separator}]+`;\n    const values = clipboard.split(new RegExp(regex)).map(v => v.trim());\n    const validator = this.props.isValidNewOption;\n    const selected = this.props.value || [];\n    const existingOptions = {};\n    const existing = {};\n    this.props.options.forEach(v => {\n      existingOptions[v[this.props.valueKey]] = 1;\n    });\n    let options = [];\n    selected.forEach(v => {\n      options.push({ [this.props.labelKey]: v, [this.props.valueKey]: v });\n      existing[v] = 1;\n    });\n    options = options.concat(\n      values\n        .filter(v => {\n          const notExists = !existing[v];\n          existing[v] = 1;\n          return (\n            notExists &&\n            (validator ? validator({ [this.props.labelKey]: v }) : !!v)\n          );\n        })\n        .map(v => {\n          const opt = { [this.props.labelKey]: v, [this.props.valueKey]: v };\n          if (!existingOptions[v]) {\n            this.props.options.unshift(opt);\n          }\n          return opt;\n        }),\n    );\n    if (options.length) {\n      if (this.props.onChange) {\n        this.props.onChange(options);\n      }\n    }\n  }\n\n  render() {\n    const { selectWrap: SelectComponent, ...restProps } = this.props;\n    return <SelectComponent {...restProps} onPaste={this.onPaste} />;\n  }\n}\n\nOnPasteSelect.propTypes = {\n  separator: PropTypes.array,\n  selectWrap: PropTypes.elementType,\n  selectRef: PropTypes.func,\n  onChange: PropTypes.func.isRequired,\n  valueKey: PropTypes.string,\n  labelKey: PropTypes.string,\n  options: PropTypes.array,\n  isMulti: PropTypes.bool,\n  value: PropTypes.any,\n  isValidNewOption: PropTypes.func,\n  noResultsText: PropTypes.string,\n  forceOverflow: PropTypes.bool,\n};\nOnPasteSelect.defaultProps = {\n  separator: [',', '\\n', '\\t', ';'],\n  selectWrap: Select,\n  valueKey: 'value',\n  labelKey: 'label',\n  options: [],\n  isMulti: false,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport Select, { SelectProps } from 'antd/lib/select';\n\nexport type {\n  OptionType as NativeSelectOptionType,\n  SelectProps as NativeSelectProps,\n} from 'antd/lib/select';\n\nconst StyledNativeSelect = styled((props: SelectProps<any>) => (\n  <Select getPopupContainer={(trigger: any) => trigger.parentNode} {...props} />\n))`\n  display: block;\n`;\n\nconst StyledNativeGraySelect = styled(Select)`\n  &.ant-select-single {\n    .ant-select-selector {\n      height: 36px;\n      padding: 0 11px;\n      background-color: ${({ theme }) => theme.colors.grayscale.light3};\n      border: none;\n\n      .ant-select-selection-search-input {\n        height: 100%;\n      }\n\n      .ant-select-selection-item,\n      .ant-select-selection-placeholder {\n        line-height: 35px;\n        color: ${({ theme }) => theme.colors.grayscale.dark1};\n      }\n    }\n  }\n`;\n\nexport const NativeSelect = Object.assign(StyledNativeSelect, {\n  Option: Select.Option,\n});\n\nexport const NativeGraySelect = Object.assign(StyledNativeGraySelect, {\n  Option: Select.Option,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { debounce } from 'lodash';\nimport { max as d3Max } from 'd3-array';\nimport {\n  AsyncCreatableSelect,\n  CreatableSelect,\n} from 'src/components/DeprecatedSelect';\nimport Button from 'src/components/Button';\nimport {\n  css,\n  styled,\n  t,\n  SupersetClient,\n  ensureIsArray,\n  withTheme,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\n\nimport {\n  BOOL_FALSE_DISPLAY,\n  BOOL_TRUE_DISPLAY,\n  SLOW_DEBOUNCE,\n} from 'src/constants';\nimport { FormLabel } from 'src/components/Form';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl';\nimport ControlRow from 'src/explore/components/ControlRow';\nimport Control from 'src/explore/components/Control';\nimport { controls } from 'src/explore/controls';\nimport { getExploreUrl } from 'src/explore/exploreUtils';\nimport OnPasteSelect from 'src/components/DeprecatedSelect/OnPasteSelect';\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  FILTER_OPTIONS_LIMIT,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\n\n// a shortcut to a map key, used by many components\nexport const TIME_RANGE = TIME_FILTER_MAP.time_range;\n\nconst propTypes = {\n  chartId: PropTypes.number.isRequired,\n  origSelectedValues: PropTypes.object,\n  datasource: PropTypes.object.isRequired,\n  instantFiltering: PropTypes.bool,\n  filtersFields: PropTypes.arrayOf(\n    PropTypes.shape({\n      field: PropTypes.string,\n      label: PropTypes.string,\n    }),\n  ),\n  filtersChoices: PropTypes.objectOf(\n    PropTypes.arrayOf(\n      PropTypes.shape({\n        id: PropTypes.string,\n        text: PropTypes.string,\n        filter: PropTypes.string,\n        metric: PropTypes.number,\n      }),\n    ),\n  ),\n  onChange: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  showDateFilter: PropTypes.bool,\n  showSqlaTimeGrain: PropTypes.bool,\n  showSqlaTimeColumn: PropTypes.bool,\n};\nconst defaultProps = {\n  origSelectedValues: {},\n  onChange: () => {},\n  onFilterMenuOpen: () => {},\n  onFilterMenuClose: () => {},\n  showDateFilter: false,\n  showSqlaTimeGrain: false,\n  showSqlaTimeColumn: false,\n  instantFiltering: false,\n};\n\nconst StyledFilterContainer = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    flex-direction: column;\n    margin-bottom: ${theme.gridUnit * 2 + 2}px;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    label {\n      display: flex;\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    .filter-badge-container {\n      width: 30px;\n      padding-right: ${theme.gridUnit * 2 + 2}px;\n    }\n\n    .filter-badge-container + div {\n      width: 100%;\n    }\n  `}\n`;\n\n/**\n * @deprecated in version 3.0.\n */\nclass FilterBox extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selectedValues: props.origSelectedValues,\n      // this flag is used by non-instant filter, to make the apply button enabled/disabled\n      hasChanged: false,\n    };\n    this.debouncerCache = {};\n    this.maxValueCache = {};\n    this.changeFilter = this.changeFilter.bind(this);\n    this.onFilterMenuOpen = this.onFilterMenuOpen.bind(this);\n    this.onOpenDateFilterControl = this.onOpenDateFilterControl.bind(this);\n    this.onFilterMenuClose = this.onFilterMenuClose.bind(this);\n  }\n\n  onFilterMenuOpen(column) {\n    return this.props.onFilterMenuOpen(this.props.chartId, column);\n  }\n\n  onFilterMenuClose(column) {\n    return this.props.onFilterMenuClose(this.props.chartId, column);\n  }\n\n  onOpenDateFilterControl() {\n    return this.onFilterMenuOpen(TIME_RANGE);\n  }\n\n  onCloseDateFilterControl = () => this.onFilterMenuClose(TIME_RANGE);\n\n  getControlData(controlName) {\n    const { selectedValues } = this.state;\n    const control = {\n      ...controls[controlName], // TODO: make these controls ('granularity_sqla', 'time_grain_sqla') accessible from getControlsForVizType.\n      name: controlName,\n      key: `control-${controlName}`,\n      value: selectedValues[TIME_FILTER_MAP[controlName]],\n      actions: { setControlValue: this.changeFilter },\n    };\n    const mapFunc = control.mapStateToProps;\n    return mapFunc ? { ...control, ...mapFunc(this.props) } : control;\n  }\n\n  /**\n   * Get known max value of a column\n   */\n  getKnownMax(key, choices) {\n    this.maxValueCache[key] = Math.max(\n      this.maxValueCache[key] || 0,\n      d3Max(choices || this.props.filtersChoices[key] || [], x => x.metric),\n    );\n    return this.maxValueCache[key];\n  }\n\n  clickApply() {\n    const { selectedValues } = this.state;\n    this.setState({ hasChanged: false }, () => {\n      this.props.onChange(selectedValues, false);\n    });\n  }\n\n  changeFilter(filter, options) {\n    const fltr = TIME_FILTER_MAP[filter] || filter;\n    let vals = null;\n    if (options !== null) {\n      if (Array.isArray(options)) {\n        vals = options.map(opt => (typeof opt === 'string' ? opt : opt.value));\n      } else if (Object.values(TIME_FILTER_MAP).includes(fltr)) {\n        vals = options.value ?? options;\n      } else {\n        // must use array member for legacy extra_filters's value\n        vals = ensureIsArray(options.value ?? options);\n      }\n    }\n\n    this.setState(\n      prevState => ({\n        selectedValues: {\n          ...prevState.selectedValues,\n          [fltr]: vals,\n        },\n        hasChanged: true,\n      }),\n      () => {\n        if (this.props.instantFiltering) {\n          this.props.onChange({ [fltr]: vals }, false);\n        }\n      },\n    );\n  }\n\n  /**\n   * Generate a debounce function that loads options for a specific column\n   */\n  debounceLoadOptions(key) {\n    if (!(key in this.debouncerCache)) {\n      this.debouncerCache[key] = debounce((input, callback) => {\n        this.loadOptions(key, input).then(callback);\n      }, SLOW_DEBOUNCE);\n    }\n    return this.debouncerCache[key];\n  }\n\n  /**\n   * Transform select options, add bar background\n   */\n  transformOptions(options, max) {\n    const maxValue = max === undefined ? d3Max(options, x => x.metric) : max;\n    return options.map(opt => {\n      const perc = Math.round((opt.metric / maxValue) * 100);\n      const color = 'lightgrey';\n      const backgroundImage = `linear-gradient(to right, ${color}, ${color} ${perc}%, rgba(0,0,0,0) ${perc}%`;\n      const style = { backgroundImage };\n      let label = opt.id;\n      if (label === true) {\n        label = BOOL_TRUE_DISPLAY;\n      } else if (label === false) {\n        label = BOOL_FALSE_DISPLAY;\n      }\n      return { value: opt.id, label, style };\n    });\n  }\n\n  async loadOptions(key, inputValue = '') {\n    const input = inputValue.toLowerCase();\n    const sortAsc = this.props.filtersFields.find(x => x.key === key).asc;\n    const formData = {\n      ...this.props.rawFormData,\n      adhoc_filters: inputValue\n        ? [\n            {\n              clause: 'WHERE',\n              expressionType: 'SIMPLE',\n              subject: key,\n              operator: 'ILIKE',\n              comparator: `%${input}%`,\n            },\n          ]\n        : null,\n    };\n\n    const { json } = await SupersetClient.get({\n      url: getExploreUrl({\n        formData,\n        endpointType: 'json',\n        method: 'GET',\n      }),\n    });\n    const options = (json?.data?.[key] || []).filter(x => x.id);\n    if (!options || options.length === 0) {\n      return [];\n    }\n    if (input) {\n      // sort those starts with search query to front\n      options.sort((a, b) => {\n        const labelA = a.id.toLowerCase();\n        const labelB = b.id.toLowerCase();\n        const textOrder = labelB.startsWith(input) - labelA.startsWith(input);\n        return textOrder === 0\n          ? (a.metric - b.metric) * (sortAsc ? 1 : -1)\n          : textOrder;\n      });\n    }\n    return this.transformOptions(options, this.getKnownMax(key, options));\n  }\n\n  renderDateFilter() {\n    const { showDateFilter } = this.props;\n    const label = TIME_FILTER_LABELS.time_range;\n    if (showDateFilter) {\n      return (\n        <div className=\"row space-1\">\n          <div\n            className=\"col-lg-12 col-xs-12\"\n            data-test=\"date-filter-container\"\n          >\n            <DateFilterControl\n              name={TIME_RANGE}\n              label={label}\n              description={t('Select start and end date')}\n              onChange={newValue => {\n                this.changeFilter(TIME_RANGE, newValue);\n              }}\n              onOpenDateFilterControl={this.onOpenDateFilterControl}\n              onCloseDateFilterControl={this.onCloseDateFilterControl}\n              value={this.state.selectedValues[TIME_RANGE] || 'No filter'}\n              endpoints={['inclusive', 'exclusive']}\n            />\n          </div>\n        </div>\n      );\n    }\n    return null;\n  }\n\n  renderDatasourceFilters() {\n    const { showSqlaTimeGrain, showSqlaTimeColumn } = this.props;\n    const datasourceFilters = [];\n    const sqlaFilters = [];\n    if (showSqlaTimeGrain) sqlaFilters.push('time_grain_sqla');\n    if (showSqlaTimeColumn) sqlaFilters.push('granularity_sqla');\n    if (sqlaFilters.length) {\n      datasourceFilters.push(\n        <ControlRow\n          key=\"sqla-filters\"\n          controls={sqlaFilters.map(control => (\n            <Control {...this.getControlData(control)} />\n          ))}\n        />,\n      );\n    }\n    return datasourceFilters;\n  }\n\n  renderSelect(filterConfig) {\n    const { filtersChoices } = this.props;\n    const { selectedValues } = this.state;\n    this.debouncerCache = {};\n    this.maxValueCache = {};\n\n    // Add created options to filtersChoices, even though it doesn't exist,\n    // or these options will exist in query sql but invisible to end user.\n    Object.keys(selectedValues)\n      .filter(key => key in filtersChoices)\n      .forEach(key => {\n        // empty values are ignored\n        if (!selectedValues[key]) {\n          return;\n        }\n        const choices = filtersChoices[key] || (filtersChoices[key] = []);\n        const choiceIds = new Set(choices.map(f => f.id));\n        const selectedValuesForKey = Array.isArray(selectedValues[key])\n          ? selectedValues[key]\n          : [selectedValues[key]];\n        selectedValuesForKey\n          .filter(value => value !== null && !choiceIds.has(value))\n          .forEach(value => {\n            choices.unshift({\n              filter: key,\n              id: value,\n              text: value,\n              metric: 0,\n            });\n          });\n      });\n    const {\n      key,\n      label,\n      [FILTER_CONFIG_ATTRIBUTES.MULTIPLE]: isMultiple,\n      [FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE]: defaultValue,\n      [FILTER_CONFIG_ATTRIBUTES.CLEARABLE]: isClearable,\n      [FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS]: searchAllOptions,\n    } = filterConfig;\n    const data = filtersChoices[key] || [];\n    let value = selectedValues[key] || null;\n\n    // Assign default value if required\n    if (value === undefined && defaultValue) {\n      // multiple values are separated by semicolons\n      value = isMultiple ? defaultValue.split(';') : defaultValue;\n    }\n\n    return (\n      <OnPasteSelect\n        cacheOptions\n        loadOptions={this.debounceLoadOptions(key)}\n        defaultOptions={this.transformOptions(data)}\n        key={key}\n        placeholder={t('Type or Select [%s]', label)}\n        isMulti={isMultiple}\n        isClearable={isClearable}\n        value={value}\n        options={this.transformOptions(data)}\n        onChange={newValue => {\n          // avoid excessive re-renders\n          if (newValue !== value) {\n            this.changeFilter(key, newValue);\n          }\n        }}\n        // TODO try putting this back once react-select is upgraded\n        // onFocus={() => this.onFilterMenuOpen(key)}\n        onMenuOpen={() => this.onFilterMenuOpen(key)}\n        onBlur={() => this.onFilterMenuClose(key)}\n        onMenuClose={() => this.onFilterMenuClose(key)}\n        selectWrap={\n          searchAllOptions && data.length >= FILTER_OPTIONS_LIMIT\n            ? AsyncCreatableSelect\n            : CreatableSelect\n        }\n        noResultsText={t('No results found')}\n        forceOverflow\n      />\n    );\n  }\n\n  renderFilters() {\n    const { filtersFields = [] } = this.props;\n    return filtersFields.map(filterConfig => {\n      const { label, key } = filterConfig;\n      return (\n        <StyledFilterContainer key={key} className=\"filter-container\">\n          <FormLabel htmlFor={`LABEL-${key}`}>{label}</FormLabel>\n          {this.renderSelect(filterConfig)}\n        </StyledFilterContainer>\n      );\n    });\n  }\n\n  render() {\n    const { instantFiltering, width, height } = this.props;\n    const { zIndex, gridUnit } = this.props.theme;\n    return (\n      <>\n        <Global\n          styles={css`\n            .dashboard .filter_box .slice_container > div:not(.alert) {\n              padding-top: 0;\n            }\n\n            .filter_box {\n              padding: ${gridUnit * 2 + 2}px 0;\n              overflow: visible !important;\n\n              &:hover {\n                z-index: ${zIndex.max};\n              }\n            }\n          `}\n        />\n        <div style={{ width, height, overflow: 'auto' }}>\n          {this.renderDateFilter()}\n          {this.renderDatasourceFilters()}\n          {this.renderFilters()}\n          {!instantFiltering && (\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              onClick={this.clickApply.bind(this)}\n              disabled={!this.state.hasChanged}\n            >\n              {t('Apply')}\n            </Button>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n\nFilterBox.propTypes = propTypes;\nFilterBox.defaultProps = defaultProps;\n\nexport default withTheme(FilterBox);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { kebabCase } from 'lodash';\nimport { t, useTheme, styled } from '@superset-ui/core';\nimport Tooltip from './Tooltip';\n\ninterface CertifiedIconWithTooltipProps {\n  certifiedBy?: string | null;\n  details?: string | null;\n  metricName: string;\n}\n\nconst StyledDiv = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nfunction CertifiedIconWithTooltip({\n  certifiedBy,\n  details,\n  metricName,\n}: CertifiedIconWithTooltipProps) {\n  const theme = useTheme();\n  return (\n    <Tooltip\n      id={`${kebabCase(metricName)}-tooltip`}\n      title={\n        <div>\n          {certifiedBy && (\n            <StyledDiv>{t('Certified by %s', certifiedBy)}</StyledDiv>\n          )}\n          <div>{details}</div>\n        </div>\n      }\n    >\n      {/* TODO: move Icons to superset-ui to remove duplicated icon code here */}\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        enableBackground=\"new 0 0 24 24\"\n        height=\"14\"\n        viewBox=\"0 0 24 24\"\n        width=\"14\"\n      >\n        <g>\n          <path\n            fill={theme.colors.primary.base}\n            d=\"M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z\"\n          />\n        </g>\n      </svg>\n    </Tooltip>\n  );\n}\n\nexport default CertifiedIconWithTooltip;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode, useLayoutEffect } from 'react';\nimport { css, styled, SupersetTheme } from '@superset-ui/core';\nimport { Tooltip } from './Tooltip';\nimport { ColumnTypeLabel } from './ColumnTypeLabel/ColumnTypeLabel';\nimport CertifiedIconWithTooltip from './CertifiedIconWithTooltip';\nimport { ColumnMeta } from '../types';\nimport {\n  getColumnLabelText,\n  getColumnTooltipNode,\n  getColumnTypeTooltipNode,\n} from './labelUtils';\nimport { SQLPopover } from './SQLPopover';\n\nexport type ColumnOptionProps = {\n  column: ColumnMeta;\n  showType?: boolean;\n  labelRef?: React.RefObject<any>;\n};\n\nconst StyleOverrides = styled.span`\n  display: flex;\n  align-items: center;\n  svg {\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport function ColumnOption({\n  column,\n  labelRef,\n  showType = false,\n}: ColumnOptionProps) {\n  const { expression, column_name, type_generic } = column;\n  const hasExpression = expression && expression !== column_name;\n  const type = hasExpression ? 'expression' : type_generic;\n  const [tooltipText, setTooltipText] = useState<ReactNode>(column.column_name);\n  const [columnTypeTooltipText, setcolumnTypeTooltipText] = useState<ReactNode>(\n    column.type,\n  );\n\n  useLayoutEffect(() => {\n    setTooltipText(getColumnTooltipNode(column, labelRef));\n    setcolumnTypeTooltipText(getColumnTypeTooltipNode(column));\n  }, [labelRef, column]);\n\n  return (\n    <StyleOverrides>\n      {showType && type !== undefined && (\n        <Tooltip\n          id=\"metric-type-tooltip\"\n          title={columnTypeTooltipText}\n          placement=\"bottomRight\"\n          align={{ offset: [8, -2] }}\n        >\n          <span>\n            <ColumnTypeLabel type={type} />\n          </span>\n        </Tooltip>\n      )}\n      <Tooltip id=\"metric-name-tooltip\" title={tooltipText}>\n        <span\n          className=\"option-label column-option-label\"\n          css={(theme: SupersetTheme) => css`\n            margin-right: ${theme.gridUnit}px;\n          `}\n          ref={labelRef}\n        >\n          {getColumnLabelText(column)}\n        </span>\n      </Tooltip>\n      {hasExpression && <SQLPopover sqlExpression={expression} />}\n      {column.is_certified && (\n        <CertifiedIconWithTooltip\n          metricName={column.metric_name}\n          certifiedBy={column.certified_by}\n          details={column.certification_details}\n        />\n      )}\n    </StyleOverrides>\n  );\n}\n\nexport default ColumnOption;\n","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldDerived(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M6.988 10.809l-1.031 4.84c-.184.867-.57 1.576-1.16 2.126-.59.551-1.197.827-1.822.827-.344 0-.597-.066-.76-.197a.61.61 0 01-.242-.495.7.7 0 01.152-.445c.102-.13.248-.194.44-.194.12 0 .227.028.319.082a.978.978 0 01.243.206c.055.066.116.156.185.27l.178.292c.301-.023.558-.226.77-.61.214-.382.398-.929.554-1.64l1.079-5.062H4.75l.123-.534h1.13l.083-.398c.094-.453.242-.861.445-1.225.203-.363.434-.672.692-.925.254-.25.542-.447.864-.59.322-.142.632-.213.929-.213.343 0 .596.065.758.196a.61.61 0 01.244.495.727.727 0 01-.144.446c-.096.128-.245.193-.448.193a.614.614 0 01-.317-.08.895.895 0 01-.24-.207 1.921 1.921 0 01-.187-.276 3.843 3.843 0 00-.176-.287c-.27.012-.508.19-.715.534-.207.343-.395.916-.562 1.716l-.13.621H8.57l-.123.534H6.988zm2.225 2.261c0-1.758.45-3.183 1.387-4.424h.713c-.694.89-1.236 2.774-1.236 4.424 0 1.66.537 3.54 1.236 4.429H10.6c-.938-1.24-1.387-2.666-1.387-4.429zm5.288.957h-.078l-1.25 1.988h-.952l1.802-2.632L12.2 10.75h1.001l1.25 1.958h.078l1.236-1.958h.952l-1.787 2.598 1.811 2.666h-.996l-1.245-1.988zm5.23-.952c0 1.758-.45 3.184-1.387 4.424h-.713c.693-.889 1.235-2.773 1.235-4.424 0-1.66-.537-3.54-1.235-4.429h.713c.937 1.24 1.386 2.666 1.386 4.43z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldDerived;","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldBoolean(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M12 4h-1v16h1V4zm3.248 8.475c0 2.343.913 3.691 2.5 3.691 1.582 0 2.49-1.338 2.49-3.677 0-2.334-.923-3.7-2.49-3.7-1.577 0-2.5 1.361-2.5 3.686zM5.579 9.93V16h.879V8.954h-.874l-1.875 1.348v.928l1.792-1.3h.078zm12.169 5.468c1.04 0 1.607-1.035 1.607-2.924 0-1.87-.577-2.915-1.607-2.915s-1.616 1.054-1.616 2.915c0 1.884.576 2.924 1.616 2.924z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldBoolean;","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldAbc(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M5.91 16.14c-1.14 0-2.047-.671-2.047-1.843 0-1.375 1.215-1.621 2.328-1.766 1.094-.14 1.547-.117 1.547-.562 0-.778-.41-1.235-1.265-1.235-.88 0-1.36.47-1.563.907l-.875-.313c.469-1.094 1.5-1.406 2.406-1.406.766 0 2.22.219 2.22 2.125V16h-.923v-.813h-.047c-.187.391-.734.954-1.78.954zm.14-.828c1.095 0 1.688-.734 1.688-1.484v-.844c-.156.188-1.203.297-1.593.344-.72.094-1.36.313-1.36 1.016 0 .64.531.969 1.266.969zM9.799 16V8h.921v2.953h.079c.203-.312.562-1.031 1.734-1.031 1.516 0 2.563 1.203 2.563 3.094 0 1.906-1.047 3.109-2.547 3.109-1.157 0-1.547-.719-1.75-1.047h-.11V16h-.89zm.906-3c0 1.36.61 2.297 1.719 2.297 1.156 0 1.75-1.016 1.75-2.297 0-1.266-.579-2.25-1.75-2.25-1.125 0-1.72.906-1.72 2.25zm7.684 3.125c-1.687 0-2.719-1.297-2.719-3.094 0-1.828 1.079-3.11 2.704-3.11 1.265 0 2.218.75 2.375 1.876h-.922c-.14-.547-.625-1.047-1.438-1.047-1.078 0-1.797.89-1.797 2.25 0 1.39.703 2.297 1.797 2.297.719 0 1.266-.39 1.438-1.047h.922c-.157 1.063-1.032 1.875-2.36 1.875z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldAbc;","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldNum(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M10 8h1v2h2V8h1v2h2v1h-2v2h2v1h-2v2h-1v-2h-2v2h-1v-2H8v-1h2v-2H8v-1h2V8zm3 5v-2h-2v2h2z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldNum;","/* eslint-disable no-nested-ternary */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { css, GenericDataType, styled, t } from '@superset-ui/core';\nimport { ClockCircleOutlined, QuestionOutlined } from '@ant-design/icons';\n// TODO: move all icons to superset-ui/core\nimport FunctionSvg from './type-icons/field_derived.svg';\nimport BooleanSvg from './type-icons/field_boolean.svg';\nimport StringSvg from './type-icons/field_abc.svg';\nimport NumSvg from './type-icons/field_num.svg';\n\nexport type ColumnLabelExtendedType = 'expression' | '';\n\nexport type ColumnTypeLabelProps = {\n  type?: ColumnLabelExtendedType | GenericDataType;\n};\n\nconst TypeIconWrapper = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: ${theme.gridUnit * 6}px;\n    height: ${theme.gridUnit * 6}px;\n    margin-right: ${theme.gridUnit}px;\n\n    && svg {\n      margin-right: 0;\n      margin-left: 0;\n    }\n  `};\n`;\n\nexport function ColumnTypeLabel({ type }: ColumnTypeLabelProps) {\n  let typeIcon: ReactNode = (\n    <QuestionOutlined aria-label={t('unknown type icon')} />\n  );\n\n  if (type === '' || type === 'expression') {\n    typeIcon = <FunctionSvg aria-label={t('function type icon')} />;\n  } else if (type === GenericDataType.STRING) {\n    typeIcon = <StringSvg aria-label={t('string type icon')} />;\n  } else if (type === GenericDataType.NUMERIC) {\n    typeIcon = <NumSvg aria-label={t('numeric type icon')} />;\n  } else if (type === GenericDataType.BOOLEAN) {\n    typeIcon = <BooleanSvg aria-label={t('boolean type icon')} />;\n  } else if (type === GenericDataType.TEMPORAL) {\n    typeIcon = <ClockCircleOutlined aria-label={t('temporal type icon')} />;\n  }\n\n  return <TypeIconWrapper>{typeIcon}</TypeIconWrapper>;\n}\n\nexport default ColumnTypeLabel;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { CSSProperties } from 'react';\nimport { kebabCase } from 'lodash';\nimport { TooltipPlacement } from 'antd/lib/tooltip';\nimport { t } from '@superset-ui/core';\nimport { Tooltip, TooltipProps } from './Tooltip';\n\nexport interface InfoTooltipWithTriggerProps {\n  label?: string;\n  tooltip?: TooltipProps['title'];\n  icon?: string;\n  onClick?: () => void;\n  placement?: TooltipPlacement;\n  bsStyle?: string;\n  className?: string;\n  iconsStyle?: CSSProperties;\n}\n\nexport function InfoTooltipWithTrigger({\n  label,\n  tooltip,\n  bsStyle,\n  onClick,\n  icon = 'info-circle',\n  className = 'text-muted',\n  placement = 'right',\n  iconsStyle = {},\n}: InfoTooltipWithTriggerProps) {\n  const iconClass = `fa fa-${icon} ${className} ${\n    bsStyle ? `text-${bsStyle}` : ''\n  }`;\n  const iconEl = (\n    <i\n      role=\"button\"\n      aria-label={t('Show info tooltip')}\n      tabIndex={0}\n      className={iconClass}\n      style={{ cursor: onClick ? 'pointer' : undefined, ...iconsStyle }}\n      onClick={onClick}\n      onKeyPress={\n        onClick &&\n        (event => {\n          if (event.key === 'Enter' || event.key === ' ') {\n            onClick();\n          }\n        })\n      }\n    />\n  );\n  if (!tooltip) {\n    return iconEl;\n  }\n  return (\n    <Tooltip\n      id={`${kebabCase(label)}-tooltip`}\n      title={tooltip}\n      placement={placement}\n    >\n      {iconEl}\n    </Tooltip>\n  );\n}\n\nexport default InfoTooltipWithTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode, useLayoutEffect } from 'react';\nimport {\n  css,\n  styled,\n  Metric,\n  SafeMarkdown,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport InfoTooltipWithTrigger from './InfoTooltipWithTrigger';\nimport { ColumnTypeLabel } from './ColumnTypeLabel/ColumnTypeLabel';\nimport CertifiedIconWithTooltip from './CertifiedIconWithTooltip';\nimport Tooltip from './Tooltip';\nimport { getMetricTooltipNode } from './labelUtils';\nimport { SQLPopover } from './SQLPopover';\n\nconst FlexRowContainer = styled.div`\n  align-items: center;\n  display: flex;\n\n  > svg {\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport interface MetricOptionProps {\n  metric: Omit<Metric, 'id'> & { label?: string };\n  openInNewWindow?: boolean;\n  showFormula?: boolean;\n  showType?: boolean;\n  url?: string;\n  labelRef?: React.RefObject<any>;\n  shouldShowTooltip?: boolean;\n}\n\nexport function MetricOption({\n  metric,\n  labelRef,\n  openInNewWindow = false,\n  showFormula = true,\n  showType = false,\n  shouldShowTooltip = true,\n  url = '',\n}: MetricOptionProps) {\n  const verbose = metric.verbose_name || metric.metric_name || metric.label;\n  const link = url ? (\n    <a href={url} target={openInNewWindow ? '_blank' : ''} rel=\"noreferrer\">\n      {verbose}\n    </a>\n  ) : (\n    verbose\n  );\n\n  const label = (\n    <span\n      className=\"option-label metric-option-label\"\n      css={(theme: SupersetTheme) => css`\n        margin-right: ${theme.gridUnit}px;\n      `}\n      ref={labelRef}\n    >\n      {link}\n    </span>\n  );\n\n  const warningMarkdown = metric.warning_markdown || metric.warning_text;\n\n  const [tooltipText, setTooltipText] = useState<ReactNode>(metric.metric_name);\n\n  useLayoutEffect(() => {\n    setTooltipText(getMetricTooltipNode(metric, labelRef));\n  }, [labelRef, metric]);\n\n  return (\n    <FlexRowContainer className=\"metric-option\">\n      {showType && <ColumnTypeLabel type=\"expression\" />}\n      {shouldShowTooltip ? (\n        <Tooltip id=\"metric-name-tooltip\" title={tooltipText}>\n          {label}\n        </Tooltip>\n      ) : (\n        label\n      )}\n      {showFormula && metric.expression && (\n        <SQLPopover sqlExpression={metric.expression} />\n      )}\n      {metric.is_certified && (\n        <CertifiedIconWithTooltip\n          metricName={metric.metric_name}\n          certifiedBy={metric.certified_by}\n          details={metric.certification_details}\n        />\n      )}\n      {warningMarkdown && (\n        <InfoTooltipWithTrigger\n          className=\"text-warning\"\n          icon=\"warning\"\n          tooltip={<SafeMarkdown source={warningMarkdown} />}\n          label={`warn-${metric.metric_name}`}\n          iconsStyle={{ marginLeft: 0 }}\n        />\n      )}\n    </FlexRowContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { Popover } from 'antd';\nimport type { PopoverProps } from 'antd/lib/popover';\nimport AceEditor from 'react-ace';\nimport { CalculatorOutlined } from '@ant-design/icons';\nimport { css, styled, useTheme, t } from '@superset-ui/core';\nimport 'ace-builds/src-noconflict/mode-sql';\n\nconst StyledCalculatorIcon = styled(CalculatorOutlined)`\n  ${({ theme }) => css`\n    color: ${theme.colors.grayscale.base};\n    font-size: ${theme.typography.sizes.s}px;\n    & svg {\n      margin-left: ${theme.gridUnit}px;\n      margin-right: ${theme.gridUnit}px;\n    }\n  `}\n`;\n\nexport const SQLPopover = (props: PopoverProps & { sqlExpression: string }) => {\n  const theme = useTheme();\n  return (\n    <Popover\n      content={\n        <AceEditor\n          mode=\"sql\"\n          value={props.sqlExpression}\n          editorProps={{ $blockScrolling: true }}\n          setOptions={{\n            highlightActiveLine: false,\n            highlightGutterLine: false,\n          }}\n          minLines={2}\n          maxLines={6}\n          readOnly\n          wrapEnabled\n          style={{\n            border: `1px solid ${theme.colors.grayscale.light2}`,\n            background: theme.colors.secondary.light5,\n            maxWidth: theme.gridUnit * 100,\n          }}\n        />\n      }\n      placement=\"bottomLeft\"\n      arrowPointAtCenter\n      title={t('SQL expression')}\n      {...props}\n    >\n      <StyledCalculatorIcon />\n    </Popover>\n  );\n};\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { useTheme, css } from '@superset-ui/core';\nimport { Tooltip as BaseTooltip } from 'antd';\nimport type { TooltipProps } from 'antd/lib/tooltip';\nimport { Global } from '@emotion/react';\n\nexport type { TooltipProps } from 'antd/lib/tooltip';\n\nexport const Tooltip = ({ overlayStyle, color, ...props }: TooltipProps) => {\n  const theme = useTheme();\n  const defaultColor = `${theme.colors.grayscale.dark2}e6`;\n  return (\n    <>\n      {/* Safari hack to hide browser default tooltips */}\n      <Global\n        styles={css`\n          .ant-tooltip-open {\n            display: inline-block;\n            &::after {\n              content: '';\n              display: block;\n            }\n          }\n        `}\n      />\n      <BaseTooltip\n        overlayStyle={{\n          fontSize: theme.typography.sizes.s,\n          lineHeight: '1.6',\n          maxWidth: theme.gridUnit * 62,\n          minWidth: theme.gridUnit * 30,\n          ...overlayStyle,\n        }}\n        // make the tooltip display closer to the label\n        align={{ offset: [0, 1] }}\n        color={defaultColor || color}\n        trigger=\"hover\"\n        placement=\"bottom\"\n        // don't allow hovering over the tooltip\n        mouseLeaveDelay={0}\n        {...props}\n      />\n    </>\n  );\n};\n\nexport default Tooltip;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\n\nimport { css, styled, t } from '@superset-ui/core';\nimport { ColumnMeta, Metric } from '@superset-ui/chart-controls';\n\nconst TooltipSectionWrapper = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: column;\n    font-size: ${theme.typography.sizes.s}px;\n    line-height: 1.2;\n\n    &:not(:last-of-type) {\n      margin-bottom: ${theme.gridUnit * 2}px;\n    }\n    &:last-of-type {\n      display: -webkit-box;\n      -webkit-line-clamp: 40;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}\n`;\n\nconst TooltipSectionLabel = styled.span`\n  ${({ theme }) => css`\n    font-weight: ${theme.typography.weights.bold};\n  `}\n`;\n\nconst TooltipSection = ({\n  label,\n  text,\n}: {\n  label: ReactNode;\n  text: ReactNode;\n}) => (\n  <TooltipSectionWrapper>\n    <TooltipSectionLabel>{label}</TooltipSectionLabel>\n    <span>{text}</span>\n  </TooltipSectionWrapper>\n);\n\nexport const isLabelTruncated = (labelRef?: React.RefObject<any>): boolean =>\n  !!(labelRef?.current?.scrollWidth > labelRef?.current?.clientWidth);\n\nexport const getColumnLabelText = (column: ColumnMeta): string =>\n  column.verbose_name || column.column_name;\n\nexport const getColumnTypeTooltipNode = (column: ColumnMeta): ReactNode => {\n  if (!column.type) {\n    return null;\n  }\n\n  return (\n    <TooltipSection\n      label={t('Column datatype')}\n      text={column.type.toLowerCase()}\n    />\n  );\n};\n\nexport const getColumnTooltipNode = (\n  column: ColumnMeta,\n  labelRef?: React.RefObject<any>,\n): ReactNode => {\n  if (\n    (!column.column_name || !column.verbose_name) &&\n    !column.description &&\n    !isLabelTruncated(labelRef)\n  ) {\n    return null;\n  }\n\n  return (\n    <>\n      {column.column_name && (\n        <TooltipSection label={t('Column name')} text={column.column_name} />\n      )}\n      {column.verbose_name && (\n        <TooltipSection label={t('Label')} text={column.verbose_name} />\n      )}\n      {column.description && (\n        <TooltipSection label={t('Description')} text={column.description} />\n      )}\n    </>\n  );\n};\n\ntype MetricType = Omit<Metric, 'id'> & { label?: string };\n\nexport const getMetricTooltipNode = (\n  metric: MetricType,\n  labelRef?: React.RefObject<any>,\n): ReactNode => {\n  if (\n    !metric.verbose_name &&\n    !metric.description &&\n    !metric.label &&\n    !isLabelTruncated(labelRef)\n  ) {\n    return null;\n  }\n\n  return (\n    <>\n      <TooltipSection label={t('Metric name')} text={metric.metric_name} />\n      {(metric.label || metric.verbose_name) && (\n        <TooltipSection\n          label={t('Label')}\n          text={metric.label || metric.verbose_name}\n        />\n      )}\n      {metric.description && (\n        <TooltipSection label={t('Description')} text={metric.description} />\n      )}\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  t,\n  QueryMode,\n  DTTM_ALIAS,\n  GenericDataType,\n  QueryColumn,\n  DatasourceType,\n} from '@superset-ui/core';\nimport { ColumnMeta, SortSeriesData, SortSeriesType } from './types';\n\n// eslint-disable-next-line import/prefer-default-export\nexport const TIME_FILTER_LABELS = {\n  time_range: t('Time Range'),\n  granularity_sqla: t('Time Column'),\n  time_grain_sqla: t('Time Grain'),\n  granularity: t('Time Granularity'),\n};\n\nexport const COLUMN_NAME_ALIASES: Record<string, string> = {\n  [DTTM_ALIAS]: t('Time'),\n};\n\nexport const DATASET_TIME_COLUMN_OPTION: ColumnMeta = {\n  verbose_name: COLUMN_NAME_ALIASES[DTTM_ALIAS],\n  column_name: DTTM_ALIAS,\n  type_generic: GenericDataType.TEMPORAL,\n  description: t(\n    'A reference to the [Time] configuration, taking granularity into account',\n  ),\n};\n\nexport const QUERY_TIME_COLUMN_OPTION: QueryColumn = {\n  column_name: DTTM_ALIAS,\n  type: DatasourceType.Query,\n  is_dttm: false,\n};\n\nexport const QueryModeLabel = {\n  [QueryMode.aggregate]: t('Aggregate'),\n  [QueryMode.raw]: t('Raw records'),\n};\n\nexport const DEFAULT_SORT_SERIES_DATA: SortSeriesData = {\n  sort_series_type: SortSeriesType.Sum,\n  sort_series_ascending: false,\n};\n\nexport const SORT_SERIES_CHOICES = [\n  [SortSeriesType.Name, t('Category name')],\n  [SortSeriesType.Sum, t('Total value')],\n  [SortSeriesType.Min, t('Minimum value')],\n  [SortSeriesType.Max, t('Maximum value')],\n  [SortSeriesType.Avg, t('Average value')],\n];\n\nexport const DEFAULT_XAXIS_SORT_SERIES_DATA: SortSeriesData = {\n  sort_series_type: SortSeriesType.Name,\n  sort_series_ascending: true,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from './InfoTooltipWithTrigger';\nimport { Tooltip } from './Tooltip';\n\ntype ValidationError = string;\n\nexport type ControlHeaderProps = {\n  name?: string;\n  label?: ReactNode;\n  description?: ReactNode;\n  validationErrors?: ValidationError[];\n  renderTrigger?: boolean;\n  rightNode?: ReactNode;\n  leftNode?: ReactNode;\n  hovered?: boolean;\n  required?: boolean;\n  warning?: string;\n  danger?: string;\n  onClick?: () => void;\n  tooltipOnClick?: () => void;\n};\n\nexport default function ControlHeader({\n  name,\n  description,\n  label,\n  tooltipOnClick,\n  onClick,\n  warning,\n  danger,\n  leftNode,\n  rightNode,\n  validationErrors = [],\n  renderTrigger = false,\n  hovered = false,\n  required = false,\n}: ControlHeaderProps) {\n  const renderOptionalIcons = () => {\n    if (hovered) {\n      return (\n        <span>\n          {description && (\n            <span>\n              <InfoTooltipWithTrigger\n                label={t('description')}\n                tooltip={description}\n                placement=\"top\"\n                onClick={tooltipOnClick}\n              />{' '}\n            </span>\n          )}\n          {renderTrigger && (\n            <span>\n              <InfoTooltipWithTrigger\n                label={t('bolt')}\n                tooltip={t('Changing this control takes effect instantly')}\n                placement=\"top\"\n                icon=\"bolt\"\n              />{' '}\n            </span>\n          )}\n        </span>\n      );\n    }\n    return null;\n  };\n\n  if (!label) {\n    return null;\n  }\n  const labelClass = validationErrors.length > 0 ? 'text-danger' : '';\n  return (\n    <div className=\"ControlHeader\" data-test={`${name}-header`}>\n      <div className=\"pull-left\">\n        <label className=\"control-label\" htmlFor={name}>\n          {leftNode && <span>{leftNode}</span>}\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={onClick}\n            className={labelClass}\n            style={{ cursor: onClick ? 'pointer' : '' }}\n          >\n            {label}\n          </span>{' '}\n          {warning && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={warning}>\n                <i className=\"fa fa-exclamation-circle text-warning\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {danger && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={danger}>\n                <i className=\"fa fa-exclamation-circle text-danger\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {validationErrors.length > 0 && (\n            <span>\n              <Tooltip\n                id=\"error-tooltip\"\n                placement=\"top\"\n                title={validationErrors.join(' ')}\n              >\n                <i className=\"fa fa-exclamation-circle text-danger\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {renderOptionalIcons()}\n          {required && (\n            <span className=\"text-danger m-l-4\">\n              <strong>*</strong>\n            </span>\n          )}\n        </label>\n      </div>\n      {rightNode && <div className=\"pull-right\">{rightNode}</div>}\n      <div className=\"clearfix\" />\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { JsonValue, useTheme } from '@superset-ui/core';\nimport ControlHeader from '../../components/ControlHeader';\n\n// [value, label]\nexport type RadioButtonOption = [\n  JsonValue,\n  Exclude<ReactNode, null | undefined | boolean>,\n];\n\nexport interface RadioButtonControlProps {\n  label?: ReactNode;\n  description?: string;\n  options: RadioButtonOption[];\n  hovered?: boolean;\n  value?: JsonValue;\n  onChange: (opt: RadioButtonOption[0]) => void;\n}\n\nexport default function RadioButtonControl({\n  value: initialValue,\n  options,\n  onChange,\n  ...props\n}: RadioButtonControlProps) {\n  const currentValue = initialValue || options[0][0];\n  const theme = useTheme();\n  return (\n    <div\n      css={{\n        '.btn svg': {\n          position: 'relative',\n          top: '0.2em',\n        },\n        '.btn:focus': {\n          outline: 'none',\n        },\n        '.control-label': {\n          color: theme.colors.grayscale.base,\n          marginBottom: theme.gridUnit,\n        },\n        '.control-label + .btn-group': {\n          marginTop: '1px',\n        },\n        '.btn-group .btn-default': {\n          color: theme.colors.grayscale.dark1,\n        },\n        '.btn-group .btn.active': {\n          background: theme.colors.grayscale.light4,\n          fontWeight: theme.typography.weights.bold,\n          boxShadow: 'none',\n        },\n      }}\n    >\n      <ControlHeader {...props} />\n      <div className=\"btn-group btn-group-sm\">\n        {options.map(([val, label]) => (\n          <button\n            key={JSON.stringify(val)}\n            type=\"button\"\n            className={`btn btn-default ${\n              val === currentValue ? 'active' : ''\n            }`}\n            onClick={() => {\n              onChange(val);\n            }}\n          >\n            {label}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FunctionComponentElement, useMemo } from 'react';\nimport {\n  FAST_DEBOUNCE,\n  JsonObject,\n  JsonValue,\n  useTheme,\n} from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { ControlFormItemNode } from './ControlFormItem';\n\nexport * from './ControlFormItem';\n\nexport type ControlFormRowProps = {\n  children: ControlFormItemNode | ControlFormItemNode[];\n};\n\nexport function ControlFormRow({ children }: ControlFormRowProps) {\n  const { gridUnit } = useTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexWrap: 'nowrap',\n        margin: -2 * gridUnit,\n        marginBottom: gridUnit,\n      }}\n    >\n      {children}\n    </div>\n  );\n}\n\ntype ControlFormRowNode = FunctionComponentElement<ControlFormRowProps>;\n\nexport type ControlFormProps = {\n  /**\n   * Form field values dict.\n   */\n  value?: JsonObject;\n  onChange: (value: JsonObject) => void;\n  children: ControlFormRowNode | ControlFormRowNode[];\n};\n\n/**\n * Light weight form for control panel.\n */\nexport default function ControlForm({\n  onChange,\n  value,\n  children,\n}: ControlFormProps) {\n  const theme = useTheme();\n  const debouncedOnChange = useMemo(\n    () =>\n      ({\n        0: onChange,\n        [FAST_DEBOUNCE]: debounce(onChange, FAST_DEBOUNCE),\n      } as Record<number, typeof onChange>),\n    [onChange],\n  );\n\n  const updatedChildren = React.Children.map(children, row => {\n    if ('children' in row.props) {\n      const defaultWidth = Array.isArray(row.props.children)\n        ? `${100 / row.props.children.length}%`\n        : undefined;\n      return React.cloneElement(row, {\n        children: React.Children.map(row.props.children, item => {\n          const {\n            name,\n            width,\n            debounceDelay = FAST_DEBOUNCE,\n            onChange: onItemValueChange,\n          } = item.props;\n          return React.cloneElement(item, {\n            width: width || defaultWidth,\n            value: value?.[name],\n            // remove `debounceDelay` from rendered control item props\n            // so React DevTools don't throw a `invalid prop` warning.\n            debounceDelay: undefined,\n            onChange(fieldValue: JsonValue) {\n              // call `onChange` on each FormItem\n              if (onItemValueChange) {\n                onItemValueChange(fieldValue);\n              }\n              // propagate to the form\n              if (!(debounceDelay in debouncedOnChange)) {\n                debouncedOnChange[debounceDelay] = debounce(\n                  onChange,\n                  debounceDelay,\n                );\n              }\n              debouncedOnChange[debounceDelay]({\n                ...value,\n                [name]: fieldValue,\n              });\n            },\n          });\n        }),\n      });\n    }\n    return row;\n  });\n  return (\n    <div\n      css={{\n        label: {\n          textTransform: 'uppercase',\n          color: theme.colors.text.label,\n          fontSize: theme.typography.sizes.s,\n        },\n      }}\n    >\n      {updatedChildren}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode } from 'react';\nimport AntdSelect, { SelectProps as AntdSelectProps } from 'antd/lib/select';\n\nexport const { Option }: any = AntdSelect;\n\nexport type SelectOption<VT = string> = [VT, ReactNode];\n\nexport type SelectProps<VT> = Omit<AntdSelectProps<VT>, 'options'> & {\n  creatable?: boolean;\n  minWidth?: string | number;\n  options?: SelectOption<VT>[];\n};\n\n/**\n * AntD select with creatable options.\n */\nexport default function Select<VT extends string | number>({\n  creatable,\n  onSearch,\n  dropdownMatchSelectWidth = false,\n  minWidth = '100%',\n  showSearch: showSearch_ = true,\n  onChange,\n  options,\n  children,\n  value,\n  ...props\n}: SelectProps<VT>) {\n  const [searchValue, setSearchValue] = useState<string>();\n  // force show search if creatable\n  const showSearch = showSearch_ || creatable;\n  const handleSearch = showSearch\n    ? (input: string) => {\n        if (creatable) {\n          setSearchValue(input);\n        }\n        if (onSearch) {\n          onSearch(input);\n        }\n      }\n    : undefined;\n\n  const optionsHasSearchValue = options?.some(([val]) => val === searchValue);\n  const optionsHasValue = options?.some(([val]) => val === value);\n\n  const handleChange: SelectProps<VT>['onChange'] = showSearch\n    ? (val, opt) => {\n        // reset input value once selected\n        setSearchValue('');\n        if (onChange) {\n          onChange(val, opt);\n        }\n      }\n    : onChange;\n\n  return (\n    <AntdSelect<VT>\n      dropdownMatchSelectWidth={dropdownMatchSelectWidth}\n      showSearch={showSearch}\n      onSearch={handleSearch}\n      onChange={handleChange}\n      value={value}\n      {...props}\n      css={{\n        minWidth,\n      }}\n    >\n      {options?.map(([val, label]) => (\n        <Option value={val}>{label}</Option>\n      ))}\n      {children}\n      {value && !optionsHasValue && (\n        <Option key={value} value={value}>\n          {value}\n        </Option>\n      )}\n      {searchValue && !optionsHasSearchValue && (\n        <Option key={searchValue} value={searchValue}>\n          {/* Unfortunately AntD select does not support displaying different\n          label for option vs select value, so we can't use\n          `t('Create \"%s\"', searchValue)` here */}\n          {searchValue}\n        </Option>\n      )}\n    </AntdSelect>\n  );\n}\n\nSelect.Option = Option;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { Slider, InputNumber, Input } from 'antd';\nimport Checkbox, { CheckboxProps } from 'antd/lib/checkbox';\nimport Select, { SelectOption } from '../Select';\nimport RadioButtonControl, {\n  RadioButtonOption,\n} from '../../shared-controls/components/RadioButtonControl';\n\nexport const ControlFormItemComponents = {\n  Slider,\n  InputNumber,\n  Input,\n  Select,\n  // Directly export Checkbox will result in \"using name from external module\" error\n  // ref: https://stackoverflow.com/questions/43900035/ts4023-exported-variable-x-has-or-is-using-name-y-from-external-module-but\n  Checkbox: Checkbox as React.ForwardRefExoticComponent<\n    CheckboxProps & React.RefAttributes<HTMLInputElement>\n  >,\n  RadioButtonControl,\n};\n\nexport type ControlType = keyof typeof ControlFormItemComponents;\n\nexport type ControlFormValueValidator<V> = (value: V) => string | false;\n\nexport type ControlFormItemSpec<T extends ControlType = ControlType> = {\n  controlType: T;\n  label: ReactNode;\n  description: ReactNode;\n  placeholder?: string;\n  required?: boolean;\n  validators?: ControlFormValueValidator<any>[];\n  width?: number | string;\n  /**\n   * Time to delay change propagation.\n   */\n  debounceDelay?: number;\n} & (T extends 'Select'\n  ? {\n      options: SelectOption<any>[];\n      value?: string;\n      defaultValue?: string;\n      creatable?: boolean;\n      minWidth?: number | string;\n      validators?: ControlFormValueValidator<string>[];\n    }\n  : T extends 'RadioButtonControl'\n  ? {\n      options: RadioButtonOption[];\n      value?: string;\n      defaultValue?: string;\n    }\n  : T extends 'Checkbox'\n  ? {\n      value?: boolean;\n      defaultValue?: boolean;\n    }\n  : T extends 'InputNumber' | 'Slider'\n  ? {\n      min?: number;\n      max?: number;\n      step?: number;\n      value?: number;\n      defaultValue?: number;\n      validators?: ControlFormValueValidator<number>[];\n    }\n  : T extends 'Input'\n  ? {\n      controlType: 'Input';\n      value?: string;\n      defaultValue?: string;\n      validators?: ControlFormValueValidator<string>[];\n    }\n  : {});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, FunctionComponentElement, ChangeEvent } from 'react';\nimport { JsonValue, useTheme } from '@superset-ui/core';\nimport ControlHeader, { ControlHeaderProps } from '../ControlHeader';\nimport InfoTooltipWithTrigger from '../InfoTooltipWithTrigger';\nimport { ControlFormItemComponents, ControlFormItemSpec } from './controls';\n\nexport * from './controls';\n\nexport type ControlFormItemProps = ControlFormItemSpec & {\n  name: string;\n  onChange?: (fieldValue: JsonValue) => void;\n};\n\nexport type ControlFormItemNode =\n  FunctionComponentElement<ControlFormItemProps>;\n\n/**\n * Accept `false` or `0`, but not empty string.\n */\nfunction isEmptyValue(value?: JsonValue) {\n  return value == null || value === '';\n}\n\nexport function ControlFormItem({\n  name,\n  label,\n  description,\n  width,\n  validators,\n  required,\n  onChange,\n  value: initialValue,\n  defaultValue,\n  controlType,\n  ...props\n}: ControlFormItemProps) {\n  const { gridUnit } = useTheme();\n  const [hovered, setHovered] = useState(false);\n  const [value, setValue] = useState(\n    initialValue === undefined ? defaultValue : initialValue,\n  );\n  const [validationErrors, setValidationErrors] =\n    useState<ControlHeaderProps['validationErrors']>();\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement> | JsonValue) => {\n    const fieldValue =\n      e && typeof e === 'object' && 'target' in e\n        ? e.target.type === 'checkbox' || e.target.type === 'radio'\n          ? e.target.checked\n          : e.target.value\n        : e;\n    const errors =\n      (validators\n        ?.map(validator =>\n          !required && isEmptyValue(fieldValue) ? false : validator(fieldValue),\n        )\n        .filter(x => !!x) as string[]) || [];\n    setValidationErrors(errors);\n    setValue(fieldValue);\n    if (errors.length === 0 && onChange) {\n      onChange(fieldValue as JsonValue);\n    }\n  };\n\n  const Control = ControlFormItemComponents[controlType];\n\n  return (\n    <div\n      css={{\n        margin: 2 * gridUnit,\n        width,\n      }}\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n    >\n      {controlType === 'Checkbox' ? (\n        <ControlFormItemComponents.Checkbox\n          checked={value as boolean}\n          onChange={handleChange}\n        >\n          {label}{' '}\n          {hovered && description && (\n            <InfoTooltipWithTrigger tooltip={description} />\n          )}\n        </ControlFormItemComponents.Checkbox>\n      ) : (\n        <>\n          {label && (\n            <ControlHeader\n              name={name}\n              label={label}\n              description={description}\n              validationErrors={validationErrors}\n              hovered={hovered}\n              required={required}\n            />\n          )}\n          {/* @ts-ignore */}\n          <Control {...props} value={value} onChange={handleChange} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default ControlFormItem;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { GenericDataType, t, validateNumber } from '@superset-ui/core';\nimport { FaAlignLeft } from '@react-icons/all-files/fa/FaAlignLeft';\nimport { FaAlignRight } from '@react-icons/all-files/fa/FaAlignRight';\nimport { FaAlignCenter } from '@react-icons/all-files/fa/FaAlignCenter';\nimport {\n  D3_FORMAT_DOCS,\n  D3_FORMAT_OPTIONS,\n  D3_TIME_FORMAT_DOCS,\n  D3_TIME_FORMAT_OPTIONS,\n} from '../../../utils';\nimport { ControlFormItemSpec } from '../../../components/ControlForm';\nimport { ColumnConfigFormLayout } from './types';\n\nexport type SharedColumnConfigProp =\n  | 'alignPositiveNegative'\n  | 'colorPositiveNegative'\n  | 'columnWidth'\n  | 'fractionDigits'\n  | 'd3NumberFormat'\n  | 'd3SmallNumberFormat'\n  | 'd3TimeFormat'\n  | 'horizontalAlign'\n  | 'truncateLongCells'\n  | 'showCellBars';\n\nconst d3NumberFormat: ControlFormItemSpec<'Select'> = {\n  controlType: 'Select',\n  label: t('D3 format'),\n  description: D3_FORMAT_DOCS,\n  options: D3_FORMAT_OPTIONS,\n  defaultValue: D3_FORMAT_OPTIONS[0][0],\n  creatable: true,\n  minWidth: '14em',\n  debounceDelay: 500,\n};\n\nconst d3TimeFormat: ControlFormItemSpec<'Select'> = {\n  controlType: 'Select',\n  label: t('D3 format'),\n  description: D3_TIME_FORMAT_DOCS,\n  options: D3_TIME_FORMAT_OPTIONS,\n  defaultValue: D3_TIME_FORMAT_OPTIONS[0][0],\n  creatable: true,\n  minWidth: '10em',\n  debounceDelay: 500,\n};\n\nconst fractionDigits: ControlFormItemSpec<'Slider'> = {\n  controlType: 'Slider',\n  label: t('Fraction digits'),\n  description: t('Number of decimal digits to round numbers to'),\n  min: 0,\n  step: 1,\n  max: 100,\n  defaultValue: 100,\n};\n\nconst columnWidth: ControlFormItemSpec<'InputNumber'> = {\n  controlType: 'InputNumber',\n  label: t('Min Width'),\n  description: t(\n    \"Default minimal column width in pixels, actual width may still be larger than this if other columns don't need much space\",\n  ),\n  width: 120,\n  placeholder: t('auto'),\n  debounceDelay: 400,\n  validators: [validateNumber],\n};\n\nconst horizontalAlign: ControlFormItemSpec<'RadioButtonControl'> & {\n  value?: 'left' | 'right' | 'center';\n  defaultValue?: 'left' | 'right' | 'center';\n} = {\n  controlType: 'RadioButtonControl',\n  label: t('Text align'),\n  description: t('Horizontal alignment'),\n  width: 130,\n  debounceDelay: 50,\n  defaultValue: 'left',\n  options: [\n    ['left', <FaAlignLeft title={t('Left')} />],\n    ['center', <FaAlignCenter title={t('Center')} />],\n    ['right', <FaAlignRight title={t('Right')} />],\n  ],\n};\n\nconst showCellBars: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Show cell bars'),\n  description: t('Whether to display a bar chart background in table columns'),\n  defaultValue: true,\n  debounceDelay: 200,\n};\n\nconst alignPositiveNegative: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Align +/-'),\n  description: t(\n    'Whether to align positive and negative values in cell bar chart at 0',\n  ),\n  defaultValue: false,\n  debounceDelay: 200,\n};\n\nconst colorPositiveNegative: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Color +/-'),\n  description: t(\n    'Whether to colorize numeric values by if they are positive or negative',\n  ),\n  defaultValue: false,\n  debounceDelay: 200,\n};\n\nconst truncateLongCells: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Truncate Cells'),\n  description: t('Truncate long cells to the \"min width\" set above'),\n  defaultValue: false,\n  debounceDelay: 400,\n};\n\n/**\n * All configurable column formatting properties.\n */\nexport const SHARED_COLUMN_CONFIG_PROPS = {\n  d3NumberFormat,\n  d3SmallNumberFormat: {\n    ...d3NumberFormat,\n    label: t('Small number format'),\n    description: t(\n      'D3 number format for numbers between -1.0 and 1.0, ' +\n        'useful when you want to have different significant digits for small and large numbers',\n    ),\n  },\n  d3TimeFormat,\n  fractionDigits,\n  columnWidth,\n  truncateLongCells,\n  horizontalAlign,\n  showCellBars,\n  alignPositiveNegative,\n  colorPositiveNegative,\n};\n\nexport type SharedColumnConfig = {\n  [key in SharedColumnConfigProp]?: typeof SHARED_COLUMN_CONFIG_PROPS[key]['value'];\n};\n\nexport const DEFAULT_CONFIG_FORM_LAYOUT: ColumnConfigFormLayout = {\n  [GenericDataType.STRING]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n    ['truncateLongCells'],\n  ],\n  [GenericDataType.NUMERIC]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'right' } },\n    ],\n    ['d3NumberFormat'],\n    ['d3SmallNumberFormat'],\n    ['alignPositiveNegative', 'colorPositiveNegative'],\n    ['showCellBars'],\n  ],\n  [GenericDataType.TEMPORAL]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n    ['d3TimeFormat'],\n  ],\n  [GenericDataType.BOOLEAN]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n  ],\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { GenericDataType } from '@superset-ui/core';\nimport ControlForm, {\n  ControlFormRow,\n  ControlFormItem,\n  ControlFormItemSpec,\n} from '../../../components/ControlForm';\nimport {\n  SHARED_COLUMN_CONFIG_PROPS,\n  SharedColumnConfigProp,\n} from './constants';\nimport {\n  ColumnConfig,\n  ColumnConfigFormLayout,\n  ColumnConfigInfo,\n} from './types';\n\nexport type ColumnConfigPopoverProps = {\n  column: ColumnConfigInfo;\n  configFormLayout: ColumnConfigFormLayout;\n  onChange: (value: ColumnConfig) => void;\n};\n\nexport default function ColumnConfigPopover({\n  column,\n  configFormLayout,\n  onChange,\n}: ColumnConfigPopoverProps) {\n  return (\n    <ControlForm onChange={onChange} value={column.config}>\n      {configFormLayout[\n        column.type === undefined ? GenericDataType.STRING : column.type\n      ].map((row, i) => (\n        <ControlFormRow key={i}>\n          {row.map(meta => {\n            const key = typeof meta === 'string' ? meta : meta.name;\n            const override =\n              typeof meta === 'string'\n                ? {}\n                : 'override' in meta\n                ? meta.override\n                : meta.config;\n            const props = {\n              ...(key in SHARED_COLUMN_CONFIG_PROPS\n                ? SHARED_COLUMN_CONFIG_PROPS[key as SharedColumnConfigProp]\n                : undefined),\n              ...override,\n            } as ControlFormItemSpec;\n            return <ControlFormItem key={key} name={key} {...props} />;\n          })}\n        </ControlFormRow>\n      ))}\n    </ControlForm>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { Popover } from 'antd';\nimport ColumnTypeLabel from '../../../components/ColumnTypeLabel/ColumnTypeLabel';\nimport ColumnConfigPopover, {\n  ColumnConfigPopoverProps,\n} from './ColumnConfigPopover';\n\nexport type ColumnConfigItemProps = ColumnConfigPopoverProps;\n\nexport default React.memo(function ColumnConfigItem({\n  column,\n  onChange,\n  configFormLayout,\n}: ColumnConfigItemProps) {\n  const { colors, gridUnit } = useTheme();\n  const caretWidth = gridUnit * 6;\n  return (\n    <Popover\n      title={column.name}\n      content={() => (\n        <ColumnConfigPopover\n          column={column}\n          onChange={onChange}\n          configFormLayout={configFormLayout}\n        />\n      )}\n      trigger=\"click\"\n      placement=\"right\"\n    >\n      <div\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          cursor: 'pointer',\n          padding: `${gridUnit}px ${2 * gridUnit}px`,\n          borderBottom: `1px solid ${colors.grayscale.light2}`,\n          position: 'relative',\n          paddingRight: caretWidth,\n          '&:last-child': {\n            borderBottom: 'none',\n          },\n          '&:hover': {\n            background: colors.grayscale.light4,\n          },\n          '> .fa': {\n            color: colors.grayscale.light2,\n          },\n          '&:hover > .fa': {\n            color: colors.grayscale.light1,\n          },\n        }}\n      >\n        <ColumnTypeLabel type={column.type} />\n        {column.name}\n        <i\n          className=\"fa fa-caret-right\"\n          css={{\n            position: 'absolute',\n            right: 3 * gridUnit,\n            top: 3 * gridUnit,\n          }}\n        />\n      </div>\n    </Popover>\n  );\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  GenericDataType,\n  JsonObject,\n  StrictJsonValue,\n} from '@superset-ui/core';\nimport { ControlFormItemSpec } from '../../../components/ControlForm';\nimport {\n  SHARED_COLUMN_CONFIG_PROPS,\n  SharedColumnConfigProp,\n} from './constants';\n\n/**\n * Column formatting configs.\n */\nexport type ColumnConfig = {\n  [key in SharedColumnConfigProp]?: typeof SHARED_COLUMN_CONFIG_PROPS[key]['value'];\n} & Record<string, StrictJsonValue>;\n\n/**\n * All required info about a column to render the\n * formatting.\n */\nexport interface ColumnConfigInfo {\n  name: string;\n  type?: GenericDataType;\n  config: JsonObject;\n}\n\nexport type ColumnConfigFormItem =\n  | SharedColumnConfigProp\n  | { name: SharedColumnConfigProp; override: Partial<ControlFormItemSpec> }\n  | { name: string; config: ControlFormItemSpec };\n\nexport type ColumnConfigFormLayout = Record<\n  GenericDataType,\n  ColumnConfigFormItem[][]\n>;\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport RadioButtonControl from './RadioButtonControl';\nimport ColumnConfigControl from './ColumnConfigControl';\n\nexport * from './RadioButtonControl';\nexport * from './ColumnConfigControl';\n\n/**\n * Shared chart controls. Can be referred via string shortcuts in chart control\n * configs.\n */\nexport default {\n  RadioButtonControl,\n  ColumnConfigControl,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState } from 'react';\nimport {\n  ChartDataResponseResult,\n  useTheme,\n  t,\n  GenericDataType,\n} from '@superset-ui/core';\nimport ControlHeader from '../../../components/ControlHeader';\nimport { ControlComponentProps } from '../types';\n\nimport ColumnConfigItem from './ColumnConfigItem';\nimport {\n  ColumnConfigInfo,\n  ColumnConfig,\n  ColumnConfigFormLayout,\n} from './types';\nimport { DEFAULT_CONFIG_FORM_LAYOUT } from './constants';\nimport { COLUMN_NAME_ALIASES } from '../../../constants';\n\nexport type ColumnConfigControlProps<T extends ColumnConfig> =\n  ControlComponentProps<Record<string, T>> & {\n    queryResponse?: ChartDataResponseResult;\n    configFormLayout?: ColumnConfigFormLayout;\n    appliedColumnNames?: string[];\n  };\n\n/**\n * Max number of columns to show by default.\n */\nconst MAX_NUM_COLS = 10;\n\n/**\n * Add per-column config to queried results.\n */\nexport default function ColumnConfigControl<T extends ColumnConfig>({\n  queryResponse,\n  appliedColumnNames = [],\n  value,\n  onChange,\n  configFormLayout = DEFAULT_CONFIG_FORM_LAYOUT,\n  ...props\n}: ColumnConfigControlProps<T>) {\n  const { colnames: _colnames, coltypes: _coltypes } = queryResponse || {};\n  let colnames: string[] = [];\n  let coltypes: GenericDataType[] = [];\n  if (appliedColumnNames.length === 0) {\n    colnames = _colnames || [];\n    coltypes = _coltypes || [];\n  } else {\n    const appliedCol = new Set(appliedColumnNames);\n    _colnames?.forEach((col, idx) => {\n      if (appliedCol.has(col)) {\n        colnames.push(col);\n        coltypes.push(_coltypes?.[idx] as GenericDataType);\n      }\n    });\n  }\n  const theme = useTheme();\n  const columnConfigs = useMemo(() => {\n    const configs: Record<string, ColumnConfigInfo> = {};\n    colnames?.forEach((col, idx) => {\n      configs[col] = {\n        name: COLUMN_NAME_ALIASES[col] || col,\n        type: coltypes?.[idx],\n        config: value?.[col] || {},\n      };\n    });\n    return configs;\n  }, [value, colnames, coltypes]);\n  const [showAllColumns, setShowAllColumns] = useState(false);\n\n  const getColumnInfo = (col: string) => columnConfigs[col] || {};\n  const setColumnConfig = (col: string, config: T) => {\n    if (onChange) {\n      // Only keep configs for known columns\n      const validConfigs: Record<string, T> =\n        colnames && value\n          ? Object.fromEntries(\n              Object.entries(value).filter(([key]) => colnames.includes(key)),\n            )\n          : { ...value };\n      onChange({\n        ...validConfigs,\n        [col]: config,\n      });\n    }\n  };\n\n  if (!colnames || colnames.length === 0) return null;\n\n  const needShowMoreButton = colnames.length > MAX_NUM_COLS + 2;\n  const cols =\n    needShowMoreButton && !showAllColumns\n      ? colnames.slice(0, MAX_NUM_COLS)\n      : colnames;\n\n  return (\n    <>\n      <ControlHeader {...props} />\n      <div\n        css={{\n          border: `1px solid ${theme.colors.grayscale.light2}`,\n          borderRadius: theme.gridUnit,\n        }}\n      >\n        {cols.map(col => (\n          <ColumnConfigItem\n            key={col}\n            column={getColumnInfo(col)}\n            onChange={config => setColumnConfig(col, config as T)}\n            configFormLayout={configFormLayout}\n          />\n        ))}\n        {needShowMoreButton && (\n          <div\n            role=\"button\"\n            tabIndex={-1}\n            css={{\n              padding: theme.gridUnit * 2,\n              textAlign: 'center',\n              cursor: 'pointer',\n              textTransform: 'uppercase',\n              fontSize: theme.typography.sizes.xs,\n              color: theme.colors.text.label,\n              ':hover': {\n                backgroundColor: theme.colors.grayscale.light4,\n              },\n            }}\n            onClick={() => setShowAllColumns(!showAllColumns)}\n          >\n            {showAllColumns ? (\n              <>\n                <i className=\"fa fa-angle-up\" /> &nbsp; {t('Show less columns')}\n              </>\n            ) : (\n              <>\n                <i className=\"fa fa-angle-down\" /> &nbsp;\n                {t('Show all columns')}\n              </>\n            )}\n          </div>\n        )}\n      </div>\n    </>\n  );\n}\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo } from 'react';\nimport {\n  FeatureFlag,\n  isFeatureEnabled,\n  QueryColumn,\n  t,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport {\n  ExtraControlProps,\n  SharedControlConfig,\n  Dataset,\n  Metric,\n  isDataset,\n} from '../types';\nimport { DATASET_TIME_COLUMN_OPTION, TIME_FILTER_LABELS } from '../constants';\nimport {\n  QUERY_TIME_COLUMN_OPTION,\n  defineSavedMetrics,\n  ColumnOption,\n  ColumnMeta,\n  FilterOption,\n  temporalColumnMixin,\n  datePickerInAdhocFilterMixin,\n  xAxisMixin,\n} from '..';\n\ntype Control = {\n  savedMetrics?: Metric[] | null;\n  default?: unknown;\n};\n\n/*\n * Note: Previous to the commit that introduced this comment, the shared controls module\n * would check feature flags at module execution time and expose a different control\n * configuration (component + props) depending on the status of drag-and-drop feature\n * flags.  This commit combines those configs, merging the required props for both the\n * drag-and-drop and non-drag-and-drop components, and renders a wrapper component that\n * checks feature flags at component render time to avoid race conditions between when\n * feature flags are set and when they're checked.\n */\n\nexport const dndGroupByControl: SharedControlConfig<\n  'DndColumnSelect' | 'SelectControl',\n  ColumnMeta\n> = {\n  type: 'DndColumnSelect',\n  label: t('Dimensions'),\n  multi: true,\n  freeForm: true,\n  clearable: true,\n  default: [],\n  includeTime: false,\n  description: t(\n    'One or many columns to group by. High cardinality groupings should include a sort by metric ' +\n      'and series limit to limit the number of fetched and rendered series.',\n  ),\n  optionRenderer: (c: ColumnMeta) => <ColumnOption showType column={c} />,\n  valueRenderer: (c: ColumnMeta) => <ColumnOption column={c} />,\n  valueKey: 'column_name',\n  allowAll: true,\n  filterOption: ({ data: opt }: FilterOption<ColumnMeta>, text: string) =>\n    opt.column_name?.toLowerCase().includes(text.toLowerCase()) ||\n    opt.verbose_name?.toLowerCase().includes(text.toLowerCase()) ||\n    false,\n  promptTextCreator: (label: unknown) => label,\n  mapStateToProps(state, controlState) {\n    const newState: ExtraControlProps = {};\n    const { datasource } = state;\n    if (datasource?.columns[0]?.hasOwnProperty('groupby')) {\n      const options = (datasource as Dataset).columns.filter(c => c.groupby);\n      if (controlState?.includeTime) {\n        options.unshift(DATASET_TIME_COLUMN_OPTION);\n      }\n      newState.options = options;\n      newState.savedMetrics = (datasource as Dataset).metrics || [];\n    } else {\n      const options = (datasource?.columns as QueryColumn[]) || [];\n      if (controlState?.includeTime) {\n        options.unshift(QUERY_TIME_COLUMN_OPTION);\n      }\n      newState.options = options;\n    }\n    return newState;\n  },\n  commaChoosesOption: false,\n};\n\nexport const dndColumnsControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Columns'),\n  description: t('One or many columns to pivot as columns'),\n};\n\nexport const dndSeriesControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Dimension'),\n  multi: false,\n  default: null,\n  description: t(\n    'Defines the grouping of entities. ' +\n      'Each series is shown as a specific color on the chart and ' +\n      'has a legend toggle',\n  ),\n};\n\nexport const dndEntityControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Entity'),\n  default: null,\n  multi: false,\n  validators: [validateNonEmpty],\n  description: t('This defines the element to be plotted on the chart'),\n};\n\nexport const dndAdhocFilterControl: SharedControlConfig<\n  'DndFilterSelect' | 'AdhocFilterControl'\n> = {\n  type: 'DndFilterSelect',\n  label: t('Filters'),\n  default: [],\n  description: '',\n  mapStateToProps: ({ datasource, form_data }) => ({\n    columns: isDataset(datasource)\n      ? datasource.columns.filter(c => c.filterable)\n      : datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    // current active adhoc metrics\n    selectedMetrics:\n      form_data.metrics || (form_data.metric ? [form_data.metric] : []),\n    datasource,\n  }),\n  provideFormDataToProps: true,\n  ...datePickerInAdhocFilterMixin,\n};\n\nexport const dndAdhocMetricsControl: SharedControlConfig<\n  'DndMetricSelect' | 'MetricsControl'\n> = {\n  type: 'DndMetricSelect',\n  multi: true,\n  label: t('Metrics'),\n  validators: [validateNonEmpty],\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n  description: t('One or many metrics to display'),\n};\n\nexport const dndAdhocMetricControl: typeof dndAdhocMetricsControl = {\n  ...dndAdhocMetricsControl,\n  multi: false,\n  label: t('Metric'),\n  description: t('Metric'),\n};\n\nexport const dndAdhocMetricControl2: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Right Axis Metric'),\n  clearable: true,\n  description: t('Choose a metric for right axis'),\n};\n\nexport const dndSortByControl: SharedControlConfig<\n  'DndMetricSelect' | 'MetricsControl'\n> = {\n  type: 'DndMetricSelect',\n  label: t('Sort by'),\n  default: null,\n  description: t(\n    'Metric used to define how the top series are sorted if a series or row limit is present. ' +\n      'If undefined reverts to the first metric (where appropriate).',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n};\n\nexport const dndSizeControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Bubble Size'),\n  description: t('Metric used to calculate bubble size'),\n  default: null,\n};\n\nexport const dndXControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('X Axis'),\n  description: t('Metric assigned to the [X] axis'),\n  default: null,\n};\n\nexport const dndYControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Y Axis'),\n  description: t('Metric assigned to the [Y] axis'),\n  default: null,\n};\n\nexport const dndSecondaryMetricControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Color Metric'),\n  default: null,\n  validators: [],\n  description: t('A metric to use for color'),\n};\n\nexport const dndGranularitySqlaControl: typeof dndSeriesControl = {\n  ...dndSeriesControl,\n  ...temporalColumnMixin,\n  label: TIME_FILTER_LABELS.granularity_sqla,\n  description: t(\n    'The time column for the visualization. Note that you ' +\n      'can define arbitrary expression that return a DATETIME ' +\n      'column in the table. Also note that the ' +\n      'filter below is applied against this column or ' +\n      'expression',\n  ),\n  default: (c: Control) => c.default,\n  clearable: false,\n  canDelete: false,\n  ghostButtonText: t('Drop a temporal column here or click'),\n  optionRenderer: (c: ColumnMeta) => <ColumnOption showType column={c} />,\n  valueRenderer: (c: ColumnMeta) => <ColumnOption column={c} />,\n  valueKey: 'column_name',\n};\n\nexport const dndXAxisControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  ...xAxisMixin,\n};\n\nexport function withDndFallback(\n  DndComponent: React.ComponentType<any>,\n  FallbackComponent: React.ComponentType<any>,\n) {\n  return function DndControl(props: any) {\n    const enableExploreDnd = useMemo(\n      () => isFeatureEnabled(FeatureFlag.ENABLE_EXPLORE_DRAG_AND_DROP),\n      [],\n    );\n\n    return enableExploreDnd ? (\n      <DndComponent {...props} />\n    ) : (\n      <FallbackComponent {...props} />\n    );\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  hasGenericChartAxes,\n  NO_TIME_RANGE,\n  QueryFormData,\n  t,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport { BaseControlConfig, ControlPanelState, ControlState } from '../types';\nimport { getTemporalColumns } from '../utils';\n\nconst getAxisLabel = (\n  formData: QueryFormData,\n): Record<'label' | 'description', string> =>\n  formData?.orientation === 'horizontal'\n    ? { label: t('Y-axis'), description: t('Dimension to use on y-axis.') }\n    : { label: t('X-axis'), description: t('Dimension to use on x-axis.') };\n\nexport const xAxisMixin = {\n  label: (state: ControlPanelState) => getAxisLabel(state?.form_data).label,\n  multi: false,\n  description: (state: ControlPanelState) =>\n    getAxisLabel(state?.form_data).description,\n  validators: [validateNonEmpty],\n  initialValue: (control: ControlState, state: ControlPanelState | null) => {\n    if (\n      hasGenericChartAxes &&\n      state?.form_data?.granularity_sqla &&\n      !state.form_data?.x_axis &&\n      !control?.value\n    ) {\n      return state.form_data.granularity_sqla;\n    }\n    return undefined;\n  },\n  default: undefined,\n};\n\nexport const temporalColumnMixin: Pick<BaseControlConfig, 'mapStateToProps'> = {\n  mapStateToProps: ({ datasource }) => {\n    const payload = getTemporalColumns(datasource);\n\n    return {\n      options: payload.temporalColumns,\n      default: payload.defaultTemporalColumn,\n      isTemporal: true,\n    };\n  },\n};\n\nexport const datePickerInAdhocFilterMixin: Pick<\n  BaseControlConfig,\n  'initialValue'\n> = {\n  initialValue: (control: ControlState, state: ControlPanelState | null) => {\n    // skip initialValue if\n    // 1) GENERIC_CHART_AXES is disabled\n    // 2) the time_range control is present (this is the case for legacy charts)\n    // 3) there was a time filter in adhoc filters\n    if (\n      !hasGenericChartAxes ||\n      state?.controls?.time_range?.value ||\n      ensureIsArray(control.value).findIndex(\n        (flt: any) => flt?.operator === 'TEMPORAL_RANGE',\n      ) > -1\n    ) {\n      return undefined;\n    }\n\n    // should migrate original granularity_sqla and time_range into adhoc filter\n    // 1) granularity_sqla and time_range are existed\n    if (state?.form_data?.granularity_sqla && state?.form_data?.time_range) {\n      return [\n        ...ensureIsArray(control.value),\n        {\n          clause: 'WHERE',\n          subject: state.form_data.granularity_sqla,\n          operator: 'TEMPORAL_RANGE',\n          comparator: state.form_data.time_range,\n          expressionType: 'SIMPLE',\n        },\n      ];\n    }\n\n    // should apply the default time filter into adhoc filter\n    // 1) temporal column is existed in current datasource\n    const temporalColumn =\n      state?.datasource &&\n      getTemporalColumns(state.datasource).defaultTemporalColumn;\n    if (hasGenericChartAxes && temporalColumn) {\n      return [\n        ...ensureIsArray(control.value),\n        {\n          clause: 'WHERE',\n          subject: temporalColumn,\n          operator: 'TEMPORAL_RANGE',\n          comparator: state?.common?.conf?.DEFAULT_TIME_FILTER || NO_TIME_RANGE,\n          expressionType: 'SIMPLE',\n        },\n      ];\n    }\n\n    return undefined;\n  },\n};\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * This file exports all controls available for use in chart plugins internal to Superset.\n * It is not recommended to use the controls here for any third-party plugins.\n *\n * While the React components located in `controls/components` represent different\n * types of controls (CheckboxControl, SelectControl, TextControl, ...), the controls here\n * represent instances of control types, that can be reused across visualization types.\n *\n * When controls are reused across viz types, their values are carried over as a user\n * changes the chart types.\n *\n * While the keys defined in the control itself get passed to the controlType as props,\n * here's a list of the keys that are common to all controls, and as a result define the\n * control interface.\n */\nimport { isEmpty } from 'lodash';\nimport {\n  t,\n  getCategoricalSchemeRegistry,\n  getSequentialSchemeRegistry,\n  SequentialScheme,\n  legacyValidateInteger,\n  ComparisonType,\n  isAdhocColumn,\n  isPhysicalColumn,\n  ensureIsArray,\n  isDefined,\n  hasGenericChartAxes,\n  NO_TIME_RANGE,\n} from '@superset-ui/core';\n\nimport {\n  formatSelectOptions,\n  D3_FORMAT_OPTIONS,\n  D3_FORMAT_DOCS,\n  D3_TIME_FORMAT_OPTIONS,\n  D3_TIME_FORMAT_DOCS,\n  DEFAULT_TIME_FORMAT,\n  DEFAULT_NUMBER_FORMAT,\n} from '../utils';\nimport { TIME_FILTER_LABELS } from '../constants';\nimport {\n  SharedControlConfig,\n  Dataset,\n  ColumnMeta,\n  ControlState,\n  ControlPanelState,\n} from '../types';\n\nimport {\n  dndAdhocFilterControl,\n  dndAdhocMetricControl,\n  dndAdhocMetricsControl,\n  dndGranularitySqlaControl,\n  dndSortByControl,\n  dndSecondaryMetricControl,\n  dndSizeControl,\n  dndXControl,\n  dndYControl,\n  dndColumnsControl,\n  dndEntityControl,\n  dndGroupByControl,\n  dndSeriesControl,\n  dndAdhocMetricControl2,\n  dndXAxisControl,\n} from './dndControls';\n\nexport { withDndFallback } from './dndControls';\n\nconst categoricalSchemeRegistry = getCategoricalSchemeRegistry();\nconst sequentialSchemeRegistry = getSequentialSchemeRegistry();\n\nexport const PRIMARY_COLOR = { r: 0, g: 122, b: 135, a: 1 };\n\nconst ROW_LIMIT_OPTIONS = [10, 50, 100, 250, 500, 1000, 5000, 10000, 50000];\nconst SERIES_LIMITS = [5, 10, 25, 50, 100, 500];\n\nconst appContainer = document.getElementById('app');\nconst { user } = JSON.parse(\n  appContainer?.getAttribute('data-bootstrap') || '{}',\n);\n\ntype SelectDefaultOption = {\n  label: string;\n  value: string;\n};\n\nconst datasourceControl: SharedControlConfig<'DatasourceControl'> = {\n  type: 'DatasourceControl',\n  label: t('Datasource'),\n  default: null,\n  description: null,\n  mapStateToProps: ({ datasource, form_data }) => ({\n    datasource,\n    form_data,\n    user,\n  }),\n};\n\nconst viz_type: SharedControlConfig<'VizTypeControl'> = {\n  type: 'VizTypeControl',\n  label: t('Visualization Type'),\n  default: 'table',\n  description: t('The type of visualization to display'),\n};\n\nconst color_picker: SharedControlConfig<'ColorPickerControl'> = {\n  type: 'ColorPickerControl',\n  label: t('Fixed Color'),\n  description: t('Use this to define a static color for all circles'),\n  default: PRIMARY_COLOR,\n  renderTrigger: true,\n};\n\nconst linear_color_scheme: SharedControlConfig<'ColorSchemeControl'> = {\n  type: 'ColorSchemeControl',\n  label: t('Linear Color Scheme'),\n  choices: () =>\n    (sequentialSchemeRegistry.values() as SequentialScheme[]).map(value => [\n      value.id,\n      value.label,\n    ]),\n  default: sequentialSchemeRegistry.getDefaultKey(),\n  clearable: false,\n  description: '',\n  renderTrigger: true,\n  schemes: () => sequentialSchemeRegistry.getMap(),\n  isLinear: true,\n  mapStateToProps: state => ({\n    dashboardId: state?.form_data?.dashboardId,\n  }),\n};\n\nconst granularity: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: TIME_FILTER_LABELS.granularity,\n  default: 'one day',\n  choices: [\n    [null, t('all')],\n    ['PT5S', t('5 seconds')],\n    ['PT30S', t('30 seconds')],\n    ['PT1M', t('1 minute')],\n    ['PT5M', t('5 minutes')],\n    ['PT30M', t('30 minutes')],\n    ['PT1H', t('1 hour')],\n    ['PT6H', t('6 hour')],\n    ['P1D', t('1 day')],\n    ['P7D', t('7 days')],\n    ['P1W', t('week')],\n    ['week_starting_sunday', t('week starting Sunday')],\n    ['week_ending_saturday', t('week ending Saturday')],\n    ['P1M', t('month')],\n    ['P3M', t('quarter')],\n    ['P1Y', t('year')],\n  ],\n  description: t(\n    'The time granularity for the visualization. Note that you ' +\n      'can type and use simple natural language as in `10 seconds`, ' +\n      '`1 day` or `56 weeks`',\n  ),\n};\n\nconst time_grain_sqla: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  label: TIME_FILTER_LABELS.time_grain_sqla,\n  placeholder: t('None'),\n  initialValue: (control: ControlState, state: ControlPanelState) => {\n    if (!isDefined(state)) {\n      // If a chart is in a Dashboard, the ControlPanelState is empty.\n      return control.value;\n    }\n    // If a chart is a new one that isn't saved, metadata is null. In this\n    // case we want to default P1D. If the chart has been saved, we want\n    // to use whichever value was chosen, either nothing or valid a time grain.\n    return state?.metadata || 'time_grain_sqla' in (state?.form_data ?? {})\n      ? state?.form_data?.time_grain_sqla\n      : 'P1D';\n  },\n  description: t(\n    'The time granularity for the visualization. This ' +\n      'applies a date transformation to alter ' +\n      'your time column and defines a new time granularity. ' +\n      'The options here are defined on a per database ' +\n      'engine basis in the Superset source code.',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    choices: (datasource as Dataset)?.time_grain_sqla || [],\n  }),\n  visibility: ({ controls }) => {\n    if (!hasGenericChartAxes) {\n      return true;\n    }\n\n    const xAxis = controls?.x_axis;\n    const xAxisValue = xAxis?.value;\n    if (isAdhocColumn(xAxisValue)) {\n      return true;\n    }\n    if (isPhysicalColumn(xAxisValue)) {\n      return !!(xAxis?.options ?? []).find(\n        (col: ColumnMeta) => col?.column_name === xAxisValue,\n      )?.is_dttm;\n    }\n    return false;\n  },\n};\n\nconst time_range: SharedControlConfig<'DateFilterControl'> = {\n  type: 'DateFilterControl',\n  freeForm: true,\n  label: TIME_FILTER_LABELS.time_range,\n  default: NO_TIME_RANGE, // this value is an empty filter constant so shouldn't translate it.\n  description: t(\n    'The time range for the visualization. All relative times, e.g. \"Last month\", ' +\n      '\"Last 7 days\", \"now\", etc. are evaluated on the server using the server\\'s ' +\n      'local time (sans timezone). All tooltips and placeholder times are expressed ' +\n      'in UTC (sans timezone). The timestamps are then evaluated by the database ' +\n      \"using the engine's local timezone. Note one can explicitly set the timezone \" +\n      'per the ISO 8601 format if specifying either the start and/or end time.',\n  ),\n};\n\nconst row_limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Row limit'),\n  validators: [legacyValidateInteger],\n  default: 10000,\n  choices: formatSelectOptions(ROW_LIMIT_OPTIONS),\n  description: t('Limits the number of rows that get displayed.'),\n};\n\nconst order_desc: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Sort Descending'),\n  default: true,\n  description: t('Whether to sort descending or ascending'),\n  visibility: ({ controls }) =>\n    Boolean(\n      controls?.timeseries_limit_metric.value &&\n        !isEmpty(controls?.timeseries_limit_metric.value),\n    ),\n};\n\nconst limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Series limit'),\n  placeholder: t('None'),\n  validators: [legacyValidateInteger],\n  choices: formatSelectOptions(SERIES_LIMITS),\n  clearable: true,\n  description: t(\n    'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n      'where subqueries are not supported) is applied to limit the number of series that get ' +\n      'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n      'column(s) though does increase the query complexity and cost.',\n  ),\n};\n\nconst series_limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Series limit'),\n  placeholder: t('None'),\n  validators: [legacyValidateInteger],\n  choices: formatSelectOptions(SERIES_LIMITS),\n  description: t(\n    'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n      'where subqueries are not supported) is applied to limit the number of series that get ' +\n      'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n      'column(s) though does increase the query complexity and cost.',\n  ),\n};\n\nconst y_axis_format: SharedControlConfig<'SelectControl', SelectDefaultOption> =\n  {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Y Axis Format'),\n    renderTrigger: true,\n    default: DEFAULT_NUMBER_FORMAT,\n    choices: D3_FORMAT_OPTIONS,\n    description: D3_FORMAT_DOCS,\n    tokenSeparators: ['\\n', '\\t', ';'],\n    filterOption: ({ data: option }, search) =>\n      option.label.includes(search) || option.value.includes(search),\n    mapStateToProps: state => {\n      const isPercentage =\n        state.controls?.comparison_type?.value === ComparisonType.Percentage;\n      return {\n        choices: isPercentage\n          ? D3_FORMAT_OPTIONS.filter(option => option[0].includes('%'))\n          : D3_FORMAT_OPTIONS,\n      };\n    },\n  };\n\nconst x_axis_time_format: SharedControlConfig<\n  'SelectControl',\n  SelectDefaultOption\n> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Time format'),\n  renderTrigger: true,\n  default: DEFAULT_TIME_FORMAT,\n  choices: D3_TIME_FORMAT_OPTIONS,\n  description: D3_TIME_FORMAT_DOCS,\n  filterOption: ({ data: option }, search) =>\n    option.label.includes(search) || option.value.includes(search),\n};\n\nconst color_scheme: SharedControlConfig<'ColorSchemeControl'> = {\n  type: 'ColorSchemeControl',\n  label: t('Color Scheme'),\n  default: categoricalSchemeRegistry.getDefaultKey(),\n  renderTrigger: true,\n  choices: () => categoricalSchemeRegistry.keys().map(s => [s, s]),\n  description: t('The color scheme for rendering chart'),\n  schemes: () => categoricalSchemeRegistry.getMap(),\n  mapStateToProps: state => ({\n    dashboardId: state?.form_data?.dashboardId,\n  }),\n};\n\nconst truncate_metric: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Truncate Metric'),\n  default: true,\n  description: t('Whether to truncate metrics'),\n};\n\nconst show_empty_columns: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Show empty columns'),\n  default: true,\n  description: t('Show empty columns'),\n};\n\nconst temporal_columns_lookup: SharedControlConfig<'HiddenControl'> = {\n  type: 'HiddenControl',\n  initialValue: (control: ControlState, state: ControlPanelState | null) =>\n    Object.fromEntries(\n      ensureIsArray<Record<string, any>>(state?.datasource?.columns)\n        .filter(option => option.is_dttm)\n        .map(option => [option.column_name ?? option.name, option.is_dttm]),\n    ),\n};\n\nexport default {\n  metrics: dndAdhocMetricsControl,\n  metric: dndAdhocMetricControl,\n  datasource: datasourceControl,\n  viz_type,\n  color_picker,\n  metric_2: dndAdhocMetricControl2,\n  linear_color_scheme,\n  secondary_metric: dndSecondaryMetricControl,\n  groupby: dndGroupByControl,\n  columns: dndColumnsControl,\n  granularity,\n  granularity_sqla: dndGranularitySqlaControl,\n  time_grain_sqla,\n  time_range,\n  row_limit,\n  limit,\n  timeseries_limit_metric: dndSortByControl,\n  orderby: dndSortByControl,\n  order_desc,\n  series: dndSeriesControl,\n  entity: dndEntityControl,\n  x: dndXControl,\n  y: dndYControl,\n  size: dndSizeControl,\n  y_axis_format,\n  x_axis_time_format,\n  adhoc_filters: dndAdhocFilterControl,\n  color_scheme,\n  series_columns: dndColumnsControl,\n  series_limit,\n  series_limit_metric: dndSortByControl,\n  legacy_order_by: dndSortByControl,\n  truncate_metric,\n  x_axis: dndXAxisControl,\n  show_empty_columns,\n  temporal_columns_lookup,\n};\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactElement, ReactNode, ReactText } from 'react';\nimport type {\n  AdhocColumn,\n  Column,\n  Currency,\n  DatasourceType,\n  JsonObject,\n  JsonValue,\n  Metric,\n  QueryFormColumn,\n  QueryFormData,\n  QueryFormMetric,\n  QueryResponse,\n} from '@superset-ui/core';\nimport { sharedControls, sharedControlComponents } from './shared-controls';\n\nexport type { Metric } from '@superset-ui/core';\nexport type { ControlFormItemSpec } from './components/ControlForm';\nexport type { ControlComponentProps } from './shared-controls/components/types';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AnyDict = Record<string, any>;\ninterface Action {\n  type: string;\n}\ninterface AnyAction extends Action, AnyDict {}\n\nexport type SharedControls = typeof sharedControls;\nexport type SharedControlAlias = keyof typeof sharedControls;\nexport type SharedControlComponents = typeof sharedControlComponents;\n\n/** ----------------------------------------------\n * Input data/props while rendering\n * ---------------------------------------------*/\nexport interface Owner {\n  first_name: string;\n  id: number;\n  last_name: string;\n  username: string;\n  email?: string;\n}\n\nexport type ColumnMeta = Omit<Column, 'id'> & {\n  id?: number;\n} & AnyDict;\n\nexport interface Dataset {\n  id: number;\n  type: DatasourceType;\n  columns: ColumnMeta[];\n  metrics: Metric[];\n  column_formats: Record<string, string>;\n  currency_formats: Record<string, Currency>;\n  verbose_map: Record<string, string>;\n  main_dttm_col: string;\n  // eg. ['[\"ds\", true]', 'ds [asc]']\n  order_by_choices?: [string, string][] | null;\n  time_grain_sqla?: string;\n  granularity_sqla?: string;\n  datasource_name: string | null;\n  name?: string;\n  description: string | null;\n  uid?: string;\n  owners?: Owner[];\n  filter_select?: boolean;\n  filter_select_enabled?: boolean;\n}\n\nexport interface ControlPanelState {\n  form_data: QueryFormData;\n  datasource: Dataset | QueryResponse | null;\n  controls: ControlStateMapping;\n  common: JsonObject;\n  metadata?: JsonObject | null;\n}\n\n/**\n * The action dispatcher will call Redux `dispatch` internally and return what's\n * returned from `dispatch`, which by default is the original or another action.\n */\nexport interface ActionDispatcher<\n  ARGS extends unknown[],\n  A extends Action = AnyAction,\n> {\n  (...args: ARGS): A;\n}\n\n/**\n * Mapping of action dispatchers\n */\nexport interface ControlPanelActionDispatchers {\n  setDatasource: ActionDispatcher<[Dataset]>;\n}\n\n/**\n * Additional control props obtained from `mapStateToProps`.\n */\nexport type ExtraControlProps = {\n  value?: JsonValue;\n} & AnyDict;\n\n// Ref:superset-frontend/src/explore/store.js\nexport type ControlState<\n  T = ControlType,\n  O extends SelectOption = SelectOption,\n> = ControlConfig<T, O> & ExtraControlProps;\n\nexport interface ControlStateMapping {\n  [key: string]: ControlState;\n}\n\n// Ref: superset-frontend/src/explore/components/ControlPanelsContainer.jsx\nexport interface ControlPanelsContainerProps extends AnyDict {\n  actions: ControlPanelActionDispatchers;\n  controls: ControlStateMapping;\n  exportState: AnyDict;\n  form_data: QueryFormData;\n}\n\n/** ----------------------------------------------\n * Config for a chart Control\n * ---------------------------------------------*/\n\n// Ref: superset-frontend/src/explore/components/controls/index.js\nexport type InternalControlType =\n  | 'AnnotationLayerControl'\n  | 'BoundsControl'\n  | 'CheckboxControl'\n  | 'CollectionControl'\n  | 'ColorPickerControl'\n  | 'ColorSchemeControl'\n  | 'DatasourceControl'\n  | 'DateFilterControl'\n  | 'FixedOrMetricControl'\n  | 'HiddenControl'\n  | 'SelectAsyncControl'\n  | 'SelectControl'\n  | 'SliderControl'\n  | 'SpatialControl'\n  | 'TextAreaControl'\n  | 'TextControl'\n  | 'TimeSeriesColumnControl'\n  | 'ViewportControl'\n  | 'VizTypeControl'\n  | 'MetricsControl'\n  | 'AdhocFilterControl'\n  | 'FilterBoxItemControl'\n  | 'DndColumnSelect'\n  | 'DndFilterSelect'\n  | 'DndMetricSelect'\n  | keyof SharedControlComponents; // expanded in `expandControlConfig`\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type ControlType = InternalControlType | React.ComponentType<any>;\n\nexport type TabOverride = 'data' | 'customize' | boolean;\n\n/**\n * Control config specifying how chart controls appear in the control panel, all\n * these configs will be passed to the UI component for control as props.\n *\n * - type: the control type, referencing a React component of the same name\n * - label: the label as shown in the control's header\n * - description: shown in the info tooltip of the control's header\n * - default: the default value when opening a new chart, or changing visualization type\n * - renderTrigger: a bool that defines whether the visualization should be re-rendered\n *    when changed. This should `true` for controls that only affect the rendering (client side)\n *    and don't affect the query or backend data processing as those require to re run a query\n *    and fetch the data\n * - validators: an array of functions that will receive the value of the component and\n *    should return error messages when the value is not valid. The error message gets\n *    bubbled up to the control header, section header and query panel header.\n * - warning: text shown as a tooltip on a warning icon in the control's header\n * - error: text shown as a tooltip on a error icon in the control's header\n * - shouldMapStateToProps: a function that receives the previous and current app state\n *   and determines if the control needs to recalculate it's props based on the new state.\n * - mapStateToProps: a function that receives the App's state and return an object of k/v\n *    to overwrite configuration at runtime. This is useful to alter a component based on\n *    anything external to it, like another control's value. For instance it's possible to\n *    show a warning based on the value of another component. It's also possible to bind\n *    arbitrary data from the redux store to the component this way.\n * - tabOverride: set to 'data' if you want to force a renderTrigger to show up on the `Data`\n     tab, or 'customize' if you want it to show up on that tam. Otherwise sections with ALL\n     `renderTrigger: true` components will show up on the `Customize` tab.\n * - visibility: a function that uses control panel props to check whether a control should\n *    be visible.\n */\nexport interface BaseControlConfig<\n  T extends ControlType = ControlType,\n  O extends SelectOption = SelectOption,\n  V = JsonValue,\n> extends AnyDict {\n  type: T;\n  label?:\n    | ReactNode\n    | ((\n        state: ControlPanelState,\n        controlState: ControlState,\n        // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n        chartState?: AnyDict,\n      ) => ReactNode);\n  description?:\n    | ReactNode\n    | ((\n        state: ControlPanelState,\n        controlState: ControlState,\n        // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n        chartState?: AnyDict,\n      ) => ReactNode);\n  default?: V;\n  initialValue?: V;\n  renderTrigger?: boolean;\n  validators?: ControlValueValidator<T, O, V>[];\n  warning?: ReactNode;\n  error?: ReactNode;\n  /**\n   * Add additional props to chart control.\n   */\n  shouldMapStateToProps?: (\n    prevState: ControlPanelState,\n    state: ControlPanelState,\n    controlState: ControlState,\n    // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n    chartState?: AnyDict,\n  ) => boolean;\n  mapStateToProps?: (\n    state: ControlPanelState,\n    controlState: ControlState,\n    // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n    chartState?: AnyDict,\n  ) => ExtraControlProps;\n  visibility?: (\n    props: ControlPanelsContainerProps,\n    controlData: AnyDict,\n  ) => boolean;\n}\n\nexport interface ControlValueValidator<\n  T = ControlType,\n  O extends SelectOption = SelectOption,\n  V = unknown,\n> {\n  (value: V, state?: ControlState<T, O>): boolean | string;\n}\n\n/** --------------------------------------------\n * Additional Config for specific control Types\n * --------------------------------------------- */\nexport type SelectOption = AnyDict | string | [ReactText, ReactNode];\n\nexport type SelectControlType =\n  | 'SelectControl'\n  | 'SelectAsyncControl'\n  | 'MetricsControl'\n  | 'FixedOrMetricControl'\n  | 'AdhocFilterControl'\n  | 'FilterBoxItemControl';\n\n// via react-select/src/filters\nexport interface FilterOption<T extends SelectOption> {\n  label: string;\n  value: string;\n  data: T;\n}\n\n// Ref: superset-frontend/src/components/Select/SupersetStyledSelect.tsx\nexport interface SelectControlConfig<\n  O extends SelectOption = SelectOption,\n  T extends SelectControlType = SelectControlType,\n> extends BaseControlConfig<T, O> {\n  clearable?: boolean;\n  freeForm?: boolean;\n  multi?: boolean;\n  valueKey?: string;\n  labelKey?: string;\n  options?: O[];\n  optionRenderer?: (option: O) => ReactNode;\n  valueRenderer?: (option: O) => ReactNode;\n  filterOption?:\n    | ((option: FilterOption<O>, rawInput: string) => Boolean)\n    | null;\n}\n\nexport type SharedControlConfig<\n  T extends InternalControlType = InternalControlType,\n  O extends SelectOption = SelectOption,\n> = T extends SelectControlType\n  ? SelectControlConfig<O, T>\n  : BaseControlConfig<T>;\n\n/** --------------------------------------------\n * Custom controls\n * --------------------------------------------- */\nexport type CustomControlConfig<P = {}> = BaseControlConfig<\n  React.ComponentType<P>\n> &\n  // two run-time properties from superset-frontend/src/explore/components/Control.jsx\n  Omit<P, 'onChange' | 'hovered'>;\n\n// Catch-all ControlConfig\n//  - if T is known control types, return SharedControlConfig,\n//  - if T is object, assume a CustomComponent\n//  - otherwise assume it's a custom component control\nexport type ControlConfig<\n  T = AnyDict,\n  O extends SelectOption = SelectOption,\n> = T extends InternalControlType\n  ? SharedControlConfig<T, O>\n  : T extends object\n  ? CustomControlConfig<T> // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  : CustomControlConfig<any>;\n\n/** ===========================================================\n * Chart plugin control panel config\n * ========================================================= */\nexport type SharedSectionAlias =\n  | 'annotations'\n  | 'colorScheme'\n  | 'datasourceAndVizType'\n  | 'sqlaTimeSeries'\n  | 'NVD3TimeSeries';\n\nexport interface OverrideSharedControlItem<\n  A extends SharedControlAlias = SharedControlAlias,\n> {\n  name: A;\n  override: Partial<SharedControls[A]>;\n}\n\nexport type CustomControlItem = {\n  name: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  config: BaseControlConfig<any, any, any>;\n};\n\n// use ReactElement instead of ReactNode because `string`, `number`, etc. may\n// interfere with other ControlSetItem types\nexport type ExpandedControlItem = CustomControlItem | ReactElement | null;\n\nexport type ControlSetItem =\n  | SharedControlAlias\n  | OverrideSharedControlItem\n  | ExpandedControlItem;\n\nexport type ControlSetRow = ControlSetItem[];\n\n// Ref:\n//  - superset-frontend/src/explore/components/ControlPanelsContainer.jsx\n//  - superset-frontend/src/explore/components/ControlPanelSection.jsx\nexport interface ControlPanelSectionConfig {\n  label?: ReactNode;\n  description?: ReactNode;\n  expanded?: boolean;\n  tabOverride?: TabOverride;\n  controlSetRows: ControlSetRow[];\n}\n\nexport interface StandardizedControls {\n  metrics: QueryFormMetric[];\n  columns: QueryFormColumn[];\n}\n\nexport interface StandardizedFormDataInterface {\n  // Controls not used in the current viz\n  controls: StandardizedControls;\n  // Transformation history\n  memorizedFormData: Map<string, QueryFormData>;\n}\n\nexport type QueryStandardizedFormData = QueryFormData & {\n  standardizedFormData: StandardizedFormDataInterface;\n};\n\nexport const isStandardizedFormData = (\n  formData: QueryFormData,\n): formData is QueryStandardizedFormData =>\n  formData?.standardizedFormData?.controls &&\n  formData?.standardizedFormData?.memorizedFormData &&\n  Array.isArray(formData.standardizedFormData.controls.metrics) &&\n  Array.isArray(formData.standardizedFormData.controls.columns);\n\nexport interface ControlPanelConfig {\n  controlPanelSections: (ControlPanelSectionConfig | null)[];\n  controlOverrides?: ControlOverrides;\n  sectionOverrides?: SectionOverrides;\n  onInit?: (state: ControlStateMapping) => void;\n  formDataOverrides?: (formData: QueryFormData) => QueryFormData;\n}\n\nexport type ControlOverrides = {\n  [P in SharedControlAlias]?: Partial<SharedControls[P]>;\n};\n\nexport type SectionOverrides = {\n  [P in SharedSectionAlias]?: Partial<ControlPanelSectionConfig>;\n};\n\n// Ref:\n//  - superset-frontend/src/explore/components/ConditionalFormattingControl.tsx\nexport enum COMPARATOR {\n  NONE = 'None',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_OR_EQUAL = '',\n  LESS_OR_EQUAL = '',\n  EQUAL = '=',\n  NOT_EQUAL = '',\n  BETWEEN = '< x <',\n  BETWEEN_OR_EQUAL = ' x ',\n  BETWEEN_OR_LEFT_EQUAL = ' x <',\n  BETWEEN_OR_RIGHT_EQUAL = '< x ',\n}\n\nexport const MULTIPLE_VALUE_COMPARATORS = [\n  COMPARATOR.BETWEEN,\n  COMPARATOR.BETWEEN_OR_EQUAL,\n  COMPARATOR.BETWEEN_OR_LEFT_EQUAL,\n  COMPARATOR.BETWEEN_OR_RIGHT_EQUAL,\n];\n\nexport type ConditionalFormattingConfig = {\n  operator?: COMPARATOR;\n  targetValue?: number;\n  targetValueLeft?: number;\n  targetValueRight?: number;\n  column?: string;\n  colorScheme?: string;\n};\n\nexport type ColorFormatters = {\n  column: string;\n  getColorFromValue: (value: number) => string | undefined;\n}[];\n\nexport default {};\n\nexport function isColumnMeta(column: AnyDict): column is ColumnMeta {\n  return !!column && 'column_name' in column;\n}\n\nexport function isSavedExpression(\n  column: AdhocColumn | ColumnMeta,\n): column is ColumnMeta {\n  return (\n    'column_name' in column && 'expression' in column && !!column.expression\n  );\n}\n\nexport function isControlPanelSectionConfig(\n  section: ControlPanelSectionConfig | null,\n): section is ControlPanelSectionConfig {\n  return section !== null;\n}\n\nexport function isDataset(\n  datasource: Dataset | QueryResponse | null | undefined,\n): datasource is Dataset {\n  return !!datasource && 'columns' in datasource;\n}\n\nexport function isQueryResponse(\n  datasource: Dataset | QueryResponse | null | undefined,\n): datasource is QueryResponse {\n  return !!datasource && 'results' in datasource && 'sql' in datasource;\n}\n\nexport enum SortSeriesType {\n  Name = 'name',\n  Max = 'max',\n  Min = 'min',\n  Sum = 'sum',\n  Avg = 'avg',\n}\n\nexport type SortSeriesData = {\n  sort_series_type: SortSeriesType;\n  sort_series_ascending: boolean;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  t,\n  smartDateFormatter,\n  NumberFormats,\n  getNumberFormatter,\n} from '@superset-ui/core';\n\n// D3 specific formatting config\nexport const D3_FORMAT_DOCS = t(\n  'D3 format syntax: https://github.com/d3/d3-format',\n);\n\nexport const D3_NUMBER_FORMAT_DESCRIPTION_VALUES_TEXT = t(\n  'Only applies when \"Label Type\" is set to show values.',\n);\nexport const D3_NUMBER_FORMAT_DESCRIPTION_PERCENTAGE_TEXT = t(\n  'Only applies when \"Label Type\" is not set to a percentage.',\n);\n\nconst d3Formatted: [string, string][] = [\n  ',d',\n  '.1s',\n  '.3s',\n  ',.1%',\n  '.2%',\n  '.3%',\n  '.4r',\n  ',.1f',\n  ',.2f',\n  ',.3f',\n  '+,',\n  '$,.2f',\n].map(fmt => [fmt, `${fmt} (${getNumberFormatter(fmt).preview()})`]);\n\n// input choices & options\nexport const D3_FORMAT_OPTIONS: [string, string][] = [\n  [NumberFormats.SMART_NUMBER, t('Adaptive formatting')],\n  ['~g', t('Original value')],\n  ...d3Formatted,\n  ['DURATION', t('Duration in ms (66000 => 1m 6s)')],\n  ['DURATION_SUB', t('Duration in ms (1.40008 => 1ms 400s 80ns)')],\n];\n\nexport const D3_TIME_FORMAT_DOCS = t(\n  'D3 time format syntax: https://github.com/d3/d3-time-format',\n);\n\nexport const D3_TIME_FORMAT_OPTIONS: [string, string][] = [\n  [smartDateFormatter.id, t('Adaptive formatting')],\n  ['%d/%m/%Y', '%d/%m/%Y | 14/01/2019'],\n  ['%m/%d/%Y', '%m/%d/%Y | 01/14/2019'],\n  ['%Y-%m-%d', '%Y-%m-%d | 2019-01-14'],\n  ['%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10'],\n  ['%d-%m-%Y %H:%M:%S', '%d-%m-%Y %H:%M:%S | 14-01-2019 01:32:10'],\n  ['%H:%M:%S', '%H:%M:%S | 01:32:10'],\n];\n\nexport const DEFAULT_NUMBER_FORMAT = D3_FORMAT_OPTIONS[0][0];\nexport const DEFAULT_TIME_FORMAT = D3_TIME_FORMAT_OPTIONS[0][0];\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { QueryResponse, DEFAULT_METRICS } from '@superset-ui/core';\nimport { Dataset } from '../types';\n\nexport const defineSavedMetrics = (\n  datasource: Dataset | QueryResponse | null,\n) =>\n  datasource?.hasOwnProperty('metrics')\n    ? (datasource as Dataset)?.metrics || []\n    : DEFAULT_METRICS;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactElement } from 'react';\nimport { sharedControls, sharedControlComponents } from '../shared-controls';\nimport {\n  ControlType,\n  ControlSetItem,\n  ExpandedControlItem,\n  ControlOverrides,\n} from '../types';\n\nexport function expandControlType(controlType: ControlType) {\n  if (\n    typeof controlType === 'string' &&\n    controlType in sharedControlComponents\n  ) {\n    return sharedControlComponents[\n      controlType as keyof typeof sharedControlComponents\n    ];\n  }\n  return controlType;\n}\n\n/**\n * Expand a shorthand control config item to full config in the format of\n *   {\n *     name: ...,\n *     config: {\n *        type: ...,\n *        ...\n *     }\n *   }\n */\nexport function expandControlConfig(\n  control: ControlSetItem,\n  controlOverrides: ControlOverrides = {},\n): ExpandedControlItem {\n  // one of the named shared controls\n  if (typeof control === 'string' && control in sharedControls) {\n    const name = control;\n    return {\n      name,\n      config: {\n        ...sharedControls[name],\n        ...controlOverrides[name],\n      },\n    };\n  }\n  // JSX/React element or NULL\n  if (\n    !control ||\n    typeof control === 'string' ||\n    React.isValidElement(control)\n  ) {\n    return control as ReactElement;\n  }\n  // already fully expanded control config, e.g.\n  // {\n  //   name: 'metric',\n  //   config: {\n  //     type: 'SelectControl' | SelectComponent\n  //   }\n  // }\n  if ('name' in control && 'config' in control) {\n    return {\n      ...control,\n      config: {\n        ...control.config,\n        type: expandControlType(control.config.type as ControlType),\n      },\n    };\n  }\n  // apply overrides with shared controls\n  if ('override' in control && control.name in sharedControls) {\n    const { name, override } = control;\n    return {\n      name,\n      config: {\n        ...sharedControls[name],\n        ...override,\n      },\n    };\n  }\n  return null;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { makeSingleton, QueryFormData } from '@superset-ui/core';\nimport { isStandardizedFormData, StandardizedControls } from '../types';\n\nclass StandardizedControlsManager {\n  controls: StandardizedControls;\n\n  constructor() {\n    this.controls = {\n      metrics: [],\n      columns: [],\n    };\n  }\n\n  setStandardizedControls(formData: QueryFormData) {\n    if (isStandardizedFormData(formData)) {\n      const { controls } = formData.standardizedFormData;\n      this.controls = {\n        metrics: controls.metrics,\n        columns: controls.columns,\n      };\n    }\n  }\n\n  shiftMetric() {\n    return this.controls.metrics.shift();\n  }\n\n  shiftColumn() {\n    return this.controls.columns.shift();\n  }\n\n  popAllMetrics() {\n    return this.controls.metrics.splice(0, this.controls.metrics.length);\n  }\n\n  popAllColumns() {\n    return this.controls.columns.splice(0, this.controls.columns.length);\n  }\n\n  clear() {\n    this.controls = {\n      metrics: [],\n      columns: [],\n    };\n  }\n}\n\nexport const getStandardizedControls = makeSingleton(\n  StandardizedControlsManager,\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  isDefined,\n  QueryColumn,\n  ValueOf,\n} from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  ControlPanelState,\n  isDataset,\n  isQueryResponse,\n} from '@superset-ui/chart-controls';\n\nexport function getTemporalColumns(\n  datasource: ValueOf<Pick<ControlPanelState, 'datasource'>>,\n) {\n  const rv: {\n    temporalColumns: ColumnMeta[] | QueryColumn[];\n    defaultTemporalColumn: string | null | undefined;\n  } = {\n    temporalColumns: [],\n    defaultTemporalColumn: undefined,\n  };\n\n  if (isDataset(datasource)) {\n    rv.temporalColumns = ensureIsArray(datasource.columns).filter(\n      c => c.is_dttm,\n    );\n  }\n  if (isQueryResponse(datasource)) {\n    rv.temporalColumns = ensureIsArray(datasource.columns).filter(\n      c => c.is_dttm,\n    );\n  }\n\n  if (isDataset(datasource)) {\n    rv.defaultTemporalColumn = datasource.main_dttm_col;\n  }\n  if (!isDefined(rv.defaultTemporalColumn)) {\n    rv.defaultTemporalColumn =\n      (rv.temporalColumns[0] as ColumnMeta)?.column_name ??\n      (rv.temporalColumns[0] as QueryColumn)?.name;\n  }\n\n  return rv;\n}\n\nexport function isTemporalColumn(\n  columnName: string,\n  datasource: ValueOf<Pick<ControlPanelState, 'datasource'>>,\n): boolean {\n  const columns = getTemporalColumns(datasource).temporalColumns;\n  for (let i = 0; i < columns.length; i += 1) {\n    if (columns[i].column_name === columnName) {\n      return true;\n    }\n  }\n  return false;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// helper functions for select controls\n\nexport type Formattable = string | number;\n\nexport type Formatted = [Formattable, string];\n\n/** Turns an array of string/number options into options for a select input */\nexport function formatSelectOptions<T extends Formattable>(\n  options: (T | [T, string])[],\n): [T, string][] {\n  return options.map(opt => (Array.isArray(opt) ? opt : [opt, opt.toString()]));\n}\n\n/**\n * Outputs array of arrays\n *   >> formatSelectOptionsForRange(1, 5)\n *   >> [[1,'1'], [2,'2'], [3,'3'], [4,'4'], [5,'5']]\n */\nexport function formatSelectOptionsForRange(start: number, end: number) {\n  const options: Formatted[] = [];\n  for (let i = start; i <= end; i += 1) {\n    options.push([i, i.toString()]);\n  }\n  return options;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  Registry,\n  makeSingleton,\n  OverwritePolicy,\n  QueryContext,\n  SetDataMaskHook,\n  JsonObject,\n} from '../..';\n\n// Ideally this would be <T extends QueryFormData>\nexport type BuildQuery<T = any> = (\n  formData: T,\n  options?: {\n    extras?: {\n      cachedChanges?: any;\n    };\n    ownState?: JsonObject;\n    hooks?: {\n      setDataMask: SetDataMaskHook;\n      setCachedChanges: (newChanges: any) => void;\n    };\n  },\n) => QueryContext;\n\nclass ChartBuildQueryRegistry extends Registry<BuildQuery> {\n  constructor() {\n    super({ name: 'ChartBuildQuery', overwritePolicy: OverwritePolicy.WARN });\n  }\n}\n\nconst getInstance = makeSingleton(ChartBuildQueryRegistry);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Registry, makeSingleton } from '../..';\nimport { ChartControlPanel } from '../models/ChartControlPanel';\n\nclass ChartControlPanelRegistry extends Registry<\n  ChartControlPanel,\n  ChartControlPanel\n> {\n  constructor() {\n    super({ name: 'ChartControlPanel' });\n  }\n}\n\nconst getInstance = makeSingleton(ChartControlPanelRegistry);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Registry, makeSingleton, OverwritePolicy } from '../..';\nimport ChartMetadata from '../models/ChartMetadata';\n\nclass ChartMetadataRegistry extends Registry<ChartMetadata, ChartMetadata> {\n  constructor() {\n    super({ name: 'ChartMetadata', overwritePolicy: OverwritePolicy.WARN });\n  }\n}\n\nconst getInstance = makeSingleton(ChartMetadataRegistry);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { BinaryQueryObjectFilterClause, ExtraFormData } from '../../query';\nimport { JsonObject } from '../..';\n\nexport type HandlerFunction = (...args: unknown[]) => void;\n\nexport enum Behavior {\n  INTERACTIVE_CHART = 'INTERACTIVE_CHART',\n  NATIVE_FILTER = 'NATIVE_FILTER',\n\n  /**\n   * Include `DRILL_TO_DETAIL` behavior if plugin handles `contextmenu` event\n   * when dimensions are right-clicked on.\n   */\n  DRILL_TO_DETAIL = 'DRILL_TO_DETAIL',\n  DRILL_BY = 'DRILL_BY',\n}\n\nexport interface ContextMenuFilters {\n  crossFilter?: {\n    dataMask: DataMask;\n    isCurrentValueSelected?: boolean;\n  };\n  drillToDetail?: BinaryQueryObjectFilterClause[];\n  drillBy?: {\n    filters: BinaryQueryObjectFilterClause[];\n    groupbyFieldName: string;\n    adhocFilterFieldName?: string;\n  };\n}\n\nexport enum AppSection {\n  EXPLORE = 'EXPLORE',\n  DASHBOARD = 'DASHBOARD',\n  FILTER_BAR = 'FILTER_BAR',\n  FILTER_CONFIG_MODAL = 'FILTER_CONFIG_MODAL',\n  EMBEDDED = 'EMBEDDED',\n}\n\nexport type FilterState = { value?: any; [key: string]: any };\n\nexport type DataMask = {\n  extraFormData?: ExtraFormData;\n  filterState?: FilterState;\n  ownState?: JsonObject;\n};\n\nexport type SetDataMaskHook = {\n  ({ filterState, extraFormData, ownState }: DataMask): void;\n};\n\nexport interface PlainObject {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n}\n\nexport enum ChartLabel {\n  DEPRECATED = 'DEPRECATED',\n  FEATURED = 'FEATURED',\n}\n\nexport const chartLabelExplanations: Record<ChartLabel, string> = {\n  [ChartLabel.DEPRECATED]:\n    'This chart uses features or modules which are no longer actively maintained. It will eventually be replaced or removed.',\n  [ChartLabel.FEATURED]:\n    'This chart was tested and verified, so the overall experience should be stable.',\n};\n\nexport const chartLabelWeight: Record<ChartLabel, { weight: number }> = {\n  [ChartLabel.DEPRECATED]: {\n    weight: -0.1,\n  },\n  [ChartLabel.FEATURED]: {\n    weight: 0.1,\n  },\n};\n\nexport enum AxisType {\n  category = 'category',\n  value = 'value',\n  time = 'time',\n  log = 'log',\n}\n\nexport interface LegendState {\n  [key: string]: boolean;\n}\n\nexport default {};\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport CategoricalColorScale from './CategoricalColorScale';\nimport { ColorsLookup } from './types';\nimport getCategoricalSchemeRegistry from './CategoricalSchemeRegistrySingleton';\nimport stringifyAndTrim from './stringifyAndTrim';\n\nexport default class CategoricalColorNamespace {\n  name: string;\n\n  forcedItems: ColorsLookup;\n\n  scales: {\n    [key: string]: CategoricalColorScale;\n  };\n\n  constructor(name: string) {\n    this.name = name;\n    this.scales = {};\n    this.forcedItems = {};\n  }\n\n  getScale(schemeId?: string) {\n    const id = schemeId ?? getCategoricalSchemeRegistry().getDefaultKey() ?? '';\n    const scheme = getCategoricalSchemeRegistry().get(id);\n    return new CategoricalColorScale(scheme?.colors ?? [], this.forcedItems);\n  }\n\n  /**\n   * Enforce specific color for given value\n   * This will apply across all color scales\n   * in this namespace.\n   * @param {*} value value\n   * @param {*} forcedColor color\n   */\n  setColor(value: string, forcedColor: string) {\n    this.forcedItems[stringifyAndTrim(value)] = forcedColor;\n\n    return this;\n  }\n\n  resetColors() {\n    this.forcedItems = {};\n  }\n}\n\nconst namespaces: {\n  [key: string]: CategoricalColorNamespace;\n} = {};\n\nexport const DEFAULT_NAMESPACE = 'GLOBAL';\n\nexport function getNamespace(name: string = DEFAULT_NAMESPACE) {\n  const instance = namespaces[name];\n  if (instance) {\n    return instance;\n  }\n  const newInstance = new CategoricalColorNamespace(name);\n  namespaces[name] = newInstance;\n\n  return newInstance;\n}\n\nexport function getColor(\n  value?: string,\n  schemeId?: string,\n  namespace?: string,\n) {\n  return getNamespace(namespace).getScale(schemeId).getColor(value);\n}\n\n/*\n  Returns a new scale instance within the same namespace.\n  Especially useful when a chart is booting for the first time\n*/\nexport function getScale(scheme?: string, namespace?: string) {\n  return getNamespace(namespace).getScale(scheme);\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-dupe-class-members */\nimport { scaleOrdinal, ScaleOrdinal } from 'd3-scale';\nimport { ExtensibleFunction } from '../models';\nimport { ColorsInitLookup, ColorsLookup } from './types';\nimport stringifyAndTrim from './stringifyAndTrim';\nimport getSharedLabelColor from './SharedLabelColorSingleton';\nimport { getAnalogousColors } from './utils';\nimport { FeatureFlag, isFeatureEnabled } from '../utils';\n\n// Use type augmentation to correct the fact that\n// an instance of CategoricalScale is also a function\ninterface CategoricalColorScale {\n  (x: { toString(): string }, y?: number): string;\n}\n\nclass CategoricalColorScale extends ExtensibleFunction {\n  originColors: string[];\n\n  colors: string[];\n\n  scale: ScaleOrdinal<{ toString(): string }, string>;\n\n  parentForcedColors: ColorsLookup;\n\n  forcedColors: ColorsLookup;\n\n  multiple: number;\n\n  /**\n   * Constructor\n   * @param {*} colors an array of colors\n   * @param {*} parentForcedColors optional parameter that comes from parent\n   * (usually CategoricalColorNamespace) and supersede this.forcedColors\n   */\n  constructor(colors: string[], parentForcedColors: ColorsInitLookup = {}) {\n    super((value: string, sliceId?: number) => this.getColor(value, sliceId));\n\n    this.originColors = colors;\n    this.colors = colors;\n    this.scale = scaleOrdinal<{ toString(): string }, string>();\n    this.scale.range(colors);\n\n    // reserve fixed colors in parent map based on their index in the scale\n    Object.entries(parentForcedColors).forEach(([key, value]) => {\n      if (typeof value === 'number') {\n        // eslint-disable-next-line no-param-reassign\n        parentForcedColors[key] = colors[value % colors.length];\n      }\n    });\n\n    // all indexes have been replaced by a fixed color\n    this.parentForcedColors = parentForcedColors as ColorsLookup;\n    this.forcedColors = {};\n    this.multiple = 0;\n  }\n\n  removeSharedLabelColorFromRange(\n    sharedColorMap: Map<string, string>,\n    cleanedValue: string,\n  ) {\n    // make sure we don't overwrite the origin colors\n    const updatedRange = [...this.originColors];\n    // remove the color option from shared color\n    sharedColorMap.forEach((value: string, key: string) => {\n      if (key !== cleanedValue) {\n        const index = updatedRange.indexOf(value);\n        updatedRange.splice(index, 1);\n      }\n    });\n    this.range(updatedRange.length > 0 ? updatedRange : this.originColors);\n  }\n\n  getColor(value?: string, sliceId?: number) {\n    const cleanedValue = stringifyAndTrim(value);\n    const sharedLabelColor = getSharedLabelColor();\n    const sharedColorMap = sharedLabelColor.getColorMap();\n    const sharedColor = sharedColorMap.get(cleanedValue);\n\n    // priority: parentForcedColors > forcedColors > labelColors\n    let color =\n      this.parentForcedColors?.[cleanedValue] ||\n      this.forcedColors?.[cleanedValue] ||\n      sharedColor;\n\n    if (isFeatureEnabled(FeatureFlag.USE_ANALAGOUS_COLORS)) {\n      const multiple = Math.floor(\n        this.domain().length / this.originColors.length,\n      );\n      if (multiple > this.multiple) {\n        this.multiple = multiple;\n        const newRange = getAnalogousColors(this.originColors, multiple);\n        this.range(this.originColors.concat(newRange));\n      }\n    }\n    const newColor = this.scale(cleanedValue);\n    if (!color) {\n      color = newColor;\n      if (isFeatureEnabled(FeatureFlag.AVOID_COLORS_COLLISION)) {\n        this.removeSharedLabelColorFromRange(sharedColorMap, cleanedValue);\n        color = this.scale(cleanedValue);\n      }\n    }\n\n    sharedLabelColor.addSlice(cleanedValue, color, sliceId);\n\n    return color;\n  }\n\n  /**\n   * Enforce specific color for given value\n   * @param {*} value value\n   * @param {*} forcedColor forcedColor\n   */\n  setColor(value: string, forcedColor: string) {\n    this.forcedColors[stringifyAndTrim(value)] = forcedColor;\n    return this;\n  }\n\n  /**\n   * Get a mapping of data values to colors\n   * @returns an object where the key is the data value and the value is the hex color code\n   */\n  getColorMap() {\n    const colorMap: { [key: string]: string | undefined } = {};\n    this.scale.domain().forEach(value => {\n      colorMap[value.toString()] = this.scale(value);\n    });\n\n    return {\n      ...colorMap,\n      ...this.forcedColors,\n      ...this.parentForcedColors,\n    };\n  }\n\n  /**\n   * Returns an exact copy of this scale. Changes to this scale will not affect the returned scale, and vice versa.\n   */\n  copy() {\n    const copy = new CategoricalColorScale(\n      this.scale.range(),\n      this.parentForcedColors,\n    );\n    copy.forcedColors = { ...this.forcedColors };\n    copy.domain(this.domain());\n    copy.unknown(this.unknown());\n\n    return copy;\n  }\n\n  /**\n   * Returns the scale's current domain.\n   */\n  domain(): { toString(): string }[];\n\n  /**\n   * Expands the domain to include the specified array of values.\n   */\n  domain(newDomain: { toString(): string }[]): this;\n\n  domain(newDomain?: { toString(): string }[]): unknown {\n    if (typeof newDomain === 'undefined') {\n      return this.scale.domain();\n    }\n\n    this.scale.domain(newDomain);\n    return this;\n  }\n\n  /**\n   * Returns the scale's current range.\n   */\n  range(): string[];\n\n  /**\n   * Sets the range of the ordinal scale to the specified array of values.\n   *\n   * The first element in the domain will be mapped to the first element in range, the second domain value to the second range value, and so on.\n   *\n   * If there are fewer elements in the range than in the domain, the scale will reuse values from the start of the range.\n   *\n   * @param newRange Array of range values.\n   */\n  range(newRange: string[]): this;\n\n  range(newRange?: string[]): unknown {\n    if (typeof newRange === 'undefined') {\n      return this.scale.range();\n    }\n\n    this.colors = newRange;\n    this.scale.range(newRange);\n    return this;\n  }\n\n  /**\n   * Returns the current unknown value, which defaults to \"implicit\".\n   */\n  unknown(): string | { name: 'implicit' };\n\n  /**\n   * Sets the output value of the scale for unknown input values and returns this scale.\n   * The implicit value enables implicit domain construction. scaleImplicit can be used as a convenience to set the implicit value.\n   *\n   * @param value Unknown value to be used or scaleImplicit to set implicit scale generation.\n   */\n  unknown(value: string | { name: 'implicit' }): this;\n\n  unknown(value?: string | { name: 'implicit' }): unknown {\n    if (typeof value === 'undefined') {\n      return this.scale.unknown();\n    }\n\n    this.scale.unknown(value);\n    return this;\n  }\n}\n\nexport default CategoricalColorScale;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { CategoricalColorNamespace } from '.';\nimport { makeSingleton } from '../utils';\n\nexport enum SharedLabelColorSource {\n  dashboard,\n  explore,\n}\nexport class SharedLabelColor {\n  sliceLabelMap: Map<number, string[]>;\n\n  colorMap: Map<string, string>;\n\n  source: SharedLabelColorSource;\n\n  constructor() {\n    // { sliceId1: [label1, label2, ...], sliceId2: [label1, label2, ...] }\n    this.sliceLabelMap = new Map();\n    this.colorMap = new Map();\n    this.source = SharedLabelColorSource.dashboard;\n  }\n\n  updateColorMap(colorNamespace?: string, colorScheme?: string) {\n    const categoricalNamespace =\n      CategoricalColorNamespace.getNamespace(colorNamespace);\n    const newColorMap = new Map();\n    this.colorMap.clear();\n    this.sliceLabelMap.forEach(labels => {\n      const colorScale = categoricalNamespace.getScale(colorScheme);\n      labels.forEach(label => {\n        const newColor = colorScale(label);\n        newColorMap.set(label, newColor);\n      });\n    });\n    this.colorMap = newColorMap;\n  }\n\n  getColorMap() {\n    return this.colorMap;\n  }\n\n  addSlice(label: string, color: string, sliceId?: number) {\n    if (\n      this.source !== SharedLabelColorSource.dashboard ||\n      sliceId === undefined\n    )\n      return;\n    const labels = this.sliceLabelMap.get(sliceId) || [];\n    if (!labels.includes(label)) {\n      labels.push(label);\n      this.sliceLabelMap.set(sliceId, labels);\n    }\n    this.colorMap.set(label, color);\n  }\n\n  removeSlice(sliceId: number) {\n    if (this.source !== SharedLabelColorSource.dashboard) return;\n    this.sliceLabelMap.delete(sliceId);\n    const newColorMap = new Map();\n    this.sliceLabelMap.forEach(labels => {\n      labels.forEach(label => {\n        newColorMap.set(label, this.colorMap.get(label));\n      });\n    });\n    this.colorMap = newColorMap;\n  }\n\n  reset() {\n    const copyColorMap = new Map(this.colorMap);\n    copyColorMap.forEach((_, label) => {\n      this.colorMap.set(label, '');\n    });\n  }\n\n  clear() {\n    this.sliceLabelMap.clear();\n    this.colorMap.clear();\n  }\n}\n\nconst getInstance = makeSingleton(SharedLabelColor);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Ensure value is a string\n * @param {any} value\n */\nexport default function stringifyAndTrim(value?: number | string) {\n  return String(value).trim();\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport tinycolor from 'tinycolor2';\n\nconst rgbRegex = /^rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/;\nexport function getContrastingColor(color: string, thresholds = 186) {\n  let r = 0;\n  let g = 0;\n  let b = 0;\n  if (color.length > 7) {\n    // rgb\n    const matchColor = rgbRegex.exec(color);\n    if (!matchColor) {\n      throw new Error(`Invalid color: ${color}`);\n    }\n    r = parseInt(matchColor[1], 10);\n    g = parseInt(matchColor[2], 10);\n    b = parseInt(matchColor[3], 10);\n  } else {\n    // hex\n    let hex = color;\n    if (hex.startsWith('#')) {\n      hex = hex.substring(1);\n    }\n    // #FFF\n    if (hex.length === 3) {\n      hex = [hex[0], hex[0], hex[1], hex[1], hex[2], hex[2]].join('');\n    }\n    if (hex.length !== 6) {\n      throw new Error(`Invalid color: ${color}`);\n    }\n    r = parseInt(hex.slice(0, 2), 16);\n    g = parseInt(hex.slice(2, 4), 16);\n    b = parseInt(hex.slice(4, 6), 16);\n  }\n\n  return r * 0.299 + g * 0.587 + b * 0.114 > thresholds ? '#000' : '#FFF';\n}\n\nexport function getAnalogousColors(colors: string[], results: number) {\n  const generatedColors: string[] = [];\n  // This is to solve the problem that the first three values generated by tinycolor.analogous\n  // may have the same or very close colors.\n  const ext = 3;\n  const analogousColors = colors.map(color => {\n    const result = tinycolor(color).analogous(results + ext);\n    return result.slice(ext);\n  });\n\n  // [[A, AA, AAA], [B, BB, BBB]] => [A, B, AA, BB, AAA, BBB]\n  while (analogousColors[analogousColors.length - 1]?.length) {\n    analogousColors.forEach(colors => {\n      const color = colors.shift() as tinycolor.Instance;\n      generatedColors.push(color.toHexString());\n    });\n  }\n\n  return generatedColors;\n}\n\nexport function addAlpha(color: string, opacity: number): string {\n  // opacity value should be between 0 and 1.\n  if (opacity > 1 || opacity < 0) {\n    throw new Error(`The opacity should between 0 and 1, but got: ${opacity}`);\n  }\n  // the alpha value is between 00 - FF\n  const alpha = `0${Math.round(opacity * 255)\n    .toString(16)\n    .toUpperCase()}`.slice(-2);\n\n  return `${color}${alpha}`;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport rehypeSanitize, { defaultSchema } from 'rehype-sanitize';\nimport rehypeRaw from 'rehype-raw';\nimport remarkGfm from 'remark-gfm';\nimport { mergeWith, isArray } from 'lodash';\nimport { FeatureFlag, isFeatureEnabled } from '../utils';\n\ninterface SafeMarkdownProps {\n  source: string;\n  htmlSanitization?: boolean;\n  htmlSchemaOverrides?: typeof defaultSchema;\n}\n\nexport function getOverrideHtmlSchema(\n  originalSchema: typeof defaultSchema,\n  htmlSchemaOverrides: SafeMarkdownProps['htmlSchemaOverrides'],\n) {\n  return mergeWith(originalSchema, htmlSchemaOverrides, (objValue, srcValue) =>\n    isArray(objValue) ? objValue.concat(srcValue) : undefined,\n  );\n}\n\nfunction SafeMarkdown({\n  source,\n  htmlSanitization = true,\n  htmlSchemaOverrides = {},\n}: SafeMarkdownProps) {\n  const escapeHtml = isFeatureEnabled(FeatureFlag.ESCAPE_MARKDOWN_HTML);\n\n  const rehypePlugins = useMemo(() => {\n    const rehypePlugins: any = [];\n    if (!escapeHtml) {\n      rehypePlugins.push(rehypeRaw);\n      if (htmlSanitization) {\n        const schema = getOverrideHtmlSchema(\n          defaultSchema,\n          htmlSchemaOverrides,\n        );\n        rehypePlugins.push([rehypeSanitize, schema]);\n      }\n    }\n    return rehypePlugins;\n  }, [escapeHtml, htmlSanitization, htmlSchemaOverrides]);\n\n  // React Markdown escapes HTML by default\n  return (\n    <ReactMarkdown\n      rehypePlugins={rehypePlugins}\n      remarkPlugins={[remarkGfm]}\n      skipHtml={false}\n    >\n      {source}\n    </ReactMarkdown>\n  );\n}\n\nexport default SafeMarkdown;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Faster debounce delay for inputs without expensive operation.\n */\nexport const FAST_DEBOUNCE = 250;\n\n/**\n * Slower debounce delay for inputs with expensive API calls.\n */\nexport const SLOW_DEBOUNCE = 500;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/** The type of an imported module. Don't fully understand this, yet. */\nexport type Module = any;\n\n/**\n * This is where packages are stored. We use window, because it plays well with Webpack.\n * To avoid\n * Have to amend the type of window, because window's usual type doesn't describe these fields.\n */\ninterface ModuleReferencer {\n  [packageKey: string]: Promise<Module>;\n}\n\ndeclare const window: Window & typeof globalThis & ModuleReferencer;\n\nconst modulePromises: { [key: string]: Promise<Module> } = {};\n\nconst withNamespace = (name: string) => `__superset__/${name}`;\n\n/**\n * Dependency management using global variables, because for the life of me\n * I can't figure out how to hook into UMD from a dynamically imported package.\n *\n * This defines a dynamically imported js module that can be used to import from\n * multiple different plugins.\n *\n * When importing a common module (such as react or lodash or superset-ui)\n * from a plugin, the plugin's build config will be able to\n * reference these globals instead of rebuilding them.\n *\n * @param name the module's name (should match name in package.json)\n * @param promise the promise resulting from a call to `import(name)`\n */\nexport async function defineSharedModule(\n  name: string,\n  fetchModule: () => Promise<Module>,\n) {\n  // this field on window is used by dynamic plugins to reference the module\n  const moduleKey = withNamespace(name);\n\n  if (!window[moduleKey] && !modulePromises[name]) {\n    // if the module has not been loaded, load it\n    const modulePromise = fetchModule();\n    modulePromises[name] = modulePromise;\n    // wait for the module to load, and attach the result to window\n    // so that it can be referenced by plugins\n    window[moduleKey] = await modulePromise;\n  }\n\n  // we always return a reference to the promise.\n  // Multiple consumers can `.then()` or `await` the same promise,\n  // even long after it has completed,\n  // and it will always call back with the same reference.\n  return modulePromises[name];\n}\n\n/**\n * Define multiple shared modules at once, using a map of name -> `import(name)`\n *\n * @see defineSharedModule\n * @param moduleMap\n */\nexport async function defineSharedModules(moduleMap: {\n  [key: string]: () => Promise<Module>;\n}) {\n  return Promise.all(\n    Object.entries(moduleMap).map(([name, fetchModule]) =>\n      defineSharedModule(name, fetchModule),\n    ),\n  );\n}\n\n// only exposed for tests\nexport function reset() {\n  Object.keys(modulePromises).forEach(key => {\n    delete window[withNamespace(key)];\n    delete modulePromises[key];\n  });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useEffect, useRef } from 'react';\n\n/**\n * Pass in a piece of state.\n * This hook returns what the value of that state was in the previous render.\n * Returns undefined (or whatever value you specify) the first time.\n */\nexport function usePrevious<T>(value: T): T | undefined;\nexport function usePrevious<T, INIT>(value: T, initialValue: INIT): T | INIT;\nexport function usePrevious<T>(value: T, initialValue?: any): T {\n  const previous = useRef<T>(initialValue);\n  useEffect(() => {\n    // useEffect runs after the render completes\n    previous.current = value;\n  }, [value]);\n  return previous.current;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * A Registry which serves as a typed key:value store for Superset and for Plugins.\n *\n * Differences from the older Registry class:\n *\n * 1. The keys and values stored in this class are individually typed by TYPEMAP parameter.\n *    In the old Registry, all values are of the same type and keys are not enumerated.\n *    Though you can also use indexed or mapped types in a TYPEMAP.\n *\n * 2. This class does not have a separate async get and set methods or use loaders.\n *    Instead, TYPEMAP should specify async values and loaders explicitly when needed.\n *    The value can be anything! A string, a class, a function, an async function... anything!\n *\n * 3. This class does not implement Policies, that is a separate concern to be handled elsewhere.\n *\n *\n * Removing or altering types in a type map could be a potential breaking change, be careful!\n *\n * Listener methods have not been added because there isn't a use case yet.\n */\nclass TypedRegistry<TYPEMAP extends {}> {\n  name = 'TypedRegistry';\n\n  private records: TYPEMAP;\n\n  constructor(initialRecords: TYPEMAP) {\n    this.records = initialRecords;\n  }\n\n  get<K extends keyof TYPEMAP>(key: K): TYPEMAP[K] {\n    // The type construction above means that when you call this function,\n    // you get a really specific type back.\n    return this.records[key];\n  }\n\n  set<K extends keyof TYPEMAP>(key: K, value: TYPEMAP[K]) {\n    this.records[key] = value;\n  }\n}\n\nexport default TypedRegistry;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { DatasourceType } from './types/Datasource';\n\nexport default class DatasourceKey {\n  readonly id: number;\n\n  readonly type: DatasourceType;\n\n  constructor(key: string) {\n    const [idStr, typeStr] = key.split('__');\n    this.id = parseInt(idStr, 10);\n    this.type = DatasourceType.Table; // default to SqlaTable model\n    this.type = typeStr === 'query' ? DatasourceType.Query : this.type;\n  }\n\n  public toString() {\n    return `${this.id}__${this.type}`;\n  }\n\n  public toObject() {\n    return {\n      id: this.id,\n      type: this.type,\n    };\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport buildQueryObject from './buildQueryObject';\nimport DatasourceKey from './DatasourceKey';\nimport { QueryFieldAliases, QueryFormData } from './types/QueryFormData';\nimport { QueryContext, QueryObject } from './types/Query';\nimport { SetDataMaskHook } from '../chart';\nimport { JsonObject } from '../connection';\nimport { normalizeTimeColumn } from './normalizeTimeColumn';\nimport { isXAxisSet } from './getXAxis';\n\nconst WRAP_IN_ARRAY = (baseQueryObject: QueryObject) => [baseQueryObject];\n\nexport type BuildFinalQueryObjects = (\n  baseQueryObject: QueryObject,\n) => QueryObject[];\n\nexport default function buildQueryContext(\n  formData: QueryFormData,\n  options?:\n    | {\n        buildQuery?: BuildFinalQueryObjects;\n        queryFields?: QueryFieldAliases;\n        ownState?: JsonObject;\n        hooks?: { setDataMask: SetDataMaskHook };\n      }\n    | BuildFinalQueryObjects,\n): QueryContext {\n  const { queryFields, buildQuery = WRAP_IN_ARRAY } =\n    typeof options === 'function'\n      ? { buildQuery: options, queryFields: {} }\n      : options || {};\n  let queries = buildQuery(buildQueryObject(formData, queryFields));\n  // --- query mutator begin ---\n  // todo(Yongjie): move the query mutator into buildQueryObject instead of buildQueryContext\n  queries.forEach(query => {\n    if (Array.isArray(query.post_processing)) {\n      // eslint-disable-next-line no-param-reassign\n      query.post_processing = query.post_processing.filter(Boolean);\n    }\n  });\n  if (isXAxisSet(formData)) {\n    queries = queries.map(query => normalizeTimeColumn(formData, query));\n  }\n  // --- query mutator end ---\n  return {\n    datasource: new DatasourceKey(formData.datasource).toObject(),\n    force: formData.force || false,\n    queries,\n    form_data: formData,\n    result_format: formData.result_format || 'json',\n    result_type: formData.result_type || 'full',\n  };\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable camelcase */\nimport { QueryFormData } from './types/QueryFormData';\nimport { QueryObjectFilterClause } from './types/Query';\nimport { isSimpleAdhocFilter } from './types/Filter';\nimport convertFilter from './convertFilter';\n\nfunction sanitizeClause(clause: string): string {\n  let sanitizedClause = clause;\n  if (clause.includes('--')) {\n    sanitizedClause = `${clause}\\n`;\n  }\n  return `(${sanitizedClause})`;\n}\n\n/** Logic formerly in viz.py's process_query_filters */\nexport default function processFilters(\n  formData: Partial<QueryFormData>,\n): Partial<QueryFormData> {\n  // Split adhoc_filters into four fields according to\n  // (1) clause (WHERE or HAVING)\n  // (2) expressionType\n  //     2.1 SIMPLE (subject + operator + comparator)\n  //     2.2 SQL (freeform SQL expression))\n  const { adhoc_filters, extras = {}, filters = [], where } = formData;\n  const simpleWhere: QueryObjectFilterClause[] = filters;\n\n  const freeformWhere: string[] = [];\n  if (where) freeformWhere.push(where);\n  const freeformHaving: string[] = [];\n\n  (adhoc_filters || []).forEach(filter => {\n    const { clause } = filter;\n    if (isSimpleAdhocFilter(filter)) {\n      const filterClause = convertFilter(filter);\n      if (clause === 'WHERE') {\n        simpleWhere.push(filterClause);\n      }\n    } else {\n      const { sqlExpression } = filter;\n      if (clause === 'WHERE') {\n        freeformWhere.push(sqlExpression);\n      } else {\n        freeformHaving.push(sqlExpression);\n      }\n    }\n  });\n\n  // some filter-related fields need to go in `extras`\n  extras.having = freeformHaving.map(sanitizeClause).join(' AND ');\n  extras.where = freeformWhere.map(sanitizeClause).join(' AND ');\n\n  return {\n    filters: simpleWhere,\n    extras,\n  };\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable camelcase */\nimport {\n  AdhocFilter,\n  QueryObject,\n  QueryObjectFilterClause,\n  isQueryFormMetric,\n} from './types';\nimport {\n  QueryFieldAliases,\n  QueryFormMetric,\n  QueryFormData,\n} from './types/QueryFormData';\nimport processFilters from './processFilters';\nimport extractExtras from './extractExtras';\nimport extractQueryFields from './extractQueryFields';\nimport { overrideExtraFormData } from './processExtraFormData';\nimport { isDefined } from '../utils';\n\n/**\n * Build the common segments of all query objects (e.g. the granularity field derived from\n * SQLAlchemy). The segments specific to each viz type is constructed in the\n * buildQuery method for each viz type (see `wordcloud/buildQuery.ts` for an example).\n * Note the type of the formData argument passed in here is the type of the formData for a\n * specific viz, which is a subtype of the generic formData shared among all viz types.\n */\nexport default function buildQueryObject<T extends QueryFormData>(\n  formData: T,\n  queryFields?: QueryFieldAliases,\n): QueryObject {\n  const {\n    annotation_layers = [],\n    extra_form_data,\n    time_range,\n    since,\n    until,\n    row_limit,\n    row_offset,\n    order_desc,\n    limit,\n    timeseries_limit_metric,\n    granularity,\n    url_params = {},\n    custom_params = {},\n    series_columns,\n    series_limit,\n    series_limit_metric,\n    ...residualFormData\n  } = formData;\n  const {\n    adhoc_filters: appendAdhocFilters = [],\n    filters: appendFilters = [],\n    custom_form_data = {},\n    ...overrides\n  } = extra_form_data || {};\n\n  const numericRowLimit = Number(row_limit);\n  const numericRowOffset = Number(row_offset);\n  const { metrics, columns, orderby } = extractQueryFields(\n    residualFormData,\n    queryFields,\n  );\n\n  // collect all filters for conversion to simple filters/freeform clauses\n  const extras = extractExtras(formData);\n  const { filters: extraFilters } = extras;\n  const filterFormData: {\n    filters: QueryObjectFilterClause[];\n    adhoc_filters: AdhocFilter[];\n  } = {\n    filters: [...extraFilters, ...appendFilters],\n    adhoc_filters: [...(formData.adhoc_filters || []), ...appendAdhocFilters],\n  };\n  const extrasAndfilters = processFilters({\n    ...formData,\n    ...extras,\n    ...filterFormData,\n  });\n  const normalizeSeriesLimitMetric = (metric: QueryFormMetric | undefined) => {\n    if (isQueryFormMetric(metric)) {\n      return metric;\n    }\n    return undefined;\n  };\n\n  let queryObject: QueryObject = {\n    // fallback `null` to `undefined` so they won't be sent to the backend\n    // (JSON.stringify will ignore `undefined`.)\n    time_range: time_range || undefined,\n    since: since || undefined,\n    until: until || undefined,\n    granularity: granularity || undefined,\n    ...extras,\n    ...extrasAndfilters,\n    columns,\n    metrics,\n    orderby,\n    annotation_layers,\n    row_limit:\n      row_limit == null || Number.isNaN(numericRowLimit)\n        ? undefined\n        : numericRowLimit,\n    row_offset:\n      row_offset == null || Number.isNaN(numericRowOffset)\n        ? undefined\n        : numericRowOffset,\n    series_columns,\n    series_limit: series_limit ?? (isDefined(limit) ? Number(limit) : 0),\n    series_limit_metric:\n      normalizeSeriesLimitMetric(series_limit_metric) ??\n      timeseries_limit_metric ??\n      undefined,\n    order_desc: typeof order_desc === 'undefined' ? true : order_desc,\n    url_params: url_params || undefined,\n    custom_params,\n  };\n\n  // override extra form data used by native and cross filters\n  queryObject = overrideExtraFormData(queryObject, overrides);\n\n  return { ...queryObject, custom_form_data };\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable camelcase */\nimport { TimeGranularity, QueryFormData } from '@superset-ui/core';\nimport {\n  AppliedTimeExtras,\n  QueryObjectExtras,\n  QueryObjectFilterClause,\n  TimeColumnConfigKey,\n} from './types';\n\ntype ExtraFilterQueryField = {\n  time_range?: string;\n  granularity_sqla?: string;\n  time_grain_sqla?: TimeGranularity;\n  granularity?: string;\n};\n\ntype ExtractedExtra = ExtraFilterQueryField & {\n  filters: QueryObjectFilterClause[];\n  extras: QueryObjectExtras;\n  applied_time_extras: AppliedTimeExtras;\n};\n\nexport default function extractExtras(formData: QueryFormData): ExtractedExtra {\n  const applied_time_extras: AppliedTimeExtras = {};\n  const filters: QueryObjectFilterClause[] = [];\n  const extras: QueryObjectExtras = {};\n  const extract: ExtractedExtra = {\n    filters,\n    extras,\n    applied_time_extras,\n  };\n\n  const reservedColumnsToQueryField: Record<\n    TimeColumnConfigKey,\n    keyof ExtraFilterQueryField\n  > = {\n    __time_range: 'time_range',\n    __time_col: 'granularity_sqla',\n    __time_grain: 'time_grain_sqla',\n    __granularity: 'granularity',\n  };\n\n  (formData.extra_filters || []).forEach(filter => {\n    if (filter.col in reservedColumnsToQueryField) {\n      const key = filter.col as TimeColumnConfigKey;\n      const queryField = reservedColumnsToQueryField[key];\n      extract[queryField] = filter.val as TimeGranularity;\n      applied_time_extras[key] = filter.val as string;\n    } else {\n      filters.push(filter);\n    }\n  });\n\n  // SQL\n  extras.time_grain_sqla = extract.time_grain_sqla || formData.time_grain_sqla;\n  extract.granularity =\n    extract.granularity_sqla ||\n    formData.granularity ||\n    formData.granularity_sqla;\n  delete extract.granularity_sqla;\n  delete extract.time_grain_sqla;\n\n  return extract;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ExtraFormDataOverride, QueryObject } from './types';\nimport {\n  EXTRA_FORM_DATA_OVERRIDE_EXTRA_KEYS,\n  EXTRA_FORM_DATA_OVERRIDE_REGULAR_MAPPINGS,\n} from './constants';\n\nexport function overrideExtraFormData(\n  queryObject: QueryObject,\n  overrideFormData: ExtraFormDataOverride,\n): QueryObject {\n  const overriddenFormData: QueryObject = { ...queryObject };\n  const { extras: overriddenExtras = {} } = overriddenFormData;\n  Object.entries(EXTRA_FORM_DATA_OVERRIDE_REGULAR_MAPPINGS).forEach(\n    ([key, target]) => {\n      const value = overrideFormData[key as keyof ExtraFormDataOverride];\n      if (value !== undefined) {\n        overriddenFormData[target] = value;\n      }\n    },\n  );\n  EXTRA_FORM_DATA_OVERRIDE_EXTRA_KEYS.forEach(key => {\n    if (key in overrideFormData) {\n      // @ts-ignore\n      overriddenExtras[key] = overrideFormData[key];\n    }\n  });\n  if (Object.keys(overriddenExtras).length > 0) {\n    overriddenFormData.extras = overriddenExtras;\n  }\n  return overriddenFormData;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ExtraFormDataAppend,\n  ExtraFormDataOverrideExtras,\n  ExtraFormDataOverrideRegular,\n  ExtraFormDataOverride,\n  QueryObject,\n} from './types';\n\nexport const DTTM_ALIAS = '__timestamp';\nexport const NO_TIME_RANGE = 'No filter';\n\nexport const EXTRA_FORM_DATA_OVERRIDE_EXTRA_KEYS: (keyof ExtraFormDataOverrideExtras)[] =\n  ['relative_start', 'relative_end', 'time_grain_sqla'];\n\nexport const EXTRA_FORM_DATA_APPEND_KEYS: (keyof ExtraFormDataAppend)[] = [\n  'adhoc_filters',\n  'filters',\n  'interactive_groupby',\n  'interactive_highlight',\n  'interactive_drilldown',\n  'custom_form_data',\n];\n\nexport const EXTRA_FORM_DATA_OVERRIDE_REGULAR_MAPPINGS: Record<\n  keyof ExtraFormDataOverrideRegular,\n  keyof QueryObject\n> = {\n  granularity: 'granularity',\n  granularity_sqla: 'granularity',\n  time_column: 'time_column',\n  time_grain: 'time_grain',\n  time_range: 'time_range',\n};\n\nexport const EXTRA_FORM_DATA_OVERRIDE_REGULAR_KEYS = Object.keys(\n  EXTRA_FORM_DATA_OVERRIDE_REGULAR_MAPPINGS,\n) as (keyof ExtraFormDataOverrideRegular)[];\n\nexport const EXTRA_FORM_DATA_OVERRIDE_KEYS: (keyof ExtraFormDataOverride)[] = [\n  ...EXTRA_FORM_DATA_OVERRIDE_REGULAR_KEYS,\n  ...EXTRA_FORM_DATA_OVERRIDE_EXTRA_KEYS,\n];\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  SimpleAdhocFilter,\n  isBinaryAdhocFilter,\n  isUnaryAdhocFilter,\n} from './types/Filter';\nimport { QueryObjectFilterClause } from './types/Query';\n\nexport default function convertFilter(\n  filter: SimpleAdhocFilter,\n): QueryObjectFilterClause {\n  const { subject } = filter;\n  if (isUnaryAdhocFilter(filter)) {\n    const { operator } = filter;\n\n    return {\n      col: subject,\n      op: operator,\n    };\n  }\n  if (isBinaryAdhocFilter(filter)) {\n    const { operator } = filter;\n\n    return {\n      col: subject,\n      op: operator,\n      val: filter.comparator,\n    };\n  }\n\n  const { operator } = filter;\n\n  return {\n    col: subject,\n    op: operator,\n    val: filter.comparator,\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '../translation';\nimport { removeDuplicates } from '../utils';\nimport { DTTM_ALIAS } from './constants';\nimport getColumnLabel from './getColumnLabel';\nimport getMetricLabel from './getMetricLabel';\nimport {\n  QueryFields,\n  QueryFormColumn,\n  QueryFormMetric,\n  QueryFormOrderBy,\n  QueryFieldAliases,\n  FormDataResidual,\n  QueryMode,\n} from './types/QueryFormData';\nimport { hasGenericChartAxes } from './getXAxis';\n\n/**\n * Extra SQL query related fields from chart form data.\n * Consolidate field values into arrays.\n *\n * @param formData - the (partial) form data obtained from chart controls.\n * @param aliases - additional field aliases that maps arbitrary field names to\n *                  query field names.\n */\nexport default function extractQueryFields(\n  formData: FormDataResidual,\n  aliases?: QueryFieldAliases,\n): QueryFields {\n  const queryFieldAliases: QueryFieldAliases = {\n    /** These are predefined for backward compatibility */\n    metric: 'metrics',\n    metric_2: 'metrics',\n    secondary_metric: 'metrics',\n    x: 'metrics',\n    y: 'metrics',\n    size: 'metrics',\n    all_columns: 'columns',\n    series: 'groupby',\n    order_by_cols: 'orderby',\n    ...aliases,\n  };\n  const {\n    query_mode: queryMode,\n    include_time: includeTime,\n    ...restFormData\n  } = formData;\n\n  let columns: QueryFormColumn[] = [];\n  let metrics: QueryFormMetric[] = [];\n  let orderby: QueryFormOrderBy[] = [];\n\n  Object.entries(restFormData).forEach(([key, value]) => {\n    // ignore `null` or `undefined` value\n    if (value == null) {\n      return;\n    }\n\n    let normalizedKey: string = queryFieldAliases[key] || key;\n\n    // ignore columns when (specifically) in aggregate mode.\n    // For charts that support both aggregate and raw records mode,\n    // we store both `groupby` and `columns` in `formData`, so users can\n    // switch between modes while retaining the selected options for each.\n    if (queryMode === QueryMode.aggregate && normalizedKey === 'columns') {\n      return;\n    }\n\n    // for the same reason, ignore groupby and metrics in raw records mode\n    if (\n      queryMode === QueryMode.raw &&\n      (normalizedKey === 'groupby' || normalizedKey === 'metrics')\n    ) {\n      return;\n    }\n\n    // groupby has been deprecated in QueryObject: https://github.com/apache/superset/pull/9366\n    if (normalizedKey === 'groupby') {\n      normalizedKey = 'columns';\n    }\n\n    if (normalizedKey === 'metrics') {\n      metrics = metrics.concat(value);\n    } else if (normalizedKey === 'columns') {\n      // currently the columns field only accept pre-defined columns (string shortcut)\n      columns = columns.concat(value);\n    } else if (normalizedKey === 'orderby') {\n      orderby = orderby.concat(value);\n    }\n  });\n\n  if (!hasGenericChartAxes && includeTime && !columns.includes(DTTM_ALIAS)) {\n    columns.unshift(DTTM_ALIAS);\n  }\n\n  return {\n    columns: removeDuplicates(\n      columns.filter(col => col !== ''),\n      getColumnLabel,\n    ),\n    metrics:\n      queryMode === QueryMode.raw\n        ? undefined\n        : removeDuplicates(metrics, getMetricLabel),\n    orderby:\n      orderby.length > 0\n        ? orderby.map(item => {\n            // value can be in the format of `['[\"col1\", true]', '[\"col2\", false]'],\n            // where the option strings come directly from `order_by_choices`.\n            if (typeof item === 'string') {\n              try {\n                return JSON.parse(item);\n              } catch (error) {\n                throw new Error(t('Found invalid orderby options'));\n              }\n            }\n            return item;\n          })\n        : undefined,\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { isPhysicalColumn, QueryFormColumn } from './types';\n\nexport default function getColumnLabel(column: QueryFormColumn): string {\n  if (isPhysicalColumn(column)) {\n    return column;\n  }\n  if (column?.label) {\n    return column.label;\n  }\n  return column?.sqlExpression;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { QueryFormMetric, isSavedMetric, isAdhocMetricSimple } from './types';\n\nexport default function getMetricLabel(metric: QueryFormMetric): string {\n  if (isSavedMetric(metric)) {\n    return metric;\n  }\n  if (metric.label) {\n    return metric.label;\n  }\n  if (isAdhocMetricSimple(metric)) {\n    return `${metric.aggregate}(${\n      metric.column.columnName || metric.column.column_name\n    })`;\n  }\n  return metric.sqlExpression;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  DTTM_ALIAS,\n  FeatureFlag,\n  isFeatureEnabled,\n  getColumnLabel,\n  isQueryFormColumn,\n  QueryFormData,\n  QueryFormColumn,\n  Optional,\n} from '@superset-ui/core';\n\nexport const isXAxisSet = (formData: QueryFormData) =>\n  isQueryFormColumn(formData.x_axis);\n\nexport const hasGenericChartAxes = isFeatureEnabled(\n  FeatureFlag.GENERIC_CHART_AXES,\n);\n\nexport const getXAxisColumn = (\n  formData: QueryFormData,\n): Optional<QueryFormColumn> => {\n  // The formData should be \"raw form_data\" -- the snake_case version of formData rather than camelCase.\n  if (!(formData.granularity_sqla || formData.x_axis)) {\n    return undefined;\n  }\n\n  if (isXAxisSet(formData)) {\n    return formData.x_axis;\n  }\n  return DTTM_ALIAS;\n};\n\nexport const getXAxisLabel = (formData: QueryFormData): Optional<string> => {\n  const col = getXAxisColumn(formData);\n  if (col) {\n    return getColumnLabel(col);\n  }\n  return undefined;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport omit from 'lodash/omit';\n\nimport {\n  AdhocColumn,\n  isAdhocColumn,\n  isPhysicalColumn,\n  QueryFormColumn,\n  QueryFormData,\n  QueryObject,\n} from './types';\nimport { isXAxisSet } from './getXAxis';\n\nexport function normalizeTimeColumn(\n  formData: QueryFormData,\n  queryObject: QueryObject,\n): QueryObject {\n  // The formData should be \"raw form_data\" -- the snake_case version of formData rather than camelCase.\n  if (!isXAxisSet(formData)) {\n    return queryObject;\n  }\n\n  const { columns: _columns, extras: _extras } = queryObject;\n  const mutatedColumns: QueryFormColumn[] = [...(_columns || [])];\n  const axisIdx = _columns?.findIndex(\n    col =>\n      (isPhysicalColumn(col) &&\n        isPhysicalColumn(formData.x_axis) &&\n        col === formData.x_axis) ||\n      (isAdhocColumn(col) &&\n        isAdhocColumn(formData.x_axis) &&\n        col.sqlExpression === formData.x_axis.sqlExpression),\n  );\n  if (\n    axisIdx !== undefined &&\n    axisIdx > -1 &&\n    formData.x_axis &&\n    Array.isArray(_columns)\n  ) {\n    if (isAdhocColumn(_columns[axisIdx])) {\n      mutatedColumns[axisIdx] = {\n        timeGrain: _extras?.time_grain_sqla,\n        columnType: 'BASE_AXIS',\n        ...(_columns[axisIdx] as AdhocColumn),\n      };\n    } else {\n      mutatedColumns[axisIdx] = {\n        timeGrain: _extras?.time_grain_sqla,\n        columnType: 'BASE_AXIS',\n        sqlExpression: formData.x_axis,\n        label: formData.x_axis,\n        expressionType: 'SQL',\n      };\n    }\n\n    const newQueryObject = omit(queryObject, [\n      'extras.time_grain_sqla',\n      'is_timeseries',\n    ]);\n    newQueryObject.columns = mutatedColumns;\n\n    return newQueryObject;\n  }\n\n  // fallback, return original queryObject\n  return queryObject;\n}\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport enum RollingType {\n  Mean = 'mean',\n  Sum = 'sum',\n  Std = 'std',\n  Cumsum = 'cumsum',\n}\nexport interface RollingWindow {\n  rolling_type?: RollingType;\n  rolling_periods?: number;\n  min_periods?: number;\n}\n\nexport enum ComparisonType {\n  Values = 'values',\n  Difference = 'difference',\n  Percentage = 'percentage',\n  Ratio = 'ratio',\n}\nexport interface TimeCompare {\n  time_compare?: string;\n  comparison_type?: ComparisonType;\n}\n\nexport default {};\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { GenericDataType } from './QueryResponse';\nimport { QueryFormColumn } from './QueryFormData';\n\nexport interface AdhocColumn {\n  hasCustomLabel?: boolean;\n  label?: string;\n  optionName?: string;\n  sqlExpression: string;\n  expressionType: 'SQL';\n  columnType?: 'BASE_AXIS' | 'SERIES';\n  timeGrain?: string;\n  datasourceWarning?: boolean;\n}\n\n/**\n * A column that is physically defined in datasource.\n */\nexport type PhysicalColumn = string;\n\n/**\n * Column information defined in datasource.\n */\nexport interface Column {\n  id?: number;\n  type?: string;\n  type_generic?: GenericDataType;\n  column_name: string;\n  groupby?: boolean;\n  is_dttm?: boolean;\n  filterable?: boolean;\n  verbose_name?: string | null;\n  description?: string | null;\n  expression?: string | null;\n  database_expression?: string | null;\n  python_date_format?: string | null;\n\n  // used for advanced_data_type\n  optionName?: string;\n  filterBy?: string;\n  value?: string;\n  advanced_data_type?: string;\n}\n\nexport function isPhysicalColumn(column?: any): column is PhysicalColumn {\n  return typeof column === 'string';\n}\n\nexport function isAdhocColumn(column?: any): column is AdhocColumn {\n  return (\n    typeof column !== 'string' &&\n    column?.sqlExpression !== undefined &&\n    column?.label !== undefined &&\n    (column?.expressionType === undefined || column?.expressionType === 'SQL')\n  );\n}\n\nexport function isQueryFormColumn(column: any): column is QueryFormColumn {\n  return isPhysicalColumn(column) || isAdhocColumn(column);\n}\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { AdhocFilter, DataMask } from '@superset-ui/core';\n\nexport interface NativeFilterColumn {\n  name: string;\n  displayName?: string;\n}\n\nexport interface NativeFilterScope {\n  rootPath: string[];\n  excluded: number[];\n}\n\n/** The target of a filter is the datasource/column being filtered */\nexport interface NativeFilterTarget {\n  datasetId: number;\n  column: NativeFilterColumn;\n\n  // maybe someday support this?\n  // show values from these columns in the filter options selector\n  // clarityColumns?: Column[];\n}\n\nexport enum NativeFilterType {\n  NATIVE_FILTER = 'NATIVE_FILTER',\n  DIVIDER = 'DIVIDER',\n}\n\nexport enum DataMaskType {\n  NativeFilters = 'nativeFilters',\n  CrossFilters = 'crossFilters',\n}\n\nexport type DataMaskState = { [id: string]: DataMask };\n\nexport type DataMaskWithId = { id: string } & DataMask;\nexport type DataMaskStateWithId = { [filterId: string]: DataMaskWithId };\n\nexport type FilterSet = {\n  id: number;\n  name: string;\n  nativeFilters: Filters;\n  dataMask: DataMaskStateWithId;\n};\n\nexport type FilterSets = {\n  [filtersSetId: string]: FilterSet;\n};\n\nexport type Filter = {\n  cascadeParentIds: string[];\n  defaultDataMask: DataMask;\n  id: string; // randomly generated at filter creation\n  name: string;\n  scope: NativeFilterScope;\n  filterType: string;\n  // for now there will only ever be one target\n  // when multiple targets are supported, change this to Target[]\n  targets: [Partial<NativeFilterTarget>];\n  controlValues: {\n    [key: string]: any;\n  };\n  sortMetric?: string | null;\n  adhoc_filters?: AdhocFilter[];\n  granularity_sqla?: string;\n  granularity?: string;\n  time_grain_sqla?: string;\n  time_range?: string;\n  requiredFirst?: boolean;\n  tabsInScope?: string[];\n  chartsInScope?: number[];\n  type: typeof NativeFilterType.NATIVE_FILTER;\n  description: string;\n};\n\nexport type FilterWithDataMask = Filter & { dataMask: DataMaskWithId };\n\nexport type Divider = Partial<Omit<Filter, 'id' | 'type'>> & {\n  id: string;\n  title: string;\n  description: string;\n  type: typeof NativeFilterType.DIVIDER;\n};\n\nexport function isNativeFilter(\n  filterElement: Filter | Divider,\n): filterElement is Filter {\n  return filterElement.type === NativeFilterType.NATIVE_FILTER;\n}\n\nexport function isNativeFilterWithDataMask(\n  filterElement: Filter | Divider,\n): filterElement is FilterWithDataMask {\n  return (\n    isNativeFilter(filterElement) &&\n    (filterElement as FilterWithDataMask).dataMask?.filterState?.value\n  );\n}\n\nexport function isFilterDivider(\n  filterElement: Filter | Divider,\n): filterElement is Divider {\n  return filterElement.type === NativeFilterType.DIVIDER;\n}\n\nexport type FilterConfiguration = Array<Filter | Divider>;\n\nexport type Filters = {\n  [filterId: string]: Filter | Divider;\n};\n\nexport type PartialFilters = {\n  [filterId: string]: Partial<Filters[keyof Filters]>;\n};\n\nexport type NativeFiltersState = {\n  filters: Filters;\n  filterSets: FilterSets;\n  focusedFilterId?: string;\n  hoveredFilterId?: string;\n};\n\nexport type DashboardComponentMetadata = {\n  nativeFilters: NativeFiltersState;\n  dataMask: DataMaskStateWithId;\n};\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Column } from './Column';\nimport { Metric } from './Metric';\n\nexport enum DatasourceType {\n  Table = 'table',\n  Query = 'query',\n  Dataset = 'dataset',\n  SlTable = 'sl_table',\n  SavedQuery = 'saved_query',\n}\n\nexport interface Currency {\n  symbol: string;\n  symbolPosition: string;\n}\n\n/**\n * Datasource metadata.\n */\nexport interface Datasource {\n  id: number;\n  name: string;\n  type: DatasourceType;\n  columns: Column[];\n  metrics: Metric[];\n  description?: string;\n  // key is column names (labels)\n  columnFormats?: {\n    [key: string]: string;\n  };\n  currencyFormats?: {\n    [key: string]: Currency;\n  };\n  verboseMap?: {\n    [key: string]: string;\n  };\n}\n\nexport const DEFAULT_METRICS: Metric[] = [\n  {\n    metric_name: 'COUNT(*)',\n    expression: 'COUNT(*)',\n  },\n];\n\nexport default {};\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  UnaryOperator,\n  BinaryOperator,\n  SetOperator,\n  isUnaryOperator,\n  isBinaryOperator,\n  isSetOperator,\n} from './Operator';\nimport { TimeGranularity } from '../../time-format';\n\ninterface BaseAdhocFilter {\n  clause: 'WHERE' | 'HAVING';\n  timeGrain?: TimeGranularity;\n  isExtra?: boolean;\n}\n\ninterface BaseSimpleAdhocFilter extends BaseAdhocFilter {\n  expressionType: 'SIMPLE';\n  subject: string;\n}\n\nexport type UnaryAdhocFilter = BaseSimpleAdhocFilter & {\n  operator: UnaryOperator;\n};\n\nexport type BinaryAdhocFilter = BaseSimpleAdhocFilter & {\n  operator: BinaryOperator;\n  comparator: string;\n};\n\nexport type SetAdhocFilter = BaseSimpleAdhocFilter & {\n  operator: SetOperator;\n  comparator: string[];\n};\n\nexport type SimpleAdhocFilter =\n  | UnaryAdhocFilter\n  | BinaryAdhocFilter\n  | SetAdhocFilter;\n\nexport interface FreeFormAdhocFilter extends BaseAdhocFilter {\n  expressionType: 'SQL';\n  sqlExpression: string;\n}\n\nexport type AdhocFilter = SimpleAdhocFilter | FreeFormAdhocFilter;\n\n//---------------------------------------------------\n// Type guards\n//---------------------------------------------------\n\nexport function isSimpleAdhocFilter(\n  filter: AdhocFilter,\n): filter is SimpleAdhocFilter {\n  return filter.expressionType === 'SIMPLE';\n}\n\nexport function isFreeFormAdhocFilter(\n  filter: AdhocFilter,\n): filter is FreeFormAdhocFilter {\n  return filter.expressionType === 'SQL';\n}\n\nexport function isUnaryAdhocFilter(\n  filter: SimpleAdhocFilter,\n): filter is UnaryAdhocFilter {\n  return isUnaryOperator(filter.operator);\n}\n\nexport function isBinaryAdhocFilter(\n  filter: SimpleAdhocFilter,\n): filter is BinaryAdhocFilter {\n  return isBinaryOperator(filter.operator);\n}\n\nexport function isSetAdhocFilter(\n  filter: SimpleAdhocFilter,\n): filter is SetAdhocFilter {\n  return isSetOperator(filter.operator);\n}\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Maybe, QueryFormMetric } from '../../types';\nimport { Column } from './Column';\n\nexport type Aggregate =\n  | 'AVG'\n  | 'COUNT'\n  | 'COUNT_DISTINCT'\n  | 'MAX'\n  | 'MIN'\n  | 'SUM';\n\nexport interface AdhocMetricBase {\n  hasCustomLabel?: boolean;\n  label?: string;\n  optionName?: string;\n}\n\nexport interface AdhocMetricSimple extends AdhocMetricBase {\n  expressionType: 'SIMPLE';\n  column: Omit<Column, 'column_name'> & {\n    column_name?: string;\n    columnName?: string;\n  };\n  aggregate: Aggregate;\n}\n\nexport interface AdhocMetricSQL extends AdhocMetricBase {\n  expressionType: 'SQL';\n  sqlExpression: string;\n}\n\nexport type AdhocMetric = AdhocMetricSimple | AdhocMetricSQL;\n\n/**\n * Select a predefined metric by its `metric_name`.\n */\nexport type SavedMetric = string;\n\n/**\n * Metric definition stored in datasource metadata.\n */\nexport interface Metric {\n  id?: number;\n  metric_name: string;\n  expression?: Maybe<string>;\n  certification_details?: Maybe<string>;\n  certified_by?: Maybe<string>;\n  d3format?: Maybe<string>;\n  currency?: Maybe<string>;\n  description?: Maybe<string>;\n  is_certified?: boolean;\n  verbose_name?: string;\n  warning_markdown?: Maybe<string>;\n  warning_text?: Maybe<string>;\n}\n\nexport function isSavedMetric(metric: any): metric is SavedMetric {\n  return typeof metric === 'string';\n}\n\nexport function isAdhocMetricSimple(metric: any): metric is AdhocMetricSimple {\n  return typeof metric !== 'string' && metric?.expressionType === 'SIMPLE';\n}\n\nexport function isAdhocMetricSQL(metric: any): metric is AdhocMetricSQL {\n  return typeof metric !== 'string' && metric?.expressionType === 'SQL';\n}\n\nexport function isQueryFormMetric(metric: any): metric is QueryFormMetric {\n  return (\n    isSavedMetric(metric) ||\n    isAdhocMetricSimple(metric) ||\n    isAdhocMetricSQL(metric)\n  );\n}\n\nexport default {};\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/** List of operators that do not require another operand */\nconst UNARY_OPERATORS = ['IS NOT NULL', 'IS NULL'] as const;\n\n/** List of operators that require another operand that is a single value */\nconst BINARY_OPERATORS = [\n  '==',\n  '!=',\n  '>',\n  '<',\n  '>=',\n  '<=',\n  'ILIKE',\n  'LIKE',\n  'REGEX',\n  'TEMPORAL_RANGE',\n] as const;\n\n/** List of operators that require another operand that is a set */\nconst SET_OPERATORS = ['IN', 'NOT IN'] as const;\n\n//---------------------------------------------------\n// Derived types\n//---------------------------------------------------\n\n/** An operator that does not require another operand */\nexport type UnaryOperator = typeof UNARY_OPERATORS[number];\n\n/** An operator that requires another operand that is a single value */\nexport type BinaryOperator = typeof BINARY_OPERATORS[number];\n\n/** An operator that require another operand that is a set */\nexport type SetOperator = typeof SET_OPERATORS[number];\n\n//---------------------------------------------------\n// Type guards\n//---------------------------------------------------\n\nconst unaryOperatorSet = new Set<string>(UNARY_OPERATORS);\n\nexport function isUnaryOperator(operator: string): operator is UnaryOperator {\n  return unaryOperatorSet.has(operator);\n}\n\nconst binaryOperatorSet = new Set<string>(BINARY_OPERATORS);\n\nexport function isBinaryOperator(operator: string): operator is BinaryOperator {\n  return binaryOperatorSet.has(operator);\n}\n\nconst setOperatorSet = new Set<string>(SET_OPERATORS);\n\nexport function isSetOperator(operator: string): operator is SetOperator {\n  return setOperatorSet.has(operator);\n}\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Types for the final QueryContext sent to /api/v1/chart/data.\n */\nimport { AdhocMetric, SavedMetric } from './Metric';\nimport { AdhocFilter } from './Filter';\nimport { BinaryOperator, SetOperator } from './Operator';\nimport { AnnotationLayer } from './AnnotationLayer';\nimport {\n  QueryObject,\n  QueryObjectExtras,\n  QueryObjectFilterClause,\n} from './Query';\nimport { TimeRange } from './Time';\nimport { TimeGranularity } from '../../time-format';\nimport { JsonObject } from '../../connection';\nimport { AdhocColumn, PhysicalColumn } from './Column';\n\n/**\n * Metric definition/reference in query object.\n */\nexport type QueryFormMetric = SavedMetric | AdhocMetric;\n\n/**\n * Column selects in query object (used as dimensions in both groupby or raw\n * query mode). Can be either reference to physical column or expression.\n */\nexport type QueryFormColumn = PhysicalColumn | AdhocColumn;\n\n/**\n * Order query results by columns.\n * Format: [metric/column, is_ascending].\n */\nexport type QueryFormOrderBy =\n  | [QueryFormColumn | QueryFormMetric | {}, boolean]\n  | [];\n\nexport interface FormDataResidual {\n  [key: string]: any;\n}\n\nexport enum QueryMode {\n  aggregate = 'aggregate',\n  raw = 'raw',\n}\n\n/**\n * Query form fields related to SQL query and data outputs.\n */\nexport interface QueryFields {\n  columns?: QueryFormColumn[];\n  metrics?: QueryFormMetric[];\n  orderby?: QueryFormOrderBy[];\n}\n\n/**\n * Name of query fields.\n */\nexport type QueryField = keyof QueryFields;\n\n/**\n * Map of arbitrary control field names to query field names\n * (one of 'metrics' | 'columns' | 'groupby').\n *\n * Note that `groupby` is only added here because it is will be handled when\n * processing aliases but will not be sent to final objects. See `extraQueryFields.ts`.\n */\nexport type QueryFieldAliases = {\n  [key: string]: QueryField | 'groupby';\n};\n\n/**\n * Filter value for adhoc filters from dashboard FilterBox.\n * Currently only Binary and Set filters are supported.\n */\nexport type QueryFormExtraFilter = {\n  col: string;\n} & (\n  | {\n      op: BinaryOperator;\n      val: string;\n    }\n  | {\n      op: SetOperator;\n      val: string[];\n    }\n);\n\n/** These properties will be appended to those pre-existing in the form data/query object */\nexport type ExtraFormDataAppend = {\n  adhoc_filters?: AdhocFilter[];\n  filters?: QueryObjectFilterClause[];\n  /** These properties are for dynamic cross chart interaction */\n  interactive_drilldown?: string[];\n  interactive_groupby?: string[];\n  interactive_highlight?: string[];\n  /** This property can be used to pass non-standard form data between viz components */\n  custom_form_data?: JsonObject;\n};\n\n/** These parameters override properties in the extras parameter in the form data/query object.\n * Not all keys of QueryObjectExtras are supported here to ensure that freeform where and having\n * filter clauses can't be overridden */\nexport type ExtraFormDataOverrideExtras = Pick<\n  QueryObjectExtras,\n  'relative_start' | 'relative_end' | 'time_grain_sqla'\n>;\n\n/** These parameters override those already present in the form data/query object */\nexport type ExtraFormDataOverrideRegular = Partial<\n  Pick<SqlaFormData, 'granularity_sqla'>\n> &\n  Partial<Pick<SqlaFormData, 'granularity'>> &\n  Partial<Pick<BaseFormData, 'time_range'>> &\n  Partial<Pick<QueryObject, 'time_column' | 'time_grain'>>;\n\n/** These parameters override those already present in the form data/query object */\nexport type ExtraFormDataOverride = ExtraFormDataOverrideRegular &\n  ExtraFormDataOverrideExtras;\n\nexport type ExtraFormData = ExtraFormDataAppend & ExtraFormDataOverride;\n\n// Type signature for formData shared by all viz types\n// It will be gradually filled out as we build out the query object\n\nexport interface BaseFormData extends TimeRange, FormDataResidual {\n  /** datasource identifier ${id}_${type} */\n  datasource: string;\n  /**\n   * visualization type\n   * - necessary if you use the plugin and want to use\n   * buildQuery function from the plugin.\n   * This must match the key used when registering the plugin.\n   * - not necessary if you do not plan to use the\n   * buildQuery function from the plugin.\n   * Can put \"custom\" (or any string) in this field in that case.\n   */\n  viz_type: string;\n  metrics?: QueryFormMetric[];\n  where?: string;\n  columns?: QueryFormColumn[];\n  groupby?: QueryFormColumn[];\n  all_columns?: QueryFormColumn[];\n  /** list of filters */\n  adhoc_filters?: AdhocFilter[] | null;\n  extra_filters?: QueryFormExtraFilter[] | null;\n  extra_form_data?: ExtraFormData;\n  /** order descending */\n  order_desc?: boolean;\n  /** limit number of time series\n   *  deprecated - use series_limit instead */\n  limit?: number;\n  /** limit number of row in the results */\n  row_limit?: string | number | null;\n  /** row offset for server side pagination */\n  row_offset?: string | number | null;\n  /** The metric used to order timeseries for limiting\n   *  deprecated - use series_limit_metric instead */\n  timeseries_limit_metric?: QueryFormMetric;\n  /** Force refresh */\n  force?: boolean;\n  result_format?: string;\n  result_type?: string;\n  annotation_layers?: AnnotationLayer[];\n  url_params?: Record<string, string>;\n  custom_params?: Record<string, string>;\n  /** limit number of series */\n  series_columns?: QueryFormColumn[];\n  series_limit?: number;\n  series_limit_metric?: QueryFormMetric;\n}\n\n/**\n * Form data for SQLAlchemy based datasources.\n */\nexport interface SqlaFormData extends BaseFormData {\n  /**\n   * Name of the Time Column. Time column is optional.\n   */\n  granularity?: string;\n  granularity_sqla?: string;\n  time_grain_sqla?: TimeGranularity;\n  having?: string;\n}\n\nexport type QueryFormData = SqlaFormData;\n\n//---------------------------------------------------\n// Type guards\n//---------------------------------------------------\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TimeseriesDataRecord } from '../../chart';\nimport { AnnotationData } from './AnnotationLayer';\n\n/**\n * Generic data types, see enum of the same name in superset/utils/core.py.\n */\nexport enum GenericDataType {\n  NUMERIC = 0,\n  STRING = 1,\n  TEMPORAL = 2,\n  BOOLEAN = 3,\n}\n\n/**\n * Primitive types for data field values.\n */\nexport type DataRecordValue = number | string | boolean | Date | null;\n\nexport interface DataRecord {\n  [key: string]: DataRecordValue;\n}\n\n/**\n * Queried data for charts. The `queries` field from `POST /chart/data`.\n * See superset/charts/schemas.py for the class of the same name.\n */\nexport interface ChartDataResponseResult {\n  /**\n   * Data for the annotation layer.\n   */\n  annotation_data: AnnotationData | null;\n  cache_key: string | null;\n  cache_timeout: number | null;\n  cached_dttm: string | null;\n  /**\n   * Array of data records as dictionary\n   */\n  data: DataRecord[];\n  /**\n   * Name of each column, for retaining the order of the output columns.\n   */\n  colnames: string[];\n  /**\n   * Generic data types, based on the final output pandas dataframe.\n   */\n  coltypes: GenericDataType[];\n  error: string | null;\n  is_cached: boolean;\n  query: string;\n  rowcount: number;\n  stacktrace: string | null;\n  status:\n    | 'stopped'\n    | 'failed'\n    | 'pending'\n    | 'running'\n    | 'scheduled'\n    | 'success'\n    | 'timed_out';\n  from_dttm: number | null;\n  to_dttm: number | null;\n}\n\nexport interface TimeseriesChartDataResponseResult\n  extends ChartDataResponseResult {\n  data: TimeseriesDataRecord[];\n  label_map: Record<string, string[]>;\n}\n\n/**\n * Query response from /api/v1/chart/data\n */\nexport interface ChartDataResponse {\n  queries: ChartDataResponseResult[];\n}\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { TypedRegistry } from '../models';\nimport { makeSingleton } from '../utils';\nimport { Extensions } from './types';\n\n/**\n * A registry containing extensions which can alter Superset's UI at specific points defined by Superset.\n * See SIP-87: https://github.com/apache/superset/issues/20615\n */\nclass ExtensionsRegistry extends TypedRegistry<Extensions> {\n  name = 'ExtensionsRegistry';\n}\n\nexport const getExtensionsRegistry = makeSingleton(ExtensionsRegistry, {});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// We can codegen the enum definition based on a list of supported flags that we\n// check into source control. We're hardcoding the supported flags for now.\nexport enum FeatureFlag {\n  // PLEASE KEEP THE LIST SORTED ALPHABETICALLY\n  ALERTS_ATTACH_REPORTS = 'ALERTS_ATTACH_REPORTS',\n  ALERT_REPORTS = 'ALERT_REPORTS',\n  ALLOW_FULL_CSV_EXPORT = 'ALLOW_FULL_CSV_EXPORT',\n  CLIENT_CACHE = 'CLIENT_CACHE',\n  DASHBOARD_CROSS_FILTERS = 'DASHBOARD_CROSS_FILTERS',\n  DASHBOARD_FILTERS_EXPERIMENTAL = 'DASHBOARD_FILTERS_EXPERIMENTAL',\n  CONFIRM_DASHBOARD_DIFF = 'CONFIRM_DASHBOARD_DIFF',\n  DASHBOARD_NATIVE_FILTERS = 'DASHBOARD_NATIVE_FILTERS',\n  DASHBOARD_NATIVE_FILTERS_SET = 'DASHBOARD_NATIVE_FILTERS_SET',\n  DASHBOARD_VIRTUALIZATION = 'DASHBOARD_VIRTUALIZATION',\n  DASHBOARD_RBAC = 'DASHBOARD_RBAC',\n  DATAPANEL_CLOSED_BY_DEFAULT = 'DATAPANEL_CLOSED_BY_DEFAULT',\n  DISABLE_DATASET_SOURCE_EDIT = 'DISABLE_DATASET_SOURCE_EDIT',\n  DISABLE_LEGACY_DATASOURCE_EDITOR = 'DISABLE_LEGACY_DATASOURCE_EDITOR',\n  DRILL_TO_DETAIL = 'DRILL_TO_DETAIL',\n  DRILL_BY = 'DRILL_BY',\n  DYNAMIC_PLUGINS = 'DYNAMIC_PLUGINS',\n  EMBEDDABLE_CHARTS = 'EMBEDDABLE_CHARTS',\n  EMBEDDED_SUPERSET = 'EMBEDDED_SUPERSET',\n  ENABLE_ADVANCED_DATA_TYPES = 'ENABLE_ADVANCED_DATA_TYPES',\n  ENABLE_EXPLORE_DRAG_AND_DROP = 'ENABLE_EXPLORE_DRAG_AND_DROP',\n  ENABLE_JAVASCRIPT_CONTROLS = 'ENABLE_JAVASCRIPT_CONTROLS',\n  ENABLE_TEMPLATE_PROCESSING = 'ENABLE_TEMPLATE_PROCESSING',\n  ENABLE_TEMPLATE_REMOVE_FILTERS = 'ENABLE_TEMPLATE_REMOVE_FILTERS',\n  ESCAPE_MARKDOWN_HTML = 'ESCAPE_MARKDOWN_HTML',\n  ESTIMATE_QUERY_COST = 'ESTIMATE_QUERY_COST',\n  GENERIC_CHART_AXES = 'GENERIC_CHART_AXES',\n  GLOBAL_ASYNC_QUERIES = 'GLOBAL_ASYNC_QUERIES',\n  HORIZONTAL_FILTER_BAR = 'HORIZONTAL_FILTER_BAR',\n  LISTVIEWS_DEFAULT_CARD_VIEW = 'LISTVIEWS_DEFAULT_CARD_VIEW',\n  SCHEDULED_QUERIES = 'SCHEDULED_QUERIES',\n  SHARE_QUERIES_VIA_KV_STORE = 'SHARE_QUERIES_VIA_KV_STORE',\n  SQLLAB_BACKEND_PERSISTENCE = 'SQLLAB_BACKEND_PERSISTENCE',\n  SQL_VALIDATORS_BY_ENGINE = 'SQL_VALIDATORS_BY_ENGINE',\n  THUMBNAILS = 'THUMBNAILS',\n  USE_ANALAGOUS_COLORS = 'USE_ANALAGOUS_COLORS',\n  TAGGING_SYSTEM = 'TAGGING_SYSTEM',\n  VERSIONED_EXPORT = 'VERSIONED_EXPORT',\n  SSH_TUNNELING = 'SSH_TUNNELING',\n  AVOID_COLORS_COLLISION = 'AVOID_COLORS_COLLISION',\n}\nexport type ScheduleQueriesProps = {\n  JSONSCHEMA: {\n    [key: string]: string;\n  };\n  UISCHEMA: {\n    [key: string]: string;\n  };\n  VALIDATION: {\n    [key: string]: string;\n  };\n};\nexport type FeatureFlagMap = {\n  [key in Exclude<FeatureFlag, FeatureFlag.SCHEDULED_QUERIES>]?: boolean;\n} & {\n  SCHEDULED_QUERIES?: ScheduleQueriesProps;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ndeclare global {\n  interface Window {\n    featureFlags: FeatureFlagMap;\n  }\n}\n\nexport function isFeatureEnabled(feature: FeatureFlag): boolean {\n  try {\n    return !!window.featureFlags[feature];\n  } catch (error) {\n    console.error(`Failed to query feature flag ${feature}`);\n  }\n  return false;\n}\n","import React from 'react';\nimport { FilterXSS, getDefaultWhiteList } from 'xss';\n\nconst xssFilter = new FilterXSS({\n  whiteList: {\n    ...getDefaultWhiteList(),\n    span: ['style', 'class', 'title'],\n    div: ['style', 'class'],\n    a: ['style', 'class', 'href', 'title', 'target'],\n    img: ['style', 'class', 'src', 'alt', 'title', 'width', 'height'],\n    video: [\n      'autoplay',\n      'controls',\n      'loop',\n      'preload',\n      'src',\n      'height',\n      'width',\n      'muted',\n    ],\n  },\n  stripIgnoreTag: true,\n  css: false,\n});\n\nexport function sanitizeHtml(htmlString: string) {\n  return xssFilter.process(htmlString);\n}\n\nexport function isProbablyHTML(text: string) {\n  return /<[^>]+>/.test(text);\n}\n\nexport function sanitizeHtmlIfNeeded(htmlString: string) {\n  return isProbablyHTML(htmlString) ? sanitizeHtml(htmlString) : htmlString;\n}\n\nexport function safeHtmlSpan(possiblyHtmlString: string) {\n  const isHtml = isProbablyHTML(possiblyHtmlString);\n  if (isHtml) {\n    return (\n      <span\n        className=\"safe-html-wrapper\"\n        dangerouslySetInnerHTML={{ __html: sanitizeHtml(possiblyHtmlString) }}\n      />\n    );\n  }\n  return possiblyHtmlString;\n}\n\nexport function removeHTMLTags(str: string): string {\n  return str.replace(/<[^>]*>/g, '');\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport default function isDefined<T>(x: T): x is NonNullable<T> {\n  return x !== null && x !== undefined;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function isEqualArray<T extends unknown[] | undefined | null>(\n  arrA: T,\n  arrB: T,\n) {\n  return (\n    arrA === arrB ||\n    (!arrA && !arrB) ||\n    !!(\n      arrA &&\n      arrB &&\n      arrA.length === arrB.length &&\n      arrA.every((x, i) => x === arrB[i])\n    )\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * Remove duplicate items from a list.\n */\nexport function removeDuplicates<T>(\n  items: T[],\n  hash?: (item: T) => unknown,\n): T[] {\n  if (hash) {\n    const seen = new Set();\n    return items.filter(x => {\n      const itemHash = hash(x);\n      if (seen.has(itemHash)) return false;\n      seen.add(itemHash);\n      return true;\n    });\n  }\n  return [...new Set(items)];\n}\n\nexport default removeDuplicates;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\n/**\n * formerly called integer()\n * @param v\n */\nexport default function legacyValidateInteger(v: unknown) {\n  if (\n    v &&\n    (Number.isNaN(Number(v)) || parseInt(v as string, 10) !== Number(v))\n  ) {\n    return t('is expected to be an integer');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\n/**\n * formerly called numeric()\n * @param v\n */\nexport default function numeric(v: unknown) {\n  if (v && Number.isNaN(Number(v))) {\n    return t('is expected to be a number');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\nexport default function validateNonEmpty(v: unknown) {\n  if (\n    v === null ||\n    typeof v === 'undefined' ||\n    v === '' ||\n    (Array.isArray(v) && v.length === 0)\n  ) {\n    return t('cannot be empty');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\nexport default function validateInteger(v: unknown) {\n  if (\n    (typeof v === 'string' &&\n      v.trim().length > 0 &&\n      Number.isFinite(Number(v.trim()))) ||\n    (typeof v === 'number' && Number.isFinite(v))\n  ) {\n    return false;\n  }\n\n  return t('is expected to be a number');\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useCallback, useState } from 'react';\nimport { Radio } from 'src/components/Radio';\nimport { RadioChangeEvent, AsyncSelect } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport StyledModal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport {\n  styled,\n  t,\n  SupersetClient,\n  JsonResponse,\n  JsonObject,\n  QueryResponse,\n  QueryFormData,\n} from '@superset-ui/core';\nimport { useSelector, useDispatch } from 'react-redux';\nimport moment from 'moment';\nimport rison from 'rison';\nimport { createDatasource } from 'src/SqlLab/actions/sqlLab';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { UserWithPermissionsAndRoles as User } from 'src/types/bootstrapTypes';\nimport {\n  DatasetRadioState,\n  EXPLORE_CHART_DEFAULT,\n  DatasetOwner,\n  SqlLabExploreRootState,\n  getInitialState,\n  SqlLabRootState,\n} from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport { URL_PARAMS } from 'src/constants';\nimport { SelectValue } from 'antd/lib/select';\nimport { isEmpty, isString } from 'lodash';\n\ninterface QueryDatabase {\n  id?: number;\n}\n\nexport type ExploreQuery = QueryResponse & {\n  database?: QueryDatabase | null | undefined;\n};\n\nexport interface ISimpleColumn {\n  column_name?: string | null;\n  name?: string | null;\n  type?: string | null;\n  is_dttm?: boolean | null;\n}\n\nexport type Database = {\n  backend: string;\n  id: number;\n  parameter: object;\n};\n\nexport interface ISaveableDatasource {\n  columns: ISimpleColumn[];\n  name: string;\n  dbId: number;\n  sql: string;\n  templateParams?: string | object | null;\n  schema?: string | null;\n  database?: Database;\n}\n\ninterface SaveDatasetModalProps {\n  visible: boolean;\n  onHide: () => void;\n  buttonTextOnSave: string;\n  buttonTextOnOverwrite: string;\n  modalDescription?: string;\n  datasource: ISaveableDatasource;\n  openWindow?: boolean;\n  formData?: Omit<QueryFormData, 'datasource'>;\n}\n\nconst Styles = styled.div`\n  .sdm-body {\n    margin: 0 8px;\n  }\n  .sdm-input {\n    margin-left: 45px;\n    width: 401px;\n  }\n  .sdm-autocomplete {\n    width: 401px;\n    align-self: center;\n  }\n  .sdm-radio {\n    display: block;\n    height: 30px;\n    margin: 10px 0px;\n    line-height: 30px;\n  }\n  .sdm-overwrite-msg {\n    margin: 7px;\n  }\n  .sdm-overwrite-container {\n    flex: 1 1 auto;\n    display: flex;\n  }\n`;\n\nconst updateDataset = async (\n  dbId: number,\n  datasetId: number,\n  sql: string,\n  columns: Array<Record<string, any>>,\n  owners: [number],\n  overrideColumns: boolean,\n) => {\n  const endpoint = `api/v1/dataset/${datasetId}?override_columns=${overrideColumns}`;\n  const headers = { 'Content-Type': 'application/json' };\n  const body = JSON.stringify({\n    sql,\n    columns,\n    owners,\n    database_id: dbId,\n  });\n\n  const data: JsonResponse = await SupersetClient.put({\n    endpoint,\n    headers,\n    body,\n  });\n  return data.json.result;\n};\n\nconst UNTITLED = t('Untitled Dataset');\n\nexport const SaveDatasetModal = ({\n  visible,\n  onHide,\n  buttonTextOnSave,\n  buttonTextOnOverwrite,\n  modalDescription,\n  datasource,\n  openWindow = true,\n  formData = {},\n}: SaveDatasetModalProps) => {\n  const defaultVizType = useSelector<SqlLabRootState, string>(\n    state => state.common?.conf?.DEFAULT_VIZ_TYPE || 'table',\n  );\n\n  const getDefaultDatasetName = () =>\n    `${datasource?.name || UNTITLED} ${moment().format('MM/DD/YYYY HH:mm:ss')}`;\n  const [datasetName, setDatasetName] = useState(getDefaultDatasetName());\n  const [newOrOverwrite, setNewOrOverwrite] = useState(\n    DatasetRadioState.SAVE_NEW,\n  );\n  const [shouldOverwriteDataset, setShouldOverwriteDataset] = useState(false);\n  const [datasetToOverwrite, setDatasetToOverwrite] = useState<\n    Record<string, any>\n  >({});\n  const [selectedDatasetToOverwrite, setSelectedDatasetToOverwrite] = useState<\n    SelectValue | undefined\n  >(undefined);\n  const [loading, setLoading] = useState<boolean>(false);\n\n  const user = useSelector<SqlLabExploreRootState, User>(user =>\n    getInitialState(user),\n  );\n  const dispatch = useDispatch<(dispatch: any) => Promise<JsonObject>>();\n\n  const createWindow = (url: string) => {\n    if (openWindow) {\n      window.open(url, '_blank', 'noreferrer');\n    } else {\n      window.location.href = url;\n    }\n  };\n  const formDataWithDefaults = {\n    ...EXPLORE_CHART_DEFAULT,\n    ...(formData || {}),\n  };\n  const handleOverwriteDataset = async () => {\n    // if user wants to overwrite a dataset we need to prompt them\n    if (!shouldOverwriteDataset) {\n      setShouldOverwriteDataset(true);\n      return;\n    }\n    setLoading(true);\n\n    const [, key] = await Promise.all([\n      updateDataset(\n        datasource?.dbId,\n        datasetToOverwrite?.datasetid,\n        datasource?.sql,\n        datasource?.columns?.map(\n          (d: { column_name: string; type: string; is_dttm: boolean }) => ({\n            column_name: d.column_name,\n            type: d.type,\n            is_dttm: d.is_dttm,\n          }),\n        ),\n        datasetToOverwrite?.owners?.map((o: DatasetOwner) => o.id),\n        true,\n      ),\n      postFormData(datasetToOverwrite.datasetid, 'table', {\n        ...formDataWithDefaults,\n        datasource: `${datasetToOverwrite.datasetid}__table`,\n        ...(defaultVizType === 'table' && {\n          all_columns: datasource?.columns?.map(column => column.column_name),\n        }),\n      }),\n    ]);\n    setLoading(false);\n\n    const url = mountExploreUrl(null, {\n      [URL_PARAMS.formDataKey.name]: key,\n    });\n    createWindow(url);\n\n    setShouldOverwriteDataset(false);\n    setDatasetName(getDefaultDatasetName());\n    onHide();\n  };\n\n  const loadDatasetOverwriteOptions = useCallback(\n    async (input = '') => {\n      const { userId } = user;\n      const queryParams = rison.encode({\n        filters: [\n          {\n            col: 'table_name',\n            opr: 'ct',\n            value: input,\n          },\n          {\n            col: 'owners',\n            opr: 'rel_m_m',\n            value: userId,\n          },\n        ],\n        order_column: 'changed_on_delta_humanized',\n        order_direction: 'desc',\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/dataset?q=${queryParams}`,\n      }).then(response => ({\n        data: response.json.result.map(\n          (r: { table_name: string; id: number; owners: [DatasetOwner] }) => ({\n            value: r.table_name,\n            label: r.table_name,\n            datasetid: r.id,\n            owners: r.owners,\n          }),\n        ),\n        totalCount: response.json.count,\n      }));\n    },\n    [user],\n  );\n\n  const handleSaveInDataset = () => {\n    setLoading(true);\n    const selectedColumns = datasource?.columns ?? [];\n\n    // The filters param is only used to test jinja templates.\n    // Remove the special filters entry from the templateParams\n    // before saving the dataset.\n    let templateParams;\n    if (isString(datasource?.templateParams)) {\n      const p = JSON.parse(datasource.templateParams);\n      /* eslint-disable-next-line no-underscore-dangle */\n      if (p._filters) {\n        /* eslint-disable-next-line no-underscore-dangle */\n        delete p._filters;\n        // eslint-disable-next-line no-param-reassign\n        templateParams = JSON.stringify(p);\n      }\n    }\n\n    dispatch(\n      createDatasource({\n        sql: datasource.sql,\n        dbId: datasource.dbId || datasource?.database?.id,\n        templateParams,\n        datasourceName: datasetName,\n      }),\n    )\n      .then((data: { id: number }) =>\n        postFormData(data.id, 'table', {\n          ...formDataWithDefaults,\n          datasource: `${data.id}__table`,\n          ...(defaultVizType === 'table' && {\n            all_columns: selectedColumns.map(column => column.column_name),\n          }),\n        }),\n      )\n      .then((key: string) => {\n        setLoading(false);\n        const url = mountExploreUrl(null, {\n          [URL_PARAMS.formDataKey.name]: key,\n        });\n        createWindow(url);\n        setDatasetName(getDefaultDatasetName());\n        onHide();\n      })\n      .catch(() => {\n        setLoading(false);\n        addDangerToast(t('An error occurred saving dataset'));\n      });\n  };\n\n  const handleOverwriteDatasetOption = (value: SelectValue, option: any) => {\n    setDatasetToOverwrite(option);\n    setSelectedDatasetToOverwrite(value);\n  };\n\n  const handleDatasetNameChange = (e: React.FormEvent<HTMLInputElement>) => {\n    // @ts-expect-error\n    setDatasetName(e.target.value);\n  };\n\n  const handleOverwriteCancel = () => {\n    setShouldOverwriteDataset(false);\n    setDatasetToOverwrite({});\n  };\n\n  const disableSaveAndExploreBtn =\n    (newOrOverwrite === DatasetRadioState.SAVE_NEW &&\n      datasetName.length === 0) ||\n    (newOrOverwrite === DatasetRadioState.OVERWRITE_DATASET &&\n      isEmpty(selectedDatasetToOverwrite));\n\n  const filterAutocompleteOption = (\n    inputValue: string,\n    option: { value: string; datasetid: number },\n  ) => option.value.toLowerCase().includes(inputValue.toLowerCase());\n\n  return (\n    <StyledModal\n      show={visible}\n      title={t('Save or Overwrite Dataset')}\n      onHide={onHide}\n      footer={\n        <>\n          {newOrOverwrite === DatasetRadioState.SAVE_NEW && (\n            <Button\n              disabled={disableSaveAndExploreBtn}\n              buttonStyle=\"primary\"\n              onClick={handleSaveInDataset}\n              loading={loading}\n            >\n              {buttonTextOnSave}\n            </Button>\n          )}\n          {newOrOverwrite === DatasetRadioState.OVERWRITE_DATASET && (\n            <>\n              {shouldOverwriteDataset && (\n                <Button onClick={handleOverwriteCancel}>{t('Back')}</Button>\n              )}\n              <Button\n                className=\"md\"\n                buttonStyle=\"primary\"\n                onClick={handleOverwriteDataset}\n                disabled={disableSaveAndExploreBtn}\n                loading={loading}\n              >\n                {buttonTextOnOverwrite}\n              </Button>\n            </>\n          )}\n        </>\n      }\n    >\n      <Styles>\n        {!shouldOverwriteDataset && (\n          <div className=\"sdm-body\">\n            {modalDescription && (\n              <div className=\"sdm-prompt\">{modalDescription}</div>\n            )}\n            <Radio.Group\n              onChange={(e: RadioChangeEvent) => {\n                setNewOrOverwrite(Number(e.target.value));\n              }}\n              value={newOrOverwrite}\n            >\n              <Radio className=\"sdm-radio\" value={1}>\n                {t('Save as new')}\n                <Input\n                  className=\"sdm-input\"\n                  value={datasetName}\n                  onChange={handleDatasetNameChange}\n                  disabled={newOrOverwrite !== 1}\n                />\n              </Radio>\n              <div className=\"sdm-overwrite-container\">\n                <Radio className=\"sdm-radio\" value={2}>\n                  {t('Overwrite existing')}\n                </Radio>\n                <div className=\"sdm-autocomplete\">\n                  <AsyncSelect\n                    allowClear\n                    showSearch\n                    placeholder={t('Select or type dataset name')}\n                    ariaLabel={t('Existing dataset')}\n                    onChange={handleOverwriteDatasetOption}\n                    options={input => loadDatasetOverwriteOptions(input)}\n                    value={selectedDatasetToOverwrite}\n                    filterOption={filterAutocompleteOption}\n                    disabled={newOrOverwrite !== 2}\n                    getPopupContainer={() => document.body}\n                  />\n                </div>\n              </div>\n            </Radio.Group>\n          </div>\n        )}\n        {shouldOverwriteDataset && (\n          <div className=\"sdm-overwrite-msg\">\n            {t('Are you sure you want to overwrite this dataset?')}\n          </div>\n        )}\n      </Styles>\n    </StyledModal>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nexport const STATE_TYPE_MAP = {\n  offline: 'danger',\n  failed: 'danger',\n  pending: 'info',\n  fetching: 'info',\n  running: 'warning',\n  stopped: 'danger',\n  success: 'success',\n};\n\nexport const STATE_TYPE_MAP_LOCALIZED = {\n  offline: t('offline'),\n  failed: t('failed'),\n  pending: t('pending'),\n  fetching: t('fetching'),\n  running: t('running'),\n  stopped: t('stopped'),\n  success: t('success'),\n};\n\nexport const STATUS_OPTIONS = {\n  success: 'success',\n  failed: 'failed',\n  running: 'running',\n  offline: 'offline',\n  pending: 'pending',\n};\n\nexport const STATUS_OPTIONS_LOCALIZED = {\n  success: t('success'),\n  failed: t('failed'),\n  running: t('running'),\n  offline: t('offline'),\n  pending: t('pending'),\n};\n\nexport const TIME_OPTIONS = [\n  'now',\n  '1 hour ago',\n  '1 day ago',\n  '7 days ago',\n  '28 days ago',\n  '90 days ago',\n  '1 year ago',\n];\n\n// SqlEditor layout constants\nexport const SQL_EDITOR_GUTTER_HEIGHT = 5;\nexport const SQL_EDITOR_GUTTER_MARGIN = 3;\nexport const SQL_TOOLBAR_HEIGHT = 51;\nexport const SQL_EDITOR_LEFTBAR_WIDTH = 400;\nexport const SQL_EDITOR_PADDING = 10;\nexport const INITIAL_NORTH_PERCENT = 30;\nexport const INITIAL_SOUTH_PERCENT = 70;\nexport const SET_QUERY_EDITOR_SQL_DEBOUNCE_MS = 2000;\nexport const VALIDATION_DEBOUNCE_MS = 600;\nexport const WINDOW_RESIZE_THROTTLE_MS = 100;\n\n// kilobyte storage\nexport const KB_STORAGE = 1024;\nexport const BYTES_PER_CHAR = 2;\n\n// browser's localStorage max usage constants\nexport const LOCALSTORAGE_MAX_QUERY_AGE_MS = 24 * 60 * 60 * 1000; // 24 hours\nexport const LOCALSTORAGE_MAX_USAGE_KB = 5 * 1024; // 5M\nexport const LOCALSTORAGE_MAX_QUERY_RESULTS_KB = 1 * 1024; // 1M\nexport const LOCALSTORAGE_WARNING_THRESHOLD = 0.9;\nexport const LOCALSTORAGE_WARNING_MESSAGE_THROTTLE_MS = 8000; // danger type toast duration\n\n// autocomplete score weights\nexport const SQL_KEYWORD_AUTOCOMPLETE_SCORE = 100;\nexport const SQL_FUNCTIONS_AUTOCOMPLETE_SCORE = 90;\nexport const SCHEMA_AUTOCOMPLETE_SCORE = 60;\nexport const TABLE_AUTOCOMPLETE_SCORE = 55;\nexport const COLUMN_AUTOCOMPLETE_SCORE = 50;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { JsonObject, QueryResponse } from '@superset-ui/core';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { ToastType } from 'src/components/MessageToasts/types';\nimport { RootState } from 'src/dashboard/types';\nimport { DropdownButtonProps } from 'src/components/DropdownButton';\nimport { ButtonProps } from 'src/components/Button';\n\nexport type QueryButtonProps = DropdownButtonProps | ButtonProps;\n\n// Object as Dictionary (associative array) with Query id as the key and type Query as the value\nexport type QueryDictionary = {\n  [id: string]: QueryResponse;\n};\n\nexport interface QueryEditor {\n  id: string;\n  dbId?: number;\n  name: string;\n  schema: string;\n  autorun: boolean;\n  sql: string;\n  remoteId: number | null;\n  hideLeftBar?: boolean;\n  latestQueryId?: string | null;\n  templateParams?: string;\n  selectedText?: string;\n  queryLimit?: number;\n  description?: string;\n}\n\nexport type toastState = {\n  id: string;\n  toastType: ToastType;\n  text: string;\n  duration: number;\n  noDuplicate: boolean;\n};\n\nexport type SqlLabRootState = {\n  sqlLab: {\n    activeSouthPaneTab: string | number; // default is string; action.newQuery.id is number\n    alerts: any[];\n    databases: Record<string, any>;\n    dbConnect: boolean;\n    offline: boolean;\n    queries: Record<string, QueryResponse>;\n    queryEditors: QueryEditor[];\n    tabHistory: string[]; // default is activeTab ? [activeTab.id.toString()] : []\n    tables: Record<string, any>[];\n    queriesLastUpdate: number;\n    user: UserWithPermissionsAndRoles;\n    errorMessage: string | null;\n    unsavedQueryEditor: Partial<QueryEditor>;\n    queryCostEstimates?: Record<string, QueryCostEstimate>;\n  };\n  localStorageUsageInKilobytes: number;\n  messageToasts: toastState[];\n  common: {\n    flash_messages: string[];\n    conf: JsonObject;\n  };\n};\n\nexport type SqlLabExploreRootState = SqlLabRootState | RootState;\n\nexport const getInitialState = (state: SqlLabExploreRootState) => {\n  if (state.hasOwnProperty('sqlLab')) {\n    const {\n      sqlLab: { user },\n    } = state as SqlLabRootState;\n    return user;\n  }\n\n  const { user } = state as RootState;\n  return user as UserWithPermissionsAndRoles;\n};\n\nexport enum DatasetRadioState {\n  SAVE_NEW = 1,\n  OVERWRITE_DATASET = 2,\n}\n\nexport const EXPLORE_CHART_DEFAULT = {\n  metrics: [],\n  groupby: [],\n  time_range: 'No filter',\n  row_limit: 1000,\n};\n\nexport interface DatasetOwner {\n  first_name: string;\n  id: number;\n  last_name: string;\n  username: string;\n}\n\nexport interface DatasetOptionAutocomplete {\n  value: string;\n  datasetId: number;\n  owners: [DatasetOwner];\n}\n\nexport interface SchemaOption {\n  value: string;\n  label: string;\n  title: string;\n}\n\nexport interface QueryCostEstimate {\n  completed: string;\n  cost: Record<string, any>[];\n  error: string;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SQL_KEYWORD_AUTOCOMPLETE_SCORE } from '../constants';\n\nconst SQL_KEYWORDS = [\n  'AND',\n  'AS',\n  'ASC',\n  'AVG',\n  'BY',\n  'CASE',\n  'COUNT',\n  'CREATE',\n  'CROSS',\n  'DATABASE',\n  'DEFAULT',\n  'DELETE',\n  'DESC',\n  'DISTINCT',\n  'DROP',\n  'ELSE',\n  'END',\n  'FOREIGN',\n  'FROM',\n  'GRANT',\n  'GROUP',\n  'HAVING',\n  'IF',\n  'INNER',\n  'INSERT',\n  'JOIN',\n  'KEY',\n  'LEFT',\n  'LIMIT',\n  'MAX',\n  'MIN',\n  'NATURAL',\n  'NOT',\n  'NULL',\n  'OFFSET',\n  'ON',\n  'OR',\n  'ORDER',\n  'OUTER',\n  'PRIMARY',\n  'REFERENCES',\n  'RIGHT',\n  'SELECT',\n  'SUM',\n  'TABLE',\n  'THEN',\n  'TYPE',\n  'UNION',\n  'UPDATE',\n  'WHEN',\n  'WHERE',\n];\n\nconst SQL_DATA_TYPES = [\n  'BIGINT',\n  'BINARY',\n  'BIT',\n  'CHAR',\n  'DATE',\n  'DECIMAL',\n  'DOUBLE',\n  'FLOAT',\n  'INT',\n  'INTEGER',\n  'MONEY',\n  'NUMBER',\n  'NUMERIC',\n  'REAL',\n  'SET',\n  'TEXT',\n  'TIMESTAMP',\n  'VARCHAR',\n];\n\nconst allKeywords = SQL_KEYWORDS.concat(SQL_DATA_TYPES);\n\nconst sqlKeywords = allKeywords.map(keyword => ({\n  meta: 'sql',\n  name: keyword,\n  score: SQL_KEYWORD_AUTOCOMPLETE_SCORE,\n  value: keyword,\n}));\n\nexport default sqlKeywords;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { PropsWithChildren } from 'react';\nimport AntdAlert, { AlertProps as AntdAlertProps } from 'antd/lib/alert';\nimport { useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\n\nexport type AlertProps = PropsWithChildren<\n  AntdAlertProps & { roomBelow?: boolean }\n>;\n\nexport default function Alert(props: AlertProps) {\n  const {\n    type = 'info',\n    description,\n    showIcon = true,\n    closable = true,\n    roomBelow = false,\n    children,\n  } = props;\n\n  const theme = useTheme();\n  const { colors, typography, gridUnit } = theme;\n  const { alert, error, info, success } = colors;\n\n  let baseColor = info;\n  let AlertIcon = Icons.InfoSolid;\n  if (type === 'error') {\n    baseColor = error;\n    AlertIcon = Icons.ErrorSolid;\n  } else if (type === 'warning') {\n    baseColor = alert;\n    AlertIcon = Icons.AlertSolid;\n  } else if (type === 'success') {\n    baseColor = success;\n    AlertIcon = Icons.CircleCheckSolid;\n  }\n\n  return (\n    <AntdAlert\n      role=\"alert\"\n      showIcon={showIcon}\n      icon={<AlertIcon aria-label={`${type} icon`} />}\n      closeText={closable && <Icons.XSmall aria-label=\"close icon\" />}\n      css={{\n        marginBottom: roomBelow ? gridUnit * 4 : 0,\n        padding: `${gridUnit * 2}px ${gridUnit * 3}px`,\n        alignItems: 'flex-start',\n        border: 0,\n        backgroundColor: baseColor.light2,\n        '& .ant-alert-icon': {\n          marginRight: gridUnit * 2,\n        },\n        '& .ant-alert-message': {\n          color: baseColor.dark2,\n          fontSize: typography.sizes.m,\n          fontWeight: description\n            ? typography.weights.bold\n            : typography.weights.normal,\n        },\n        '& .ant-alert-description': {\n          color: baseColor.dark2,\n          fontSize: typography.sizes.m,\n        },\n      }}\n      {...props}\n    >\n      {children}\n    </AntdAlert>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { forwardRef } from 'react';\nimport {\n  Editor as OrigEditor,\n  IEditSession,\n  Position,\n  TextMode as OrigTextMode,\n} from 'brace';\nimport AceEditor, { IAceEditorProps } from 'react-ace';\nimport { acequire } from 'ace-builds/src-noconflict/ace';\nimport AsyncEsmComponent, {\n  PlaceholderProps,\n} from 'src/components/AsyncEsmComponent';\n\nexport interface AceCompleterKeywordData {\n  name: string;\n  value: string;\n  score: number;\n  meta: string;\n}\n\nexport type TextMode = OrigTextMode & { $id: string };\n\nexport interface AceCompleter {\n  insertMatch: (\n    data?: Editor | { value: string } | string,\n    options?: AceCompleterKeywordData,\n  ) => void;\n}\n\nexport type Editor = OrigEditor & {\n  completer: AceCompleter;\n  completers: AceCompleter[];\n};\n\nexport interface AceCompleterKeyword extends AceCompleterKeywordData {\n  completer?: AceCompleter;\n}\n\n/**\n * Async loaders to import brace modules. Must manually create call `import(...)`\n * promises because webpack can only analyze async imports statically.\n */\nconst aceModuleLoaders = {\n  'mode/sql': () => import('brace/mode/sql'),\n  'mode/markdown': () => import('brace/mode/markdown'),\n  'mode/css': () => import('brace/mode/css'),\n  'mode/json': () => import('brace/mode/json'),\n  'mode/yaml': () => import('brace/mode/yaml'),\n  'mode/html': () => import('brace/mode/html'),\n  'mode/javascript': () => import('brace/mode/javascript'),\n  'theme/textmate': () => import('brace/theme/textmate'),\n  'theme/github': () => import('brace/theme/github'),\n  'ext/language_tools': () => import('brace/ext/language_tools'),\n  'ext/searchbox': () => import('brace/ext/searchbox'),\n};\n\nexport type AceModule = keyof typeof aceModuleLoaders;\n\nexport type AsyncAceEditorProps = IAceEditorProps & {\n  keywords?: AceCompleterKeyword[];\n};\n\nexport type AceEditorMode = 'sql';\nexport type AceEditorTheme = 'textmate' | 'github';\nexport type AsyncAceEditorOptions = {\n  defaultMode?: AceEditorMode;\n  defaultTheme?: AceEditorTheme;\n  defaultTabSize?: number;\n  fontFamily?: string;\n  placeholder?: React.ComponentType<\n    PlaceholderProps & Partial<IAceEditorProps>\n  > | null;\n};\n\n/**\n * Get an async AceEditor with automatical loading of specified ace modules.\n */\nexport default function AsyncAceEditor(\n  aceModules: AceModule[],\n  {\n    defaultMode,\n    defaultTheme,\n    defaultTabSize = 2,\n    fontFamily = 'Menlo, Consolas, Courier New, Ubuntu Mono, source-code-pro, Lucida Console, monospace',\n    placeholder,\n  }: AsyncAceEditorOptions = {},\n) {\n  return AsyncEsmComponent(async () => {\n    const { default: ReactAceEditor } = await import('react-ace');\n\n    await Promise.all(aceModules.map(x => aceModuleLoaders[x]()));\n\n    const inferredMode =\n      defaultMode ||\n      aceModules.find(x => x.startsWith('mode/'))?.replace('mode/', '');\n    const inferredTheme =\n      defaultTheme ||\n      aceModules.find(x => x.startsWith('theme/'))?.replace('theme/', '');\n\n    return forwardRef<AceEditor, AsyncAceEditorProps>(\n      function ExtendedAceEditor(\n        {\n          keywords,\n          mode = inferredMode,\n          theme = inferredTheme,\n          tabSize = defaultTabSize,\n          defaultValue = '',\n          ...props\n        },\n        ref,\n      ) {\n        if (keywords) {\n          const langTools = acequire('ace/ext/language_tools');\n          const completer = {\n            getCompletions: (\n              editor: AceEditor,\n              session: IEditSession,\n              pos: Position,\n              prefix: string,\n              callback: (error: null, wordList: object[]) => void,\n            ) => {\n              // If the prefix starts with a number, don't try to autocomplete\n              if (!Number.isNaN(parseInt(prefix, 10))) {\n                return;\n              }\n              if ((session.getMode() as TextMode).$id === `ace/mode/${mode}`) {\n                callback(null, keywords);\n              }\n            },\n          };\n          langTools.setCompleters([completer]);\n        }\n        return (\n          <ReactAceEditor\n            ref={ref}\n            mode={mode}\n            theme={theme}\n            tabSize={tabSize}\n            defaultValue={defaultValue}\n            setOptions={{ fontFamily }}\n            {...props}\n          />\n        );\n      },\n    );\n  }, placeholder);\n}\n\nexport const SQLEditor = AsyncAceEditor([\n  'mode/sql',\n  'theme/github',\n  'ext/language_tools',\n  'ext/searchbox',\n]);\n\nexport const FullSQLEditor = AsyncAceEditor(\n  ['mode/sql', 'theme/github', 'ext/language_tools', 'ext/searchbox'],\n  {\n    // a custom placeholder in SQL lab for less jumpy re-renders\n    placeholder: () => {\n      const gutterBackground = '#e8e8e8'; // from ace-github theme\n      return (\n        <div\n          style={{\n            height: '100%',\n          }}\n        >\n          <div\n            style={{ width: 41, height: '100%', background: gutterBackground }}\n          />\n          {/* make it possible to resize the placeholder */}\n          <div className=\"ace_content\" />\n        </div>\n      );\n    },\n  },\n);\n\nexport const MarkdownEditor = AsyncAceEditor([\n  'mode/markdown',\n  'theme/textmate',\n]);\n\nexport const TextAreaEditor = AsyncAceEditor([\n  'mode/markdown',\n  'mode/sql',\n  'mode/json',\n  'mode/html',\n  'mode/javascript',\n  'theme/textmate',\n]);\n\nexport const CssEditor = AsyncAceEditor(['mode/css', 'theme/github']);\n\nexport const JsonEditor = AsyncAceEditor(['mode/json', 'theme/github']);\n\n/**\n * JSON or Yaml config editor.\n */\nexport const ConfigEditor = AsyncAceEditor([\n  'mode/json',\n  'mode/yaml',\n  'theme/github',\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  CSSProperties,\n  useEffect,\n  useState,\n  RefObject,\n  forwardRef,\n} from 'react';\nimport Loading from '../Loading';\n\nexport type PlaceholderProps = {\n  showLoadingForImport?: boolean;\n  width?: string | number;\n  height?: string | number;\n  placeholderStyle?: CSSProperties;\n} & {\n  [key: string]: any;\n};\n\nfunction DefaultPlaceholder({\n  width,\n  height,\n  showLoadingForImport = false,\n  placeholderStyle: style,\n}: PlaceholderProps) {\n  return (\n    // since `width` defaults to 100%, we can display the placeholder once\n    // height is specified.\n    (height && (\n      <div key=\"async-asm-placeholder\" style={{ width, height, ...style }}>\n        {showLoadingForImport && <Loading position=\"floating\" />}\n      </div>\n    )) ||\n    // `|| null` is for in case of height=0.\n    null\n  );\n}\n\n/**\n * Asynchronously import an ES module as a React component, render a placeholder\n * first (if provided) and re-render once import is complete.\n */\nexport default function AsyncEsmComponent<\n  P = PlaceholderProps,\n  M = React.ComponentType<P> | { default: React.ComponentType<P> },\n>(\n  /**\n   * A promise generator that returns the React component to render.\n   */\n  loadComponent: Promise<M> | (() => Promise<M>),\n  /**\n   * Placeholder while still importing.\n   */\n  placeholder: React.ComponentType<\n    PlaceholderProps & Partial<P>\n  > | null = DefaultPlaceholder,\n) {\n  // component props + placeholder props\n  type FullProps = P & PlaceholderProps;\n  let promise: Promise<M> | undefined;\n  let component: React.ComponentType<FullProps>;\n\n  /**\n   * Safely wait for promise, make sure the loader function only execute once.\n   */\n  function waitForPromise() {\n    if (!promise) {\n      // load component on initialization\n      promise =\n        loadComponent instanceof Promise ? loadComponent : loadComponent();\n    }\n    if (!component) {\n      promise.then(result => {\n        component = ((result as { default?: React.ComponentType<P> }).default ||\n          result) as React.ComponentType<FullProps>;\n      });\n    }\n    return promise;\n  }\n\n  type AsyncComponent = React.ForwardRefExoticComponent<\n    React.PropsWithoutRef<FullProps> &\n      React.RefAttributes<React.ComponentType<FullProps>>\n  > & {\n    preload?: typeof waitForPromise;\n  };\n\n  const AsyncComponent: AsyncComponent = forwardRef(function AsyncComponent(\n    props: FullProps,\n    ref: RefObject<React.ComponentType<FullProps>>,\n  ) {\n    const [loaded, setLoaded] = useState(component !== undefined);\n    useEffect(() => {\n      let isMounted = true;\n      if (!loaded) {\n        // update state to trigger a re-render\n        waitForPromise().then(() => {\n          if (isMounted) {\n            setLoaded(true);\n          }\n        });\n      }\n      return () => {\n        isMounted = false;\n      };\n    });\n    const Component = component || placeholder;\n    return Component ? (\n      // placeholder does not get the ref\n      <Component ref={Component === component ? ref : null} {...props} />\n    ) : null;\n  });\n  // preload the async component before rendering\n  AsyncComponent.preload = waitForPromise;\n\n  return AsyncComponent as AsyncComponent & {\n    preload: typeof waitForPromise;\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t } from '@superset-ui/core';\nimport { omit } from 'lodash';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport { DatasourcesAction } from 'src/dashboard/actions/datasources';\nimport { ChartState } from 'src/explore/types';\nimport { getFormDataFromControls } from 'src/explore/controlUtils';\nimport { HYDRATE_EXPLORE } from 'src/explore/actions/hydrateExplore';\nimport { now } from 'src/utils/dates';\nimport * as actions from './chartAction';\n\nexport const chart: ChartState = {\n  id: 0,\n  chartAlert: null,\n  chartStatus: 'loading',\n  chartStackTrace: null,\n  chartUpdateEndTime: null,\n  chartUpdateStartTime: 0,\n  latestQueryFormData: {},\n  sliceFormData: null,\n  queryController: null,\n  queriesResponse: null,\n  triggerQuery: true,\n  lastRendered: 0,\n};\n\ntype ChartActionHandler = (state: ChartState) => ChartState;\n\ntype AnyChartAction = Record<string, any>;\n\nexport default function chartReducer(\n  charts: Record<string, ChartState> = {},\n  action: AnyChartAction,\n) {\n  const actionHandlers: Record<string, ChartActionHandler> = {\n    [actions.ADD_CHART]() {\n      return {\n        ...chart,\n        ...action.chart,\n      };\n    },\n    [actions.CHART_UPDATE_SUCCEEDED](state) {\n      return {\n        ...state,\n        chartStatus: 'success',\n        chartAlert: null,\n        queriesResponse: action.queriesResponse,\n        chartUpdateEndTime: now(),\n      };\n    },\n    [actions.CHART_UPDATE_STARTED](state) {\n      return {\n        ...state,\n        chartStatus: 'loading',\n        chartStackTrace: null,\n        chartAlert: null,\n        chartUpdateEndTime: null,\n        chartUpdateStartTime: now(),\n        queryController: action.queryController,\n      };\n    },\n    [actions.CHART_UPDATE_STOPPED](state) {\n      return {\n        ...state,\n        chartStatus: 'stopped',\n        chartAlert: t('Updating chart was stopped'),\n        chartUpdateEndTime: now(),\n      };\n    },\n    [actions.CHART_RENDERING_SUCCEEDED](state) {\n      return { ...state, chartStatus: 'rendered', chartUpdateEndTime: now() };\n    },\n    [actions.CHART_RENDERING_FAILED](state) {\n      return {\n        ...state,\n        chartStatus: 'failed',\n        chartStackTrace: action.stackTrace,\n        chartAlert: t(\n          'An error occurred while rendering the visualization: %s',\n          action.error,\n        ),\n      };\n    },\n    [actions.CHART_UPDATE_FAILED](state) {\n      return {\n        ...state,\n        chartStatus: 'failed',\n        chartAlert: action.queriesResponse\n          ? action.queriesResponse?.[0]?.error\n          : t('Network error.'),\n        chartUpdateEndTime: now(),\n        queriesResponse: action.queriesResponse,\n        chartStackTrace: action.queriesResponse\n          ? action.queriesResponse?.[0]?.stacktrace\n          : null,\n      };\n    },\n    [actions.DYNAMIC_PLUGIN_CONTROLS_READY](state) {\n      const sliceFormData = getFormDataFromControls(action.controlsState);\n      return { ...state, sliceFormData };\n    },\n    [actions.TRIGGER_QUERY](state) {\n      return {\n        ...state,\n        triggerQuery: action.value,\n        chartStatus: 'loading',\n      };\n    },\n    [actions.RENDER_TRIGGERED](state) {\n      return { ...state, lastRendered: action.value };\n    },\n    [actions.UPDATE_QUERY_FORM_DATA](state) {\n      return { ...state, latestQueryFormData: action.value };\n    },\n    [actions.ANNOTATION_QUERY_STARTED](state) {\n      if (state.annotationQuery?.[action.annotation.name]) {\n        state.annotationQuery[action.annotation.name].abort();\n      }\n      const annotationQuery = {\n        ...state.annotationQuery,\n        [action.annotation.name]: action.queryController,\n      };\n      return {\n        ...state,\n        annotationQuery,\n      };\n    },\n    [actions.ANNOTATION_QUERY_SUCCESS](state) {\n      const annotationData = {\n        ...state.annotationData,\n        [action.annotation.name]: action.queryResponse.data,\n      };\n      const annotationError = { ...state.annotationError };\n      delete annotationError[action.annotation.name];\n      const annotationQuery = { ...state.annotationQuery };\n      delete annotationQuery[action.annotation.name];\n      return {\n        ...state,\n        annotationData,\n        annotationError,\n        annotationQuery,\n      };\n    },\n    [actions.ANNOTATION_QUERY_FAILED](state) {\n      const annotationData = { ...state.annotationData };\n      delete annotationData[action.annotation.name];\n      const annotationError = {\n        ...state.annotationError,\n        [action.annotation.name]: action.queryResponse\n          ? action.queryResponse.error\n          : t('Network error.'),\n      };\n      const annotationQuery = { ...state.annotationQuery };\n      delete annotationQuery[action.annotation.name];\n      return {\n        ...state,\n        annotationData,\n        annotationError,\n        annotationQuery,\n      };\n    },\n  };\n\n  /* eslint-disable no-param-reassign */\n  if (action.type === actions.REMOVE_CHART) {\n    return omit(charts, [action.key]);\n  }\n  if (action.type === actions.UPDATE_CHART_ID) {\n    const { newId, key } = action;\n    charts[newId] = {\n      ...charts[key],\n      id: newId,\n    };\n    delete charts[key];\n    return charts;\n  }\n  if (action.type === HYDRATE_DASHBOARD || action.type === HYDRATE_EXPLORE) {\n    return { ...action.data.charts };\n  }\n  if (action.type === DatasourcesAction.SET_DATASOURCES) {\n    return Object.fromEntries(\n      Object.entries(charts).map(([chartId, chart]) => [\n        chartId,\n        // some charts may not have properly handled missing datasource,\n        // causing a JS error, so we reset error message and try to re-render\n        // the chart once the datasource is fully loaded\n        chart.chartStatus === 'failed' && chart.chartStackTrace\n          ? {\n              ...chart,\n              chartStatus: '',\n              chartStackTrace: null,\n              chartAlert: null,\n            }\n          : chart,\n      ]),\n    );\n  }\n\n  if (action.type in actionHandlers) {\n    return {\n      ...charts,\n      [action.key]: actionHandlers[action.type](charts[action.key]),\n    };\n  }\n\n  return charts;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\n\nexport const CheckboxChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z\"\n        fill={theme.colors.primary.base}\n      />\n      <path\n        d=\"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z\"\n        fill=\"white\"\n      />\n    </svg>\n  );\n};\n\nexport const CheckboxHalfChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light1}\n      />\n      <path d=\"M14 10H4V8H14V10Z\" fill=\"white\" />\n    </svg>\n  );\n};\n\nexport const CheckboxUnchecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light2}\n      />\n      <path d=\"M16 2V16H2V2H16V2Z\" fill=\"white\" />\n    </svg>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport { CheckboxChecked, CheckboxUnchecked } from 'src/components/Checkbox';\n\nexport interface CheckboxProps {\n  checked: boolean;\n  onChange: (val?: boolean) => void;\n  style?: React.CSSProperties;\n  className?: string;\n}\n\nconst Styles = styled.span`\n  &,\n  & svg {\n    vertical-align: top;\n  }\n`;\n\nexport default function Checkbox({\n  checked,\n  onChange,\n  style,\n  className,\n}: CheckboxProps) {\n  return (\n    <Styles\n      style={style}\n      onClick={() => {\n        onChange(!checked);\n      }}\n      role=\"checkbox\"\n      tabIndex={0}\n      aria-checked={checked}\n      aria-label=\"Checkbox\"\n      className={className || ''}\n    >\n      {checked ? <CheckboxChecked /> : <CheckboxUnchecked />}\n    </Styles>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport { Collapse as AntdCollapse } from 'antd';\nimport { CollapseProps as AntdCollapseProps } from 'antd/lib/collapse';\n\nexport interface CollapseProps extends AntdCollapseProps {\n  light?: boolean;\n  bigger?: boolean;\n  bold?: boolean;\n  animateArrows?: boolean;\n}\n\nconst Collapse = Object.assign(\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  styled(({ light, bigger, bold, animateArrows, ...props }: CollapseProps) => (\n    <AntdCollapse {...props} />\n  ))`\n    .ant-collapse-item {\n      .ant-collapse-header {\n        font-weight: ${({ bold, theme }) =>\n          bold\n            ? theme.typography.weights.bold\n            : theme.typography.weights.normal};\n        font-size: ${({ bigger, theme }) =>\n          bigger ? `${theme.gridUnit * 4}px` : 'inherit'};\n\n        .ant-collapse-arrow svg {\n          transition: ${({ animateArrows }) =>\n            animateArrows ? 'transform 0.24s' : 'none'};\n        }\n\n        ${({ expandIconPosition }) =>\n          expandIconPosition &&\n          expandIconPosition === 'right' &&\n          `\n            .anticon.anticon-right.ant-collapse-arrow > svg {\n              transform: rotate(90deg) !important;\n            }\n          `}\n\n        ${({ light, theme }) =>\n          light &&\n          `\n            color: ${theme.colors.grayscale.light4};\n            .ant-collapse-arrow svg {\n              color: ${theme.colors.grayscale.light4};\n            }\n          `}\n\n        ${({ ghost, bordered, theme }) =>\n          ghost &&\n          bordered &&\n          `\n            border-bottom: 1px solid ${theme.colors.grayscale.light3};\n          `}\n      }\n      .ant-collapse-content {\n        .ant-collapse-content-box {\n          .loading.inline {\n            margin: ${({ theme }) => theme.gridUnit * 12}px auto;\n            display: block;\n          }\n        }\n      }\n    }\n    .ant-collapse-item-active {\n      .ant-collapse-header {\n        ${({ expandIconPosition }) =>\n          expandIconPosition &&\n          expandIconPosition === 'right' &&\n          `\n            .anticon.anticon-right.ant-collapse-arrow > svg {\n              transform: rotate(-90deg) !important;\n            }\n          `}\n      }\n    }\n  `,\n  {\n    Panel: AntdCollapse.Panel,\n  },\n);\n\nexport default Collapse;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  FunctionComponent,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n} from 'react';\nimport Alert from 'src/components/Alert';\nimport { SupersetClient, t, styled } from '@superset-ui/core';\nimport TableView, { EmptyWrapperType } from 'src/components/TableView';\nimport { ServerPagination, SortByType } from 'src/components/TableView/types';\nimport StyledModal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport { useListViewResource } from 'src/views/CRUD/hooks';\nimport Dataset from 'src/types/Dataset';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport Loading from 'src/components/Loading';\nimport { AntdInput } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport {\n  PAGE_SIZE as DATASET_PAGE_SIZE,\n  SORT_BY as DATASET_SORT_BY,\n} from 'src/features/datasets/constants';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport FacePile from '../FacePile';\n\nconst CONFIRM_WARNING_MESSAGE = t(\n  'Warning! Changing the dataset may break the chart if the metadata does not exist.',\n);\n\nconst CHANGE_WARNING_MSG = t(\n  'Changing the dataset may break the chart if the chart relies ' +\n    'on columns or metadata that does not exist in the target dataset',\n);\n\ninterface Datasource {\n  type: string;\n  id: number;\n  uid: string;\n}\n\ninterface ChangeDatasourceModalProps {\n  addDangerToast: (msg: string) => void;\n  addSuccessToast: (msg: string) => void;\n  onChange: (uid: string) => void;\n  onDatasourceSave: (datasource: object, errors?: Array<any>) => {};\n  onHide: () => void;\n  show: boolean;\n}\n\nconst Modal = styled(StyledModal)`\n  .ant-modal-body {\n    display: flex;\n    flex-direction: column;\n  }\n`;\n\nconst ConfirmModalStyled = styled.div`\n  .btn-container {\n    display: flex;\n    justify-content: flex-end;\n    padding: 0px 15px;\n    margin: 10px 0 0 0;\n  }\n\n  .confirm-modal-container {\n    margin: 9px;\n  }\n`;\n\nconst StyledSpan = styled.span`\n  cursor: pointer;\n  color: ${({ theme }) => theme.colors.primary.dark1};\n  &: hover {\n    color: ${({ theme }) => theme.colors.primary.dark2};\n  }\n`;\n\nconst ChangeDatasourceModal: FunctionComponent<ChangeDatasourceModalProps> = ({\n  addDangerToast,\n  addSuccessToast,\n  onChange,\n  onDatasourceSave,\n  onHide,\n  show,\n}) => {\n  const [filter, setFilter] = useState<any>(undefined);\n  const [pageIndex, setPageIndex] = useState<number>(0);\n  const [sortBy, setSortBy] = useState<SortByType>(DATASET_SORT_BY);\n  const [confirmChange, setConfirmChange] = useState(false);\n  const [confirmedDataset, setConfirmedDataset] = useState<Datasource>();\n  const searchRef = useRef<AntdInput>(null);\n\n  const {\n    state: { loading, resourceCollection, resourceCount },\n    fetchData,\n  } = useListViewResource<Dataset>('dataset', t('dataset'), addDangerToast);\n\n  const selectDatasource = useCallback((datasource: Datasource) => {\n    setConfirmChange(true);\n    setConfirmedDataset(datasource);\n  }, []);\n\n  const fetchDatasetPayload = {\n    pageIndex,\n    pageSize: DATASET_PAGE_SIZE,\n    filters: [],\n    sortBy,\n  };\n\n  useDebouncedEffect(\n    () => {\n      fetchData({\n        ...fetchDatasetPayload,\n        ...(filter && {\n          filters: [\n            {\n              id: 'table_name',\n              operator: 'ct',\n              value: filter,\n            },\n          ],\n        }),\n      });\n    },\n    SLOW_DEBOUNCE,\n    [filter, pageIndex, sortBy],\n  );\n\n  useEffect(() => {\n    const onEnterModal = async () => {\n      setTimeout(() => searchRef?.current?.focus(), 200);\n    };\n\n    if (show) {\n      onEnterModal();\n    }\n  }, [\n    addDangerToast,\n    fetchData,\n    onChange,\n    onDatasourceSave,\n    onHide,\n    selectDatasource,\n    show,\n  ]);\n\n  const changeSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const searchValue = event.target.value ?? '';\n    setFilter(searchValue);\n    setPageIndex(0);\n  };\n\n  const handleChangeConfirm = () => {\n    SupersetClient.get({\n      endpoint: `/api/v1/dataset/${confirmedDataset?.id}`,\n    })\n      .then(({ json }) => {\n        // eslint-disable-next-line no-param-reassign\n        json.result.type = 'table';\n        onDatasourceSave(json.result);\n        onChange(`${confirmedDataset?.id}__table`);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(\n          ({ error, message }: { error: any; message: string }) => {\n            const errorMessage = error\n              ? error.error || error.statusText || error\n              : message;\n            addDangerToast(errorMessage);\n          },\n        );\n      });\n    onHide();\n    addSuccessToast(t('Successfully changed dataset!'));\n  };\n\n  const handlerCancelConfirm = () => {\n    setConfirmChange(false);\n  };\n\n  const columns = [\n    {\n      Cell: ({ row: { original } }: any) => (\n        <StyledSpan\n          role=\"button\"\n          tabIndex={0}\n          data-test=\"datasource-link\"\n          onClick={() => selectDatasource({ type: 'table', ...original })}\n        >\n          {original?.table_name}\n        </StyledSpan>\n      ),\n      Header: t('Name'),\n      accessor: 'table_name',\n    },\n    {\n      Header: t('Type'),\n      accessor: 'kind',\n      disableSortBy: true,\n    },\n    {\n      Header: t('Schema'),\n      accessor: 'schema',\n    },\n    {\n      Header: t('Connection'),\n      accessor: 'database.database_name',\n      disableSortBy: true,\n    },\n    {\n      Cell: ({\n        row: {\n          original: { owners = [] },\n        },\n      }: any) => <FacePile users={owners} />,\n      Header: t('Owners'),\n      id: 'owners',\n      disableSortBy: true,\n    },\n  ];\n\n  const onServerPagination = (args: ServerPagination) => {\n    setPageIndex(args.pageIndex);\n    if (args.sortBy) {\n      // ensure default sort by\n      setSortBy(args.sortBy.length > 0 ? args.sortBy : DATASET_SORT_BY);\n    }\n  };\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      responsive\n      title={t('Swap dataset')}\n      width={confirmChange ? '432px' : ''}\n      height={confirmChange ? 'auto' : '540px'}\n      hideFooter={!confirmChange}\n      footer={\n        <>\n          {confirmChange && (\n            <ConfirmModalStyled>\n              <div className=\"btn-container\">\n                <Button onClick={handlerCancelConfirm}>{t('Cancel')}</Button>\n                <Button\n                  className=\"proceed-btn\"\n                  buttonStyle=\"primary\"\n                  onClick={handleChangeConfirm}\n                >\n                  {t('Proceed')}\n                </Button>\n              </div>\n            </ConfirmModalStyled>\n          )}\n        </>\n      }\n    >\n      <>\n        {!confirmChange && (\n          <>\n            <Alert\n              roomBelow\n              type=\"warning\"\n              css={theme => ({ marginBottom: theme.gridUnit * 4 })}\n              message={\n                <>\n                  <strong>{t('Warning!')}</strong> {CHANGE_WARNING_MSG}\n                </>\n              }\n            />\n            <Input\n              ref={searchRef}\n              type=\"text\"\n              value={filter}\n              placeholder={t('Search / Filter')}\n              onChange={changeSearch}\n            />\n            {loading && <Loading />}\n            {!loading && (\n              <TableView\n                columns={columns}\n                data={resourceCollection}\n                pageSize={DATASET_PAGE_SIZE}\n                initialPageIndex={pageIndex}\n                initialSortBy={sortBy}\n                totalCount={resourceCount}\n                onServerPagination={onServerPagination}\n                className=\"table-condensed\"\n                emptyWrapperType={EmptyWrapperType.Small}\n                serverPagination\n                isPaginationSticky\n                scrollTable\n              />\n            )}\n          </>\n        )}\n        {confirmChange && <>{CONFIRM_WARNING_MESSAGE}</>}\n      </>\n    </Modal>\n  );\n};\n\nexport default withToasts(ChangeDatasourceModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FunctionComponent, useState, useRef } from 'react';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport {\n  FeatureFlag,\n  isDefined,\n  Metric,\n  styled,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport AsyncEsmComponent from 'src/components/AsyncEsmComponent';\nimport { isFeatureEnabled } from 'src/featureFlags';\n\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { useSelector } from 'react-redux';\n\nconst DatasourceEditor = AsyncEsmComponent(() => import('./DatasourceEditor'));\n\nconst StyledDatasourceModal = styled(Modal)`\n  .modal-content {\n    height: 900px;\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .modal-header {\n    flex: 0 1 auto;\n  }\n  .modal-body {\n    flex: 1 1 auto;\n    overflow: auto;\n  }\n\n  .modal-footer {\n    flex: 0 1 auto;\n  }\n`;\n\ninterface DatasourceModalProps {\n  addSuccessToast: (msg: string) => void;\n  datasource: any;\n  onChange: () => {};\n  onDatasourceSave: (datasource: object, errors?: Array<any>) => {};\n  onHide: () => {};\n  show: boolean;\n}\n\nfunction buildExtraJsonObject(item: Record<string, unknown>) {\n  const certification =\n    item?.certified_by || item?.certification_details\n      ? {\n          certified_by: item?.certified_by,\n          details: item?.certification_details,\n        }\n      : undefined;\n  return JSON.stringify({\n    certification,\n    warning_markdown: item?.warning_markdown,\n  });\n}\n\nconst DatasourceModal: FunctionComponent<DatasourceModalProps> = ({\n  addSuccessToast,\n  datasource,\n  onDatasourceSave,\n  onHide,\n  show,\n}) => {\n  const [currentDatasource, setCurrentDatasource] = useState({\n    ...datasource,\n    metrics: datasource?.metrics?.map((metric: Metric) => ({\n      ...metric,\n      currency: JSON.parse(metric.currency || 'null'),\n    })),\n  });\n  const currencies = useSelector<\n    {\n      common: {\n        currencies: string[];\n      };\n    },\n    string[]\n  >(state => state.common?.currencies);\n  const [errors, setErrors] = useState<any[]>([]);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const dialog = useRef<any>(null);\n  const [modal, contextHolder] = Modal.useModal();\n\n  const onConfirmSave = () => {\n    // Pull out extra fields into the extra object\n    const schema =\n      currentDatasource.tableSelector?.schema ||\n      currentDatasource.databaseSelector?.schema ||\n      currentDatasource.schema;\n\n    setIsSaving(true);\n    SupersetClient.put({\n      endpoint: `/api/v1/dataset/${currentDatasource.id}`,\n      jsonPayload: {\n        table_name: currentDatasource.table_name,\n        database_id: currentDatasource.database?.id,\n        sql: currentDatasource.sql,\n        filter_select_enabled: currentDatasource.filter_select_enabled,\n        fetch_values_predicate: currentDatasource.fetch_values_predicate,\n        schema,\n        description: currentDatasource.description,\n        main_dttm_col: currentDatasource.main_dttm_col,\n        offset: currentDatasource.offset,\n        default_endpoint: currentDatasource.default_endpoint,\n        cache_timeout:\n          currentDatasource.cache_timeout === ''\n            ? null\n            : currentDatasource.cache_timeout,\n        is_sqllab_view: currentDatasource.is_sqllab_view,\n        template_params: currentDatasource.template_params,\n        extra: currentDatasource.extra,\n        is_managed_externally: currentDatasource.is_managed_externally,\n        external_url: currentDatasource.external_url,\n        metrics: currentDatasource?.metrics?.map(\n          (metric: Record<string, unknown>) => {\n            const metricBody: any = {\n              expression: metric.expression,\n              description: metric.description,\n              metric_name: metric.metric_name,\n              metric_type: metric.metric_type,\n              d3format: metric.d3format || null,\n              currency: !isDefined(metric.currency)\n                ? null\n                : JSON.stringify(metric.currency),\n              verbose_name: metric.verbose_name,\n              warning_text: metric.warning_text,\n              uuid: metric.uuid,\n              extra: buildExtraJsonObject(metric),\n            };\n            if (!Number.isNaN(Number(metric.id))) {\n              metricBody.id = metric.id;\n            }\n            return metricBody;\n          },\n        ),\n        columns: currentDatasource?.columns?.map(\n          (column: Record<string, unknown>) => ({\n            id: typeof column.id === 'number' ? column.id : undefined,\n            column_name: column.column_name,\n            type: column.type,\n            advanced_data_type: column.advanced_data_type,\n            verbose_name: column.verbose_name,\n            description: column.description,\n            expression: column.expression,\n            filterable: column.filterable,\n            groupby: column.groupby,\n            is_active: column.is_active,\n            is_dttm: column.is_dttm,\n            python_date_format: column.python_date_format || null,\n            uuid: column.uuid,\n            extra: buildExtraJsonObject(column),\n          }),\n        ),\n        owners: currentDatasource.owners.map(\n          (o: Record<string, number>) => o.value || o.id,\n        ),\n      },\n    })\n      .then(() => {\n        addSuccessToast(t('The dataset has been saved'));\n        return SupersetClient.get({\n          endpoint: `/api/v1/dataset/${currentDatasource?.id}`,\n        });\n      })\n      .then(({ json }) => {\n        // eslint-disable-next-line no-param-reassign\n        json.result.type = 'table';\n        onDatasourceSave({\n          ...json.result,\n          owners: currentDatasource.owners,\n        });\n        onHide();\n      })\n      .catch(response => {\n        setIsSaving(false);\n        getClientErrorObject(response).then(({ error }) => {\n          modal.error({\n            title: t('Error'),\n            content: error || t('An error has occurred'),\n            okButtonProps: { danger: true, className: 'btn-danger' },\n          });\n        });\n      });\n  };\n\n  const onDatasourceChange = (data: Record<string, any>, err: Array<any>) => {\n    setCurrentDatasource({\n      ...data,\n      metrics: data?.metrics.map((metric: Record<string, unknown>) => ({\n        ...metric,\n        is_certified: metric?.certified_by || metric?.certification_details,\n      })),\n    });\n    setErrors(err);\n  };\n\n  const renderSaveDialog = () => (\n    <div>\n      <Alert\n        css={theme => ({\n          marginTop: theme.gridUnit * 4,\n          marginBottom: theme.gridUnit * 4,\n        })}\n        type=\"warning\"\n        showIcon\n        message={t(`The dataset configuration exposed here\n                affects all the charts using this dataset.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways.`)}\n      />\n      {t('Are you sure you want to save and apply changes?')}\n    </div>\n  );\n\n  const onClickSave = () => {\n    dialog.current = modal.confirm({\n      title: t('Confirm save'),\n      content: renderSaveDialog(),\n      onOk: onConfirmSave,\n      icon: null,\n      okText: t('OK'),\n      cancelText: t('Cancel'),\n    });\n  };\n\n  const showLegacyDatasourceEditor = !isFeatureEnabled(\n    FeatureFlag.DISABLE_LEGACY_DATASOURCE_EDITOR,\n  );\n\n  return (\n    <StyledDatasourceModal\n      show={show}\n      onHide={onHide}\n      title={\n        <span>\n          {t('Edit Dataset ')}\n          <strong>{currentDatasource.table_name}</strong>\n        </span>\n      }\n      maskClosable={!isEditing}\n      footer={\n        <>\n          {showLegacyDatasourceEditor && (\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"default\"\n              data-test=\"datasource-modal-legacy-edit\"\n              className=\"m-r-5\"\n              onClick={() => {\n                window.location.href =\n                  currentDatasource.edit_url || currentDatasource.url;\n              }}\n            >\n              {t('Use legacy datasource editor')}\n            </Button>\n          )}\n          <Button\n            data-test=\"datasource-modal-cancel\"\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={onHide}\n          >\n            {t('Cancel')}\n          </Button>\n          <Button\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            data-test=\"datasource-modal-save\"\n            onClick={onClickSave}\n            disabled={\n              isSaving ||\n              errors.length > 0 ||\n              currentDatasource.is_managed_externally\n            }\n            tooltip={\n              currentDatasource.is_managed_externally\n                ? t(\n                    \"This dataset is managed externally, and can't be edited in Superset\",\n                  )\n                : ''\n            }\n          >\n            {t('Save')}\n          </Button>\n        </>\n      }\n      responsive\n    >\n      <DatasourceEditor\n        showLoadingForImport\n        height={500}\n        datasource={currentDatasource}\n        onChange={onDatasourceChange}\n        setIsEditing={setIsEditing}\n        currencies={currencies}\n      />\n      {contextHolder}\n    </StyledDatasourceModal>\n  );\n};\n\nexport default withToasts(DatasourceModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DatePicker as AntdDatePicker } from 'antd';\nimport { styled } from '@superset-ui/core';\n\nconst AntdRangePicker = AntdDatePicker.RangePicker;\n\nexport const RangePicker = styled(AntdRangePicker)`\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const DatePicker = AntdDatePicker;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useContext, useEffect, useReducer } from 'react';\nimport {\n  ChartMetadata,\n  defineSharedModules,\n  FeatureFlag,\n  getChartMetadataRegistry,\n  logging,\n  makeApi,\n} from '@superset-ui/core';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { omitBy } from 'lodash';\n\nconst metadataRegistry = getChartMetadataRegistry();\n\nexport type PluginContextType = {\n  loading: boolean;\n  /** These are actually only the dynamic plugins */\n  dynamicPlugins: {\n    [key: string]: {\n      key: string;\n      mounting: boolean;\n      error: null | Error;\n    };\n  };\n  keys: string[];\n  /** Mounted means the plugin's js bundle has been imported */\n  mountedPluginMetadata: Record<string, ChartMetadata>;\n  fetchAll: () => void;\n};\n\nconst dummyPluginContext: PluginContextType = {\n  loading: true,\n  dynamicPlugins: {},\n  keys: [],\n  mountedPluginMetadata: {},\n  fetchAll: () => {},\n};\n\n/**\n * It is highly recommended to use the usePluginContext hook instead.\n * @see usePluginContext\n */\nexport const PluginContext = React.createContext(dummyPluginContext);\n\n/**\n * The plugin context provides info about what dynamic plugins are available.\n * It also provides loading info for the plugins' javascript bundles.\n *\n * Note: This does not include any information about static plugins.\n * Those are compiled into the Superset bundle at build time.\n * Dynamic plugins are added by the end user and can be any webhosted javascript.\n */\nexport const usePluginContext = () => useContext(PluginContext);\n\n// the plugin returned from the API\ntype Plugin = {\n  name: string;\n  key: string;\n  bundle_url: string;\n  id: number;\n};\n\n// when a plugin completes loading\ntype CompleteAction = {\n  type: 'complete';\n  key: string;\n  error: null | Error;\n};\n\n// when plugins start loading\ntype BeginAction = {\n  type: 'begin';\n  keys: string[];\n};\n\ntype ChangedKeysAction = {\n  type: 'changed keys';\n};\n\ntype PluginAction = BeginAction | CompleteAction | ChangedKeysAction;\n\nfunction getRegistryData() {\n  return {\n    keys: metadataRegistry.keys(),\n    mountedPluginMetadata: omitBy(\n      metadataRegistry.getMap(),\n      value => value === undefined,\n    ) as Record<string, ChartMetadata>, // cast required to get rid of undefined values\n  };\n}\n\nfunction pluginContextReducer(\n  state: PluginContextType,\n  action: PluginAction,\n): PluginContextType {\n  switch (action.type) {\n    case 'begin': {\n      const plugins = { ...state.dynamicPlugins };\n      action.keys.forEach(key => {\n        plugins[key] = { key, error: null, mounting: true };\n      });\n      return {\n        ...state,\n        loading: action.keys.length > 0,\n        dynamicPlugins: plugins,\n      };\n    }\n    case 'complete': {\n      return {\n        ...state,\n        loading: Object.values(state.dynamicPlugins).some(\n          plugin => plugin.mounting && plugin.key !== action.key,\n        ),\n        dynamicPlugins: {\n          ...state.dynamicPlugins,\n          [action.key]: {\n            key: action.key,\n            mounting: false,\n            error: action.error,\n          },\n        },\n      };\n    }\n    case 'changed keys': {\n      return {\n        ...state,\n        ...getRegistryData(),\n      };\n    }\n    default:\n      return state;\n  }\n}\n\nconst pluginApi = makeApi<{}, { result: Plugin[] }>({\n  method: 'GET',\n  endpoint: '/dynamic-plugins/api/read',\n});\n\nconst sharedModules = {\n  react: () => import('react'),\n  lodash: () => import('lodash'),\n  'react-dom': () => import('react-dom'),\n  '@superset-ui/chart-controls': () => import('@superset-ui/chart-controls'),\n  '@superset-ui/core': () => import('@superset-ui/core'),\n};\n\nexport const DynamicPluginProvider: React.FC = ({ children }) => {\n  const [pluginState, dispatch] = useReducer(\n    pluginContextReducer,\n    dummyPluginContext,\n    state => ({\n      ...state,\n      ...getRegistryData(),\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      fetchAll,\n      loading: isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS),\n      // TODO: Write fetchByKeys\n    }),\n  );\n\n  // For now, we fetch all the plugins at the same time.\n  // In the future it would be nice to fetch on an as-needed basis.\n  // That will most likely depend on having a json manifest for each plugin.\n  async function fetchAll() {\n    try {\n      await defineSharedModules(sharedModules);\n      const { result: plugins } = await pluginApi({});\n      dispatch({ type: 'begin', keys: plugins.map(plugin => plugin.key) });\n      await Promise.all(\n        plugins.map(async plugin => {\n          let error: Error | null = null;\n          try {\n            await import(/* webpackIgnore: true */ plugin.bundle_url);\n          } catch (err) {\n            logging.error(\n              `Failed to load plugin ${plugin.key} with the following error:`,\n              err.stack,\n            );\n            error = err;\n          }\n          dispatch({\n            type: 'complete',\n            key: plugin.key,\n            error,\n          });\n        }),\n      );\n    } catch (error) {\n      logging.error('Failed to load dynamic plugins', error.stack || error);\n    }\n  }\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS)) {\n      fetchAll();\n    }\n    const registryListener = () => {\n      dispatch({ type: 'changed keys' });\n    };\n    metadataRegistry.addListener(registryListener);\n    return () => {\n      metadataRegistry.removeListener(registryListener);\n    };\n  }, []);\n\n  return (\n    <PluginContext.Provider value={pluginState}>\n      {children}\n    </PluginContext.Provider>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { ReactNode, SyntheticEvent } from 'react';\nimport { styled, css, SupersetTheme, t } from '@superset-ui/core';\nimport { Empty } from 'src/components';\nimport Button from 'src/components/Button';\n\nexport enum EmptyStateSize {\n  Small,\n  Medium,\n  Big,\n}\n\nexport interface EmptyStateSmallProps {\n  title: ReactNode;\n  description?: ReactNode;\n  image?: ReactNode;\n}\n\nexport interface EmptyStateProps extends EmptyStateSmallProps {\n  buttonText?: ReactNode;\n  buttonAction?: React.MouseEventHandler<HTMLElement>;\n  className?: string;\n}\n\nexport interface ImageContainerProps {\n  image: ReactNode;\n  size: EmptyStateSize;\n}\n\nconst EmptyStateContainer = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    align-items: center;\n    justify-content: center;\n    padding: ${theme.gridUnit * 4}px;\n    text-align: center;\n\n    & .ant-empty-image svg {\n      width: auto;\n    }\n\n    & a,\n    & span[role='button'] {\n      color: inherit;\n      text-decoration: underline;\n      &:hover {\n        color: ${theme.colors.grayscale.base};\n      }\n    }\n  `}\n`;\n\nconst TextContainer = styled.div``;\n\nconst Title = styled.p`\n  ${({ theme }) => css`\n    font-size: ${theme.typography.sizes.m}px;\n    color: ${theme.colors.grayscale.light1};\n    margin: ${theme.gridUnit * 2}px 0 0 0;\n    font-weight: ${theme.typography.weights.bold};\n  `}\n`;\n\nconst BigTitle = styled(Title)`\n  ${({ theme }) => css`\n    font-size: ${theme.typography.sizes.l}px;\n    color: ${theme.colors.grayscale.light1};\n    margin-top: ${theme.gridUnit * 4}px;\n  `}\n`;\n\nconst Description = styled.p`\n  ${({ theme }) => css`\n    font-size: ${theme.typography.sizes.s}px;\n    color: ${theme.colors.grayscale.light1};\n    margin: ${theme.gridUnit * 2}px 0 0 0;\n  `}\n`;\n\nconst BigDescription = styled(Description)`\n  ${({ theme }) => css`\n    font-size: ${theme.typography.sizes.m}px;\n  `}\n`;\n\nconst SmallDescription = styled(Description)`\n  ${({ theme }) => css`\n    margin-top: ${theme.gridUnit}px;\n    line-height: 1.2;\n  `}\n`;\n\nconst ActionButton = styled(Button)`\n  ${({ theme }) => css`\n    margin-top: ${theme.gridUnit * 4}px;\n    z-index: 1;\n  `}\n`;\n\nconst getImage = (image: string | ReactNode) =>\n  typeof image === 'string' ? `/static/assets/images/${image}` : image;\n\nconst getImageHeight = (size: EmptyStateSize) => {\n  switch (size) {\n    case EmptyStateSize.Small:\n      return { height: '50px' };\n    case EmptyStateSize.Medium:\n      return { height: '80px' };\n    case EmptyStateSize.Big:\n      return { height: '150px' };\n    default:\n      return { height: '50px' };\n  }\n};\n\nconst ImageContainer = ({ image, size }: ImageContainerProps) => (\n  <Empty\n    description={false}\n    image={getImage(image)}\n    imageStyle={getImageHeight(size)}\n  />\n);\n\nconst handleMouseDown = (e: SyntheticEvent) => {\n  e.preventDefault();\n  e.stopPropagation();\n};\n\nexport const EmptyStateBig = ({\n  title,\n  image,\n  description,\n  buttonAction,\n  buttonText,\n  className,\n}: EmptyStateProps) => (\n  <EmptyStateContainer className={className}>\n    {image && <ImageContainer image={image} size={EmptyStateSize.Big} />}\n    <TextContainer\n      css={(theme: SupersetTheme) => css`\n        max-width: ${theme.gridUnit * 150}px;\n      `}\n    >\n      <BigTitle>{title}</BigTitle>\n      {description && <BigDescription>{description}</BigDescription>}\n      {buttonAction && buttonText && (\n        <ActionButton\n          buttonStyle=\"primary\"\n          onClick={buttonAction}\n          onMouseDown={handleMouseDown}\n        >\n          {buttonText}\n        </ActionButton>\n      )}\n    </TextContainer>\n  </EmptyStateContainer>\n);\n\nexport const EmptyStateMedium = ({\n  title,\n  image,\n  description,\n  buttonAction,\n  buttonText,\n}: EmptyStateProps) => (\n  <EmptyStateContainer>\n    {image && <ImageContainer image={image} size={EmptyStateSize.Medium} />}\n    <TextContainer\n      css={(theme: SupersetTheme) => css`\n        max-width: ${theme.gridUnit * 100}px;\n      `}\n    >\n      <Title>{title}</Title>\n      {description && <Description>{description}</Description>}\n      {buttonText && buttonAction && (\n        <ActionButton\n          buttonStyle=\"primary\"\n          onClick={buttonAction}\n          onMouseDown={handleMouseDown}\n        >\n          {buttonText}\n        </ActionButton>\n      )}\n    </TextContainer>\n  </EmptyStateContainer>\n);\n\nexport const EmptyStateSmall = ({\n  title,\n  image,\n  description,\n}: EmptyStateSmallProps) => (\n  <EmptyStateContainer>\n    {image && <ImageContainer image={image} size={EmptyStateSize.Small} />}\n    <TextContainer\n      css={(theme: SupersetTheme) => css`\n        max-width: ${theme.gridUnit * 75}px;\n      `}\n    >\n      <Title>{title}</Title>\n      {description && <SmallDescription>{description}</SmallDescription>}\n    </TextContainer>\n  </EmptyStateContainer>\n);\n\nconst TRANSLATIONS = {\n  NO_DATABASES_MATCH_TITLE: t('No databases match your search'),\n  NO_DATABASES_AVAILABLE_TITLE: t('There are no databases available'),\n  MANAGE_YOUR_DATABASES_TEXT: t('Manage your databases'),\n  HERE_TEXT: t('here'),\n};\n\nexport const emptyStateComponent = (emptyResultsWithSearch: boolean) => (\n  <EmptyStateSmall\n    image=\"empty.svg\"\n    title={\n      emptyResultsWithSearch\n        ? TRANSLATIONS.NO_DATABASES_MATCH_TITLE\n        : TRANSLATIONS.NO_DATABASES_AVAILABLE_TITLE\n    }\n    description={\n      <p>\n        {TRANSLATIONS.MANAGE_YOUR_DATABASES_TEXT}{' '}\n        <a href=\"/databaseview/list\">{TRANSLATIONS.HERE_TEXT}</a>\n      </p>\n    }\n  />\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport getErrorMessageComponentRegistry from './getErrorMessageComponentRegistry';\nimport { SupersetError, ErrorSource } from './types';\nimport ErrorAlert from './ErrorAlert';\n\nconst DEFAULT_TITLE = t('Unexpected error');\n\ntype Props = {\n  title?: string;\n  error?: SupersetError;\n  link?: string;\n  subtitle?: React.ReactNode;\n  copyText?: string;\n  stackTrace?: string;\n  source?: ErrorSource;\n  description?: string;\n  errorMitigationFunction?: () => void;\n  fallback?: React.ReactNode;\n};\n\nexport default function ErrorMessageWithStackTrace({\n  title = DEFAULT_TITLE,\n  error,\n  subtitle,\n  copyText,\n  link,\n  stackTrace,\n  source,\n  description,\n  fallback,\n}: Props) {\n  // Check if a custom error message component was registered for this message\n  if (error) {\n    const ErrorMessageComponent = getErrorMessageComponentRegistry().get(\n      error.error_type,\n    );\n    if (ErrorMessageComponent) {\n      return (\n        <ErrorMessageComponent\n          error={error}\n          source={source}\n          subtitle={subtitle}\n        />\n      );\n    }\n  }\n\n  if (fallback) {\n    return <>{fallback}</>;\n  }\n\n  return (\n    <ErrorAlert\n      level=\"warning\"\n      title={title}\n      subtitle={subtitle}\n      copyText={copyText}\n      description={description}\n      source={source}\n      body={\n        link || stackTrace ? (\n          <>\n            {link && (\n              <a href={link} target=\"_blank\" rel=\"noopener noreferrer\">\n                (Request Access)\n              </a>\n            )}\n            <br />\n            {stackTrace && <pre>{stackTrace}</pre>}\n          </>\n        ) : undefined\n      }\n    />\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport {\n  getCategoricalSchemeRegistry,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Avatar } from 'src/components';\nimport { getRandomColor } from './utils';\n\ninterface FacePileProps {\n  users: { first_name: string; last_name: string; id: number }[];\n  maxCount?: number;\n}\n\nconst colorList = getCategoricalSchemeRegistry().get()?.colors ?? [];\n\nconst customAvatarStyler = (theme: SupersetTheme) => `\n  width: ${theme.gridUnit * 6}px;\n  height: ${theme.gridUnit * 6}px;\n  line-height: ${theme.gridUnit * 6}px;\n  font-size: ${theme.typography.sizes.m}px;\n`;\n\nconst StyledAvatar = styled(Avatar)`\n  ${({ theme }) => customAvatarStyler(theme)}\n`;\n\n// to apply styling to the maxCount avatar\nconst StyledGroup = styled(Avatar.Group)`\n  .ant-avatar {\n    ${({ theme }) => customAvatarStyler(theme)}\n  }\n`;\n\nexport default function FacePile({ users, maxCount = 4 }: FacePileProps) {\n  return (\n    <StyledGroup maxCount={maxCount}>\n      {users.map(({ first_name, last_name, id }) => {\n        const name = `${first_name} ${last_name}`;\n        const uniqueKey = `${id}-${first_name}-${last_name}`;\n        const color = getRandomColor(uniqueKey, colorList);\n        return (\n          <Tooltip key={name} title={name} placement=\"top\">\n            <StyledAvatar\n              key={name}\n              style={{\n                backgroundColor: color,\n                borderColor: color,\n              }}\n            >\n              {first_name?.[0]?.toLocaleUpperCase()}\n              {last_name?.[0]?.toLocaleUpperCase()}\n            </StyledAvatar>\n          </Tooltip>\n        );\n      })}\n    </StyledGroup>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// https://en.wikipedia.org/wiki/Linear_congruential_generator\nfunction stringAsciiPRNG(value: string, m: number) {\n  // Xn+1 = (a * Xn + c) % m\n  // 0 < a < m\n  // 0 <= c < m\n  // 0 <= X0 < m\n\n  const charCodes = [...value].map(letter => letter.charCodeAt(0));\n  const len = charCodes.length;\n\n  const a = (len % (m - 1)) + 1;\n  const c = charCodes.reduce((current, next) => current + next) % m;\n\n  let random = charCodes[0] % m;\n\n  [...new Array(len)].forEach(() => {\n    random = (a * random + c) % m;\n  });\n\n  return random;\n}\n\nexport function getRandomColor(sampleValue: string, colorList: string[]) {\n  // if no value is passed, always return transparent color for consistency\n  if (!sampleValue) return 'transparent';\n\n  // value based random color index,\n  // ensuring the same sampleValue always resolves to the same color\n  return colorList[stringAsciiPRNG(sampleValue, colorList.length)];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport Form from 'antd/lib/form';\nimport { styled } from '@superset-ui/core';\n\nconst StyledItem = styled(Form.Item)`\n  ${({ theme }) => `\n    .ant-form-item-label {\n      padding-bottom: ${theme.gridUnit}px;\n      & > label {\n        text-transform: uppercase;\n        font-size: ${theme.typography.sizes.s}px;\n        color: ${theme.colors.grayscale.base};\n\n        &.ant-form-item-required:not(.ant-form-item-required-mark-optional) {\n          &::before {\n            display: none;\n          }\n          &::after {\n            display: inline-block;\n            color: ${theme.colors.error.base};\n            font-size: ${theme.typography.sizes.s}px;\n            content: '*';\n          }\n        }\n      }\n    }\n  `}\n`;\n\nexport default StyledItem;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { styled } from '@superset-ui/core';\n\nexport type FormLabelProps = {\n  children: ReactNode;\n  htmlFor?: string;\n  required?: boolean;\n  className?: string;\n};\n\nconst Label = styled.label`\n  text-transform: uppercase;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst RequiredLabel = styled.label`\n  text-transform: uppercase;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n  &::after {\n    display: inline-block;\n    margin-left: ${({ theme }) => theme.gridUnit}px;\n    color: ${({ theme }) => theme.colors.error.base};\n    font-size: ${({ theme }) => theme.typography.sizes.m}px;\n    content: '*';\n  }\n`;\n\nexport default function FormLabel({\n  children,\n  htmlFor,\n  required = false,\n  className,\n}: FormLabelProps) {\n  const StyledLabel = required ? RequiredLabel : Label;\n  return (\n    <StyledLabel htmlFor={htmlFor} className={className}>\n      {children}\n    </StyledLabel>\n  );\n}\n","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgError(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M12 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm0 8a1 1 0 100 2 1 1 0 000-2zm9.71-7.44l-5.27-5.27a1.05 1.05 0 00-.71-.29H8.27a1.05 1.05 0 00-.71.29L2.29 7.56a1.05 1.05 0 00-.29.71v7.46c.004.265.107.518.29.71l5.27 5.27c.192.183.445.286.71.29h7.46a1.05 1.05 0 00.71-.29l5.27-5.27a1.05 1.05 0 00.29-.71V8.27a1.05 1.05 0 00-.29-.71zM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4h6.62L20 8.69v6.62z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgError;","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { Input, Tooltip } from 'antd';\nimport { styled, css, SupersetTheme, t } from '@superset-ui/core';\nimport InfoTooltip from 'src/components/InfoTooltip';\nimport Icons from 'src/components/Icons';\nimport errorIcon from 'src/assets/images/icons/error.svg';\nimport FormItem from './FormItem';\nimport FormLabel from './FormLabel';\n\nexport interface LabeledErrorBoundInputProps {\n  label?: string;\n  validationMethods:\n    | { onBlur: (value: any) => void }\n    | { onChange: (value: any) => void };\n  errorMessage?: string | null;\n  helpText?: string;\n  required?: boolean;\n  hasTooltip?: boolean;\n  tooltipText?: string | null;\n  id?: string;\n  classname?: string;\n  visibilityToggle?: boolean;\n  [x: string]: any;\n}\n\nconst StyledInput = styled(Input)`\n  margin: ${({ theme }) => `${theme.gridUnit}px 0 ${theme.gridUnit * 2}px`};\n`;\n\nconst StyledInputPassword = styled(Input.Password)`\n  margin: ${({ theme }) => `${theme.gridUnit}px 0 ${theme.gridUnit * 2}px`};\n`;\n\nconst alertIconStyles = (theme: SupersetTheme, hasError: boolean) => css`\n  .ant-form-item-children-icon {\n    display: none;\n  }\n  ${hasError &&\n  `.ant-form-item-control-input-content {\n      position: relative;\n      &:after {\n        content: ' ';\n        display: inline-block;\n        background: ${theme.colors.error.base};\n        mask: url(${errorIcon});\n        mask-size: cover;\n        width: ${theme.gridUnit * 4}px;\n        height: ${theme.gridUnit * 4}px;\n        position: absolute;\n        right: ${theme.gridUnit * 1.25}px;\n        top: ${theme.gridUnit * 2.75}px;\n      }\n    }`}\n`;\n\nconst StyledFormGroup = styled('div')`\n  input::-webkit-outer-spin-button,\n  input::-webkit-inner-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n  }\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  .ant-form-item {\n    margin-bottom: 0;\n  }\n`;\n\nconst StyledAlignment = styled.div`\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledFormLabel = styled(FormLabel)`\n  margin-bottom: 0;\n`;\n\nconst iconReset = css`\n  &.anticon > * {\n    line-height: 0;\n  }\n`;\n\nconst LabeledErrorBoundInput = ({\n  label,\n  validationMethods,\n  errorMessage,\n  helpText,\n  required = false,\n  hasTooltip = false,\n  tooltipText,\n  id,\n  className,\n  visibilityToggle,\n  ...props\n}: LabeledErrorBoundInputProps) => (\n  <StyledFormGroup className={className}>\n    <StyledAlignment>\n      <StyledFormLabel htmlFor={id} required={required}>\n        {label}\n      </StyledFormLabel>\n      {hasTooltip && (\n        <InfoTooltip tooltip={`${tooltipText}`} viewBox=\"0 -1 24 24\" />\n      )}\n    </StyledAlignment>\n    <FormItem\n      css={(theme: SupersetTheme) => alertIconStyles(theme, !!errorMessage)}\n      validateTrigger={Object.keys(validationMethods)}\n      validateStatus={errorMessage ? 'error' : 'success'}\n      help={errorMessage || helpText}\n      hasFeedback={!!errorMessage}\n    >\n      {visibilityToggle || props.name === 'password' ? (\n        <StyledInputPassword\n          {...props}\n          {...validationMethods}\n          iconRender={visible =>\n            visible ? (\n              <Tooltip title={t('Hide password.')}>\n                <Icons.EyeInvisibleOutlined iconSize=\"m\" css={iconReset} />\n              </Tooltip>\n            ) : (\n              <Tooltip title={t('Show password.')}>\n                <Icons.EyeOutlined\n                  iconSize=\"m\"\n                  css={iconReset}\n                  data-test=\"icon-eye\"\n                />\n              </Tooltip>\n            )\n          }\n          role=\"textbox\"\n        />\n      ) : (\n        <StyledInput {...props} {...validationMethods} />\n      )}\n    </FormItem>\n  </StyledFormGroup>\n);\n\nexport default LabeledErrorBoundInput;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport AntdForm, { FormProps } from 'antd/lib/form';\nimport { styled } from '@superset-ui/core';\n\nconst StyledForm = styled(AntdForm)`\n  &.ant-form label {\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  }\n  .ant-form-item {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n  }\n`;\n\nexport default function Form(props: FormProps) {\n  return <StyledForm {...props} />;\n}\n\nexport type { FormProps };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\n\nexport interface InfoTooltipProps {\n  className?: string;\n  tooltip: string;\n  placement?:\n    | 'bottom'\n    | 'left'\n    | 'right'\n    | 'top'\n    | 'topLeft'\n    | 'topRight'\n    | 'bottomLeft'\n    | 'bottomRight'\n    | 'leftTop'\n    | 'leftBottom'\n    | 'rightTop'\n    | 'rightBottom'\n    | undefined;\n  trigger?: string | Array<string>;\n  overlayStyle?: any;\n  bgColor?: string;\n  viewBox?: string;\n}\n\nconst StyledTooltip = styled(Tooltip)`\n  cursor: pointer;\n  path:first-of-type {\n    fill: ${({ theme }) => theme.colors.grayscale.base};\n  }\n`;\n\nconst StyledTooltipTitle = styled.span`\n  display: -webkit-box;\n  -webkit-line-clamp: 20;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst defaultOverlayStyle = {\n  fontSize: '12px',\n  lineHeight: '16px',\n};\n\nconst defaultColor = 'rgba(0,0,0,0.9)';\n\nexport default function InfoTooltip({\n  tooltip,\n  placement = 'right',\n  trigger = 'hover',\n  overlayStyle = defaultOverlayStyle,\n  bgColor = defaultColor,\n  viewBox = '0 -2 24 24',\n}: InfoTooltipProps) {\n  return (\n    <StyledTooltip\n      title={<StyledTooltipTitle>{tooltip}</StyledTooltipTitle>}\n      placement={placement}\n      trigger={trigger}\n      overlayStyle={overlayStyle}\n      color={bgColor}\n    >\n      <Icons.InfoSolidSmall className=\"info-solid-small\" viewBox={viewBox} />\n    </StyledTooltip>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\nimport { Input as AntdInput, InputNumber as AntdInputNumber } from 'antd';\n\nexport const Input = styled(AntdInput)`\n  border: 1px solid ${({ theme }) => theme.colors.secondary.light3};\n  border-radius: ${({ theme }) => theme.borderRadius}px;\n`;\n\nexport const InputNumber = styled(AntdInputNumber)`\n  border: 1px solid ${({ theme }) => theme.colors.secondary.light3};\n  border-radius: ${({ theme }) => theme.borderRadius}px;\n`;\n\nexport const TextArea = styled(AntdInput.TextArea)`\n  border: 1px solid ${({ theme }) => theme.colors.secondary.light3};\n  border-radius: ${({ theme }) => theme.borderRadius}px;\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\nimport { Menu as AntdMenu } from 'antd';\nimport { MenuProps as AntdMenuProps } from 'antd/lib/menu';\n\nexport type MenuProps = AntdMenuProps;\n\nconst MenuItem = styled(AntdMenu.Item)`\n  > a {\n    text-decoration: none;\n  }\n\n  &.ant-menu-item {\n    height: ${({ theme }) => theme.gridUnit * 8}px;\n    line-height: ${({ theme }) => theme.gridUnit * 8}px;\n    a {\n      border-bottom: none;\n      transition: background-color ${({ theme }) => theme.transitionTiming}s;\n      &:after {\n        content: '';\n        position: absolute;\n        bottom: -3px;\n        left: 50%;\n        width: 0;\n        height: 3px;\n        opacity: 0;\n        transform: translateX(-50%);\n        transition: all ${({ theme }) => theme.transitionTiming}s;\n        background-color: ${({ theme }) => theme.colors.primary.base};\n      }\n      &:focus {\n        border-bottom: none;\n        background-color: transparent;\n        @media (max-width: 767px) {\n          background-color: ${({ theme }) => theme.colors.primary.light5};\n        }\n      }\n    }\n  }\n\n  &.ant-menu-item,\n  &.ant-dropdown-menu-item {\n    span[role='button'] {\n      display: inline-block;\n      width: 100%;\n    }\n    transition-duration: 0s;\n  }\n`;\n\nconst StyledNav = styled(AntdMenu)`\n  line-height: 51px;\n  border: none;\n\n  & > .ant-menu-item,\n  & > .ant-menu-submenu {\n    vertical-align: inherit;\n    &:hover {\n      color: ${({ theme }) => theme.colors.grayscale.dark1};\n    }\n  }\n\n  &:not(.ant-menu-dark) > .ant-menu-submenu,\n  &:not(.ant-menu-dark) > .ant-menu-item {\n    &:hover {\n      border-bottom: none;\n    }\n  }\n\n  &:not(.ant-menu-dark) > .ant-menu-submenu,\n  &:not(.ant-menu-dark) > .ant-menu-item {\n    margin: 0px;\n  }\n\n  & > .ant-menu-item > a {\n    padding: ${({ theme }) => theme.gridUnit * 4}px;\n  }\n`;\n\nconst StyledSubMenu = styled(AntdMenu.SubMenu)`\n  color: ${({ theme }) => theme.colors.grayscale.dark1};\n  border-bottom: none;\n  .ant-menu-submenu-open,\n  .ant-menu-submenu-active {\n    background-color: ${({ theme }) => theme.colors.primary.light5};\n    .ant-menu-submenu-title {\n      color: ${({ theme }) => theme.colors.grayscale.dark1};\n      background-color: ${({ theme }) => theme.colors.primary.light5};\n      border-bottom: none;\n      margin: 0;\n      &:after {\n        opacity: 1;\n        width: calc(100% - 1);\n      }\n    }\n  }\n  .ant-menu-submenu-title {\n    position: relative;\n    top: ${({ theme }) => -theme.gridUnit - 3}px;\n    &:after {\n      content: '';\n      position: absolute;\n      bottom: -3px;\n      left: 50%;\n      width: 0;\n      height: 3px;\n      opacity: 0;\n      transform: translateX(-50%);\n      transition: all ${({ theme }) => theme.transitionTiming}s;\n      background-color: ${({ theme }) => theme.colors.primary.base};\n    }\n  }\n  .ant-menu-submenu-arrow {\n    top: 67%;\n  }\n  & > .ant-menu-submenu-title {\n    padding: 0 ${({ theme }) => theme.gridUnit * 6}px 0\n      ${({ theme }) => theme.gridUnit * 3}px !important;\n    span[role='img'] {\n      position: absolute;\n      right: ${({ theme }) => -theme.gridUnit + -2}px;\n      top: ${({ theme }) => theme.gridUnit * 5.25}px;\n      svg {\n        font-size: ${({ theme }) => theme.gridUnit * 6}px;\n        color: ${({ theme }) => theme.colors.grayscale.base};\n      }\n    }\n    & > span {\n      position: relative;\n      top: 7px;\n    }\n    &:hover {\n      color: ${({ theme }) => theme.colors.primary.base};\n    }\n  }\n`;\n\nexport declare type MenuMode =\n  | 'vertical'\n  | 'vertical-left'\n  | 'vertical-right'\n  | 'horizontal'\n  | 'inline';\n\nexport const Menu = Object.assign(AntdMenu, {\n  Item: MenuItem,\n});\n\nexport const MainNav = Object.assign(StyledNav, {\n  Item: MenuItem,\n  SubMenu: StyledSubMenu,\n  Divider: AntdMenu.Divider,\n  ItemGroup: AntdMenu.ItemGroup,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState } from 'react';\nimport Modal from 'src/components/Modal';\nimport Button from 'src/components/Button';\n\ninterface ModalTriggerProps {\n  dialogClassName?: string;\n  triggerNode: React.ReactNode;\n  modalTitle?: string;\n  modalBody?: React.ReactNode; // not required because it can be generated by beforeOpen\n  modalFooter?: React.ReactNode;\n  beforeOpen?: Function;\n  onExit?: Function;\n  isButton?: boolean;\n  className?: string;\n  tooltip?: string;\n  width?: string;\n  maxWidth?: string;\n  responsive?: boolean;\n  resizable?: boolean;\n  resizableConfig?: any;\n  draggable?: boolean;\n  draggableConfig?: any;\n  destroyOnClose?: boolean;\n}\n\nexport interface ModalTriggerRef {\n  current: {\n    close: Function;\n    open: Function;\n  };\n}\n\nconst ModalTrigger = React.forwardRef(\n  (props: ModalTriggerProps, ref: ModalTriggerRef | null) => {\n    const [showModal, setShowModal] = useState(false);\n    const {\n      beforeOpen = () => {},\n      onExit = () => {},\n      isButton = false,\n      resizable = false,\n      draggable = false,\n      className = '',\n      tooltip,\n      modalFooter,\n      triggerNode,\n      destroyOnClose = true,\n      modalBody,\n      draggableConfig = {},\n      resizableConfig = {},\n      modalTitle,\n      responsive,\n      width,\n      maxWidth,\n    } = props;\n\n    const close = () => {\n      setShowModal(false);\n      onExit?.();\n    };\n\n    const open = (e: React.MouseEvent) => {\n      e.preventDefault();\n      beforeOpen?.();\n      setShowModal(true);\n    };\n\n    if (ref) {\n      ref.current = { close, open }; // eslint-disable-line\n    }\n\n    /* eslint-disable jsx-a11y/interactive-supports-focus */\n    return (\n      <>\n        {isButton && (\n          <Button\n            className=\"modal-trigger\"\n            data-test=\"btn-modal-trigger\"\n            tooltip={tooltip}\n            onClick={open}\n          >\n            {triggerNode}\n          </Button>\n        )}\n        {!isButton && (\n          <span data-test=\"span-modal-trigger\" onClick={open} role=\"button\">\n            {triggerNode}\n          </span>\n        )}\n        <Modal\n          className={className}\n          show={showModal}\n          onHide={close}\n          title={modalTitle}\n          footer={modalFooter}\n          hideFooter={!modalFooter}\n          width={width}\n          maxWidth={maxWidth}\n          responsive={responsive}\n          resizable={resizable}\n          resizableConfig={resizableConfig}\n          draggable={draggable}\n          draggableConfig={draggableConfig}\n          destroyOnClose={destroyOnClose}\n        >\n          {modalBody}\n        </Modal>\n      </>\n    );\n  },\n);\n\nexport default ModalTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { Popover as AntdPopover } from 'antd';\nimport type { PopoverProps as AntdPopoverProps } from 'antd/lib/popover';\n\nexport interface PopoverProps extends AntdPopoverProps {\n  forceRender?: boolean;\n}\n\nexport const Popover = (props: PopoverProps) => <AntdPopover {...props} />;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { MouseEventHandler, ReactNode } from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\n\nexport interface PopoverSectionProps {\n  title: string;\n  isSelected?: boolean;\n  onSelect?: MouseEventHandler<HTMLDivElement>;\n  info?: string;\n  children?: ReactNode;\n}\n\nexport default function PopoverSection({\n  title,\n  isSelected,\n  children,\n  onSelect,\n  info,\n}: PopoverSectionProps) {\n  const theme = useTheme();\n  return (\n    <div\n      css={{\n        paddingBottom: theme.gridUnit * 2,\n        opacity: isSelected ? 1 : theme.opacity.mediumHeavy,\n      }}\n    >\n      <div\n        role=\"button\"\n        tabIndex={0}\n        onClick={onSelect}\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          cursor: onSelect ? 'pointer' : 'default',\n        }}\n      >\n        <strong data-test=\"popover-title\">{title}</strong>\n        {info && (\n          <Tooltip title={info} css={{ marginLeft: theme.gridUnit }}>\n            <Icons.InfoSolidSmall\n              role=\"img\"\n              width={14}\n              height={14}\n              iconColor={theme.colors.grayscale.light1}\n            />\n          </Tooltip>\n        )}\n        <Icons.Check\n          role=\"img\"\n          iconColor={\n            isSelected ? theme.colors.primary.base : theme.colors.grayscale.base\n          }\n        />\n      </div>\n      <div\n        css={{\n          marginLeft: theme.gridUnit,\n          marginTop: theme.gridUnit,\n        }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\nimport { Radio as AntdRadio } from 'antd';\n\nconst StyledRadio = styled(AntdRadio)`\n  .ant-radio-inner {\n    top: -1px;\n    left: 2px;\n    width: ${({ theme }) => theme.gridUnit * 4}px;\n    height: ${({ theme }) => theme.gridUnit * 4}px;\n    border-width: 2px;\n    border-color: ${({ theme }) => theme.colors.grayscale.light2};\n  }\n\n  .ant-radio.ant-radio-checked {\n    .ant-radio-inner {\n      border-width: ${({ theme }) => theme.gridUnit + 1}px;\n      border-color: ${({ theme }) => theme.colors.primary.base};\n    }\n\n    .ant-radio-inner::after {\n      background-color: ${({ theme }) => theme.colors.grayscale.light5};\n      top: 0;\n      left: 0;\n      width: ${({ theme }) => theme.gridUnit + 2}px;\n      height: ${({ theme }) => theme.gridUnit + 2}px;\n    }\n  }\n\n  .ant-radio:hover,\n  .ant-radio:focus {\n    .ant-radio-inner {\n      border-color: ${({ theme }) => theme.colors.primary.dark1};\n    }\n  }\n`;\nconst StyledGroup = styled(AntdRadio.Group)`\n  font-size: inherit;\n`;\n\nexport const Radio = Object.assign(StyledRadio, {\n  Group: StyledGroup,\n  Button: AntdRadio.Button,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme, SafeMarkdown } from '@superset-ui/core';\nimport Icons, { IconType } from 'src/components/Icons';\nimport { Tooltip } from 'src/components/Tooltip';\n\nexport interface WarningIconWithTooltipProps {\n  warningMarkdown: string;\n  size?: IconType['iconSize'];\n}\n\nfunction WarningIconWithTooltip({\n  warningMarkdown,\n  size,\n}: WarningIconWithTooltipProps) {\n  const theme = useTheme();\n  return (\n    <Tooltip\n      id=\"warning-tooltip\"\n      title={<SafeMarkdown source={warningMarkdown} />}\n    >\n      <Icons.AlertSolid\n        iconColor={theme.colors.alert.base}\n        iconSize={size}\n        css={{ marginRight: theme.gridUnit * 2 }}\n      />\n    </Tooltip>\n  );\n}\n\nexport default WarningIconWithTooltip;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\nimport { makeApi, CategoricalColorNamespace, t } from '@superset-ui/core';\nimport { isString } from 'lodash';\nimport { getErrorText } from 'src/utils/getClientErrorObject';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport {\n  ChartConfiguration,\n  DashboardInfo,\n  FilterBarOrientation,\n  GlobalChartCrossFilterConfig,\n  RootState,\n} from 'src/dashboard/types';\nimport { onSave } from './dashboardState';\n\nexport const DASHBOARD_INFO_UPDATED = 'DASHBOARD_INFO_UPDATED';\n\nexport function updateColorSchema(\n  metadata: Record<string, any>,\n  labelColors: Record<string, string>,\n) {\n  const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n    metadata?.color_namespace,\n  );\n  const colorMap = isString(labelColors)\n    ? JSON.parse(labelColors)\n    : labelColors;\n  Object.keys(colorMap).forEach(label => {\n    categoricalNamespace.setColor(label, colorMap[label]);\n  });\n}\n\n// updates partially changed dashboard info\nexport function dashboardInfoChanged(newInfo: { metadata: any }) {\n  const { metadata } = newInfo;\n\n  const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n    metadata?.color_namespace,\n  );\n\n  categoricalNamespace.resetColors();\n\n  if (metadata?.shared_label_colors) {\n    updateColorSchema(metadata, metadata?.shared_label_colors);\n  }\n\n  if (metadata?.label_colors) {\n    updateColorSchema(metadata, metadata?.label_colors);\n  }\n\n  return { type: DASHBOARD_INFO_UPDATED, newInfo };\n}\nexport const SAVE_CHART_CONFIG_BEGIN = 'SAVE_CHART_CONFIG_BEGIN';\nexport const SAVE_CHART_CONFIG_COMPLETE = 'SAVE_CHART_CONFIG_COMPLETE';\nexport const SAVE_CHART_CONFIG_FAIL = 'SAVE_CHART_CONFIG_FAIL';\n\nexport const saveChartConfiguration =\n  ({\n    chartConfiguration,\n    globalChartConfiguration,\n  }: {\n    chartConfiguration?: ChartConfiguration;\n    globalChartConfiguration?: GlobalChartCrossFilterConfig;\n  }) =>\n  async (dispatch: Dispatch, getState: () => RootState) => {\n    dispatch({\n      type: SAVE_CHART_CONFIG_BEGIN,\n      chartConfiguration,\n      globalChartConfiguration,\n    });\n    const { id, metadata } = getState().dashboardInfo;\n\n    // TODO extract this out when makeApi supports url parameters\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: DashboardInfo }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          chart_configuration:\n            chartConfiguration ?? metadata.chart_configuration,\n          global_chart_configuration:\n            globalChartConfiguration ?? metadata.global_chart_configuration,\n        }),\n      });\n      dispatch(\n        dashboardInfoChanged({\n          metadata: JSON.parse(response.result.json_metadata),\n        }),\n      );\n      dispatch({\n        type: SAVE_CHART_CONFIG_COMPLETE,\n        chartConfiguration,\n        globalChartConfiguration,\n      });\n    } catch (err) {\n      dispatch({\n        type: SAVE_CHART_CONFIG_FAIL,\n        chartConfiguration,\n        globalChartConfiguration,\n      });\n      dispatch(addDangerToast(t('Failed to save cross-filter scoping')));\n    }\n  };\n\nexport const SET_FILTER_BAR_ORIENTATION = 'SET_FILTER_BAR_ORIENTATION';\n\nexport function setFilterBarOrientation(\n  filterBarOrientation: FilterBarOrientation,\n) {\n  return { type: SET_FILTER_BAR_ORIENTATION, filterBarOrientation };\n}\n\nexport const SET_CROSS_FILTERS_ENABLED = 'SET_CROSS_FILTERS_ENABLED';\n\nexport function setCrossFiltersEnabled(crossFiltersEnabled: boolean) {\n  return { type: SET_CROSS_FILTERS_ENABLED, crossFiltersEnabled };\n}\n\nexport function saveFilterBarOrientation(orientation: FilterBarOrientation) {\n  return async (dispatch: Dispatch, getState: () => RootState) => {\n    const { id, metadata } = getState().dashboardInfo;\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: Partial<DashboardInfo>; last_modified_time: number }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          filter_bar_orientation: orientation,\n        }),\n      });\n      const updatedDashboard = response.result;\n      const lastModifiedTime = response.last_modified_time;\n      if (updatedDashboard.json_metadata) {\n        const metadata = JSON.parse(updatedDashboard.json_metadata);\n        if (metadata.filter_bar_orientation) {\n          dispatch(setFilterBarOrientation(metadata.filter_bar_orientation));\n        }\n      }\n      if (lastModifiedTime) {\n        dispatch(onSave(lastModifiedTime));\n      }\n    } catch (errorObject) {\n      const errorText = await getErrorText(errorObject, 'dashboard');\n      dispatch(addDangerToast(errorText));\n      throw errorObject;\n    }\n  };\n}\n\nexport function saveCrossFiltersSetting(crossFiltersEnabled: boolean) {\n  return async (dispatch: Dispatch, getState: () => RootState) => {\n    const { id, metadata } = getState().dashboardInfo;\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: Partial<DashboardInfo>; last_modified_time: number }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          cross_filters_enabled: crossFiltersEnabled,\n        }),\n      });\n      const updatedDashboard = response.result;\n      const lastModifiedTime = response.last_modified_time;\n      if (updatedDashboard.json_metadata) {\n        const metadata = JSON.parse(updatedDashboard.json_metadata);\n        dispatch(setCrossFiltersEnabled(metadata.cross_filters_enabled));\n      }\n      if (lastModifiedTime) {\n        dispatch(onSave(lastModifiedTime));\n      }\n    } catch (errorObject) {\n      const errorText = await getErrorText(errorObject, 'dashboard');\n      dispatch(addDangerToast(errorText));\n      throw errorObject;\n    }\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\nimport { SupersetClient } from '@superset-ui/core';\nimport { Datasource, RootState } from 'src/dashboard/types';\n\n// update datasources index for Dashboard\nexport enum DatasourcesAction {\n  SET_DATASOURCES = 'SET_DATASOURCES',\n  SET_DATASOURCE = 'SET_DATASOURCE',\n}\n\nexport type DatasourcesActionPayload =\n  | {\n      type: DatasourcesAction.SET_DATASOURCES;\n      datasources: Datasource[] | null;\n    }\n  | {\n      type: DatasourcesAction.SET_DATASOURCE;\n      key: Datasource['uid'];\n      datasource: Datasource;\n    };\n\nexport function setDatasources(datasources: Datasource[] | null) {\n  return {\n    type: DatasourcesAction.SET_DATASOURCES,\n    datasources,\n  };\n}\n\nexport function setDatasource(datasource: Datasource, key: string) {\n  return {\n    type: DatasourcesAction.SET_DATASOURCE,\n    key,\n    datasource,\n  };\n}\n\nexport function fetchDatasourceMetadata(key: string) {\n  return (dispatch: Dispatch, getState: () => RootState) => {\n    const { datasources } = getState();\n    const datasource = datasources[key];\n\n    if (datasource) {\n      return dispatch(setDatasource(datasource, key));\n    }\n\n    return SupersetClient.get({\n      endpoint: `/superset/fetch_datasource_metadata?datasourceKey=${key}`,\n    }).then(({ json }) => dispatch(setDatasource(json as Datasource, key)));\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  FilterConfiguration,\n  Filters,\n  FilterSet,\n  FilterSets,\n  makeApi,\n} from '@superset-ui/core';\nimport { Dispatch } from 'redux';\nimport { cloneDeep } from 'lodash';\nimport {\n  SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL,\n  setDataMaskForFilterConfigComplete,\n} from 'src/dataMask/actions';\nimport { HYDRATE_DASHBOARD } from './hydrate';\nimport { dashboardInfoChanged } from './dashboardInfo';\nimport { FilterSetFullData } from '../reducers/types';\nimport { DashboardInfo, RootState } from '../types';\n\nexport const SET_FILTER_CONFIG_BEGIN = 'SET_FILTER_CONFIG_BEGIN';\nexport interface SetFilterConfigBegin {\n  type: typeof SET_FILTER_CONFIG_BEGIN;\n  filterConfig: FilterConfiguration;\n}\n\nexport const SET_FILTER_CONFIG_COMPLETE = 'SET_FILTER_CONFIG_COMPLETE';\nexport interface SetFilterConfigComplete {\n  type: typeof SET_FILTER_CONFIG_COMPLETE;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_FILTER_CONFIG_FAIL = 'SET_FILTER_CONFIG_FAIL';\nexport interface SetFilterConfigFail {\n  type: typeof SET_FILTER_CONFIG_FAIL;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_IN_SCOPE_STATUS_OF_FILTERS = 'SET_IN_SCOPE_STATUS_OF_FILTERS';\nexport interface SetInScopeStatusOfFilters {\n  type: typeof SET_IN_SCOPE_STATUS_OF_FILTERS;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_FILTER_SETS_BEGIN = 'SET_FILTER_SETS_BEGIN';\nexport interface SetFilterSetsBegin {\n  type: typeof SET_FILTER_SETS_BEGIN;\n}\nexport const SET_FILTER_SETS_COMPLETE = 'SET_FILTER_SETS_COMPLETE';\nexport interface SetFilterSetsComplete {\n  type: typeof SET_FILTER_SETS_COMPLETE;\n  filterSets: FilterSet[];\n}\nexport const SET_FILTER_SETS_FAIL = 'SET_FILTER_SETS_FAIL';\nexport interface SetFilterSetsFail {\n  type: typeof SET_FILTER_SETS_FAIL;\n}\n\nexport const CREATE_FILTER_SET_BEGIN = 'CREATE_FILTER_SET_BEGIN';\nexport interface CreateFilterSetBegin {\n  type: typeof CREATE_FILTER_SET_BEGIN;\n}\nexport const CREATE_FILTER_SET_COMPLETE = 'CREATE_FILTER_SET_COMPLETE';\nexport interface CreateFilterSetComplete {\n  type: typeof CREATE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const CREATE_FILTER_SET_FAIL = 'CREATE_FILTER_SET_FAIL';\nexport interface CreateFilterSetFail {\n  type: typeof CREATE_FILTER_SET_FAIL;\n}\n\nexport const DELETE_FILTER_SET_BEGIN = 'DELETE_FILTER_SET_BEGIN';\nexport interface DeleteFilterSetBegin {\n  type: typeof DELETE_FILTER_SET_BEGIN;\n}\nexport const DELETE_FILTER_SET_COMPLETE = 'DELETE_FILTER_SET_COMPLETE';\nexport interface DeleteFilterSetComplete {\n  type: typeof DELETE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const DELETE_FILTER_SET_FAIL = 'DELETE_FILTER_SET_FAIL';\nexport interface DeleteFilterSetFail {\n  type: typeof DELETE_FILTER_SET_FAIL;\n}\n\nexport const UPDATE_FILTER_SET_BEGIN = 'UPDATE_FILTER_SET_BEGIN';\nexport interface UpdateFilterSetBegin {\n  type: typeof UPDATE_FILTER_SET_BEGIN;\n}\nexport const UPDATE_FILTER_SET_COMPLETE = 'UPDATE_FILTER_SET_COMPLETE';\nexport interface UpdateFilterSetComplete {\n  type: typeof UPDATE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const UPDATE_FILTER_SET_FAIL = 'UPDATE_FILTER_SET_FAIL';\nexport interface UpdateFilterSetFail {\n  type: typeof UPDATE_FILTER_SET_FAIL;\n}\n\nexport const setFilterConfiguration =\n  (filterConfig: FilterConfiguration) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    dispatch({\n      type: SET_FILTER_CONFIG_BEGIN,\n      filterConfig,\n    });\n    const { id, metadata } = getState().dashboardInfo;\n    const oldFilters = getState().nativeFilters?.filters;\n\n    // TODO extract this out when makeApi supports url parameters\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: DashboardInfo }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n\n    const mergedFilterConfig = filterConfig.map(filter => {\n      const oldFilter = oldFilters[filter.id];\n      if (!oldFilter) {\n        return filter;\n      }\n      return { ...oldFilter, ...filter };\n    });\n\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          native_filter_configuration: mergedFilterConfig,\n        }),\n      });\n      dispatch(\n        dashboardInfoChanged({\n          metadata: JSON.parse(response.result.json_metadata),\n        }),\n      );\n      dispatch({\n        type: SET_FILTER_CONFIG_COMPLETE,\n        filterConfig: mergedFilterConfig,\n      });\n      dispatch(\n        setDataMaskForFilterConfigComplete(mergedFilterConfig, oldFilters),\n      );\n    } catch (err) {\n      dispatch({\n        type: SET_FILTER_CONFIG_FAIL,\n        filterConfig: mergedFilterConfig,\n      });\n      dispatch({\n        type: SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL,\n        filterConfig: mergedFilterConfig,\n      });\n    }\n  };\n\nexport const setInScopeStatusOfFilters =\n  (\n    filterScopes: {\n      filterId: string;\n      chartsInScope: number[];\n      tabsInScope: string[];\n    }[],\n  ) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    const filters = getState().nativeFilters?.filters;\n    const filtersWithScopes = filterScopes.map(scope => ({\n      ...filters[scope.filterId],\n      chartsInScope: scope.chartsInScope,\n      tabsInScope: scope.tabsInScope,\n    }));\n    dispatch({\n      type: SET_IN_SCOPE_STATUS_OF_FILTERS,\n      filterConfig: filtersWithScopes,\n    });\n    // need to update native_filter_configuration in the dashboard metadata\n    const metadata = cloneDeep(getState().dashboardInfo.metadata);\n    const filterConfig: FilterConfiguration =\n      metadata.native_filter_configuration;\n    const mergedFilterConfig = filterConfig.map(filter => {\n      const filterWithScope = filtersWithScopes.find(\n        scope => scope.id === filter.id,\n      );\n      if (!filterWithScope) {\n        return filter;\n      }\n      return { ...filterWithScope, ...filter };\n    });\n    metadata.native_filter_configuration = mergedFilterConfig;\n    dispatch(\n      dashboardInfoChanged({\n        metadata,\n      }),\n    );\n  };\n\ntype BootstrapData = {\n  nativeFilters: {\n    filters: Filters;\n    filterSets: FilterSets;\n    filtersState: object;\n  };\n};\n\nexport interface SetBootstrapData {\n  type: typeof HYDRATE_DASHBOARD;\n  data: BootstrapData;\n}\n\nexport const getFilterSets =\n  (dashboardId: number) => async (dispatch: Dispatch) => {\n    const fetchFilterSets = makeApi<\n      null,\n      {\n        count: number;\n        ids: number[];\n        result: FilterSetFullData[];\n      }\n    >({\n      method: 'GET',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets`,\n    });\n\n    dispatch({\n      type: SET_FILTER_SETS_BEGIN,\n    });\n\n    const response = await fetchFilterSets(null);\n\n    dispatch({\n      type: SET_FILTER_SETS_COMPLETE,\n      filterSets: response.ids.map((id, i) => ({\n        ...response.result[i].params,\n        id,\n        name: response.result[i].name,\n      })),\n    });\n  };\n\nexport const createFilterSet =\n  (filterSet: Omit<FilterSet, 'id'>) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const postFilterSets = makeApi<\n      Partial<FilterSetFullData & { json_metadata: any }>,\n      {\n        count: number;\n        ids: number[];\n        result: FilterSetFullData[];\n      }\n    >({\n      method: 'POST',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets`,\n    });\n\n    dispatch({\n      type: CREATE_FILTER_SET_BEGIN,\n    });\n\n    const serverFilterSet: Omit<FilterSet, 'id' | 'name'> & { name?: string } =\n      {\n        ...filterSet,\n      };\n\n    delete serverFilterSet.name;\n\n    await postFilterSets({\n      name: filterSet.name,\n      owner_type: 'Dashboard',\n      owner_id: dashboardId,\n      json_metadata: JSON.stringify(serverFilterSet),\n    });\n\n    dispatch({\n      type: CREATE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const updateFilterSet =\n  (filterSet: FilterSet) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const postFilterSets = makeApi<\n      Partial<FilterSetFullData & { json_metadata: any }>,\n      {}\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets/${filterSet.id}`,\n    });\n\n    dispatch({\n      type: UPDATE_FILTER_SET_BEGIN,\n    });\n\n    const serverFilterSet: Omit<FilterSet, 'id' | 'name'> & {\n      name?: string;\n      id?: number;\n    } = {\n      ...filterSet,\n    };\n\n    delete serverFilterSet.id;\n    delete serverFilterSet.name;\n\n    await postFilterSets({\n      name: filterSet.name,\n      json_metadata: JSON.stringify(serverFilterSet),\n    });\n\n    dispatch({\n      type: UPDATE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const deleteFilterSet =\n  (filterSetId: number) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const deleteFilterSets = makeApi<{}, {}>({\n      method: 'DELETE',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets/${filterSetId}`,\n    });\n\n    dispatch({\n      type: DELETE_FILTER_SET_BEGIN,\n    });\n\n    await deleteFilterSets({});\n\n    dispatch({\n      type: DELETE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const SET_FOCUSED_NATIVE_FILTER = 'SET_FOCUSED_NATIVE_FILTER';\nexport interface SetFocusedNativeFilter {\n  type: typeof SET_FOCUSED_NATIVE_FILTER;\n  id: string;\n}\nexport const UNSET_FOCUSED_NATIVE_FILTER = 'UNSET_FOCUSED_NATIVE_FILTER';\nexport interface UnsetFocusedNativeFilter {\n  type: typeof UNSET_FOCUSED_NATIVE_FILTER;\n}\n\nexport function setFocusedNativeFilter(id: string): SetFocusedNativeFilter {\n  return {\n    type: SET_FOCUSED_NATIVE_FILTER,\n    id,\n  };\n}\nexport function unsetFocusedNativeFilter(): UnsetFocusedNativeFilter {\n  return {\n    type: UNSET_FOCUSED_NATIVE_FILTER,\n  };\n}\n\nexport const SET_HOVERED_NATIVE_FILTER = 'SET_HOVERED_NATIVE_FILTER';\nexport interface SetHoveredNativeFilter {\n  type: typeof SET_HOVERED_NATIVE_FILTER;\n  id: string;\n}\nexport const UNSET_HOVERED_NATIVE_FILTER = 'UNSET_HOVERED_NATIVE_FILTER';\nexport interface UnsetHoveredNativeFilter {\n  type: typeof UNSET_HOVERED_NATIVE_FILTER;\n}\n\nexport function setHoveredNativeFilter(id: string): SetHoveredNativeFilter {\n  return {\n    type: SET_HOVERED_NATIVE_FILTER,\n    id,\n  };\n}\nexport function unsetHoveredNativeFilter(): UnsetHoveredNativeFilter {\n  return {\n    type: UNSET_HOVERED_NATIVE_FILTER,\n  };\n}\n\nexport const UPDATE_CASCADE_PARENT_IDS = 'UPDATE_CASCADE_PARENT_IDS';\nexport interface UpdateCascadeParentIds {\n  type: typeof UPDATE_CASCADE_PARENT_IDS;\n  id: string;\n  parentIds: string[];\n}\nexport function updateCascadeParentIds(\n  id: string,\n  parentIds: string[],\n): UpdateCascadeParentIds {\n  return {\n    type: UPDATE_CASCADE_PARENT_IDS,\n    id,\n    parentIds,\n  };\n}\n\nexport type AnyFilterAction =\n  | SetFilterConfigBegin\n  | SetFilterConfigComplete\n  | SetFilterConfigFail\n  | SetFilterSetsBegin\n  | SetFilterSetsComplete\n  | SetFilterSetsFail\n  | SetInScopeStatusOfFilters\n  | SetBootstrapData\n  | SetFocusedNativeFilter\n  | UnsetFocusedNativeFilter\n  | SetHoveredNativeFilter\n  | UnsetHoveredNativeFilter\n  | CreateFilterSetBegin\n  | CreateFilterSetComplete\n  | CreateFilterSetFail\n  | DeleteFilterSetBegin\n  | DeleteFilterSetComplete\n  | DeleteFilterSetFail\n  | UpdateFilterSetBegin\n  | UpdateFilterSetComplete\n  | UpdateFilterSetFail\n  | UpdateCascadeParentIds;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport {\n  DatasourceType,\n  FeatureFlag,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { Dispatch } from 'redux';\nimport { Slice } from '../types';\n\nconst FETCH_SLICES_PAGE_SIZE = 200;\n\nexport function getDatasourceParameter(\n  datasourceId: number,\n  datasourceType: DatasourceType,\n) {\n  return `${datasourceId}__${datasourceType}`;\n}\n\nexport const ADD_SLICES = 'ADD_SLICES';\nfunction addSlices(slices: { [id: number]: Slice }) {\n  return { type: ADD_SLICES, payload: { slices } };\n}\n\nexport const SET_SLICES = 'SET_SLICES';\nfunction setSlices(slices: { [id: number]: Slice }) {\n  return { type: SET_SLICES, payload: { slices } };\n}\n\nexport const FETCH_ALL_SLICES_STARTED = 'FETCH_ALL_SLICES_STARTED';\nfunction fetchAllSlicesStarted() {\n  return { type: FETCH_ALL_SLICES_STARTED };\n}\n\nexport const FETCH_ALL_SLICES_FAILED = 'FETCH_ALL_SLICES_FAILED';\nfunction fetchAllSlicesFailed(error: string) {\n  return { type: FETCH_ALL_SLICES_FAILED, payload: { error } };\n}\n\nconst parseResult = (result: any[]) =>\n  result.reduce((slices, slice: any) => {\n    let form_data = JSON.parse(slice.params);\n    form_data = {\n      ...form_data,\n      // force using datasource stored in relational table prop\n      datasource:\n        getDatasourceParameter(slice.datasource_id, slice.datasource_type) ||\n        form_data.datasource,\n    };\n    return {\n      ...slices,\n      [slice.id]: {\n        slice_id: slice.id,\n        slice_url: slice.url,\n        slice_name: slice.slice_name,\n        form_data,\n        datasource_name: slice.datasource_name_text,\n        datasource_url: slice.datasource_url,\n        datasource_id: slice.datasource_id,\n        datasource_type: slice.datasource_type,\n        changed_on: new Date(slice.changed_on_utc).getTime(),\n        description: slice.description,\n        description_markdown: slice.description_markeddown,\n        viz_type: slice.viz_type,\n        modified: slice.changed_on_delta_humanized,\n        changed_on_humanized: slice.changed_on_delta_humanized,\n        thumbnail_url: slice.thumbnail_url,\n        owners: slice.owners,\n        created_by: slice.created_by,\n      },\n    };\n  }, {});\n\nexport function updateSlices(slices: { [id: number]: Slice }) {\n  return (dispatch: Dispatch) => {\n    dispatch(setSlices(slices));\n  };\n}\n\nexport function fetchSlices(\n  userId?: number,\n  filter_value?: string,\n  sortColumn = 'changed_on',\n) {\n  return (dispatch: Dispatch) => {\n    dispatch(fetchAllSlicesStarted());\n\n    const filters: {\n      col: string;\n      opr: string;\n      value: string | number;\n    }[] = filter_value\n      ? [{ col: 'slice_name', opr: 'chart_all_text', value: filter_value }]\n      : [];\n\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS)) {\n      filters.push({\n        col: 'viz_type',\n        opr: 'neq',\n        value: 'filter_box',\n      });\n    }\n\n    if (userId) {\n      filters.push({ col: 'owners', opr: 'rel_m_m', value: userId });\n    }\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${rison.encode({\n        columns: [\n          'changed_on_delta_humanized',\n          'changed_on_utc',\n          'datasource_id',\n          'datasource_type',\n          'datasource_url',\n          'datasource_name_text',\n          'description_markeddown',\n          'description',\n          'id',\n          'params',\n          'slice_name',\n          'thumbnail_url',\n          'url',\n          'viz_type',\n          'owners.id',\n          'created_by.id',\n        ],\n        filters,\n        page_size: FETCH_SLICES_PAGE_SIZE,\n        order_column:\n          sortColumn === 'changed_on'\n            ? 'changed_on_delta_humanized'\n            : sortColumn,\n        order_direction: sortColumn === 'changed_on' ? 'desc' : 'asc',\n      })}`,\n    })\n      .then(({ json }) => {\n        const { result } = json;\n        const slices = parseResult(result);\n        return dispatch(addSlices(slices));\n      })\n      .catch(errorResponse =>\n        getClientErrorObject(errorResponse).then(({ error }) => {\n          dispatch(\n            fetchAllSlicesFailed(\n              error || t('Could not fetch all saved charts'),\n            ),\n          );\n          dispatch(\n            addDangerToast(\n              t('Sorry there was an error fetching saved charts: ') + error,\n            ),\n          );\n        }),\n      );\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { FormInstance } from 'src/components';\nimport shortid from 'shortid';\nimport { getInitialDataMask } from 'src/dataMask/reducer';\nimport {\n  Filter,\n  FilterConfiguration,\n  NativeFilterType,\n  Divider,\n  NativeFilterTarget,\n  logging,\n} from '@superset-ui/core';\nimport { DASHBOARD_ROOT_ID } from 'src/dashboard/util/constants';\nimport { FilterRemoval, NativeFiltersForm } from './types';\n\nexport const REMOVAL_DELAY_SECS = 5;\n\nexport const hasCircularDependency = (\n  dependencyMap: Map<string, string[]>,\n  filterId: string,\n  trace: string[] = [],\n): boolean => {\n  if (trace.includes(filterId)) {\n    return true;\n  }\n  const dependencies = dependencyMap.get(filterId);\n  if (dependencies) {\n    return dependencies.some(dependency =>\n      hasCircularDependency(dependencyMap, dependency, [...trace, filterId]),\n    );\n  }\n  return false;\n};\n\nexport const validateForm = async (\n  form: FormInstance<NativeFiltersForm>,\n  currentFilterId: string,\n  setCurrentFilterId: Function,\n) => {\n  try {\n    let formValues: NativeFiltersForm;\n    try {\n      formValues = (await form.validateFields()) as NativeFiltersForm;\n    } catch (error) {\n      // In Jest tests in chain of tests, Ant generate `outOfDate` error so need to catch it here\n      if (!error?.errorFields?.length && error?.outOfDate) {\n        formValues = error.values;\n      } else {\n        throw error;\n      }\n    }\n    return formValues;\n  } catch (error) {\n    logging.warn('Filter configuration failed:', error);\n\n    if (!error.errorFields || !error.errorFields.length) return null; // not a validation error\n\n    // the name is in array format since the fields are nested\n    type ErrorFields = { name: ['filters', string, string] }[];\n    const errorFields = error.errorFields as ErrorFields;\n    // filter id is the second item in the field name\n    if (!errorFields.some(field => field.name[1] === currentFilterId)) {\n      // switch to the first tab that had a validation error\n      const filterError = errorFields.find(\n        field => field.name[0] === 'filters',\n      );\n      if (filterError) {\n        const filterId = filterError.name[1];\n        setCurrentFilterId(filterId);\n      }\n    }\n    return null;\n  }\n};\n\nexport const createHandleSave =\n  (\n    filterConfigMap: Record<string, Filter | Divider>,\n    filterIds: string[],\n    removedFilters: Record<string, FilterRemoval>,\n    saveForm: Function,\n    values: NativeFiltersForm,\n  ) =>\n  async () => {\n    const newFilterConfig: FilterConfiguration = filterIds\n      .filter(id => !removedFilters[id])\n      .map(id => {\n        // create a filter config object from the form inputs\n        const formInputs = values.filters?.[id];\n        // if user didn't open a filter, return the original config\n        if (!formInputs) return filterConfigMap[id];\n        if (formInputs.type === NativeFilterType.DIVIDER) {\n          return {\n            id,\n            type: NativeFilterType.DIVIDER,\n            scope: {\n              rootPath: [DASHBOARD_ROOT_ID],\n              excluded: [],\n            },\n            title: formInputs.title,\n            description: formInputs.description,\n          };\n        }\n        const target: Partial<NativeFilterTarget> = {};\n        if (formInputs.dataset) {\n          target.datasetId = formInputs.dataset.value;\n        }\n        if (formInputs.dataset && formInputs.column) {\n          target.column = { name: formInputs.column };\n        }\n        return {\n          id,\n          adhoc_filters: formInputs.adhoc_filters,\n          time_range: formInputs.time_range,\n          controlValues: formInputs.controlValues ?? {},\n          granularity_sqla: formInputs.granularity_sqla,\n          requiredFirst: Object.values(formInputs.requiredFirst ?? {}).find(\n            rf => rf,\n          ),\n          name: formInputs.name,\n          filterType: formInputs.filterType,\n          // for now there will only ever be one target\n          targets: [target],\n          defaultDataMask: formInputs.defaultDataMask ?? getInitialDataMask(),\n          cascadeParentIds: formInputs.dependencies || [],\n          scope: formInputs.scope,\n          sortMetric: formInputs.sortMetric,\n          type: formInputs.type,\n          description: (formInputs.description || '').trim(),\n        };\n      });\n\n    await saveForm(newFilterConfig);\n  };\n\nexport const createHandleRemoveItem =\n  (\n    setRemovedFilters: (\n      value:\n        | ((\n            prevState: Record<string, FilterRemoval>,\n          ) => Record<string, FilterRemoval>)\n        | Record<string, FilterRemoval>,\n    ) => void,\n    setOrderedFilters: (\n      val: string[] | ((prevState: string[]) => string[]),\n    ) => void,\n    setSaveAlertVisible: Function,\n  ) =>\n  (filterId: string) => {\n    const completeFilterRemoval = (filterId: string) => {\n      // the filter state will actually stick around in the form,\n      // and the filterConfig/newFilterIds, but we use removedFilters\n      // to mark it as removed.\n      setRemovedFilters(removedFilters => ({\n        ...removedFilters,\n        [filterId]: { isPending: false },\n      }));\n      setOrderedFilters((orderedFilters: string[]) =>\n        orderedFilters.filter(filter => filter !== filterId),\n      );\n    };\n\n    // first set up the timer to completely remove it\n    const timerId = window.setTimeout(() => {\n      completeFilterRemoval(filterId);\n    }, REMOVAL_DELAY_SECS * 1000);\n    // mark the filter state as \"removal in progress\"\n    setRemovedFilters(removedFilters => ({\n      ...removedFilters,\n      [filterId]: { isPending: true, timerId },\n    }));\n    setSaveAlertVisible(false);\n  };\n\nexport const NATIVE_FILTER_PREFIX = 'NATIVE_FILTER-';\nexport const NATIVE_FILTER_DIVIDER_PREFIX = 'NATIVE_FILTER_DIVIDER-';\nexport const generateFilterId = (type: NativeFilterType) => {\n  const prefix =\n    type === NativeFilterType.NATIVE_FILTER\n      ? NATIVE_FILTER_PREFIX\n      : NATIVE_FILTER_DIVIDER_PREFIX;\n  return `${prefix}${shortid.generate()}`;\n};\n\nexport const getFilterIds = (config: FilterConfiguration) =>\n  config.map(filter => filter.id);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  Behavior,\n  DataMaskStateWithId,\n  EXTRA_FORM_DATA_APPEND_KEYS,\n  EXTRA_FORM_DATA_OVERRIDE_KEYS,\n  ExtraFormData,\n  FeatureFlag,\n  Filter,\n  getChartMetadataRegistry,\n  QueryFormData,\n} from '@superset-ui/core';\nimport { DashboardLayout } from 'src/dashboard/types';\nimport extractUrlParams from 'src/dashboard/util/extractUrlParams';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { CHART_TYPE, TAB_TYPE } from '../../util/componentTypes';\nimport { DASHBOARD_GRID_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\nimport getBootstrapData from '../../../utils/getBootstrapData';\n\nconst getDefaultRowLimit = (): number => {\n  const bootstrapData = getBootstrapData();\n  const nativeFilterDefaultRowLimit =\n    bootstrapData?.common?.conf?.NATIVE_FILTER_DEFAULT_ROW_LIMIT;\n  return nativeFilterDefaultRowLimit || 1000;\n};\n\nexport const getFormData = ({\n  datasetId,\n  dependencies = {},\n  groupby,\n  defaultDataMask,\n  controlValues,\n  filterType,\n  sortMetric,\n  adhoc_filters,\n  time_range,\n  granularity_sqla,\n  type,\n}: Partial<Filter> & {\n  datasetId?: number;\n  dependencies?: object;\n  groupby?: string;\n  adhoc_filters?: AdhocFilter[];\n  time_range?: string;\n}): Partial<QueryFormData> => {\n  const otherProps: {\n    datasource?: string;\n    groupby?: string[];\n    sortMetric?: string;\n  } = {};\n  if (datasetId) {\n    otherProps.datasource = `${datasetId}__table`;\n  }\n  if (groupby) {\n    otherProps.groupby = [groupby];\n  }\n  if (sortMetric) {\n    otherProps.sortMetric = sortMetric;\n  }\n  return {\n    ...controlValues,\n    ...otherProps,\n    adhoc_filters: adhoc_filters ?? [],\n    extra_filters: [],\n    extra_form_data: dependencies,\n    granularity_sqla,\n    metrics: ['count'],\n    row_limit: getDefaultRowLimit(),\n    showSearch: true,\n    defaultValue: defaultDataMask?.filterState?.value,\n    time_range,\n    url_params: extractUrlParams('regular'),\n    inView: true,\n    viz_type: filterType,\n    type,\n  };\n};\n\nexport function mergeExtraFormData(\n  originalExtra: ExtraFormData = {},\n  newExtra: ExtraFormData = {},\n): ExtraFormData {\n  const mergedExtra: ExtraFormData = {};\n  EXTRA_FORM_DATA_APPEND_KEYS.forEach((key: string) => {\n    const mergedValues = [\n      ...(originalExtra[key] || []),\n      ...(newExtra[key] || []),\n    ];\n    if (mergedValues.length) {\n      mergedExtra[key] = mergedValues;\n    }\n  });\n  EXTRA_FORM_DATA_OVERRIDE_KEYS.forEach((key: string) => {\n    const originalValue = originalExtra[key];\n    if (originalValue !== undefined) {\n      mergedExtra[key] = originalValue;\n    }\n    const newValue = newExtra[key];\n    if (newValue !== undefined) {\n      mergedExtra[key] = newValue;\n    }\n  });\n  return mergedExtra;\n}\n\nexport function isCrossFilter(vizType: string) {\n  // @ts-ignore need export from superset-ui `ItemWithValue`\n  return getChartMetadataRegistry().items[vizType]?.value.behaviors?.includes(\n    Behavior.INTERACTIVE_CHART,\n  );\n}\n\nexport function getExtraFormData(\n  dataMask: DataMaskStateWithId,\n  filterIdsAppliedOnChart: string[],\n): ExtraFormData {\n  let extraFormData: ExtraFormData = {};\n  filterIdsAppliedOnChart.forEach(key => {\n    extraFormData = mergeExtraFormData(\n      extraFormData,\n      dataMask[key]?.extraFormData ?? {},\n    );\n  });\n  return extraFormData;\n}\n\nexport function nativeFilterGate(behaviors: Behavior[]): boolean {\n  return (\n    !behaviors.includes(Behavior.NATIVE_FILTER) ||\n    (isFeatureEnabled(FeatureFlag.DASHBOARD_FILTERS_EXPERIMENTAL) &&\n      isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n      behaviors.includes(Behavior.INTERACTIVE_CHART))\n  );\n}\n\nconst isComponentATab = (\n  dashboardLayout: DashboardLayout,\n  componentId: string,\n) => dashboardLayout?.[componentId]?.type === TAB_TYPE;\n\nconst findTabsWithChartsInScopeHelper = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n  componentId: string,\n  tabIds: string[],\n  tabsToHighlight: Set<string>,\n  visited: Set<string>,\n) => {\n  if (visited.has(componentId)) {\n    return;\n  }\n  visited.add(componentId);\n  if (\n    dashboardLayout?.[componentId]?.type === CHART_TYPE &&\n    chartsInScope.includes(dashboardLayout[componentId]?.meta?.chartId)\n  ) {\n    tabIds.forEach(tabsToHighlight.add, tabsToHighlight);\n  }\n  if (\n    dashboardLayout?.[componentId]?.children?.length === 0 ||\n    (isComponentATab(dashboardLayout, componentId) &&\n      tabsToHighlight.has(componentId))\n  ) {\n    return;\n  }\n  dashboardLayout[componentId]?.children.forEach(childId =>\n    findTabsWithChartsInScopeHelper(\n      dashboardLayout,\n      chartsInScope,\n      childId,\n      isComponentATab(dashboardLayout, childId) ? [...tabIds, childId] : tabIds,\n      tabsToHighlight,\n      visited,\n    ),\n  );\n};\n\nexport const findTabsWithChartsInScope = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n) => {\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot.children[0];\n  const hasTopLevelTabs = rootChildId !== DASHBOARD_GRID_ID;\n  const tabsInScope = new Set<string>();\n  const visited = new Set<string>();\n  if (hasTopLevelTabs) {\n    dashboardLayout[rootChildId]?.children?.forEach(tabId =>\n      findTabsWithChartsInScopeHelper(\n        dashboardLayout,\n        chartsInScope,\n        tabId,\n        [tabId],\n        tabsInScope,\n        visited,\n      ),\n    );\n  } else {\n    Object.values(dashboardLayout)\n      .filter(element => element?.type === TAB_TYPE)\n      .forEach(element =>\n        findTabsWithChartsInScopeHelper(\n          dashboardLayout,\n          chartsInScope,\n          element.id,\n          [element.id],\n          tabsInScope,\n          visited,\n        ),\n      );\n  }\n  return tabsInScope;\n};\n","import { DatasourceType } from '@superset-ui/core';\nimport { Datasource } from 'src/dashboard/types';\nimport { DASHBOARD_ROOT_ID } from './util/constants';\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const PLACEHOLDER_DATASOURCE: Datasource = {\n  id: 0,\n  type: DatasourceType.Table,\n  uid: '_placeholder_',\n  datasource_name: '',\n  table_name: '',\n  columns: [],\n  column_types: [],\n  metrics: [],\n  column_formats: {},\n  currency_formats: {},\n  verbose_map: {},\n  main_dttm_col: '',\n  description: '',\n};\n\nexport const MAIN_HEADER_HEIGHT = 53;\nexport const CLOSED_FILTER_BAR_WIDTH = 32;\nexport const OPEN_FILTER_BAR_WIDTH = 260;\nexport const OPEN_FILTER_BAR_MAX_WIDTH = 550;\nexport const FILTER_BAR_HEADER_HEIGHT = 80;\nexport const FILTER_BAR_TABS_HEIGHT = 46;\nexport const BUILDER_SIDEPANEL_WIDTH = 374;\nexport const OVERWRITE_INSPECT_FIELDS = ['css', 'json_metadata.filter_scopes'];\n\nexport const DEFAULT_CROSS_FILTER_SCOPING = {\n  rootPath: [DASHBOARD_ROOT_ID],\n  excluded: [],\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AnyFilterAction,\n  SET_FILTER_CONFIG_COMPLETE,\n  SET_IN_SCOPE_STATUS_OF_FILTERS,\n  SET_FILTER_SETS_COMPLETE,\n  SET_FOCUSED_NATIVE_FILTER,\n  UNSET_FOCUSED_NATIVE_FILTER,\n  SET_HOVERED_NATIVE_FILTER,\n  UNSET_HOVERED_NATIVE_FILTER,\n  UPDATE_CASCADE_PARENT_IDS,\n} from 'src/dashboard/actions/nativeFilters';\nimport {\n  FilterSet,\n  FilterConfiguration,\n  NativeFiltersState,\n} from '@superset-ui/core';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport function getInitialState({\n  filterSetsConfig,\n  filterConfig,\n  state: prevState,\n}: {\n  filterSetsConfig?: FilterSet[];\n  filterConfig?: FilterConfiguration;\n  state?: NativeFiltersState;\n}): NativeFiltersState {\n  const state: Partial<NativeFiltersState> = {};\n\n  const filters = {};\n  if (filterConfig) {\n    filterConfig.forEach(filter => {\n      const { id } = filter;\n      filters[id] = filter;\n    });\n    state.filters = filters;\n  } else {\n    state.filters = prevState?.filters ?? {};\n  }\n\n  if (filterSetsConfig) {\n    const filterSets = {};\n    filterSetsConfig.forEach(filtersSet => {\n      const { id } = filtersSet;\n      filterSets[id] = filtersSet;\n    });\n    state.filterSets = filterSets;\n  } else {\n    state.filterSets = prevState?.filterSets ?? {};\n  }\n  state.focusedFilterId = undefined;\n  return state as NativeFiltersState;\n}\n\nexport default function nativeFilterReducer(\n  state: NativeFiltersState = {\n    filters: {},\n    filterSets: {},\n  },\n  action: AnyFilterAction,\n) {\n  switch (action.type) {\n    case HYDRATE_DASHBOARD:\n      return {\n        filters: action.data.nativeFilters.filters,\n        filterSets: action.data.nativeFilters.filterSets,\n      };\n\n    case SET_FILTER_CONFIG_COMPLETE:\n    case SET_IN_SCOPE_STATUS_OF_FILTERS:\n      return getInitialState({ filterConfig: action.filterConfig, state });\n\n    case SET_FILTER_SETS_COMPLETE:\n      return getInitialState({\n        filterSetsConfig: action.filterSets,\n        state,\n      });\n\n    case SET_FOCUSED_NATIVE_FILTER:\n      return {\n        ...state,\n        focusedFilterId: action.id,\n      };\n\n    case UNSET_FOCUSED_NATIVE_FILTER:\n      return {\n        ...state,\n        focusedFilterId: undefined,\n      };\n\n    case SET_HOVERED_NATIVE_FILTER:\n      return {\n        ...state,\n        hoveredFilterId: action.id,\n      };\n\n    case UNSET_HOVERED_NATIVE_FILTER:\n      return {\n        ...state,\n        hoveredFilterId: undefined,\n      };\n\n    case UPDATE_CASCADE_PARENT_IDS:\n      return {\n        ...state,\n        filters: {\n          ...state.filters,\n          [action.id]: {\n            ...state.filters[action.id],\n            cascadeParentIds: action.parentIds,\n          },\n        },\n      };\n    // TODO handle SET_FILTER_CONFIG_FAIL action\n    default:\n      return state;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ChartProps,\n  DataMaskStateWithId,\n  DatasourceType,\n  ExtraFormData,\n  GenericDataType,\n  JsonObject,\n  NativeFilterScope,\n  NativeFiltersState,\n} from '@superset-ui/core';\nimport { Dataset } from '@superset-ui/chart-controls';\nimport { chart } from 'src/components/Chart/chartReducer';\nimport componentTypes from 'src/dashboard/util/componentTypes';\nimport { UrlParamEntries } from 'src/utils/urlUtils';\n\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { ChartState } from '../explore/types';\n\nexport type { Dashboard } from 'src/types/Dashboard';\n\nexport type ChartReducerInitialState = typeof chart;\n\n// chart query built from initialState\n// Ref: https://github.com/apache/superset/blob/dcac860f3e5528ecbc39e58f045c7388adb5c3d0/superset-frontend/src/dashboard/reducers/getInitialState.js#L120\nexport interface ChartQueryPayload extends Partial<ChartReducerInitialState> {\n  id: number;\n  form_data?: ChartProps['rawFormData'];\n  [key: string]: unknown;\n}\n\n/** Chart state of redux */\nexport type Chart = ChartState & {\n  form_data: {\n    viz_type: string;\n    datasource: string;\n  };\n};\n\nexport enum FilterBarOrientation {\n  VERTICAL = 'VERTICAL',\n  HORIZONTAL = 'HORIZONTAL',\n}\n\n// chart's cross filter scoping can have its custom value or point to the global configuration\nexport const GLOBAL_SCOPE_POINTER = 'global';\nexport type GlobalScopePointer = typeof GLOBAL_SCOPE_POINTER;\nexport type ChartCrossFiltersConfig = {\n  scope: NativeFilterScope | GlobalScopePointer;\n  chartsInScope: number[];\n};\nexport type GlobalChartCrossFilterConfig = {\n  scope: NativeFilterScope;\n  chartsInScope: number[];\n};\nexport const isCrossFilterScopeGlobal = (\n  scope: NativeFilterScope | GlobalScopePointer,\n): scope is GlobalScopePointer => scope === GLOBAL_SCOPE_POINTER;\n\nexport type ChartConfiguration = {\n  [chartId: number]: {\n    id: number;\n    crossFilters: ChartCrossFiltersConfig;\n  };\n};\n\nexport type ActiveTabs = string[];\nexport type DashboardLayout = { [key: string]: LayoutItem };\nexport type DashboardLayoutState = { present: DashboardLayout };\nexport type DashboardState = {\n  preselectNativeFilters?: JsonObject;\n  editMode: boolean;\n  isPublished: boolean;\n  directPathToChild: string[];\n  activeTabs: ActiveTabs;\n  fullSizeChartId: number | null;\n  isRefreshing: boolean;\n  isFiltersRefreshing: boolean;\n  hasUnsavedChanges: boolean;\n  dashboardIsSaving: boolean;\n  colorScheme: string;\n  sliceIds: number[];\n  directPathLastUpdated: number;\n  focusedFilterField?: {\n    chartId: number;\n    column: string;\n  };\n  overwriteConfirmMetadata?: {\n    updatedAt: string;\n    updatedBy: string;\n    overwriteConfirmItems: {\n      keyPath: string;\n      oldValue: string;\n      newValue: string;\n    }[];\n    dashboardId: number;\n    data: JsonObject;\n  };\n};\nexport type DashboardInfo = {\n  id: number;\n  common: {\n    flash_messages: string[];\n    conf: JsonObject;\n  };\n  userId: string;\n  dash_edit_perm: boolean;\n  json_metadata: string;\n  metadata: {\n    native_filter_configuration: JsonObject;\n    chart_configuration: ChartConfiguration;\n    global_chart_configuration: GlobalChartCrossFilterConfig;\n    color_scheme: string;\n    color_namespace: string;\n    color_scheme_domain: string[];\n    label_colors: JsonObject;\n    shared_label_colors: JsonObject;\n    cross_filters_enabled: boolean;\n  };\n  crossFiltersEnabled: boolean;\n  filterBarOrientation: FilterBarOrientation;\n};\n\nexport type ChartsState = { [key: string]: Chart };\n\nexport type Datasource = Dataset & {\n  uid: string;\n  column_types: GenericDataType[];\n  table_name: string;\n};\nexport type DatasourcesState = {\n  [key: string]: Datasource;\n};\n\n/** Root state of redux */\nexport type RootState = {\n  datasources: DatasourcesState;\n  sliceEntities: JsonObject;\n  charts: ChartsState;\n  dashboardLayout: DashboardLayoutState;\n  dashboardFilters: {};\n  dashboardState: DashboardState;\n  dashboardInfo: DashboardInfo;\n  dataMask: DataMaskStateWithId;\n  impressionId: string;\n  nativeFilters: NativeFiltersState;\n  user: UserWithPermissionsAndRoles;\n};\n\n/** State of dashboardLayout in redux */\nexport type Layout = { [key: string]: LayoutItem };\n\n/** State of charts in redux */\nexport type Charts = { [key: number]: Chart };\n\ntype ComponentTypesKeys = keyof typeof componentTypes;\nexport type ComponentType = typeof componentTypes[ComponentTypesKeys];\n\n/** State of dashboardLayout item in redux */\nexport type LayoutItem = {\n  children: string[];\n  parents: string[];\n  type: ComponentType;\n  id: string;\n  meta: {\n    chartId: number;\n    defaultText?: string;\n    height: number;\n    placeholder?: string;\n    sliceName?: string;\n    sliceNameOverride?: string;\n    text?: string;\n    uuid: string;\n    width: number;\n  };\n};\n\ntype ActiveFilter = {\n  scope: number[];\n  values: ExtraFormData;\n};\n\nexport type ActiveFilters = {\n  [key: string]: ActiveFilter;\n};\n\nexport interface DashboardPermalinkState {\n  dataMask: DataMaskStateWithId;\n  activeTabs: string[];\n  anchor: string;\n  urlParams?: UrlParamEntries;\n}\n\nexport interface DashboardPermalinkValue {\n  dashboardId: string;\n  state: DashboardPermalinkState;\n}\n\nexport type EmbeddedDashboard = {\n  uuid: string;\n  dashboard_id: string;\n  allowed_domains: string[];\n};\n\nexport type Slice = {\n  slice_id: number;\n  slice_name: string;\n  description: string;\n  description_markdown: string;\n  form_data: any;\n  slice_url: string;\n  viz_type: string;\n  thumbnail_url: string;\n  changed_on: number;\n  changed_on_humanized: string;\n  modified: string;\n  datasource_id: number;\n  datasource_type: DatasourceType;\n  datasource_url: string;\n  datasource_name: string;\n  owners: { id: number }[];\n  created_by: { id: number };\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const CHART_TYPE = 'CHART';\nexport const COLUMN_TYPE = 'COLUMN';\nexport const DASHBOARD_HEADER_TYPE = 'HEADER';\nexport const DASHBOARD_GRID_TYPE = 'GRID';\nexport const DASHBOARD_ROOT_TYPE = 'ROOT';\nexport const DIVIDER_TYPE = 'DIVIDER';\nexport const HEADER_TYPE = 'HEADER';\nexport const MARKDOWN_TYPE = 'MARKDOWN';\nexport const NEW_COMPONENT_SOURCE_TYPE = 'NEW_COMPONENT_SOURCE';\nexport const ROW_TYPE = 'ROW';\nexport const TABS_TYPE = 'TABS';\nexport const TAB_TYPE = 'TAB';\n// Dynamic type proposes lazy loading of custom dashboard components that can be added in separate repository\nexport const DYNAMIC_TYPE = 'DYNAMIC';\n\nexport default {\n  CHART_TYPE,\n  COLUMN_TYPE,\n  DASHBOARD_HEADER_TYPE,\n  DASHBOARD_GRID_TYPE,\n  DASHBOARD_ROOT_TYPE,\n  DIVIDER_TYPE,\n  HEADER_TYPE,\n  MARKDOWN_TYPE,\n  NEW_COMPONENT_SOURCE_TYPE,\n  ROW_TYPE,\n  TABS_TYPE,\n  TAB_TYPE,\n  DYNAMIC_TYPE,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// Ids\nexport const DASHBOARD_GRID_ID = 'GRID_ID';\nexport const DASHBOARD_HEADER_ID = 'HEADER_ID';\nexport const DASHBOARD_ROOT_ID = 'ROOT_ID';\nexport const DASHBOARD_VERSION_KEY = 'DASHBOARD_VERSION_KEY';\n\nexport const NEW_COMPONENTS_SOURCE_ID = 'NEW_COMPONENTS_SOURCE_ID';\nexport const NEW_CHART_ID = 'NEW_CHART_ID';\nexport const NEW_COLUMN_ID = 'NEW_COLUMN_ID';\nexport const NEW_DIVIDER_ID = 'NEW_DIVIDER_ID';\nexport const NEW_HEADER_ID = 'NEW_HEADER_ID';\nexport const NEW_MARKDOWN_ID = 'NEW_MARKDOWN_ID';\nexport const NEW_ROW_ID = 'NEW_ROW_ID';\nexport const NEW_TAB_ID = 'NEW_TAB_ID';\nexport const NEW_TABS_ID = 'NEW_TABS_ID';\nexport const NEW_DYNAMIC_COMPONENT = 'NEW_DYNAMIC_COMPONENT';\n\n// grid constants\nexport const DASHBOARD_ROOT_DEPTH = 0;\nexport const GRID_BASE_UNIT = 8;\nexport const GRID_GUTTER_SIZE = 2 * GRID_BASE_UNIT;\nexport const GRID_COLUMN_COUNT = 12;\nexport const GRID_MIN_COLUMN_COUNT = 1;\nexport const GRID_MIN_ROW_UNITS = 5;\nexport const GRID_MAX_ROW_UNITS = 100;\nexport const GRID_MIN_ROW_HEIGHT = GRID_GUTTER_SIZE;\nexport const GRID_DEFAULT_CHART_WIDTH = 4;\n\n// Header types\nexport const SMALL_HEADER = 'SMALL_HEADER';\nexport const MEDIUM_HEADER = 'MEDIUM_HEADER';\nexport const LARGE_HEADER = 'LARGE_HEADER';\n\n// Style types\nexport const BACKGROUND_WHITE = 'BACKGROUND_WHITE';\nexport const BACKGROUND_TRANSPARENT = 'BACKGROUND_TRANSPARENT';\n\n// undo-redo\nexport const UNDO_LIMIT = 50;\n\n// save dash options\nexport const SAVE_TYPE_OVERWRITE = 'overwrite';\nexport const SAVE_TYPE_OVERWRITE_CONFIRMED = 'overwriteConfirmed';\nexport const SAVE_TYPE_NEWDASHBOARD = 'newDashboard';\n\n// default dashboard layout data size limit\n// could be overwritten by server-side config\nexport const DASHBOARD_POSITION_DATA_LIMIT = 65535;\n\n// in-component element types: can be added into\n// directPathToChild, used for in dashboard navigation and focus\nexport const IN_COMPONENT_ELEMENT_TYPES = ['LABEL'];\n\n// filter scope selector filter fields pane root id\nexport const ALL_FILTERS_ROOT = 'ALL_FILTERS_ROOT';\n\nexport enum DashboardStandaloneMode {\n  NONE = 0,\n  HIDE_NAV = 1,\n  HIDE_NAV_AND_TITLE = 2,\n  REPORT = 3,\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { cloneDeep } from 'lodash';\nimport {\n  Behavior,\n  FeatureFlag,\n  getChartMetadataRegistry,\n  isDefined,\n  isFeatureEnabled,\n} from '@superset-ui/core';\nimport { getChartIdsInFilterScope } from './getChartIdsInFilterScope';\nimport {\n  ChartsState,\n  DashboardInfo,\n  DashboardLayout,\n  GLOBAL_SCOPE_POINTER,\n  isCrossFilterScopeGlobal,\n} from '../types';\nimport { DEFAULT_CROSS_FILTER_SCOPING } from '../constants';\n\nexport const isCrossFiltersEnabled = (\n  metadataCrossFiltersEnabled: boolean | undefined,\n): boolean =>\n  isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n  (metadataCrossFiltersEnabled === undefined || metadataCrossFiltersEnabled);\n\nexport const getCrossFiltersConfiguration = (\n  dashboardLayout: DashboardLayout,\n  metadata: Pick<\n    DashboardInfo['metadata'],\n    'chart_configuration' | 'global_chart_configuration'\n  >,\n  charts: ChartsState,\n) => {\n  if (!isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n    return undefined;\n  }\n\n  const globalChartConfiguration = metadata.global_chart_configuration\n    ? cloneDeep(metadata.global_chart_configuration)\n    : {\n        scope: DEFAULT_CROSS_FILTER_SCOPING,\n        chartsInScope: Object.values(charts).map(chart => chart.id),\n      };\n\n  // If user just added cross filter to dashboard it's not saving its scope on server,\n  // so we tweak it until user will update scope and will save it in server\n  const chartConfiguration = {};\n  Object.values(dashboardLayout).forEach(layoutItem => {\n    const chartId = layoutItem.meta?.chartId;\n\n    if (!isDefined(chartId)) {\n      return;\n    }\n\n    const behaviors =\n      (\n        getChartMetadataRegistry().get(charts[chartId]?.form_data?.viz_type) ??\n        {}\n      )?.behaviors ?? [];\n\n    if (behaviors.includes(Behavior.INTERACTIVE_CHART)) {\n      if (metadata.chart_configuration?.[chartId]) {\n        // We need to clone to avoid mutating Redux state\n        chartConfiguration[chartId] = cloneDeep(\n          metadata.chart_configuration[chartId],\n        );\n      }\n      if (!chartConfiguration[chartId]) {\n        chartConfiguration[chartId] = {\n          id: chartId,\n          crossFilters: {\n            scope: GLOBAL_SCOPE_POINTER,\n          },\n        };\n      }\n      chartConfiguration[chartId].crossFilters.chartsInScope =\n        isCrossFilterScopeGlobal(chartConfiguration[chartId].crossFilters.scope)\n          ? globalChartConfiguration.chartsInScope.filter(\n              id => id !== Number(chartId),\n            )\n          : getChartIdsInFilterScope(\n              chartConfiguration[chartId].crossFilters.scope,\n              Object.values(charts).map(chart => chart.id),\n              dashboardLayout,\n            );\n    }\n  });\n\n  return { chartConfiguration, globalChartConfiguration };\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport querystring from 'query-string';\nimport { JsonObject } from '@superset-ui/core';\n\nconst reservedQueryParams = new Set(['standalone', 'edit']);\n\nexport type UrlParamType = 'reserved' | 'regular' | 'all';\n\n/**\n * Returns the url params that are used to customize queries\n */\nexport default function extractUrlParams(\n  urlParamType: UrlParamType,\n): JsonObject {\n  const queryParams = querystring.parse(window.location.search);\n  return Object.entries(queryParams).reduce((acc, [key, value]) => {\n    if (\n      (urlParamType === 'regular' && reservedQueryParams.has(key)) ||\n      (urlParamType === 'reserved' && !reservedQueryParams.has(key))\n    )\n      return acc;\n    // if multiple url params share the same key (?foo=bar&foo=baz), they will appear as an array.\n    // Only one value can be used for a given query param, so we just take the first one.\n    if (Array.isArray(value)) {\n      return {\n        ...acc,\n        [key]: value[0],\n      };\n    }\n    return { ...acc, [key]: value };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ninterface ILayoutItem {\n  [key: string]: {\n    id: string;\n    children: string[];\n  };\n}\n\ninterface IStructure {\n  childId: string;\n  layout: ILayoutItem;\n}\n\nfunction findParentId(structure: IStructure): string | null {\n  let parentId = null;\n  if (structure) {\n    const { childId, layout = {} } = structure;\n    // default assignment to layout only works if value is undefined, not null\n    if (layout) {\n      const ids = Object.keys(layout);\n      for (let i = 0; i <= ids.length - 1; i += 1) {\n        const id = ids[i];\n        const component = layout[id] || {};\n        if (id !== childId && component?.children?.includes?.(childId)) {\n          parentId = id;\n          break;\n        }\n      }\n    }\n  }\n  return parentId;\n}\n\nconst cache = {};\nexport default function findParentIdWithCache(\n  structure: IStructure,\n): string | null {\n  let parentId = null;\n  if (structure) {\n    const { childId, layout = {} } = structure;\n    if (cache[childId]) {\n      const lastParent = layout?.[cache[childId]] || {};\n      if (lastParent?.children && lastParent?.children?.includes?.(childId)) {\n        return lastParent.id;\n      }\n    }\n    parentId = findParentId({ childId, layout });\n    cache[childId] = parentId;\n  }\n  return parentId;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { NativeFilterScope } from '@superset-ui/core';\nimport { CHART_TYPE } from './componentTypes';\nimport { Layout } from '../types';\n\nexport function getChartIdsInFilterScope(\n  filterScope: NativeFilterScope,\n  chartIds: number[],\n  layout: Layout,\n) {\n  const layoutItems = Object.values(layout);\n  return chartIds.filter(\n    chartId =>\n      !filterScope.excluded.includes(chartId) &&\n      layoutItems\n        .find(\n          layoutItem =>\n            layoutItem?.type === CHART_TYPE &&\n            layoutItem.meta?.chartId === chartId,\n        )\n        ?.parents?.some(elementId => filterScope.rootPath.includes(elementId)),\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\ninterface GetDashboardFilterKeyProps {\n  chartId: string;\n  column: string;\n}\n\nexport function getDashboardFilterKey({\n  chartId,\n  column,\n}: GetDashboardFilterKeyProps) {\n  return `${chartId}_${column}`;\n}\n\nconst filterKeySplitter = /^([0-9]+)_(.*)$/;\n\nexport function getChartIdAndColumnFromFilterKey(key: string) {\n  const match = filterKeySplitter.exec(key);\n  if (!match) throw new Error('Cannot parse invalid filter key');\n  return { chartId: parseInt(match[1], 10), column: match[2] };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function getLocationHash() {\n  return (window.location.hash || '#').substring(1);\n}\n","import {\n  ColorSchemeConfig,\n  FeatureFlagMap,\n  JsonObject,\n  LanguagePack,\n  Locale,\n  SequentialSchemeConfig,\n} from '@superset-ui/core';\nimport { FormatLocaleDefinition } from 'd3-format';\nimport { isPlainObject } from 'lodash';\nimport { Languages } from 'src/features/home/LanguagePicker';\nimport { FlashMessage } from '../components/FlashProvider';\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport type User = {\n  createdOn?: string;\n  email?: string;\n  firstName: string;\n  isActive: boolean;\n  isAnonymous: boolean;\n  lastName: string;\n  userId?: number; // optional because guest user doesn't have a user id\n  username: string;\n};\n\nexport type UserRoles = Record<string, [string, string][]>;\nexport interface PermissionsAndRoles {\n  permissions: {\n    database_access?: string[];\n    datasource_access?: string[];\n  };\n  roles: UserRoles;\n}\n\nexport type UserWithPermissionsAndRoles = User & PermissionsAndRoles;\n\nexport type UndefinedUser = {};\n\nexport type BootstrapUser = UserWithPermissionsAndRoles | undefined;\n\nexport type Dashboard = {\n  dttm: number;\n  id: number;\n  url: string;\n  title: string;\n  creator?: string;\n  creator_url?: string;\n};\n\nexport type DashboardData = {\n  dashboard_title?: string;\n  created_on_delta_humanized?: string;\n  url: string;\n};\n\nexport type DashboardResponse = {\n  result: DashboardData[];\n};\n\nexport type ChartData = {\n  slice_name: string;\n  created_on_delta_humanized?: string;\n  url: string;\n};\n\nexport type ChartResponse = {\n  result: ChartData[];\n};\n\nexport interface BrandProps {\n  path: string;\n  icon: string;\n  alt: string;\n  tooltip: string;\n  text: string;\n}\n\nexport interface NavBarProps {\n  show_watermark: boolean;\n  bug_report_url?: string;\n  bug_report_text?: string;\n  bug_report_icon?: string;\n  version_string?: string;\n  version_sha?: string;\n  build_number?: string;\n  documentation_url?: string;\n  documentation_text?: string;\n  documentation_icon?: string;\n  languages: Languages;\n  show_language_picker: boolean;\n  user_is_anonymous: boolean;\n  user_info_url: string;\n  user_login_url: string;\n  user_logout_url: string;\n  user_profile_url: string | null;\n  locale: string;\n}\n\nexport interface MenuObjectChildProps {\n  label: string;\n  name?: string;\n  icon?: string;\n  index?: number;\n  url?: string;\n  isFrontendRoute?: boolean;\n  perm?: string | boolean;\n  view?: string;\n  disable?: boolean;\n}\n\nexport interface MenuObjectProps extends MenuObjectChildProps {\n  childs?: (MenuObjectChildProps | string)[];\n  isHeader?: boolean;\n}\n\nexport interface MenuData {\n  menu: MenuObjectProps[];\n  brand: BrandProps;\n  navbar_right: NavBarProps;\n  settings: MenuObjectProps[];\n  environment_tag: {\n    text: string;\n    color: string;\n  };\n}\n\nexport interface CommonBootstrapData {\n  flash_messages: FlashMessage[];\n  conf: JsonObject;\n  locale: Locale;\n  feature_flags: FeatureFlagMap;\n  language_pack: LanguagePack;\n  extra_categorical_color_schemes: ColorSchemeConfig[];\n  extra_sequential_color_schemes: SequentialSchemeConfig[];\n  theme_overrides: JsonObject;\n  menu_data: MenuData;\n  d3_format: Partial<FormatLocaleDefinition>;\n}\n\nexport interface BootstrapData {\n  user?: BootstrapUser;\n  common: CommonBootstrapData;\n  config?: any;\n  embedded?: {\n    dashboard_id: string;\n  };\n}\n\nexport function isUser(user: any): user is User {\n  return isPlainObject(user) && 'username' in user;\n}\n\nexport function isUserWithPermissionsAndRoles(\n  user: any,\n): user is UserWithPermissionsAndRoles {\n  return isUser(user) && 'permissions' in user && 'roles' in user;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  isUserWithPermissionsAndRoles,\n  UndefinedUser,\n  UserWithPermissionsAndRoles,\n} from 'src/types/bootstrapTypes';\nimport { Dashboard } from 'src/types/Dashboard';\nimport { findPermission } from 'src/utils/findPermission';\n\n// this should really be a config value,\n// but is hardcoded in backend logic already, so...\nconst ADMIN_ROLE_NAME = 'admin';\nconst SQL_LAB_ROLE = 'sql_lab';\n\nexport const isUserAdmin = (\n  user?: UserWithPermissionsAndRoles | UndefinedUser,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  Object.keys(user.roles || {}).some(\n    role => role.toLowerCase() === ADMIN_ROLE_NAME,\n  );\n\nconst isUserDashboardOwner = (\n  dashboard: Dashboard,\n  user: UserWithPermissionsAndRoles | UndefinedUser,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  dashboard.owners.some(owner => owner.id === user.userId);\n\nexport const canUserEditDashboard = (\n  dashboard: Dashboard,\n  user?: UserWithPermissionsAndRoles | UndefinedUser | null,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  (isUserAdmin(user) || isUserDashboardOwner(dashboard, user)) &&\n  findPermission('can_write', 'Dashboard', user?.roles);\n\nexport function canUserAccessSqlLab(\n  user?: UserWithPermissionsAndRoles | UndefinedUser,\n) {\n  return (\n    isUserAdmin(user) ||\n    (isUserWithPermissionsAndRoles(user) &&\n      Object.keys(user.roles || {}).some(\n        role => role.toLowerCase() === SQL_LAB_ROLE,\n      ))\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  DataMask,\n  FeatureFlag,\n  FilterConfiguration,\n  Filters,\n} from '@superset-ui/core';\nimport { isFeatureEnabled } from '../featureFlags';\nimport { getInitialDataMask } from './reducer';\n\nexport const CLEAR_DATA_MASK_STATE = 'CLEAR_DATA_MASK_STATE';\nexport interface ClearDataMaskState {\n  type: typeof CLEAR_DATA_MASK_STATE;\n}\n\nexport const UPDATE_DATA_MASK = 'UPDATE_DATA_MASK';\nexport interface UpdateDataMask {\n  type: typeof UPDATE_DATA_MASK;\n  filterId: string | number;\n  dataMask: DataMask;\n}\n\nexport const INIT_DATAMASK = 'INIT_DATAMASK';\nexport interface INITDATAMASK {\n  type: typeof INIT_DATAMASK;\n  dataMask: DataMask;\n}\n\nexport const SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE =\n  'SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE';\n\nexport interface SetDataMaskForFilterConfigComplete {\n  type: typeof SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE;\n  filterConfig: FilterConfiguration;\n  filters?: Filters;\n}\n\nexport const SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL =\n  'SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL';\n\nexport interface SetDataMaskForFilterConfigFail {\n  type: typeof SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL;\n  filterConfig: FilterConfiguration;\n}\nexport function setDataMaskForFilterConfigComplete(\n  filterConfig: FilterConfiguration,\n  filters?: Filters,\n): SetDataMaskForFilterConfigComplete {\n  return {\n    type: SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE,\n    filterConfig,\n    filters,\n  };\n}\nexport function updateDataMask(\n  filterId: string | number,\n  dataMask: DataMask,\n): UpdateDataMask {\n  // Only apply data mask if one of the relevant features is enabled\n  const isFeatureFlagActive =\n    isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS) ||\n    isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS);\n  return {\n    type: UPDATE_DATA_MASK,\n    filterId,\n    dataMask: isFeatureFlagActive ? dataMask : {},\n  };\n}\n\nexport function clearDataMask(filterId: string | number) {\n  return updateDataMask(filterId, getInitialDataMask(filterId));\n}\n\nexport function clearDataMaskState(): ClearDataMaskState {\n  return {\n    type: CLEAR_DATA_MASK_STATE,\n  };\n}\n\nexport type AnyDataMaskAction =\n  | ClearDataMaskState\n  | UpdateDataMask\n  | SetDataMaskForFilterConfigFail\n  | SetDataMaskForFilterConfigComplete;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-param-reassign */\n// <- When we work with Immer, we need reassign, so disabling lint\nimport produce from 'immer';\nimport {\n  DataMask,\n  DataMaskStateWithId,\n  DataMaskWithId,\n  FeatureFlag,\n  Filter,\n  FilterConfiguration,\n  Filters,\n} from '@superset-ui/core';\nimport { NATIVE_FILTER_PREFIX } from 'src/dashboard/components/nativeFilters/FiltersConfigModal/utils';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport {\n  AnyDataMaskAction,\n  CLEAR_DATA_MASK_STATE,\n  SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE,\n  UPDATE_DATA_MASK,\n} from './actions';\nimport { areObjectsEqual } from '../reduxUtils';\n\nexport function getInitialDataMask(\n  id?: string | number,\n  moreProps?: DataMask,\n): DataMask;\nexport function getInitialDataMask(\n  id: string | number,\n  moreProps: DataMask = {},\n): DataMaskWithId {\n  let otherProps = {};\n  if (id) {\n    otherProps = {\n      id,\n    };\n  }\n  return {\n    ...otherProps,\n    extraFormData: {},\n    filterState: {},\n    ownState: {},\n    ...moreProps,\n  } as DataMaskWithId;\n}\n\nfunction fillNativeFilters(\n  filterConfig: FilterConfiguration,\n  mergedDataMask: DataMaskStateWithId,\n  draftDataMask: DataMaskStateWithId,\n  initialDataMask?: DataMaskStateWithId,\n  currentFilters?: Filters,\n) {\n  filterConfig.forEach((filter: Filter) => {\n    const dataMask = initialDataMask || {};\n    mergedDataMask[filter.id] = {\n      ...getInitialDataMask(filter.id), // take initial data\n      ...filter.defaultDataMask, // if something new came from BE - take it\n      ...dataMask[filter.id],\n    };\n    if (\n      currentFilters &&\n      !areObjectsEqual(\n        filter.defaultDataMask,\n        currentFilters[filter.id]?.defaultDataMask,\n        { ignoreUndefined: true },\n      )\n    ) {\n      mergedDataMask[filter.id] = {\n        ...mergedDataMask[filter.id],\n        ...filter.defaultDataMask,\n      };\n    }\n  });\n\n  // Get back all other non-native filters\n  Object.values(draftDataMask).forEach(filter => {\n    if (!String(filter?.id).startsWith(NATIVE_FILTER_PREFIX)) {\n      mergedDataMask[filter?.id] = filter;\n    }\n  });\n}\n\nconst dataMaskReducer = produce(\n  (draft: DataMaskStateWithId, action: AnyDataMaskAction) => {\n    const cleanState = {};\n    switch (action.type) {\n      case CLEAR_DATA_MASK_STATE:\n        return cleanState;\n      case UPDATE_DATA_MASK:\n        draft[action.filterId] = {\n          ...getInitialDataMask(action.filterId),\n          ...draft[action.filterId],\n          ...action.dataMask,\n        };\n        return draft;\n      // TODO: update hydrate to .ts\n      // @ts-ignore\n      case HYDRATE_DASHBOARD:\n        if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n          Object.keys(\n            // @ts-ignore\n            action.data.dashboardInfo?.metadata?.chart_configuration,\n          ).forEach(id => {\n            cleanState[id] = {\n              ...getInitialDataMask(id), // take initial data\n            };\n          });\n        }\n        fillNativeFilters(\n          // @ts-ignore\n          action.data.dashboardInfo?.metadata?.native_filter_configuration ??\n            [],\n          cleanState,\n          draft,\n          // @ts-ignore\n          action.data.dataMask,\n        );\n        return cleanState;\n      case SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE:\n        fillNativeFilters(\n          action.filterConfig ?? [],\n          cleanState,\n          draft,\n          action.filters,\n        );\n        return cleanState;\n\n      default:\n        return draft;\n    }\n  },\n  {},\n);\n\nexport default dataMaskReducer;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Dispatch, AnyAction } from 'redux';\nimport { ThunkDispatch } from 'redux-thunk';\nimport { Dataset } from '@superset-ui/chart-controls';\nimport { SupersetClient } from '@superset-ui/core';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { updateFormDataByDatasource } from './exploreActions';\nimport { ExplorePageState } from '../types';\n\nexport const SET_DATASOURCE = 'SET_DATASOURCE';\nexport interface SetDatasource {\n  type: string;\n  datasource: Dataset;\n}\nexport function setDatasource(datasource: Dataset) {\n  return { type: SET_DATASOURCE, datasource };\n}\n\nexport function changeDatasource(newDatasource: Dataset) {\n  return function (dispatch: Dispatch, getState: () => ExplorePageState) {\n    const {\n      explore: { datasource: prevDatasource },\n    } = getState();\n    dispatch(setDatasource(newDatasource));\n    dispatch(updateFormDataByDatasource(prevDatasource, newDatasource));\n  };\n}\n\nexport function saveDataset({\n  schema,\n  sql,\n  database,\n  templateParams,\n  datasourceName,\n  columns,\n}: Omit<SqlLabPostRequest['data'], 'dbId'> & { database: { id: number } }) {\n  return async function (dispatch: ThunkDispatch<any, undefined, AnyAction>) {\n    // Create a dataset object\n    try {\n      const {\n        json: { data },\n      } = await SupersetClient.post({\n        endpoint: '/api/v1/dataset/',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          database: database?.id,\n          table_name: datasourceName,\n          schema,\n          sql,\n          template_params: templateParams,\n          columns,\n        }),\n      });\n      // Update form_data to point to new dataset\n      dispatch(changeDatasource(data));\n      return data;\n    } catch (error) {\n      getClientErrorObject(error).then(e => {\n        dispatch(addDangerToast(e.error));\n      });\n      throw error;\n    }\n  };\n}\n\nexport const datasourcesActions = {\n  setDatasource,\n  changeDatasource,\n  saveDataset,\n};\n\nexport type AnyDatasourcesAction = SetDatasource;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport rison from 'rison';\nimport { Dataset } from '@superset-ui/chart-controls';\nimport { t, SupersetClient, QueryFormData } from '@superset-ui/core';\nimport { Dispatch } from 'redux';\nimport {\n  addDangerToast,\n  toastActions,\n} from 'src/components/MessageToasts/actions';\nimport { Slice } from 'src/types/Chart';\nimport { SaveActionType } from 'src/explore/types';\n\nexport const UPDATE_FORM_DATA_BY_DATASOURCE = 'UPDATE_FORM_DATA_BY_DATASOURCE';\nexport function updateFormDataByDatasource(\n  prevDatasource: Dataset,\n  newDatasource: Dataset,\n) {\n  return {\n    type: UPDATE_FORM_DATA_BY_DATASOURCE,\n    prevDatasource,\n    newDatasource,\n  };\n}\n\nexport const POST_DATASOURCE_STARTED = 'POST_DATASOURCE_STARTED';\nexport const FETCH_DATASOURCE_SUCCEEDED = 'FETCH_DATASOURCE_SUCCEEDED';\nexport function fetchDatasourceSucceeded() {\n  return { type: FETCH_DATASOURCE_SUCCEEDED };\n}\n\nexport const FETCH_DATASOURCES_STARTED = 'FETCH_DATASOURCES_STARTED';\nexport function fetchDatasourcesStarted() {\n  return { type: FETCH_DATASOURCES_STARTED };\n}\n\nexport const FETCH_DATASOURCES_SUCCEEDED = 'FETCH_DATASOURCES_SUCCEEDED';\nexport function fetchDatasourcesSucceeded() {\n  return { type: FETCH_DATASOURCES_SUCCEEDED };\n}\n\nexport const TOGGLE_FAVE_STAR = 'TOGGLE_FAVE_STAR';\nexport function toggleFaveStar(isStarred: boolean) {\n  return { type: TOGGLE_FAVE_STAR, isStarred };\n}\n\nexport const FETCH_FAVE_STAR = 'FETCH_FAVE_STAR';\nexport function fetchFaveStar(sliceId: string) {\n  return function (dispatch: Dispatch) {\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/favorite_status/?q=${rison.encode([sliceId])}`,\n    }).then(({ json }) => {\n      dispatch(toggleFaveStar(!!json?.result?.[0]?.value));\n    });\n  };\n}\n\nexport const SAVE_FAVE_STAR = 'SAVE_FAVE_STAR';\nexport function saveFaveStar(sliceId: string, isStarred: boolean) {\n  return function (dispatch: Dispatch) {\n    const endpoint = `/api/v1/chart/${sliceId}/favorites/`;\n    const apiCall = isStarred\n      ? SupersetClient.delete({\n          endpoint,\n        })\n      : SupersetClient.post({ endpoint });\n\n    apiCall\n      .then(() => dispatch(toggleFaveStar(!isStarred)))\n      .catch(() => {\n        dispatch(\n          addDangerToast(t('An error occurred while starring this chart')),\n        );\n      });\n  };\n}\n\nexport const SET_FIELD_VALUE = 'SET_FIELD_VALUE';\nexport function setControlValue(\n  controlName: string,\n  value: any,\n  validationErrors?: any[],\n) {\n  return { type: SET_FIELD_VALUE, controlName, value, validationErrors };\n}\n\nexport const SET_EXPLORE_CONTROLS = 'UPDATE_EXPLORE_CONTROLS';\nexport function setExploreControls(formData: QueryFormData) {\n  return { type: SET_EXPLORE_CONTROLS, formData };\n}\n\nexport const SET_FORM_DATA = 'UPDATE_FORM_DATA';\nexport function setFormData(formData: QueryFormData) {\n  return { type: SET_FORM_DATA, formData };\n}\n\nexport const UPDATE_CHART_TITLE = 'UPDATE_CHART_TITLE';\nexport function updateChartTitle(sliceName: string) {\n  return { type: UPDATE_CHART_TITLE, sliceName };\n}\n\nexport const SET_SAVE_ACTION = 'SET_SAVE_ACTION';\nexport function setSaveAction(saveAction: SaveActionType | null) {\n  return { type: SET_SAVE_ACTION, saveAction };\n}\n\nexport const CREATE_NEW_SLICE = 'CREATE_NEW_SLICE';\nexport function createNewSlice(\n  can_add: boolean,\n  can_download: boolean,\n  can_overwrite: boolean,\n  slice: Slice,\n  form_data: QueryFormData,\n) {\n  return {\n    type: CREATE_NEW_SLICE,\n    can_add,\n    can_download,\n    can_overwrite,\n    slice,\n    form_data,\n  };\n}\n\nexport const SLICE_UPDATED = 'SLICE_UPDATED';\nexport function sliceUpdated(slice: Slice) {\n  return { type: SLICE_UPDATED, slice };\n}\n\nexport const SET_FORCE_QUERY = 'SET_FORCE_QUERY';\nexport function setForceQuery(force: boolean) {\n  return {\n    type: SET_FORCE_QUERY,\n    force,\n  };\n}\n\nexport const exploreActions = {\n  ...toastActions,\n  fetchDatasourcesStarted,\n  fetchDatasourcesSucceeded,\n  toggleFaveStar,\n  fetchFaveStar,\n  saveFaveStar,\n  setControlValue,\n  setExploreControls,\n  updateChartTitle,\n  createNewSlice,\n  sliceUpdated,\n  setForceQuery,\n};\n\nexport type ExploreActions = typeof exploreActions;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ControlStateMapping } from '@superset-ui/chart-controls';\n\nimport {\n  ChartState,\n  ExplorePageInitialData,\n  ExplorePageState,\n} from 'src/explore/types';\nimport { getChartKey } from 'src/explore/exploreUtils';\nimport { getControlsState } from 'src/explore/store';\nimport { Dispatch } from 'redux';\nimport {\n  ensureIsArray,\n  getCategoricalSchemeRegistry,\n  getColumnLabel,\n  getSequentialSchemeRegistry,\n  hasGenericChartAxes,\n  NO_TIME_RANGE,\n  QueryFormColumn,\n} from '@superset-ui/core';\nimport {\n  getFormDataFromControls,\n  applyMapStateToPropsToControl,\n} from 'src/explore/controlUtils';\nimport { getDatasourceUid } from 'src/utils/getDatasourceUid';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { URL_PARAMS } from 'src/constants';\nimport { findPermission } from 'src/utils/findPermission';\n\nenum ColorSchemeType {\n  CATEGORICAL = 'CATEGORICAL',\n  SEQUENTIAL = 'SEQUENTIAL',\n}\n\nexport const HYDRATE_EXPLORE = 'HYDRATE_EXPLORE';\nexport const hydrateExplore =\n  ({\n    form_data,\n    slice,\n    dataset,\n    metadata,\n    saveAction = null,\n  }: ExplorePageInitialData) =>\n  (dispatch: Dispatch, getState: () => ExplorePageState) => {\n    const { user, datasources, charts, sliceEntities, common, explore } =\n      getState();\n\n    const sliceId = getUrlParam(URL_PARAMS.sliceId);\n    const dashboardId = getUrlParam(URL_PARAMS.dashboardId);\n    const fallbackSlice = sliceId ? sliceEntities?.slices?.[sliceId] : null;\n    const initialSlice = slice ?? fallbackSlice;\n    const initialFormData = form_data ?? initialSlice?.form_data;\n    if (!initialFormData.viz_type) {\n      const defaultVizType = common?.conf.DEFAULT_VIZ_TYPE || 'table';\n      initialFormData.viz_type =\n        getUrlParam(URL_PARAMS.vizType) || defaultVizType;\n    }\n    if (!initialFormData.time_range) {\n      initialFormData.time_range =\n        common?.conf?.DEFAULT_TIME_FILTER || NO_TIME_RANGE;\n    }\n    if (\n      hasGenericChartAxes &&\n      initialFormData.include_time &&\n      initialFormData.granularity_sqla &&\n      !initialFormData.groupby?.some(\n        (col: QueryFormColumn) =>\n          getColumnLabel(col) ===\n          getColumnLabel(initialFormData.granularity_sqla!),\n      )\n    ) {\n      initialFormData.groupby = [\n        initialFormData.granularity_sqla,\n        ...ensureIsArray(initialFormData.groupby),\n      ];\n      initialFormData.granularity_sqla = undefined;\n    }\n\n    if (dashboardId) {\n      initialFormData.dashboardId = dashboardId;\n    }\n\n    const initialDatasource = dataset;\n\n    const initialExploreState = {\n      form_data: initialFormData,\n      slice: initialSlice,\n      datasource: initialDatasource,\n    };\n    const initialControls = getControlsState(\n      initialExploreState,\n      initialFormData,\n    ) as ControlStateMapping;\n    const colorSchemeKey = initialControls.color_scheme && 'color_scheme';\n    const linearColorSchemeKey =\n      initialControls.linear_color_scheme && 'linear_color_scheme';\n    // if the selected color scheme does not exist anymore\n    // fallbacks and selects the available default one\n    const verifyColorScheme = (type: ColorSchemeType) => {\n      const schemes =\n        type === 'CATEGORICAL'\n          ? getCategoricalSchemeRegistry()\n          : getSequentialSchemeRegistry();\n      const key =\n        type === 'CATEGORICAL' ? colorSchemeKey : linearColorSchemeKey;\n      const registryDefaultScheme = schemes.defaultKey;\n      const defaultScheme =\n        type === 'CATEGORICAL' ? 'supersetColors' : 'superset_seq_1';\n      const currentScheme = initialFormData[key];\n      const colorSchemeExists = !!schemes.get(currentScheme, true);\n\n      if (currentScheme && !colorSchemeExists) {\n        initialControls[key].value = registryDefaultScheme || defaultScheme;\n      }\n    };\n\n    if (colorSchemeKey) verifyColorScheme(ColorSchemeType.CATEGORICAL);\n    if (linearColorSchemeKey) verifyColorScheme(ColorSchemeType.SEQUENTIAL);\n\n    const exploreState = {\n      // note this will add `form_data` to state,\n      // which will be manipulable by future reducers.\n      can_add: findPermission('can_write', 'Chart', user?.roles),\n      can_download: findPermission('can_csv', 'Superset', user?.roles),\n      can_overwrite: ensureIsArray(slice?.owners).includes(\n        user?.userId as number,\n      ),\n      isDatasourceMetaLoading: false,\n      isStarred: false,\n      triggerRender: false,\n      // duplicate datasource in exploreState - it's needed by getControlsState\n      datasource: initialDatasource,\n      // Initial control state will skip `control.mapStateToProps`\n      // because `bootstrapData.controls` is undefined.\n      controls: initialControls,\n      form_data: initialFormData,\n      slice: initialSlice,\n      controlsTransferred: explore.controlsTransferred,\n      standalone: getUrlParam(URL_PARAMS.standalone),\n      force: getUrlParam(URL_PARAMS.force),\n      metadata,\n      saveAction,\n      common,\n    };\n\n    // apply initial mapStateToProps for all controls, must execute AFTER\n    // bootstrapState has initialized `controls`. Order of execution is not\n    // guaranteed, so controls shouldn't rely on each other's mapped state.\n    Object.entries(exploreState.controls).forEach(([key, controlState]) => {\n      exploreState.controls[key] = applyMapStateToPropsToControl(\n        controlState,\n        exploreState,\n      );\n    });\n    const sliceFormData = initialSlice\n      ? getFormDataFromControls(initialControls)\n      : null;\n\n    const chartKey: number = getChartKey(initialExploreState);\n    const chart: ChartState = {\n      id: chartKey,\n      chartAlert: null,\n      chartStatus: null,\n      chartStackTrace: null,\n      chartUpdateEndTime: null,\n      chartUpdateStartTime: 0,\n      latestQueryFormData: getFormDataFromControls(exploreState.controls),\n      sliceFormData,\n      queryController: null,\n      queriesResponse: null,\n      triggerQuery: false,\n      lastRendered: 0,\n    };\n\n    return dispatch({\n      type: HYDRATE_EXPLORE,\n      data: {\n        charts: {\n          ...charts,\n          [chartKey]: chart,\n        },\n        datasources: {\n          ...datasources,\n          [getDatasourceUid(initialDatasource)]: initialDatasource,\n        },\n        saveModal: {\n          dashboards: [],\n          saveModalAlert: null,\n          isVisible: false,\n        },\n        explore: exploreState,\n      },\n    });\n  };\n\nexport type HydrateExplore = {\n  type: typeof HYDRATE_EXPLORE;\n  data: ExplorePageState;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { List, ListItemProps } from 'src/components';\n\nexport interface CustomListItemProps extends ListItemProps {\n  selectable: boolean;\n}\n\nexport default function CustomListItem(props: CustomListItemProps) {\n  const { selectable, children, ...rest } = props;\n  const theme = useTheme();\n  const css = {\n    '&.ant-list-item': {\n      padding: `${theme.gridUnit + 2}px ${theme.gridUnit * 3}px`,\n      ':first-of-type': {\n        borderTopLeftRadius: theme.gridUnit,\n        borderTopRightRadius: theme.gridUnit,\n      },\n      ':last-of-type': {\n        borderBottomLeftRadius: theme.gridUnit,\n        borderBottomRightRadius: theme.gridUnit,\n      },\n    },\n  };\n\n  if (selectable) {\n    css['&:hover'] = {\n      cursor: 'pointer',\n      backgroundColor: theme.colors.grayscale.light4,\n    };\n  }\n\n  return (\n    <List.Item {...rest} css={css}>\n      {children}\n    </List.Item>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport { connect } from 'react-redux';\nimport { t, withTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport AsyncEsmComponent from 'src/components/AsyncEsmComponent';\nimport { getChartKey } from 'src/explore/exploreUtils';\nimport { runAnnotationQuery } from 'src/components/Chart/chartAction';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport ControlPopover, {\n  getSectionContainerElement,\n} from '../ControlPopover/ControlPopover';\n\nconst AnnotationLayer = AsyncEsmComponent(\n  () => import('./AnnotationLayer'),\n  // size of overlay inner content\n  () => <div style={{ width: 450, height: 368 }} />,\n);\n\nconst propTypes = {\n  colorScheme: PropTypes.string.isRequired,\n  annotationError: PropTypes.object,\n  annotationQuery: PropTypes.object,\n  vizType: PropTypes.string,\n\n  validationErrors: PropTypes.array,\n  name: PropTypes.string.isRequired,\n  actions: PropTypes.object,\n  value: PropTypes.arrayOf(PropTypes.object),\n  onChange: PropTypes.func,\n  refreshAnnotationData: PropTypes.func,\n};\n\nconst defaultProps = {\n  vizType: '',\n  value: [],\n  annotationError: {},\n  annotationQuery: {},\n  onChange: () => {},\n};\n\nclass AnnotationLayerControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      popoverVisible: {},\n      addedAnnotationIndex: null,\n    };\n    this.addAnnotationLayer = this.addAnnotationLayer.bind(this);\n    this.removeAnnotationLayer = this.removeAnnotationLayer.bind(this);\n    this.handleVisibleChange = this.handleVisibleChange.bind(this);\n  }\n\n  componentDidMount() {\n    // preload the AnnotationLayer component and dependent libraries i.e. mathjs\n    AnnotationLayer.preload();\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const { name, annotationError, validationErrors, value } = nextProps;\n    if (Object.keys(annotationError).length && !validationErrors.length) {\n      this.props.actions.setControlValue(\n        name,\n        value,\n        Object.keys(annotationError),\n      );\n    }\n    if (!Object.keys(annotationError).length && validationErrors.length) {\n      this.props.actions.setControlValue(name, value, []);\n    }\n  }\n\n  addAnnotationLayer(originalAnnotation, newAnnotation) {\n    let annotations = this.props.value;\n    if (annotations.includes(originalAnnotation)) {\n      annotations = annotations.map(anno =>\n        anno === originalAnnotation ? newAnnotation : anno,\n      );\n    } else {\n      annotations = [...annotations, newAnnotation];\n      this.setState({ addedAnnotationIndex: annotations.length - 1 });\n    }\n\n    this.props.refreshAnnotationData({\n      annotation: newAnnotation,\n      force: true,\n    });\n\n    this.props.onChange(annotations);\n  }\n\n  handleVisibleChange(visible, popoverKey) {\n    this.setState(prevState => ({\n      popoverVisible: { ...prevState.popoverVisible, [popoverKey]: visible },\n    }));\n  }\n\n  removeAnnotationLayer(annotation) {\n    const annotations = this.props.value.filter(anno => anno !== annotation);\n    // So scrollbar doesnt get stuck on hidden\n    const element = getSectionContainerElement();\n    if (element) {\n      element.style.setProperty('overflow-y', 'auto', 'important');\n    }\n    this.props.onChange(annotations);\n  }\n\n  renderPopover(popoverKey, annotation, error) {\n    const id = annotation?.name || '_new';\n\n    return (\n      <div id={`annotation-pop-${id}`} data-test=\"popover-content\">\n        <AnnotationLayer\n          {...annotation}\n          error={error}\n          colorScheme={this.props.colorScheme}\n          vizType={this.props.vizType}\n          addAnnotationLayer={newAnnotation =>\n            this.addAnnotationLayer(annotation, newAnnotation)\n          }\n          removeAnnotationLayer={() => this.removeAnnotationLayer(annotation)}\n          close={() => {\n            this.handleVisibleChange(false, popoverKey);\n            this.setState({ addedAnnotationIndex: null });\n          }}\n        />\n      </div>\n    );\n  }\n\n  renderInfo(anno) {\n    const { annotationError, annotationQuery, theme } = this.props;\n    if (annotationQuery[anno.name]) {\n      return (\n        <i\n          className=\"fa fa-refresh\"\n          style={{ color: theme.colors.primary.base }}\n          aria-hidden\n        />\n      );\n    }\n    if (annotationError[anno.name]) {\n      return (\n        <InfoTooltipWithTrigger\n          label=\"validation-errors\"\n          bsStyle=\"danger\"\n          tooltip={annotationError[anno.name]}\n        />\n      );\n    }\n    if (!anno.show) {\n      return <span style={{ color: theme.colors.error.base }}> Hidden </span>;\n    }\n    return '';\n  }\n\n  render() {\n    const { addedAnnotationIndex } = this.state;\n    const addedAnnotation = this.props.value[addedAnnotationIndex];\n\n    const annotations = this.props.value.map((anno, i) => (\n      <ControlPopover\n        key={i}\n        trigger=\"click\"\n        title={t('Edit annotation layer')}\n        css={theme => ({\n          '&:hover': {\n            cursor: 'pointer',\n            backgroundColor: theme.colors.grayscale.light4,\n          },\n        })}\n        content={this.renderPopover(\n          i,\n          anno,\n          this.props.annotationError[anno.name],\n        )}\n        visible={this.state.popoverVisible[i]}\n        onVisibleChange={visible => this.handleVisibleChange(visible, i)}\n      >\n        <CustomListItem selectable>\n          <span>{anno.name}</span>\n          <span style={{ float: 'right' }}>{this.renderInfo(anno)}</span>\n        </CustomListItem>\n      </ControlPopover>\n    ));\n\n    const addLayerPopoverKey = 'add';\n    return (\n      <div>\n        <List bordered css={theme => ({ borderRadius: theme.gridUnit })}>\n          {annotations}\n          <ControlPopover\n            trigger=\"click\"\n            content={this.renderPopover(addLayerPopoverKey, addedAnnotation)}\n            title={t('Add annotation layer')}\n            visible={this.state.popoverVisible[addLayerPopoverKey]}\n            destroyTooltipOnHide\n            onVisibleChange={visible =>\n              this.handleVisibleChange(visible, addLayerPopoverKey)\n            }\n          >\n            <CustomListItem selectable>\n              <i\n                data-test=\"add-annotation-layer-button\"\n                className=\"fa fa-plus\"\n              />{' '}\n              &nbsp; {t('Add annotation layer')}\n            </CustomListItem>\n          </ControlPopover>\n        </List>\n      </div>\n    );\n  }\n}\n\nAnnotationLayerControl.propTypes = propTypes;\nAnnotationLayerControl.defaultProps = defaultProps;\n\n// Tried to hook this up through stores/control.jsx instead of using redux\n// directly, could not figure out how to get access to the color_scheme\nfunction mapStateToProps({ charts, explore }) {\n  const chartKey = getChartKey(explore);\n  const chart = charts[chartKey] || charts[0] || {};\n\n  return {\n    // eslint-disable-next-line camelcase\n    colorScheme: explore.controls?.color_scheme?.value,\n    annotationError: chart.annotationError,\n    annotationQuery: chart.annotationQuery,\n    vizType: explore.controls.viz_type.value,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    refreshAnnotationData: annotationObj =>\n      dispatch(runAnnotationQuery(annotationObj)),\n  };\n}\n\nconst themedAnnotationLayerControl = withTheme(AnnotationLayerControl);\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(themedAnnotationLayerControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport { InputNumber } from 'src/components/Input';\nimport { t, styled } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\ntype ValueType = (number | null)[];\n\nexport type BoundsControlProps = {\n  onChange?: (value: ValueType) => void;\n  value?: ValueType;\n};\n\nconst StyledDiv = styled.div`\n  display: flex;\n`;\n\nconst MinInput = styled(InputNumber)`\n  flex: 1;\n  margin-right: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst MaxInput = styled(InputNumber)`\n  flex: 1;\n  margin-left: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst parseNumber = (value: undefined | number | string | null) =>\n  value === null || Number.isNaN(Number(value)) ? null : Number(value);\n\nexport default function BoundsControl({\n  onChange = () => {},\n  value = [null, null],\n  ...props\n}: BoundsControlProps) {\n  const [minMax, setMinMax] = useState<ValueType>([\n    parseNumber(value[0]),\n    parseNumber(value[1]),\n  ]);\n  const min = value[0];\n  const max = value[1];\n  const debouncedOnChange = useRef(debounce(onChange, 300)).current;\n\n  const update = (mm: ValueType) => {\n    setMinMax(mm);\n    debouncedOnChange([\n      mm[0] === undefined ? null : mm[0],\n      mm[1] === undefined ? null : mm[1],\n    ]);\n  };\n\n  useEffect(() => {\n    setMinMax([parseNumber(min), parseNumber(max)]);\n  }, [min, max]);\n\n  const onMinChange = (value: number | string | undefined) => {\n    update([parseNumber(value), minMax[1]]);\n  };\n\n  const onMaxChange = (value: number | string | undefined) => {\n    update([minMax[0], parseNumber(value)]);\n  };\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <StyledDiv>\n        <MinInput\n          data-test=\"min-bound\"\n          placeholder={t('Min')}\n          // emit (string | number | undefined)\n          onChange={onMinChange}\n          // accept (number | undefined)\n          value={minMax[0] === null ? undefined : minMax[0]}\n        />\n        <MaxInput\n          data-test=\"max-bound\"\n          placeholder={t('Max')}\n          // emit (number | string | undefined)\n          onChange={onMaxChange}\n          // accept (number | undefined)\n          value={minMax[1] === null ? undefined : minMax[1]}\n        />\n      </StyledDiv>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport shortid from 'shortid';\nimport { t, withTheme } from '@superset-ui/core';\nimport {\n  SortableContainer,\n  SortableHandle,\n  SortableElement,\n  arrayMove,\n} from 'react-sortable-hoc';\nimport Icons from 'src/components/Icons';\nimport {\n  HeaderContainer,\n  AddIconButton,\n} from 'src/explore/components/controls/OptionControls';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport controlMap from '..';\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  placeholder: PropTypes.string,\n  addTooltip: PropTypes.string,\n  itemGenerator: PropTypes.func,\n  keyAccessor: PropTypes.func,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([PropTypes.array]),\n  isFloat: PropTypes.bool,\n  isInt: PropTypes.bool,\n  controlName: PropTypes.string.isRequired,\n};\n\nconst defaultProps = {\n  label: null,\n  description: null,\n  onChange: () => {},\n  placeholder: t('Empty collection'),\n  itemGenerator: () => ({ key: shortid.generate() }),\n  keyAccessor: o => o.key,\n  value: [],\n  addTooltip: t('Add an item'),\n};\nconst SortableListItem = SortableElement(CustomListItem);\nconst SortableList = SortableContainer(List);\nconst SortableDragger = SortableHandle(() => (\n  <i\n    role=\"img\"\n    aria-label=\"drag\"\n    className=\"fa fa-bars text-primary\"\n    style={{ cursor: 'ns-resize' }}\n  />\n));\n\nclass CollectionControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onAdd = this.onAdd.bind(this);\n  }\n\n  onChange(i, value) {\n    const newValue = [...this.props.value];\n    newValue[i] = { ...this.props.value[i], ...value };\n    this.props.onChange(newValue);\n  }\n\n  onAdd() {\n    this.props.onChange(this.props.value.concat([this.props.itemGenerator()]));\n  }\n\n  onSortEnd({ oldIndex, newIndex }) {\n    this.props.onChange(arrayMove(this.props.value, oldIndex, newIndex));\n  }\n\n  removeItem(i) {\n    this.props.onChange(this.props.value.filter((o, ix) => i !== ix));\n  }\n\n  renderList() {\n    if (this.props.value.length === 0) {\n      return <div className=\"text-muted\">{this.props.placeholder}</div>;\n    }\n    const Control = controlMap[this.props.controlName];\n    return (\n      <SortableList\n        useDragHandle\n        lockAxis=\"y\"\n        onSortEnd={this.onSortEnd.bind(this)}\n        bordered\n        css={theme => ({\n          borderRadius: theme.gridUnit,\n        })}\n      >\n        {this.props.value.map((o, i) => {\n          // label relevant only for header, not here\n          const { label, ...commonProps } = this.props;\n          return (\n            <SortableListItem\n              className=\"clearfix\"\n              css={{ justifyContent: 'flex-start' }}\n              key={this.props.keyAccessor(o)}\n              index={i}\n            >\n              <SortableDragger />\n              <div\n                css={theme => ({\n                  flex: 1,\n                  marginLeft: theme.gridUnit * 2,\n                  marginRight: theme.gridUnit * 2,\n                })}\n              >\n                <Control\n                  {...commonProps}\n                  {...o}\n                  onChange={this.onChange.bind(this, i)}\n                />\n              </div>\n              <InfoTooltipWithTrigger\n                icon=\"times\"\n                label=\"remove-item\"\n                tooltip={t('Remove item')}\n                bsStyle=\"primary\"\n                onClick={this.removeItem.bind(this, i)}\n              />\n            </SortableListItem>\n          );\n        })}\n      </SortableList>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div data-test=\"CollectionControl\" className=\"CollectionControl\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          <AddIconButton onClick={this.onAdd}>\n            <Icons.PlusLarge\n              iconSize=\"s\"\n              iconColor={theme.colors.grayscale.light5}\n            />\n          </AddIconButton>\n        </HeaderContainer>\n        {this.renderList()}\n      </div>\n    );\n  }\n}\n\nCollectionControl.propTypes = propTypes;\nCollectionControl.defaultProps = defaultProps;\n\nexport default withTheme(CollectionControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { SketchPicker } from 'react-color';\nimport { getCategoricalSchemeRegistry, styled } from '@superset-ui/core';\nimport Popover from 'src/components/Popover';\nimport ControlHeader from '../ControlHeader';\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n};\n\nconst swatchCommon = {\n  position: 'absolute',\n  width: '50px',\n  height: '20px',\n  top: '0px',\n  left: '0px',\n  right: '0px',\n  bottom: '0px',\n};\n\nconst StyledSwatch = styled.div`\n  ${({ theme }) => `\n      width: 50px;\n      height: 20px;\n      position: relative;\n      padding: ${theme.gridUnit}px;\n      borderRadius: ${theme.borderRadius}px;\n      display: inline-block;\n      cursor: pointer;\n    `}\n`;\n\nconst styles = {\n  color: {\n    ...swatchCommon,\n    borderRadius: '2px',\n  },\n  checkerboard: {\n    ...swatchCommon,\n    background:\n      'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==\") left center',\n  },\n};\nexport default class ColorPickerControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  onChange(col) {\n    this.props.onChange(col.rgb);\n  }\n\n  renderPopover() {\n    const presetColors = getCategoricalSchemeRegistry()\n      .get()\n      .colors.filter((s, i) => i < 7);\n    return (\n      <div id=\"filter-popover\" className=\"color-popover\">\n        <SketchPicker\n          color={this.props.value}\n          onChange={this.onChange}\n          presetColors={presetColors}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    const c = this.props.value || { r: 0, g: 0, b: 0, a: 0 };\n    const colStyle = {\n      ...styles.color,\n      background: `rgba(${c.r}, ${c.g}, ${c.b}, ${c.a})`,\n    };\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n        >\n          <StyledSwatch>\n            <div style={styles.checkerboard} />\n            <div style={colStyle} />\n          </StyledSwatch>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nColorPickerControl.propTypes = propTypes;\nColorPickerControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { isObject } from 'lodash';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport Button from 'src/components/Button';\n\ninterface SimpleDataSource {\n  id: string;\n  sql: string;\n  type: string;\n}\n\ninterface ViewQueryModalFooterProps {\n  closeModal?: Function;\n  changeDatasource?: Function;\n  datasource?: SimpleDataSource;\n}\n\nconst CLOSE = t('Close');\nconst SAVE_AS_DATASET = t('Save as Dataset');\nconst OPEN_IN_SQL_LAB = t('Open in SQL Lab');\n\nconst ViewQueryModalFooter: React.FC<ViewQueryModalFooterProps> = (props: {\n  closeModal: () => void;\n  changeDatasource: () => void;\n  datasource: SimpleDataSource;\n}) => {\n  const viewInSQLLab = (id: string, type: string, sql: string) => {\n    const payload = {\n      datasourceKey: `${id}__${type}`,\n      sql,\n    };\n    SupersetClient.postForm('/superset/sqllab/', payload);\n  };\n\n  const openSQL = () => {\n    const { datasource } = props;\n    if (isObject(datasource)) {\n      const { id, type, sql } = datasource;\n      viewInSQLLab(id, type, sql);\n    }\n  };\n  return (\n    <div>\n      <Button\n        onClick={() => {\n          props?.closeModal?.();\n          props?.changeDatasource?.();\n        }}\n      >\n        {SAVE_AS_DATASET}\n      </Button>\n      <Button onClick={() => openSQL()}>{OPEN_IN_SQL_LAB}</Button>\n      <Button\n        buttonStyle=\"primary\"\n        onClick={() => {\n          props?.closeModal?.();\n        }}\n      >\n        {CLOSE}\n      </Button>\n    </div>\n  );\n};\n\nexport default ViewQueryModalFooter;\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  DatasourceType,\n  SupersetClient,\n  styled,\n  t,\n  withTheme,\n} from '@superset-ui/core';\nimport { getTemporalColumns } from '@superset-ui/chart-controls';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { AntdDropdown } from 'src/components';\nimport { Menu } from 'src/components/Menu';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport {\n  ChangeDatasourceModal,\n  DatasourceModal,\n} from 'src/components/Datasource';\nimport Button from 'src/components/Button';\nimport ErrorAlert from 'src/components/ErrorMessage/ErrorAlert';\nimport WarningIconWithTooltip from 'src/components/WarningIconWithTooltip';\nimport { URL_PARAMS } from 'src/constants';\nimport { getDatasourceAsSaveableDataset } from 'src/utils/datasourceUtils';\nimport {\n  canUserAccessSqlLab,\n  isUserAdmin,\n} from 'src/dashboard/util/permissionUtils';\nimport ModalTrigger from 'src/components/ModalTrigger';\nimport ViewQueryModalFooter from 'src/explore/components/controls/ViewQueryModalFooter';\nimport ViewQuery from 'src/explore/components/controls/ViewQuery';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { isString } from 'lodash';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  datasource: PropTypes.object.isRequired,\n  form_data: PropTypes.object.isRequired,\n  isEditable: PropTypes.bool,\n  onDatasourceSave: PropTypes.func,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: null,\n  value: null,\n  isEditable: true,\n};\n\nconst Styles = styled.div`\n  .data-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    padding: ${({ theme }) => 4 * theme.gridUnit}px;\n    padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .error-alert {\n    margin: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .ant-dropdown-trigger {\n    margin-left: ${({ theme }) => 2 * theme.gridUnit}px;\n    box-shadow: none;\n    &:active {\n      box-shadow: none;\n    }\n  }\n  .btn-group .open .dropdown-toggle {\n    box-shadow: none;\n    &.button-default {\n      background: none;\n    }\n  }\n  i.angle {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n  svg.datasource-modal-trigger {\n    color: ${({ theme }) => theme.colors.primary.base};\n    cursor: pointer;\n  }\n  .title-select {\n    flex: 1 1 100%;\n    display: inline-block;\n    background-color: ${({ theme }) => theme.colors.grayscale.light3};\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    border-radius: ${({ theme }) => theme.borderRadius}px;\n    text-align: center;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n  }\n  .datasource-svg {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    flex: none;\n  }\n  span[aria-label='dataset-physical'] {\n    color: ${({ theme }) => theme.colors.grayscale.base};\n  }\n  span[aria-label='more-vert'] {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst CHANGE_DATASET = 'change_dataset';\nconst VIEW_IN_SQL_LAB = 'view_in_sql_lab';\nconst EDIT_DATASET = 'edit_dataset';\nconst QUERY_PREVIEW = 'query_preview';\nconst SAVE_AS_DATASET = 'save_as_dataset';\n\n// If the string is longer than this value's number characters we add\n// a tooltip for user can see the full name by hovering over the visually truncated string in UI\nconst VISIBLE_TITLE_LENGTH = 25;\n\n// Assign icon for each DatasourceType.  If no icon assingment is found in the lookup, no icon will render\nexport const datasourceIconLookup = {\n  [DatasourceType.Query]: (\n    <Icons.ConsoleSqlOutlined className=\"datasource-svg\" />\n  ),\n  [DatasourceType.Table]: <Icons.DatasetPhysical className=\"datasource-svg\" />,\n};\n\n// Render title for datasource with tooltip only if text is longer than VISIBLE_TITLE_LENGTH\nexport const renderDatasourceTitle = (displayString, tooltip) =>\n  displayString?.length > VISIBLE_TITLE_LENGTH ? (\n    // Add a tooltip only for long names that will be visually truncated\n    <Tooltip title={tooltip}>\n      <span className=\"title-select\">{displayString}</span>\n    </Tooltip>\n  ) : (\n    <span title={tooltip} className=\"title-select\">\n      {displayString}\n    </span>\n  );\n\n// Different data source types use different attributes for the display title\nexport const getDatasourceTitle = datasource => {\n  if (datasource?.type === 'query') return datasource?.sql;\n  return datasource?.name || '';\n};\n\nclass DatasourceControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showEditDatasourceModal: false,\n      showChangeDatasourceModal: false,\n      showSaveDatasetModal: false,\n    };\n  }\n\n  onDatasourceSave = datasource => {\n    this.props.actions.changeDatasource(datasource);\n    const { temporalColumns, defaultTemporalColumn } =\n      getTemporalColumns(datasource);\n    const { columns } = datasource;\n    // the current granularity_sqla might not be a temporal column anymore\n    const timeCol = this.props.form_data?.granularity_sqla;\n    const isGranularitySqalTemporal = columns.find(\n      ({ column_name }) => column_name === timeCol,\n    )?.is_dttm;\n    // the current main_dttm_col might not be a temporal column anymore\n    const isDefaultTemporal = columns.find(\n      ({ column_name }) => column_name === defaultTemporalColumn,\n    )?.is_dttm;\n\n    // if the current granularity_sqla is empty or it is not a temporal column anymore\n    // let's update the control value\n    if (datasource.type === 'table' && !isGranularitySqalTemporal) {\n      const temporalColumn = isDefaultTemporal\n        ? defaultTemporalColumn\n        : temporalColumns?.[0];\n      this.props.actions.setControlValue(\n        'granularity_sqla',\n        temporalColumn || null,\n      );\n    }\n\n    if (this.props.onDatasourceSave) {\n      this.props.onDatasourceSave(datasource);\n    }\n  };\n\n  toggleShowDatasource = () => {\n    this.setState(({ showDatasource }) => ({\n      showDatasource: !showDatasource,\n    }));\n  };\n\n  toggleChangeDatasourceModal = () => {\n    this.setState(({ showChangeDatasourceModal }) => ({\n      showChangeDatasourceModal: !showChangeDatasourceModal,\n    }));\n  };\n\n  toggleEditDatasourceModal = () => {\n    this.setState(({ showEditDatasourceModal }) => ({\n      showEditDatasourceModal: !showEditDatasourceModal,\n    }));\n  };\n\n  toggleSaveDatasetModal = () => {\n    this.setState(({ showSaveDatasetModal }) => ({\n      showSaveDatasetModal: !showSaveDatasetModal,\n    }));\n  };\n\n  handleMenuItemClick = ({ key }) => {\n    switch (key) {\n      case CHANGE_DATASET:\n        this.toggleChangeDatasourceModal();\n        break;\n\n      case EDIT_DATASET:\n        this.toggleEditDatasourceModal();\n        break;\n\n      case VIEW_IN_SQL_LAB:\n        {\n          const { datasource } = this.props;\n          const payload = {\n            datasourceKey: `${datasource.id}__${datasource.type}`,\n            sql: datasource.sql,\n          };\n          SupersetClient.postForm('/superset/sqllab/', {\n            form_data: safeStringify(payload),\n          });\n        }\n        break;\n\n      case SAVE_AS_DATASET:\n        this.toggleSaveDatasetModal();\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  render() {\n    const {\n      showChangeDatasourceModal,\n      showEditDatasourceModal,\n      showSaveDatasetModal,\n    } = this.state;\n    const { datasource, onChange, theme } = this.props;\n    const isMissingDatasource = !datasource?.id;\n    let isMissingParams = false;\n    if (isMissingDatasource) {\n      const datasourceId = getUrlParam(URL_PARAMS.datasourceId);\n      const sliceId = getUrlParam(URL_PARAMS.sliceId);\n\n      if (!datasourceId && !sliceId) {\n        isMissingParams = true;\n      }\n    }\n\n    const { user } = this.props;\n    const allowEdit =\n      datasource.owners?.map(o => o.id || o.value).includes(user.userId) ||\n      isUserAdmin(user);\n\n    const canAccessSqlLab = canUserAccessSqlLab(user);\n\n    const editText = t('Edit dataset');\n\n    const defaultDatasourceMenu = (\n      <Menu onClick={this.handleMenuItemClick}>\n        {this.props.isEditable && !isMissingDatasource && (\n          <Menu.Item\n            key={EDIT_DATASET}\n            data-test=\"edit-dataset\"\n            disabled={!allowEdit}\n          >\n            {!allowEdit ? (\n              <Tooltip\n                title={t(\n                  'You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access.',\n                )}\n              >\n                {editText}\n              </Tooltip>\n            ) : (\n              editText\n            )}\n          </Menu.Item>\n        )}\n        <Menu.Item key={CHANGE_DATASET}>{t('Swap dataset')}</Menu.Item>\n        {!isMissingDatasource && canAccessSqlLab && (\n          <Menu.Item key={VIEW_IN_SQL_LAB}>{t('View in SQL Lab')}</Menu.Item>\n        )}\n      </Menu>\n    );\n\n    const queryDatasourceMenu = (\n      <Menu onClick={this.handleMenuItemClick}>\n        <Menu.Item key={QUERY_PREVIEW}>\n          <ModalTrigger\n            triggerNode={\n              <span data-test=\"view-query-menu-item\">{t('Query preview')}</span>\n            }\n            modalTitle={t('Query preview')}\n            modalBody={\n              <ViewQuery\n                sql={datasource?.sql || datasource?.select_star || ''}\n              />\n            }\n            modalFooter={\n              <ViewQueryModalFooter\n                changeDatasource={this.toggleSaveDatasetModal}\n                datasource={datasource}\n              />\n            }\n            draggable={false}\n            resizable={false}\n            responsive\n          />\n        </Menu.Item>\n        {canAccessSqlLab && (\n          <Menu.Item key={VIEW_IN_SQL_LAB}>{t('View in SQL Lab')}</Menu.Item>\n        )}\n        <Menu.Item key={SAVE_AS_DATASET}>{t('Save as dataset')}</Menu.Item>\n      </Menu>\n    );\n\n    const { health_check_message: healthCheckMessage } = datasource;\n\n    let extra;\n    if (datasource?.extra) {\n      if (isString(datasource.extra)) {\n        try {\n          extra = JSON.parse(datasource.extra);\n        } catch {} // eslint-disable-line no-empty\n      } else {\n        extra = datasource.extra; // eslint-disable-line prefer-destructuring\n      }\n    }\n\n    const titleText = isMissingDatasource\n      ? t('Missing dataset')\n      : getDatasourceTitle(datasource);\n\n    const tooltip = titleText;\n\n    return (\n      <Styles data-test=\"datasource-control\" className=\"DatasourceControl\">\n        <div className=\"data-container\">\n          {datasourceIconLookup[datasource?.type]}\n          {renderDatasourceTitle(titleText, tooltip)}\n          {healthCheckMessage && (\n            <Tooltip title={healthCheckMessage}>\n              <Icons.AlertSolid iconColor={theme.colors.warning.base} />\n            </Tooltip>\n          )}\n          {extra?.warning_markdown && (\n            <WarningIconWithTooltip warningMarkdown={extra.warning_markdown} />\n          )}\n          <AntdDropdown\n            overlay={\n              datasource.type === DatasourceType.Query\n                ? queryDatasourceMenu\n                : defaultDatasourceMenu\n            }\n            trigger={['click']}\n            data-test=\"datasource-menu\"\n          >\n            <Icons.MoreVert\n              className=\"datasource-modal-trigger\"\n              data-test=\"datasource-menu-trigger\"\n            />\n          </AntdDropdown>\n        </div>\n        {/* missing dataset */}\n        {isMissingDatasource && isMissingParams && (\n          <div className=\"error-alert\">\n            <ErrorAlert\n              level=\"warning\"\n              title={t('Missing URL parameters')}\n              source=\"explore\"\n              subtitle={\n                <>\n                  <p>\n                    {t(\n                      'The URL is missing the dataset_id or slice_id parameters.',\n                    )}\n                  </p>\n                </>\n              }\n            />\n          </div>\n        )}\n        {isMissingDatasource && !isMissingParams && (\n          <div className=\"error-alert\">\n            <ErrorAlert\n              level=\"warning\"\n              title={t('Missing dataset')}\n              source=\"explore\"\n              subtitle={\n                <>\n                  <p>\n                    {t(\n                      'The dataset linked to this chart may have been deleted.',\n                    )}\n                  </p>\n                  <p>\n                    <Button\n                      buttonStyle=\"primary\"\n                      onClick={() =>\n                        this.handleMenuItemClick({ key: CHANGE_DATASET })\n                      }\n                    >\n                      {t('Swap dataset')}\n                    </Button>\n                  </p>\n                </>\n              }\n            />\n          </div>\n        )}\n        {showEditDatasourceModal && (\n          <DatasourceModal\n            datasource={datasource}\n            show={showEditDatasourceModal}\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleEditDatasourceModal}\n          />\n        )}\n        {showChangeDatasourceModal && (\n          <ChangeDatasourceModal\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleChangeDatasourceModal}\n            show={showChangeDatasourceModal}\n            onChange={onChange}\n          />\n        )}\n        {showSaveDatasetModal && (\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={this.toggleSaveDatasetModal}\n            buttonTextOnSave={t('Save')}\n            buttonTextOnOverwrite={t('Overwrite')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={getDatasourceAsSaveableDataset(datasource)}\n            openWindow={false}\n            formData={this.props.form_data}\n          />\n        )}\n      </Styles>\n    );\n  }\n}\n\nDatasourceControl.propTypes = propTypes;\nDatasourceControl.defaultProps = defaultProps;\n\nexport default withTheme(DatasourceControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ChangeEventHandler,\n  FocusEvent,\n  KeyboardEvent,\n  useCallback,\n  useState,\n} from 'react';\nimport { t, styled } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Tooltip } from 'src/components/Tooltip';\n\nconst TitleLabel = styled.span`\n  display: inline-block;\n  padding: 2px 0;\n`;\n\nconst StyledInput = styled(Input)`\n  border-radius: ${({ theme }) => theme.borderRadius};\n  height: 26px;\n  padding-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nexport interface AdhocMetricEditPopoverTitleProps {\n  title?: {\n    label?: string;\n    hasCustomLabel?: boolean;\n  };\n  isEditDisabled?: boolean;\n  onChange: ChangeEventHandler<HTMLInputElement>;\n}\n\nconst AdhocMetricEditPopoverTitle: React.FC<AdhocMetricEditPopoverTitleProps> =\n  ({ title, isEditDisabled, onChange }) => {\n    const [isHovered, setIsHovered] = useState(false);\n    const [isEditMode, setIsEditMode] = useState(false);\n\n    const defaultLabel = t('My metric');\n\n    const handleMouseOver = useCallback(() => setIsHovered(true), []);\n    const handleMouseOut = useCallback(() => setIsHovered(false), []);\n    const handleClick = useCallback(() => setIsEditMode(true), []);\n    const handleBlur = useCallback(() => setIsEditMode(false), []);\n\n    const handleKeyPress = useCallback(\n      (ev: KeyboardEvent<HTMLInputElement>) => {\n        if (ev.key === 'Enter') {\n          ev.preventDefault();\n          handleBlur();\n        }\n      },\n      [handleBlur],\n    );\n\n    const handleInputBlur = useCallback(\n      (e: FocusEvent<HTMLInputElement>) => {\n        if (e.target.value === '') {\n          onChange(e);\n        }\n\n        handleBlur();\n      },\n      [onChange, handleBlur],\n    );\n\n    if (isEditDisabled) {\n      return (\n        <span data-test=\"AdhocMetricTitle\">{title?.label || defaultLabel}</span>\n      );\n    }\n\n    if (isEditMode) {\n      return (\n        <StyledInput\n          type=\"text\"\n          placeholder={title?.label}\n          value={title?.hasCustomLabel ? title.label : ''}\n          autoFocus\n          onChange={onChange}\n          onBlur={handleInputBlur}\n          onKeyPress={handleKeyPress}\n          data-test=\"AdhocMetricEditTitle#input\"\n        />\n      );\n    }\n\n    return (\n      <Tooltip placement=\"top\" title={t('Click to edit label')}>\n        <span\n          className=\"AdhocMetricEditPopoverTitle inline-editable\"\n          data-test=\"AdhocMetricEditTitle#trigger\"\n          onMouseOver={handleMouseOver}\n          onMouseOut={handleMouseOut}\n          onClick={handleClick}\n          onBlur={handleBlur}\n          role=\"button\"\n          tabIndex={0}\n        >\n          <TitleLabel>{title?.label || defaultLabel}</TitleLabel>\n          &nbsp;\n          <i\n            className=\"fa fa-pencil\"\n            style={{ color: isHovered ? 'black' : 'grey' }}\n          />\n        </span>\n      </Tooltip>\n    );\n  };\n\nexport default AdhocMetricEditPopoverTitle;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  isDefined,\n  t,\n  styled,\n  ensureIsArray,\n  DatasourceType,\n} from '@superset-ui/core';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\nimport { noOp } from 'src/utils/common';\nimport {\n  AGGREGATES_OPTIONS,\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\nimport columnType from 'src/explore/components/controls/MetricControl/columnType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  StyledMetricOption,\n  StyledColumnOption,\n} from 'src/explore/components/optionRenderers';\n\nconst propTypes = {\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  getCurrentTab: PropTypes.func,\n  getCurrentLabel: PropTypes.func,\n  adhocMetric: PropTypes.instanceOf(AdhocMetric).isRequired,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n  isNewMetric: PropTypes.bool,\n  isLabelModified: PropTypes.bool,\n};\n\nconst defaultProps = {\n  columns: [],\n  getCurrentTab: noOp,\n  isNewMetric: false,\n};\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\nexport const SAVED_TAB_KEY = 'SAVED';\n\nexport default class AdhocMetricEditPopover extends React.PureComponent {\n  // \"Saved\" is a default tab unless there are no saved metrics for dataset\n  defaultActiveTabKey = this.getDefaultTab();\n\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onResetStateAndClose = this.onResetStateAndClose.bind(this);\n    this.onColumnChange = this.onColumnChange.bind(this);\n    this.onAggregateChange = this.onAggregateChange.bind(this);\n    this.onSavedMetricChange = this.onSavedMetricChange.bind(this);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n    this.refreshAceEditor = this.refreshAceEditor.bind(this);\n    this.getDefaultTab = this.getDefaultTab.bind(this);\n\n    this.state = {\n      adhocMetric: this.props.adhocMetric,\n      savedMetric: this.props.savedMetric,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n    };\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentDidMount() {\n    this.props.getCurrentTab(this.defaultActiveTabKey);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      prevState.adhocMetric?.sqlExpression !==\n        this.state.adhocMetric?.sqlExpression ||\n      prevState.adhocMetric?.aggregate !== this.state.adhocMetric?.aggregate ||\n      prevState.adhocMetric?.column?.column_name !==\n        this.state.adhocMetric?.column?.column_name ||\n      prevState.savedMetric?.metric_name !== this.state.savedMetric?.metric_name\n    ) {\n      this.props.getCurrentLabel({\n        savedMetricLabel:\n          this.state.savedMetric?.verbose_name ||\n          this.state.savedMetric?.metric_name,\n        adhocMetricLabel: this.state.adhocMetric?.getDefaultLabel(),\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  getDefaultTab() {\n    const { adhocMetric, savedMetric, savedMetricsOptions, isNewMetric } =\n      this.props;\n    if (isDefined(adhocMetric.column) || isDefined(adhocMetric.sqlExpression)) {\n      return adhocMetric.expressionType;\n    }\n    if (\n      (isNewMetric || savedMetric.metric_name) &&\n      Array.isArray(savedMetricsOptions) &&\n      savedMetricsOptions.length > 0\n    ) {\n      return SAVED_TAB_KEY;\n    }\n    return adhocMetric.expressionType;\n  }\n\n  onSave() {\n    const { adhocMetric, savedMetric } = this.state;\n\n    const metric = savedMetric?.metric_name ? savedMetric : adhocMetric;\n    const oldMetric = this.props.savedMetric?.metric_name\n      ? this.props.savedMetric\n      : this.props.adhocMetric;\n    this.props.onChange(\n      {\n        ...metric,\n      },\n      oldMetric,\n    );\n    this.props.onClose();\n  }\n\n  onResetStateAndClose() {\n    this.setState(\n      {\n        adhocMetric: this.props.adhocMetric,\n        savedMetric: this.props.savedMetric,\n      },\n      this.props.onClose,\n    );\n  }\n\n  onColumnChange(columnName) {\n    const column = this.props.columns.find(\n      column => column.column_name === columnName,\n    );\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onAggregateChange(aggregate) {\n    // we construct this object explicitly to overwrite the value in the case aggregate is null\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        aggregate,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onSavedMetricChange(savedMetricName) {\n    const savedMetric = this.props.savedMetricsOptions.find(\n      metric => metric.metric_name === savedMetricName,\n    );\n    this.setState(prevState => ({\n      savedMetric,\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column: undefined,\n        aggregate: undefined,\n        sqlExpression: undefined,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    }));\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY),\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(tab) {\n    this.refreshAceEditor();\n    this.props.getCurrentTab(tab);\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  refreshAceEditor() {\n    setTimeout(() => {\n      if (this.aceEditorRef) {\n        this.aceEditorRef.editor.resize();\n      }\n    }, 0);\n  }\n\n  renderColumnOption(option) {\n    const column = { ...option };\n    if (column.metric_name && !column.verbose_name) {\n      column.verbose_name = column.metric_name;\n    }\n    return <StyledColumnOption column={column} showType />;\n  }\n\n  renderMetricOption(savedMetric) {\n    return <StyledMetricOption metric={savedMetric} showType />;\n  }\n\n  render() {\n    const {\n      adhocMetric: propsAdhocMetric,\n      savedMetric: propsSavedMetric,\n      columns,\n      savedMetricsOptions,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      isNewMetric,\n      isLabelModified,\n      ...popoverProps\n    } = this.props;\n    const { adhocMetric, savedMetric } = this.state;\n    const keywords = sqlKeywords.concat(\n      columns.map(column => ({\n        name: column.column_name,\n        value: column.column_name,\n        score: 50,\n        meta: 'column',\n      })),\n    );\n\n    const columnValue =\n      (adhocMetric.column && adhocMetric.column.column_name) ||\n      adhocMetric.inferSqlExpressionColumn();\n\n    // autofocus on column if there's no value in column; otherwise autofocus on aggregate\n    const columnSelectProps = {\n      ariaLabel: t('Select column'),\n      placeholder: t('%s column(s)', columns.length),\n      value: columnValue,\n      onChange: this.onColumnChange,\n      allowClear: true,\n      autoFocus: !columnValue,\n    };\n\n    const aggregateSelectProps = {\n      ariaLabel: t('Select aggregate options'),\n      placeholder: t('%s aggregates(s)', AGGREGATES_OPTIONS.length),\n      value: adhocMetric.aggregate || adhocMetric.inferSqlExpressionAggregate(),\n      onChange: this.onAggregateChange,\n      allowClear: true,\n      autoFocus: !!columnValue,\n    };\n\n    const savedSelectProps = {\n      ariaLabel: t('Select saved metrics'),\n      placeholder: t('%s saved metric(s)', savedMetricsOptions?.length ?? 0),\n      value: savedMetric?.metric_name,\n      onChange: this.onSavedMetricChange,\n      allowClear: true,\n      autoFocus: true,\n    };\n\n    const stateIsValid = adhocMetric.isValid() || savedMetric?.metric_name;\n    const hasUnsavedChanges =\n      isLabelModified ||\n      isNewMetric ||\n      !adhocMetric.equals(propsAdhocMetric) ||\n      (!(\n        typeof savedMetric?.metric_name === 'undefined' &&\n        typeof propsSavedMetric?.metric_name === 'undefined'\n      ) &&\n        savedMetric?.metric_name !== propsSavedMetric?.metric_name);\n\n    let extra = {};\n    if (datasource?.extra) {\n      try {\n        extra = JSON.parse(datasource.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      <Form\n        layout=\"vertical\"\n        id=\"metrics-edit-popover\"\n        data-test=\"metrics-edit-popover\"\n        {...popoverProps}\n      >\n        <Tabs\n          id=\"adhoc-metric-edit-tabs\"\n          data-test=\"adhoc-metric-edit-tabs\"\n          defaultActiveKey={this.defaultActiveTabKey}\n          className=\"adhoc-metric-edit-tabs\"\n          style={{ height: this.state.height, width: this.state.width }}\n          onChange={this.onTabChange}\n          allowOverflow\n        >\n          <Tabs.TabPane key={SAVED_TAB_KEY} tab={t('Saved')}>\n            {ensureIsArray(savedMetricsOptions).length > 0 ? (\n              <FormItem label={t('Saved metric')}>\n                <StyledSelect\n                  options={ensureIsArray(savedMetricsOptions).map(\n                    savedMetric => ({\n                      value: savedMetric.metric_name,\n                      label: savedMetric.metric_name,\n                      customLabel: this.renderMetricOption(savedMetric),\n                      key: savedMetric.id,\n                    }),\n                  )}\n                  {...savedSelectProps}\n                />\n              </FormItem>\n            ) : datasource.type === DatasourceType.Table ? (\n              <EmptyStateSmall\n                image=\"empty.svg\"\n                title={t('No saved metrics found')}\n                description={t(\n                  'Add metrics to dataset in \"Edit datasource\" modal',\n                )}\n              />\n            ) : (\n              <EmptyStateSmall\n                image=\"empty.svg\"\n                title={t('No saved metrics found')}\n                description={\n                  <>\n                    <span\n                      tabIndex={0}\n                      role=\"button\"\n                      onClick={() => {\n                        this.props.handleDatasetModal(true);\n                        this.props.onClose();\n                      }}\n                    >\n                      {t('Create a dataset')}\n                    </span>\n                    {t(' to add metrics')}\n                  </>\n                }\n              />\n            )}\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={\n              extra.disallow_adhoc_metrics ? (\n                <Tooltip\n                  title={t(\n                    'Simple ad-hoc metrics are not enabled for this dataset',\n                  )}\n                >\n                  {t('Simple')}\n                </Tooltip>\n              ) : (\n                t('Simple')\n              )\n            }\n            disabled={extra.disallow_adhoc_metrics}\n          >\n            <FormItem label={t('column')}>\n              <Select\n                options={columns.map(column => ({\n                  value: column.column_name,\n                  label: column.verbose_name || column.column_name,\n                  key: column.id,\n                  customLabel: this.renderColumnOption(column),\n                }))}\n                {...columnSelectProps}\n              />\n            </FormItem>\n            <FormItem label={t('aggregate')}>\n              <Select\n                options={AGGREGATES_OPTIONS.map(option => ({\n                  value: option,\n                  label: option,\n                  key: option,\n                }))}\n                {...aggregateSelectProps}\n              />\n            </FormItem>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SQL}\n            tab={\n              extra.disallow_adhoc_metrics ? (\n                <Tooltip\n                  title={t(\n                    'Custom SQL ad-hoc metrics are not enabled for this dataset',\n                  )}\n                >\n                  {t('Custom SQL')}\n                </Tooltip>\n              ) : (\n                t('Custom SQL')\n              )\n            }\n            data-test=\"adhoc-metric-edit-tab#custom\"\n            disabled={extra.disallow_adhoc_metrics}\n          >\n            <SQLEditor\n              data-test=\"sql-editor\"\n              showLoadingForImport\n              ref={this.handleAceEditorRef}\n              keywords={keywords}\n              height={`${this.state.height - 80}px`}\n              onChange={this.onSqlExpressionChange}\n              width=\"100%\"\n              showGutter={false}\n              value={\n                adhocMetric.sqlExpression ||\n                adhocMetric.translateToSql({ transformCountDistinct: true })\n              }\n              editorProps={{ $blockScrolling: true }}\n              enableLiveAutocompletion\n              className=\"filter-sql-editor\"\n              wrapEnabled\n            />\n          </Tabs.TabPane>\n        </Tabs>\n        <div>\n          <Button\n            buttonSize=\"small\"\n            onClick={this.onResetStateAndClose}\n            data-test=\"AdhocMetricEdit#cancel\"\n            cta\n          >\n            {t('Close')}\n          </Button>\n          <Button\n            disabled={!stateIsValid || !hasUnsavedChanges}\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            data-test=\"AdhocMetricEdit#save\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <i\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </div>\n      </Form>\n    );\n  }\n}\nAdhocMetricEditPopover.propTypes = propTypes;\nAdhocMetricEditPopover.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { Metric, t } from '@superset-ui/core';\nimport AdhocMetricEditPopoverTitle from 'src/explore/components/controls/MetricControl/AdhocMetricEditPopoverTitle';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport {\n  ISaveableDatasource,\n  SaveDatasetModal,\n} from 'src/SqlLab/components/SaveDatasetModal';\nimport { Datasource } from 'src/explore/types';\nimport AdhocMetricEditPopover, {\n  SAVED_TAB_KEY,\n} from './AdhocMetricEditPopover';\nimport AdhocMetric from './AdhocMetric';\nimport { savedMetricType } from './types';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nexport type AdhocMetricPopoverTriggerProps = {\n  adhocMetric: AdhocMetric;\n  onMetricEdit(newMetric: Metric, oldMetric: Metric): void;\n  columns: { column_name: string; type: string }[];\n  savedMetricsOptions: savedMetricType[];\n  savedMetric: savedMetricType;\n  datasource: Datasource & ISaveableDatasource;\n  children: ReactNode;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  isNew?: boolean;\n};\n\nexport type AdhocMetricPopoverTriggerState = {\n  adhocMetric: AdhocMetric;\n  popoverVisible: boolean;\n  title: { label: string; hasCustomLabel: boolean };\n  currentLabel: string;\n  labelModified: boolean;\n  isTitleEditDisabled: boolean;\n  showSaveDatasetModal: boolean;\n};\n\nclass AdhocMetricPopoverTrigger extends React.PureComponent<\n  AdhocMetricPopoverTriggerProps,\n  AdhocMetricPopoverTriggerState\n> {\n  constructor(props: AdhocMetricPopoverTriggerProps) {\n    super(props);\n    this.onPopoverResize = this.onPopoverResize.bind(this);\n    this.onLabelChange = this.onLabelChange.bind(this);\n    this.closePopover = this.closePopover.bind(this);\n    this.togglePopover = this.togglePopover.bind(this);\n    this.getCurrentTab = this.getCurrentTab.bind(this);\n    this.getCurrentLabel = this.getCurrentLabel.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.handleDatasetModal = this.handleDatasetModal.bind(this);\n\n    this.state = {\n      adhocMetric: props.adhocMetric,\n      popoverVisible: false,\n      title: {\n        label: props.adhocMetric.label,\n        hasCustomLabel: props.adhocMetric.hasCustomLabel,\n      },\n      currentLabel: '',\n      labelModified: false,\n      isTitleEditDisabled: false,\n      showSaveDatasetModal: false,\n    };\n  }\n\n  static getDerivedStateFromProps(\n    nextProps: AdhocMetricPopoverTriggerProps,\n    prevState: AdhocMetricPopoverTriggerState,\n  ) {\n    if (prevState.adhocMetric.optionName !== nextProps.adhocMetric.optionName) {\n      return {\n        adhocMetric: nextProps.adhocMetric,\n        title: {\n          label: nextProps.adhocMetric.label,\n          hasCustomLabel: nextProps.adhocMetric.hasCustomLabel,\n        },\n        currentLabel: '',\n        labelModified: false,\n      };\n    }\n    return {\n      adhocMetric: nextProps.adhocMetric,\n    };\n  }\n\n  onLabelChange(e: any) {\n    const { verbose_name, metric_name } = this.props.savedMetric;\n    const defaultMetricLabel = this.props.adhocMetric?.getDefaultLabel();\n    const label = e.target.value;\n    this.setState(state => ({\n      title: {\n        label:\n          label ||\n          state.currentLabel ||\n          verbose_name ||\n          metric_name ||\n          defaultMetricLabel,\n        hasCustomLabel: !!label,\n      },\n      labelModified: true,\n    }));\n  }\n\n  onPopoverResize() {\n    this.forceUpdate();\n  }\n\n  handleDatasetModal(showModal: boolean) {\n    this.setState({ showSaveDatasetModal: showModal });\n  }\n\n  closePopover() {\n    this.togglePopover(false);\n    this.setState({\n      labelModified: false,\n    });\n  }\n\n  togglePopover(visible: boolean) {\n    this.setState({\n      popoverVisible: visible,\n    });\n  }\n\n  getCurrentTab(tab: string) {\n    this.setState({\n      isTitleEditDisabled: tab === SAVED_TAB_KEY,\n    });\n  }\n\n  getCurrentLabel({\n    savedMetricLabel,\n    adhocMetricLabel,\n  }: {\n    savedMetricLabel: string;\n    adhocMetricLabel: string;\n  }) {\n    const currentLabel = savedMetricLabel || adhocMetricLabel;\n    this.setState({\n      currentLabel,\n      labelModified: true,\n    });\n    if (savedMetricLabel || !this.state.title.hasCustomLabel) {\n      this.setState({\n        title: {\n          label: currentLabel,\n          hasCustomLabel: false,\n        },\n      });\n    }\n  }\n\n  onChange(newMetric: Metric, oldMetric: Metric) {\n    this.props.onMetricEdit({ ...newMetric, ...this.state.title }, oldMetric);\n  }\n\n  render() {\n    const {\n      adhocMetric,\n      savedMetric,\n      columns,\n      savedMetricsOptions,\n      datasource,\n      isControlledComponent,\n    } = this.props;\n    const { verbose_name, metric_name } = savedMetric;\n    const { hasCustomLabel, label } = adhocMetric;\n    const adhocMetricLabel = hasCustomLabel\n      ? label\n      : adhocMetric.getDefaultLabel();\n    const title = this.state.labelModified\n      ? this.state.title\n      : {\n          label: verbose_name || metric_name || adhocMetricLabel,\n          hasCustomLabel,\n        };\n\n    const { visible, togglePopover, closePopover } = isControlledComponent\n      ? {\n          visible: this.props.visible,\n          togglePopover: this.props.togglePopover,\n          closePopover: this.props.closePopover,\n        }\n      : {\n          visible: this.state.popoverVisible,\n          togglePopover: this.togglePopover,\n          closePopover: this.closePopover,\n        };\n\n    const overlayContent = (\n      <ExplorePopoverContent>\n        <AdhocMetricEditPopover\n          adhocMetric={adhocMetric}\n          columns={columns}\n          savedMetricsOptions={savedMetricsOptions}\n          savedMetric={savedMetric}\n          datasource={datasource}\n          handleDatasetModal={this.handleDatasetModal}\n          onResize={this.onPopoverResize}\n          onClose={closePopover}\n          onChange={this.onChange}\n          getCurrentTab={this.getCurrentTab}\n          getCurrentLabel={this.getCurrentLabel}\n          isNewMetric={this.props.isNew}\n          isLabelModified={\n            this.state.labelModified &&\n            adhocMetricLabel !== this.state.title.label\n          }\n        />\n      </ExplorePopoverContent>\n    );\n\n    const popoverTitle = (\n      <AdhocMetricEditPopoverTitle\n        title={title}\n        onChange={this.onLabelChange}\n        isEditDisabled={this.state.isTitleEditDisabled}\n      />\n    );\n\n    return (\n      <>\n        {this.state.showSaveDatasetModal && (\n          <SaveDatasetModal\n            visible={this.state.showSaveDatasetModal}\n            onHide={() => this.handleDatasetModal(false)}\n            buttonTextOnSave={t('Save')}\n            buttonTextOnOverwrite={t('Overwrite')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n        )}\n        <ControlPopover\n          placement=\"right\"\n          trigger=\"click\"\n          content={overlayContent}\n          defaultVisible={visible}\n          visible={visible}\n          onVisibleChange={togglePopover}\n          title={popoverTitle}\n          destroyTooltipOnHide\n        >\n          {this.props.children}\n        </ControlPopover>\n      </>\n    );\n  }\n}\n\nexport default AdhocMetricPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { OptionControlLabel } from 'src/explore/components/controls/OptionControls';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport columnType from './columnType';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\nimport AdhocMetricPopoverTrigger from './AdhocMetricPopoverTrigger';\n\nconst propTypes = {\n  adhocMetric: PropTypes.instanceOf(AdhocMetric),\n  onMetricEdit: PropTypes.func.isRequired,\n  onRemoveMetric: PropTypes.func,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n  onMoveLabel: PropTypes.func,\n  onDropLabel: PropTypes.func,\n  index: PropTypes.number,\n  type: PropTypes.string,\n  multi: PropTypes.bool,\n  datasourceWarningMessage: PropTypes.string,\n};\n\nclass AdhocMetricOption extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onRemoveMetric = this.onRemoveMetric.bind(this);\n  }\n\n  onRemoveMetric(e) {\n    e?.stopPropagation();\n    this.props.onRemoveMetric(this.props.index);\n  }\n\n  render() {\n    const {\n      adhocMetric,\n      onMetricEdit,\n      columns,\n      savedMetricsOptions,\n      savedMetric,\n      datasource,\n      onMoveLabel,\n      onDropLabel,\n      index,\n      type,\n      multi,\n      datasourceWarningMessage,\n    } = this.props;\n\n    return (\n      <AdhocMetricPopoverTrigger\n        adhocMetric={adhocMetric}\n        onMetricEdit={onMetricEdit}\n        columns={columns}\n        savedMetricsOptions={savedMetricsOptions}\n        savedMetric={savedMetric}\n        datasource={datasource}\n      >\n        <OptionControlLabel\n          savedMetric={savedMetric}\n          adhocMetric={adhocMetric}\n          label={adhocMetric.label}\n          onRemove={this.onRemoveMetric}\n          onMoveLabel={onMoveLabel}\n          onDropLabel={onDropLabel}\n          index={index}\n          type={type ?? DndItemType.AdhocMetricOption}\n          withCaret\n          isFunction\n          multi={multi}\n          datasourceWarningMessage={datasourceWarningMessage}\n        />\n      </AdhocMetricPopoverTrigger>\n    );\n  }\n}\n\nexport default AdhocMetricOption;\n\nAdhocMetricOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport columnType from './columnType';\nimport AdhocMetricOption from './AdhocMetricOption';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\n\nconst propTypes = {\n  option: PropTypes.oneOfType([PropTypes.object, PropTypes.string]).isRequired,\n  index: PropTypes.number.isRequired,\n  onMetricEdit: PropTypes.func,\n  onRemoveMetric: PropTypes.func,\n  onMoveLabel: PropTypes.func,\n  onDropLabel: PropTypes.func,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  multi: PropTypes.bool,\n  datasource: PropTypes.object,\n  datasourceWarningMessage: PropTypes.string,\n};\n\nexport default function MetricDefinitionValue({\n  option,\n  onMetricEdit,\n  onRemoveMetric,\n  columns,\n  savedMetrics,\n  savedMetricsOptions,\n  datasource,\n  onMoveLabel,\n  onDropLabel,\n  index,\n  type,\n  multi,\n  datasourceWarningMessage,\n}) {\n  const getSavedMetricByName = metricName =>\n    savedMetrics.find(metric => metric.metric_name === metricName);\n\n  let savedMetric;\n  if (typeof option === 'string') {\n    savedMetric = getSavedMetricByName(option);\n  } else if (option.metric_name) {\n    savedMetric = option;\n  }\n\n  if (option instanceof AdhocMetric || savedMetric) {\n    const adhocMetric =\n      option instanceof AdhocMetric ? option : new AdhocMetric({});\n\n    const metricOptionProps = {\n      onMetricEdit,\n      onRemoveMetric,\n      columns,\n      savedMetricsOptions,\n      datasource,\n      adhocMetric,\n      onMoveLabel,\n      onDropLabel,\n      index,\n      savedMetric: savedMetric ?? {},\n      type,\n      multi,\n      datasourceWarningMessage,\n    };\n\n    return <AdhocMetricOption {...metricOptionProps} />;\n  }\n  return null;\n}\nMetricDefinitionValue.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { ensureIsArray, t, useTheme, usePrevious } from '@superset-ui/core';\nimport { isEqual } from 'lodash';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Icons from 'src/components/Icons';\nimport {\n  AddIconButton,\n  AddControlLabel,\n  HeaderContainer,\n  LabelsContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport columnType from './columnType';\nimport MetricDefinitionValue from './MetricDefinitionValue';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\nimport adhocMetricType from './adhocMetricType';\nimport AdhocMetricPopoverTrigger from './AdhocMetricPopoverTrigger';\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.oneOfType([PropTypes.string, adhocMetricType])),\n    PropTypes.oneOfType([PropTypes.string, adhocMetricType]),\n  ]),\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  clearable: PropTypes.bool,\n  datasource: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  clearable: true,\n  savedMetrics: [],\n  columns: [],\n};\n\nfunction getOptionsForSavedMetrics(\n  savedMetrics,\n  currentMetricValues,\n  currentMetric,\n) {\n  return (\n    savedMetrics?.filter(savedMetric =>\n      Array.isArray(currentMetricValues)\n        ? !currentMetricValues.includes(savedMetric.metric_name) ||\n          savedMetric.metric_name === currentMetric\n        : savedMetric,\n    ) ?? []\n  );\n}\n\nfunction isDictionaryForAdhocMetric(value) {\n  return value && !(value instanceof AdhocMetric) && value.expressionType;\n}\n\n// adhoc metrics are stored as dictionaries in URL params. We convert them back into the\n// AdhocMetric class for typechecking, consistency and instance method access.\nfunction coerceAdhocMetrics(value) {\n  if (!value) {\n    return [];\n  }\n  if (!Array.isArray(value)) {\n    if (isDictionaryForAdhocMetric(value)) {\n      return [new AdhocMetric(value)];\n    }\n    return [value];\n  }\n  return value.map(val => {\n    if (isDictionaryForAdhocMetric(val)) {\n      return new AdhocMetric(val);\n    }\n    return val;\n  });\n}\n\nconst emptySavedMetric = { metric_name: '', expression: '' };\n\n// TODO: use typeguards to distinguish saved metrics from adhoc metrics\nconst getMetricsMatchingCurrentDataset = (value, columns, savedMetrics) =>\n  ensureIsArray(value).filter(metric => {\n    if (typeof metric === 'string' || metric.metric_name) {\n      return savedMetrics?.some(\n        savedMetric =>\n          savedMetric.metric_name === metric ||\n          savedMetric.metric_name === metric.metric_name,\n      );\n    }\n    return columns?.some(\n      column =>\n        !metric.column || metric.column.column_name === column.column_name,\n    );\n  });\n\nconst MetricsControl = ({\n  onChange,\n  multi,\n  value: propsValue,\n  columns,\n  savedMetrics,\n  datasource,\n  ...props\n}) => {\n  const [value, setValue] = useState(coerceAdhocMetrics(propsValue));\n  const theme = useTheme();\n  const prevColumns = usePrevious(columns);\n  const prevSavedMetrics = usePrevious(savedMetrics);\n\n  const handleChange = useCallback(\n    opts => {\n      // if clear out options\n      if (opts === null) {\n        onChange(null);\n        return;\n      }\n\n      const transformedOpts = ensureIsArray(opts);\n      const optionValues = transformedOpts\n        .map(option => {\n          // pre-defined metric\n          if (option.metric_name) {\n            return option.metric_name;\n          }\n          return option;\n        })\n        .filter(option => option);\n      onChange(multi ? optionValues : optionValues[0]);\n    },\n    [multi, onChange],\n  );\n\n  const onNewMetric = useCallback(\n    newMetric => {\n      const newValue = [...value, newMetric];\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onMetricEdit = useCallback(\n    (changedMetric, oldMetric) => {\n      const newValue = value.map(val => {\n        if (\n          // compare saved metrics\n          val === oldMetric.metric_name ||\n          // compare adhoc metrics\n          typeof val.optionName !== 'undefined'\n            ? val.optionName === oldMetric.optionName\n            : false\n        ) {\n          return changedMetric;\n        }\n        return val;\n      });\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onRemoveMetric = useCallback(\n    index => {\n      if (!Array.isArray(value)) {\n        return;\n      }\n      const valuesCopy = [...value];\n      valuesCopy.splice(index, 1);\n      setValue(valuesCopy);\n      handleChange(valuesCopy);\n    },\n    [handleChange, value],\n  );\n\n  const moveLabel = useCallback(\n    (dragIndex, hoverIndex) => {\n      const newValues = [...value];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValue(newValues);\n    },\n    [value],\n  );\n\n  const isAddNewMetricDisabled = useCallback(\n    () => !multi && value.length > 0,\n    [multi, value.length],\n  );\n\n  const savedMetricOptions = useMemo(\n    () => getOptionsForSavedMetrics(savedMetrics, propsValue, null),\n    [propsValue, savedMetrics],\n  );\n\n  const newAdhocMetric = useMemo(() => new AdhocMetric({}), [value]);\n  const addNewMetricPopoverTrigger = useCallback(\n    trigger => {\n      if (isAddNewMetricDisabled()) {\n        return trigger;\n      }\n      return (\n        <AdhocMetricPopoverTrigger\n          adhocMetric={newAdhocMetric}\n          onMetricEdit={onNewMetric}\n          columns={columns}\n          savedMetricsOptions={savedMetricOptions}\n          savedMetric={emptySavedMetric}\n          datasource={datasource}\n          isNew\n        >\n          {trigger}\n        </AdhocMetricPopoverTrigger>\n      );\n    },\n    [\n      columns,\n      datasource,\n      isAddNewMetricDisabled,\n      newAdhocMetric,\n      onNewMetric,\n      savedMetricOptions,\n    ],\n  );\n\n  useEffect(() => {\n    // Remove selected custom metrics that do not exist in the dataset anymore\n    // Remove selected adhoc metrics that use columns which do not exist in the dataset anymore\n    if (\n      propsValue &&\n      (!isEqual(prevColumns, columns) ||\n        !isEqual(prevSavedMetrics, savedMetrics))\n    ) {\n      const matchingMetrics = getMetricsMatchingCurrentDataset(\n        propsValue,\n        columns,\n        savedMetrics,\n      );\n      if (!isEqual(matchingMetrics, propsValue)) {\n        handleChange(matchingMetrics);\n      }\n    }\n  }, [columns, handleChange, savedMetrics]);\n\n  useEffect(() => {\n    setValue(coerceAdhocMetrics(propsValue));\n  }, [propsValue]);\n\n  const onDropLabel = useCallback(\n    () => handleChange(value),\n    [handleChange, value],\n  );\n\n  const valueRenderer = useCallback(\n    (option, index) => (\n      <MetricDefinitionValue\n        key={index}\n        index={index}\n        option={option}\n        onMetricEdit={onMetricEdit}\n        onRemoveMetric={onRemoveMetric}\n        columns={columns}\n        datasource={datasource}\n        savedMetrics={savedMetrics}\n        savedMetricsOptions={getOptionsForSavedMetrics(\n          savedMetrics,\n          value,\n          value?.[index],\n        )}\n        onMoveLabel={moveLabel}\n        onDropLabel={onDropLabel}\n        multi={multi}\n      />\n    ),\n    [\n      columns,\n      datasource,\n      moveLabel,\n      multi,\n      onDropLabel,\n      onMetricEdit,\n      onRemoveMetric,\n      savedMetrics,\n      value,\n    ],\n  );\n\n  return (\n    <div className=\"metrics-select\">\n      <HeaderContainer>\n        <ControlHeader {...props} />\n        {addNewMetricPopoverTrigger(\n          <AddIconButton\n            disabled={isAddNewMetricDisabled()}\n            data-test=\"add-metric-button\"\n          >\n            <Icons.PlusLarge\n              iconSize=\"s\"\n              iconColor={theme.colors.grayscale.light5}\n            />\n          </AddIconButton>,\n        )}\n      </HeaderContainer>\n      <LabelsContainer>\n        {value.length > 0\n          ? value.map((value, index) => valueRenderer(value, index))\n          : addNewMetricPopoverTrigger(\n              <AddControlLabel>\n                <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n                {t('Add metric')}\n              </AddControlLabel>,\n            )}\n      </LabelsContainer>\n    </div>\n  );\n};\n\nMetricsControl.propTypes = propTypes;\nMetricsControl.defaultProps = defaultProps;\n\nexport default MetricsControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css } from '@emotion/react';\nimport { t } from '@superset-ui/core';\nimport Label from 'src/components/Label';\nimport Collapse from 'src/components/Collapse';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport MetricsControl from 'src/explore/components/controls/MetricControl/MetricsControl';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport PopoverSection from 'src/components/PopoverSection';\n\nconst controlTypes = {\n  fixed: 'fix',\n  metric: 'metric',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  isFloat: PropTypes.bool,\n  datasource: PropTypes.object.isRequired,\n  default: PropTypes.shape({\n    type: PropTypes.oneOf(['fix', 'metric']),\n    value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  }),\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  default: { type: controlTypes.fixed, value: 5 },\n};\n\nexport default class FixedOrMetricControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n    this.setType = this.setType.bind(this);\n    this.setFixedValue = this.setFixedValue.bind(this);\n    this.setMetric = this.setMetric.bind(this);\n    const type =\n      (props.value ? props.value.type : props.default.type) ||\n      controlTypes.fixed;\n    const value =\n      (props.value ? props.value.value : props.default.value) || '100';\n    this.state = {\n      type,\n      fixedValue: type === controlTypes.fixed ? value : '',\n      metricValue: type === controlTypes.metric ? value : null,\n    };\n  }\n\n  onChange() {\n    this.props.onChange({\n      type: this.state.type,\n      value:\n        this.state.type === controlTypes.fixed\n          ? this.state.fixedValue\n          : this.state.metricValue,\n    });\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  setFixedValue(fixedValue) {\n    this.setState({ fixedValue }, this.onChange);\n  }\n\n  setMetric(metricValue) {\n    this.setState({ metricValue }, this.onChange);\n  }\n\n  render() {\n    const value = this.props.value || this.props.default;\n    const type = value.type || controlTypes.fixed;\n    const columns = this.props.datasource\n      ? this.props.datasource.columns\n      : null;\n    const metrics = this.props.datasource\n      ? this.props.datasource.metrics\n      : null;\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Collapse\n          ghost\n          css={theme => css`\n            &.ant-collapse\n              > .ant-collapse-item.ant-collapse-no-arrow\n              > .ant-collapse-header {\n              border: 0px;\n              padding: 0px 0px ${theme.gridUnit * 2}px 0px;\n              display: inline-block;\n            }\n            &.ant-collapse-ghost\n              > .ant-collapse-item\n              > .ant-collapse-content\n              > .ant-collapse-content-box {\n              padding: 0px;\n\n              & .well {\n                margin-bottom: 0px;\n                padding: ${theme.gridUnit * 2}px;\n              }\n            }\n          `}\n        >\n          <Collapse.Panel\n            showArrow={false}\n            header={\n              <Label onClick={() => undefined}>\n                {this.state.type === controlTypes.fixed && (\n                  <span>{this.state.fixedValue}</span>\n                )}\n                {this.state.type === controlTypes.metric && (\n                  <span>\n                    <span>{t('metric')}: </span>\n                    <strong>\n                      {this.state.metricValue\n                        ? this.state.metricValue.label\n                        : null}\n                    </strong>\n                  </span>\n                )}\n              </Label>\n            }\n          >\n            <div className=\"well\">\n              <PopoverSection\n                title={t('Fixed')}\n                isSelected={type === controlTypes.fixed}\n                onSelect={() => {\n                  this.setType(controlTypes.fixed);\n                }}\n              >\n                <TextControl\n                  isFloat\n                  onChange={this.setFixedValue}\n                  onFocus={() => {\n                    this.setType(controlTypes.fixed);\n                  }}\n                  value={this.state.fixedValue}\n                />\n              </PopoverSection>\n              <PopoverSection\n                title={t('Based on a metric')}\n                isSelected={type === controlTypes.metric}\n                onSelect={() => {\n                  this.setType(controlTypes.metric);\n                }}\n              >\n                <MetricsControl\n                  name=\"metric\"\n                  columns={columns}\n                  savedMetrics={metrics}\n                  multi={false}\n                  onFocus={() => {\n                    this.setType(controlTypes.metric);\n                  }}\n                  onChange={this.setMetric}\n                  value={this.state.metricValue}\n                  datasource={this.props.datasource}\n                />\n              </PopoverSection>\n            </div>\n          </Collapse.Panel>\n        </Collapse>\n      </div>\n    );\n  }\n}\n\nFixedOrMetricControl.propTypes = propTypes;\nFixedOrMetricControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Select } from 'src/components';\nimport { SelectOptionsType, SelectProps } from 'src/components/Select/types';\nimport { SelectValue, LabeledValue } from 'antd/lib/select';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\n\ntype SelectAsyncProps = Omit<SelectProps, 'options' | 'ariaLabel' | 'onChange'>;\n\ninterface SelectAsyncControlProps extends SelectAsyncProps {\n  addDangerToast: (error: string) => void;\n  ariaLabel?: string;\n  dataEndpoint: string;\n  default?: SelectValue;\n  mutator?: (response: Record<string, any>) => SelectOptionsType;\n  multi?: boolean;\n  onChange: (val: SelectValue) => void;\n  // ControlHeader related props\n  description?: string;\n  hovered?: boolean;\n  label?: string;\n}\n\nfunction isLabeledValue(arg: any): arg is LabeledValue {\n  return arg.value !== undefined;\n}\n\nconst SelectAsyncControl = ({\n  addDangerToast,\n  allowClear = true,\n  ariaLabel,\n  dataEndpoint,\n  multi = true,\n  mutator,\n  onChange,\n  placeholder,\n  value,\n  ...props\n}: SelectAsyncControlProps) => {\n  const [options, setOptions] = useState<SelectOptionsType>([]);\n\n  const handleOnChange = (val: SelectValue) => {\n    let onChangeVal = val;\n    if (Array.isArray(val)) {\n      const values = val.map(v => (isLabeledValue(v) ? v.value : v));\n      onChangeVal = values;\n    }\n    if (isLabeledValue(val)) {\n      onChangeVal = val.value;\n    }\n    onChange(onChangeVal);\n  };\n\n  const getValue = () => {\n    const currentValue =\n      value || (props.default !== undefined ? props.default : undefined);\n\n    // safety check - the value is intended to be undefined but null was used\n    if (currentValue === null && !options.find(o => o.value === null)) {\n      return undefined;\n    }\n    return currentValue;\n  };\n\n  useEffect(() => {\n    const onError = (response: Response) =>\n      getClientErrorObject(response).then(e => {\n        const { error } = e;\n        addDangerToast(t('Error while fetching data: %s', error));\n      });\n    const loadOptions = () =>\n      SupersetClient.get({\n        endpoint: dataEndpoint,\n      })\n        .then(response => {\n          const data = mutator ? mutator(response.json) : response.json.result;\n          setOptions(data);\n        })\n        .catch(onError);\n    loadOptions();\n  }, [addDangerToast, dataEndpoint, mutator]);\n\n  return (\n    <Select\n      allowClear={allowClear}\n      ariaLabel={ariaLabel || t('Select ...')}\n      value={getValue()}\n      header={<ControlHeader {...props} />}\n      mode={multi ? 'multiple' : 'single'}\n      onChange={handleOnChange}\n      options={options}\n      placeholder={placeholder}\n    />\n  );\n};\n\nexport default withToasts(SelectAsyncControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport AntdSlider, {\n  SliderSingleProps,\n  SliderRangeProps,\n} from 'antd/lib/slider';\n\nexport type { SliderSingleProps, SliderRangeProps };\n\nexport default function Slider(props: SliderSingleProps | SliderRangeProps) {\n  return <AntdSlider {...props} css={{ marginLeft: 0, marginRight: 0 }} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Input } from 'src/components/Input';\nimport Button from 'src/components/Button';\nimport { Select, Row, Col } from 'src/components';\nimport { t, styled } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport BoundsControl from '../BoundsControl';\nimport CheckboxControl from '../CheckboxControl';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nconst propTypes = {\n  label: PropTypes.string,\n  tooltip: PropTypes.string,\n  colType: PropTypes.string,\n  width: PropTypes.string,\n  height: PropTypes.string,\n  timeLag: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  timeRatio: PropTypes.string,\n  comparisonType: PropTypes.string,\n  showYAxis: PropTypes.bool,\n  yAxisBounds: PropTypes.array,\n  bounds: PropTypes.array,\n  d3format: PropTypes.string,\n  dateFormat: PropTypes.string,\n  onChange: PropTypes.func,\n};\n\nconst defaultProps = {\n  label: t('Time series columns'),\n  tooltip: '',\n  colType: '',\n  width: '',\n  height: '',\n  timeLag: '',\n  timeRatio: '',\n  comparisonType: '',\n  showYAxis: false,\n  yAxisBounds: [null, null],\n  bounds: [null, null],\n  d3format: '',\n  dateFormat: '',\n};\n\nconst comparisonTypeOptions = [\n  { value: 'value', label: t('Actual value'), key: 'value' },\n  { value: 'diff', label: t('Difference'), key: 'diff' },\n  { value: 'perc', label: t('Percentage'), key: 'perc' },\n  { value: 'perc_change', label: t('Percentage change'), key: 'perc_change' },\n];\n\nconst colTypeOptions = [\n  { value: 'time', label: t('Time comparison'), key: 'time' },\n  { value: 'contrib', label: t('Contribution'), key: 'contrib' },\n  { value: 'spark', label: t('Sparkline'), key: 'spark' },\n  { value: 'avg', label: t('Period average'), key: 'avg' },\n];\n\nconst StyledRow = styled(Row)`\n  margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledCol = styled(Col)`\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledTooltip = styled(InfoTooltipWithTrigger)`\n  margin-left: ${({ theme }) => theme.gridUnit}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nconst ButtonBar = styled.div`\n  margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  display: flex;\n  justify-content: center;\n`;\n\nexport default class TimeSeriesColumnControl extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onSave = this.onSave.bind(this);\n    this.onClose = this.onClose.bind(this);\n    this.resetState = this.resetState.bind(this);\n    this.initialState = this.initialState.bind(this);\n    this.onPopoverVisibleChange = this.onPopoverVisibleChange.bind(this);\n\n    this.state = this.initialState();\n  }\n\n  initialState() {\n    return {\n      label: this.props.label,\n      tooltip: this.props.tooltip,\n      colType: this.props.colType,\n      width: this.props.width,\n      height: this.props.height,\n      timeLag: this.props.timeLag || 0,\n      timeRatio: this.props.timeRatio,\n      comparisonType: this.props.comparisonType,\n      showYAxis: this.props.showYAxis,\n      yAxisBounds: this.props.yAxisBounds,\n      bounds: this.props.bounds,\n      d3format: this.props.d3format,\n      dateFormat: this.props.dateFormat,\n      popoverVisible: false,\n    };\n  }\n\n  resetState() {\n    const initialState = this.initialState();\n    this.setState({ ...initialState });\n  }\n\n  onSave() {\n    this.props.onChange(this.state);\n    this.setState({ popoverVisible: false });\n  }\n\n  onClose() {\n    this.resetState();\n  }\n\n  onSelectChange(attr, opt) {\n    this.setState({ [attr]: opt });\n  }\n\n  onTextInputChange(attr, event) {\n    this.setState({ [attr]: event.target.value });\n  }\n\n  onCheckboxChange(attr, value) {\n    this.setState({ [attr]: value });\n  }\n\n  onBoundsChange(bounds) {\n    this.setState({ bounds });\n  }\n\n  onPopoverVisibleChange(popoverVisible) {\n    if (popoverVisible) {\n      this.setState({ popoverVisible });\n    } else {\n      this.resetState();\n    }\n  }\n\n  onYAxisBoundsChange(yAxisBounds) {\n    this.setState({ yAxisBounds });\n  }\n\n  textSummary() {\n    return `${this.props.label}`;\n  }\n\n  formRow(label, tooltip, ttLabel, control) {\n    return (\n      <StyledRow>\n        <StyledCol xs={24} md={11}>\n          {label}\n          <StyledTooltip placement=\"top\" tooltip={tooltip} label={ttLabel} />\n        </StyledCol>\n        <Col xs={24} md={13}>\n          {control}\n        </Col>\n      </StyledRow>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={{ width: 320 }}>\n        {this.formRow(\n          t('Label'),\n          t('The column header label'),\n          'time-lag',\n          <Input\n            value={this.state.label}\n            onChange={this.onTextInputChange.bind(this, 'label')}\n            placeholder={t('Label')}\n          />,\n        )}\n        {this.formRow(\n          t('Tooltip'),\n          t('Column header tooltip'),\n          'col-tooltip',\n          <Input\n            value={this.state.tooltip}\n            onChange={this.onTextInputChange.bind(this, 'tooltip')}\n            placeholder={t('Tooltip')}\n          />,\n        )}\n        {this.formRow(\n          t('Type'),\n          t('Type of comparison, value difference or percentage'),\n          'col-type',\n          <Select\n            ariaLabel={t('Type')}\n            value={this.state.colType || undefined}\n            onChange={this.onSelectChange.bind(this, 'colType')}\n            options={colTypeOptions}\n          />,\n        )}\n        <hr />\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Width'),\n            t('Width of the sparkline'),\n            'spark-width',\n            <Input\n              value={this.state.width}\n              onChange={this.onTextInputChange.bind(this, 'width')}\n              placeholder={t('Width')}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Height'),\n            t('Height of the sparkline'),\n            'spark-width',\n            <Input\n              value={this.state.height}\n              onChange={this.onTextInputChange.bind(this, 'height')}\n              placeholder={t('Height')}\n            />,\n          )}\n        {['time', 'avg'].indexOf(this.state.colType) >= 0 &&\n          this.formRow(\n            t('Time lag'),\n            t('Number of periods to compare against'),\n            'time-lag',\n            <Input\n              value={this.state.timeLag}\n              onChange={this.onTextInputChange.bind(this, 'timeLag')}\n              placeholder={t('Time Lag')}\n            />,\n          )}\n        {['spark'].indexOf(this.state.colType) >= 0 &&\n          this.formRow(\n            t('Time ratio'),\n            t('Number of periods to ratio against'),\n            'time-ratio',\n            <Input\n              value={this.state.timeRatio}\n              onChange={this.onTextInputChange.bind(this, 'timeRatio')}\n              placeholder={t('Time Ratio')}\n            />,\n          )}\n        {this.state.colType === 'time' &&\n          this.formRow(\n            t('Type'),\n            t('Type of comparison, value difference or percentage'),\n            'comp-type',\n            <Select\n              ariaLabel={t('Type')}\n              value={this.state.comparisonType || undefined}\n              onChange={this.onSelectChange.bind(this, 'comparisonType')}\n              options={comparisonTypeOptions}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Show Y-axis'),\n            t(\n              'Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise.',\n            ),\n            'show-y-axis-bounds',\n            <CheckboxControl\n              value={this.state.showYAxis}\n              onChange={this.onCheckboxChange.bind(this, 'showYAxis')}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Y-axis bounds'),\n            t('Manually set min/max values for the y-axis.'),\n            'y-axis-bounds',\n            <BoundsControl\n              value={this.state.yAxisBounds}\n              onChange={this.onYAxisBoundsChange.bind(this)}\n            />,\n          )}\n        {this.state.colType !== 'spark' &&\n          this.formRow(\n            t('Color bounds'),\n            t(`Number bounds used for color encoding from red to blue.\n               Reverse the numbers for blue to red. To get pure red or blue,\n               you can enter either only min or max.`),\n            'bounds',\n            <BoundsControl\n              value={this.state.bounds}\n              onChange={this.onBoundsChange.bind(this)}\n            />,\n          )}\n        {this.formRow(\n          t('Number format'),\n          t('Optional d3 number format string'),\n          'd3-format',\n          <Input\n            value={this.state.d3format}\n            onChange={this.onTextInputChange.bind(this, 'd3format')}\n            placeholder={t('Number format string')}\n          />,\n        )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Date format'),\n            t('Optional d3 date format string'),\n            'date-format',\n            <Input\n              value={this.state.dateFormat}\n              onChange={this.onTextInputChange.bind(this, 'dateFormat')}\n              placeholder={t('Date format string')}\n            />,\n          )}\n        <ButtonBar>\n          <Button buttonSize=\"small\" onClick={this.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n        </ButtonBar>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span>\n        {this.textSummary()}{' '}\n        <ControlPopover\n          trigger=\"click\"\n          content={this.renderPopover()}\n          title={t('Column Configuration')}\n          visible={this.state.popoverVisible}\n          onVisibleChange={this.onPopoverVisibleChange}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </ControlPopover>\n      </span>\n    );\n  }\n}\n\nTimeSeriesColumnControl.propTypes = propTypes;\nTimeSeriesColumnControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport PropTypes from 'prop-types';\nimport Popover from 'src/components/Popover';\nimport { decimal2sexagesimal } from 'geolib';\n\nimport Label from 'src/components/Label';\nimport { FormLabel } from 'src/components/Form';\nimport TextControl from './TextControl';\nimport ControlHeader from '../ControlHeader';\n\nexport const DEFAULT_VIEWPORT = {\n  longitude: 6.85236157047845,\n  latitude: 31.222656842808707,\n  zoom: 1,\n  bearing: 0,\n  pitch: 0,\n};\n\nconst PARAMS = ['longitude', 'latitude', 'zoom', 'bearing', 'pitch'];\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.shape({\n    longitude: PropTypes.number,\n    latitude: PropTypes.number,\n    zoom: PropTypes.number,\n    bearing: PropTypes.number,\n    pitch: PropTypes.number,\n  }),\n  default: PropTypes.object,\n  name: PropTypes.string.isRequired,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  default: { type: 'fix', value: 5 },\n  value: DEFAULT_VIEWPORT,\n};\n\nexport default class ViewportControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  onChange(ctrl, value) {\n    this.props.onChange({\n      ...this.props.value,\n      [ctrl]: value,\n    });\n  }\n\n  renderTextControl(ctrl) {\n    return (\n      <div key={ctrl}>\n        <FormLabel>{ctrl}</FormLabel>\n        <TextControl\n          value={this.props.value[ctrl]}\n          onChange={this.onChange.bind(this, ctrl)}\n          isFloat\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id={`filter-popover-${this.props.name}`}>\n        {PARAMS.map(ctrl => this.renderTextControl(ctrl))}\n      </div>\n    );\n  }\n\n  renderLabel() {\n    if (this.props.value.longitude && this.props.value.latitude) {\n      return `${decimal2sexagesimal(\n        this.props.value.longitude,\n      )} | ${decimal2sexagesimal(this.props.value.latitude)}`;\n    }\n    return 'N/A';\n  }\n\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          container={document.body}\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n          title={t('Viewport')}\n        >\n          <Label className=\"pointer\">{this.renderLabel()}</Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nViewportControl.propTypes = propTypes;\nViewportControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useSelector } from 'react-redux';\nimport { css, SupersetTheme, t, useTheme } from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { getChartKey } from 'src/explore/exploreUtils';\nimport { ExplorePageState } from 'src/explore/types';\n\nexport interface VizMeta {\n  icon: ReactElement;\n  name: string;\n}\n\nexport interface FastVizSwitcherProps {\n  onChange: (vizName: string) => void;\n  currentSelection: string | null;\n}\ninterface VizTileProps {\n  vizMeta: VizMeta;\n  isActive: boolean;\n  isRendered: boolean;\n  onTileClick: (vizType: string) => void;\n}\n\nconst FEATURED_CHARTS: VizMeta[] = [\n  {\n    name: 'echarts_timeseries_line',\n    icon: <Icons.LineChartTile />,\n  },\n  {\n    name: 'echarts_timeseries_bar',\n    icon: <Icons.BarChartTile />,\n  },\n  { name: 'echarts_area', icon: <Icons.AreaChartTile /> },\n  { name: 'table', icon: <Icons.TableChartTile /> },\n  {\n    name: 'big_number_total',\n    icon: <Icons.BigNumberChartTile />,\n  },\n  { name: 'pie', icon: <Icons.PieChartTile /> },\n];\n\nconst antdIconProps = {\n  iconSize: 'l' as const,\n  css: (theme: SupersetTheme) => css`\n    padding: ${theme.gridUnit}px;\n    & > * {\n      line-height: 0;\n    }\n  `,\n};\n\nconst VizTile = ({\n  isActive,\n  isRendered,\n  vizMeta,\n  onTileClick,\n}: VizTileProps) => {\n  const { mountedPluginMetadata } = usePluginContext();\n  const chartNameRef = useRef<HTMLSpanElement>(null);\n  const theme = useTheme();\n  const TILE_TRANSITION_TIME = theme.transitionTiming * 2;\n  const [tooltipVisible, setTooltipVisible] = useState(false);\n  const [isTransitioning, setIsTransitioning] = useState(false);\n  const [showTooltip, setShowTooltip] = useState(false);\n  const chartName = vizMeta.name\n    ? mountedPluginMetadata[vizMeta.name]?.name || `${vizMeta.name}`\n    : t('Select Viz Type');\n\n  const handleTileClick = useCallback(() => {\n    onTileClick(vizMeta.name);\n    setIsTransitioning(true);\n    setTooltipVisible(false);\n    setTimeout(() => {\n      setIsTransitioning(false);\n    }, TILE_TRANSITION_TIME * 1000);\n  }, [onTileClick, TILE_TRANSITION_TIME, vizMeta.name]);\n\n  // Antd tooltip seems to be bugged - when elements move, the tooltip sometimes\n  // stays visible even when user doesn't hover over the element.\n  // Here we manually prevent it from displaying after user triggers transition\n  useEffect(() => {\n    setShowTooltip(\n      Boolean(\n        !isTransitioning &&\n          (!isActive ||\n            (chartNameRef.current &&\n              chartNameRef.current.scrollWidth >\n                chartNameRef.current.clientWidth)),\n      ),\n    );\n  }, [isActive, isTransitioning]);\n\n  const containerProps = useMemo(\n    () =>\n      !isActive\n        ? { role: 'button', tabIndex: 0, onClick: handleTileClick }\n        : {},\n    [handleTileClick, isActive],\n  );\n\n  let tooltipTitle: string | null = null;\n  if (showTooltip) {\n    tooltipTitle = isRendered\n      ? t('Currently rendered: %s', chartName)\n      : chartName;\n  }\n  return (\n    <Tooltip\n      title={tooltipTitle}\n      onVisibleChange={visible => setTooltipVisible(visible)}\n      visible={tooltipVisible && !isTransitioning}\n      placement=\"top\"\n      mouseEnterDelay={0.4}\n    >\n      <div\n        {...containerProps}\n        css={css`\n          display: flex;\n          align-items: center;\n          text-transform: uppercase;\n\n          color: ${theme.colors.grayscale.base};\n          font-weight: ${theme.typography.weights.bold};\n          border-radius: 6px;\n          white-space: nowrap;\n          overflow: hidden;\n          max-width: fit-content;\n\n          ${!isActive &&\n          css`\n            flex-shrink: 0;\n            width: ${theme.gridUnit * 6}px;\n            background-color: transparent;\n            transition: none;\n            &:hover svg path {\n              fill: ${theme.colors.primary.base};\n              transition: fill ${theme.transitionTiming}s ease-out;\n            }\n          `}\n\n          ${isActive &&\n          css`\n            width: 100%;\n            background-color: ${theme.colors.grayscale.light4};\n            transition: width ${TILE_TRANSITION_TIME}s ease-out,\n              background-color ${TILE_TRANSITION_TIME}s ease-out;\n            cursor: default;\n            svg path {\n              fill: ${theme.colors.primary.base};\n            }\n          `}\n        `}\n      >\n        {vizMeta.icon}{' '}\n        <span\n          css={css`\n            overflow: hidden;\n            text-overflow: ellipsis;\n            min-width: 0;\n            padding-right: ${theme.gridUnit}px;\n          `}\n          ref={chartNameRef}\n        >\n          {chartName}\n        </span>\n      </div>\n    </Tooltip>\n  );\n};\n\nexport const FastVizSwitcher = React.memo(\n  ({ currentSelection, onChange }: FastVizSwitcherProps) => {\n    const currentViz = useSelector<ExplorePageState, string | undefined>(\n      state =>\n        state.charts?.[getChartKey(state.explore)]?.latestQueryFormData\n          ?.viz_type,\n    );\n    const vizTiles = useMemo(() => {\n      const vizTiles = [...FEATURED_CHARTS];\n      if (\n        currentSelection &&\n        FEATURED_CHARTS.every(\n          featuredVizMeta => featuredVizMeta.name !== currentSelection,\n        ) &&\n        currentSelection !== currentViz\n      ) {\n        vizTiles.unshift({\n          name: currentSelection,\n          icon: (\n            <Icons.MonitorOutlined {...antdIconProps} aria-label=\"monitor\" />\n          ),\n        });\n      }\n      if (\n        currentViz &&\n        FEATURED_CHARTS.every(\n          featuredVizMeta => featuredVizMeta.name !== currentViz,\n        )\n      ) {\n        vizTiles.unshift({\n          name: currentViz,\n          icon: (\n            <Icons.CheckSquareOutlined\n              {...antdIconProps}\n              aria-label=\"check-square\"\n            />\n          ),\n        });\n      }\n      return vizTiles;\n    }, [currentSelection, currentViz]);\n\n    return (\n      <div\n        css={(theme: SupersetTheme) => css`\n          display: flex;\n          justify-content: space-between;\n          column-gap: ${theme.gridUnit}px;\n        `}\n        data-test=\"fast-viz-switcher\"\n      >\n        {vizTiles.map(vizMeta => (\n          <VizTile\n            vizMeta={vizMeta}\n            isActive={currentSelection === vizMeta.name}\n            isRendered={currentViz === vizMeta.name}\n            onTileClick={onChange}\n            key={vizMeta.name}\n          />\n        ))}\n      </div>\n    );\n  },\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport {\n  css,\n  t,\n  getChartMetadataRegistry,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Modal from 'src/components/Modal';\nimport { noOp } from 'src/utils/common';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport VizTypeGallery, {\n  MAX_ADVISABLE_VIZ_GALLERY_WIDTH,\n} from './VizTypeGallery';\nimport { FastVizSwitcher } from './FastVizSwitcher';\n\ninterface VizTypeControlProps {\n  description?: string;\n  label?: string;\n  name: string;\n  onChange: (vizType: string | null) => void;\n  value: string | null;\n  isModalOpenInit?: boolean;\n}\n\nconst bootstrapData = getBootstrapData();\nconst denyList: string[] = bootstrapData.common.conf.VIZ_TYPE_DENYLIST || [];\nconst metadataRegistry = getChartMetadataRegistry();\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nfunction VizSupportValidation({ vizType }: { vizType: string }) {\n  const state = usePluginContext();\n  if (state.loading || metadataRegistry.has(vizType)) {\n    return null;\n  }\n  return (\n    <div\n      className=\"text-danger\"\n      css={(theme: SupersetTheme) => css`\n        margin-top: ${theme.gridUnit}px;\n      `}\n    >\n      <i className=\"fa fa-exclamation-circle text-danger\" />{' '}\n      <small>{t('This visualization type is not supported.')}</small>\n    </div>\n  );\n}\n\nconst UnpaddedModal = styled(Modal)`\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\n/** Manages the viz type and the viz picker modal */\nconst VizTypeControl = ({\n  value: initialValue,\n  onChange = noOp,\n  isModalOpenInit,\n}: VizTypeControlProps) => {\n  const [showModal, setShowModal] = useState(!!isModalOpenInit);\n  // a trick to force re-initialization of the gallery each time the modal opens,\n  // ensuring that the modal always opens to the correct category.\n  const [modalKey, setModalKey] = useState(0);\n  const [selectedViz, setSelectedViz] = useState<string | null>(initialValue);\n\n  const openModal = useCallback(() => {\n    setShowModal(true);\n  }, []);\n\n  const onSubmit = useCallback(() => {\n    onChange(selectedViz);\n    setShowModal(false);\n  }, [selectedViz, onChange]);\n\n  const onCancel = useCallback(() => {\n    setShowModal(false);\n    setModalKey(key => key + 1);\n    // make sure the modal re-opens to the last submitted viz\n    setSelectedViz(initialValue);\n  }, [initialValue]);\n\n  return (\n    <>\n      <div\n        css={(theme: SupersetTheme) => css`\n          min-width: ${theme.gridUnit * 72}px;\n          max-width: fit-content;\n        `}\n      >\n        <FastVizSwitcher onChange={onChange} currentSelection={initialValue} />\n        {initialValue && <VizSupportValidation vizType={initialValue} />}\n      </div>\n      <div\n        css={(theme: SupersetTheme) => css`\n          display: flex;\n          justify-content: flex-end;\n          margin-top: ${theme.gridUnit * 3}px;\n          color: ${theme.colors.grayscale.base};\n          text-decoration: underline;\n        `}\n      >\n        <span role=\"button\" tabIndex={0} onClick={openModal}>\n          {t('View all charts')}\n        </span>\n      </div>\n      <UnpaddedModal\n        show={showModal}\n        onHide={onCancel}\n        title={t('Select a visualization type')}\n        primaryButtonName={t('Select')}\n        disablePrimaryButton={!selectedViz}\n        onHandledPrimaryAction={onSubmit}\n        maxWidth={`${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px`}\n        responsive\n      >\n        {/* When the key increments, it forces react to re-init the gallery component */}\n        <VizTypeGallery\n          key={modalKey}\n          selectedViz={selectedViz}\n          onChange={setSelectedViz}\n          onDoubleClick={onSubmit}\n          denyList={denyList}\n        />\n      </UnpaddedModal>\n    </>\n  );\n};\n\nexport default VizTypeControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/components';\n\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nconst STYLE_ROW = { marginTop: '5px', minHeight: '30px' };\nconst STYLE_RALIGN = { textAlign: 'right' };\n\nconst propTypes = {\n  label: PropTypes.string.isRequired,\n  tooltip: PropTypes.string,\n  control: PropTypes.node.isRequired,\n  isCheckbox: PropTypes.bool,\n};\n\nconst defaultProps = {\n  tooltip: null,\n  isCheckbox: false,\n};\n\nexport default function FormRow({ label, tooltip, control, isCheckbox }) {\n  const labelAndTooltip = (\n    <span>\n      {label}{' '}\n      {tooltip && (\n        <InfoTooltipWithTrigger\n          placement=\"top\"\n          label={label}\n          tooltip={tooltip}\n        />\n      )}\n    </span>\n  );\n  if (isCheckbox) {\n    return (\n      <Row style={STYLE_ROW} gutter={16}>\n        <Col xs={24} md={8} style={STYLE_RALIGN}>\n          {control}\n        </Col>\n        <Col xs={24} md={16}>\n          {labelAndTooltip}\n        </Col>\n      </Row>\n    );\n  }\n  return (\n    <Row style={STYLE_ROW} gutter={16}>\n      <Col xs={24} md={8} style={STYLE_RALIGN}>\n        {labelAndTooltip}\n      </Col>\n      <Col xs={24} md={16}>\n        {control}\n      </Col>\n    </Row>\n  );\n}\nFormRow.propTypes = propTypes;\nFormRow.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nimport FormRow from 'src/components/FormRow';\nimport { Select } from 'src/components';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport { FILTER_CONFIG_ATTRIBUTES } from 'src/explore/constants';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nconst INTEGRAL_TYPES = new Set([\n  'TINYINT',\n  'SMALLINT',\n  'INT',\n  'INTEGER',\n  'BIGINT',\n  'LONG',\n]);\nconst DECIMAL_TYPES = new Set([\n  'FLOAT',\n  'DOUBLE',\n  'REAL',\n  'NUMERIC',\n  'DECIMAL',\n  'MONEY',\n]);\n\nconst propTypes = {\n  datasource: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  asc: PropTypes.bool,\n  clearable: PropTypes.bool,\n  multiple: PropTypes.bool,\n  column: PropTypes.string,\n  label: PropTypes.string,\n  metric: PropTypes.string,\n  searchAllOptions: PropTypes.bool,\n  defaultValue: PropTypes.string,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  asc: true,\n  clearable: true,\n  multiple: true,\n  searchAllOptions: false,\n};\n\nconst STYLE_WIDTH = { width: 350 };\n\nexport default class FilterBoxItemControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const {\n      column,\n      metric,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      label,\n      defaultValue,\n    } = props;\n    this.state = {\n      column,\n      metric,\n      label,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      defaultValue,\n    };\n    this.onChange = this.onChange.bind(this);\n    this.onControlChange = this.onControlChange.bind(this);\n  }\n\n  onChange() {\n    this.props.onChange(this.state);\n  }\n\n  onControlChange(attr, value) {\n    let typedValue = value;\n    const { column: selectedColumnName, multiple } = this.state;\n    if (value && !multiple && attr === FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE) {\n      // if single value filter_box,\n      // convert input value string to the column's data type\n      const { datasource } = this.props;\n      const selectedColumn = datasource.columns.find(\n        col => col.column_name === selectedColumnName,\n      );\n\n      if (selectedColumn && selectedColumn.type) {\n        const type = selectedColumn.type.toUpperCase();\n        if (type === 'BOOLEAN') {\n          typedValue = value === 'true';\n        } else if (INTEGRAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseInt(value, 10);\n        } else if (DECIMAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseFloat(value);\n        }\n      }\n    }\n    this.setState({ [attr]: typedValue }, this.onChange);\n  }\n\n  setType() {}\n\n  textSummary() {\n    return this.state.column || 'N/A';\n  }\n\n  renderForm() {\n    return (\n      <div>\n        <FormRow\n          label={t('Column')}\n          control={\n            <Select\n              ariaLabel={t('Column')}\n              value={this.state.column}\n              name=\"column\"\n              options={this.props.datasource.columns\n                .filter(col => col.column_name !== this.state.column)\n                .map(col => ({\n                  value: col.column_name,\n                  label: col.column_name,\n                }))\n                .concat([\n                  { value: this.state.column, label: this.state.column },\n                ])}\n              onChange={v => this.onControlChange('column', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Label')}\n          control={\n            <TextControl\n              value={this.state.label}\n              name=\"label\"\n              onChange={v => this.onControlChange('label', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Default')}\n          tooltip={t(\n            '(optional) default value for the filter, when using ' +\n              'the multiple option, you can use a semicolon-delimited list ' +\n              'of options.',\n          )}\n          control={\n            <TextControl\n              value={this.state.defaultValue}\n              name=\"defaultValue\"\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort metric')}\n          tooltip={t('Metric to sort the results by')}\n          control={\n            <Select\n              ariaLabel={t('Sort metric')}\n              value={this.state.metric}\n              name=\"column\"\n              options={this.props.datasource.metrics\n                .filter(m => m.metric_name !== this.state.metric)\n                .map(m => ({\n                  value: m.metric_name,\n                  label: m.metric_name,\n                }))\n                .concat([\n                  { value: this.state.metric, label: this.state.metric },\n                ])}\n              onChange={v => this.onControlChange('metric', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort ascending')}\n          tooltip={t('Check for sorting ascending')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.asc}\n              onChange={v => this.onControlChange('asc', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Allow multiple selections')}\n          isCheckbox\n          tooltip={t(\n            'Multiple selections allowed, otherwise filter ' +\n              'is limited to a single value',\n          )}\n          control={\n            <CheckboxControl\n              value={this.state.multiple}\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.MULTIPLE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Search all filter options')}\n          tooltip={t(\n            'By default, each filter loads at most 1000 choices at the initial page load. ' +\n              'Check this box if you have more than 1000 filter values and want to enable dynamically ' +\n              'searching that loads filter values as users type (may add stress to your database).',\n          )}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.searchAllOptions}\n              onChange={v =>\n                this.onControlChange(\n                  FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS,\n                  v,\n                )\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Required')}\n          tooltip={t('User must select a value for this filter')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={!this.state.clearable}\n              onChange={v => this.onControlChange('clearable', !v)}\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={STYLE_WIDTH}>\n        {this.renderForm()}\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span data-test=\"FilterBoxItemControl\">\n        {this.textSummary()}{' '}\n        <ControlPopover\n          trigger=\"click\"\n          content={this.renderPopover()}\n          title={t('Filter configuration')}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </ControlPopover>\n      </span>\n    );\n  }\n}\n\nFilterBoxItemControl.propTypes = propTypes;\nFilterBoxItemControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ReactNode } from 'react';\nimport { PopoverProps } from 'antd/lib/popover';\nimport { ControlComponentProps } from '@superset-ui/chart-controls';\n\nexport enum COMPARATOR {\n  NONE = 'None',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_OR_EQUAL = '',\n  LESS_OR_EQUAL = '',\n  EQUAL = '=',\n  NOT_EQUAL = '',\n  BETWEEN = '< x <',\n  BETWEEN_OR_EQUAL = ' x ',\n  BETWEEN_OR_LEFT_EQUAL = ' x <',\n  BETWEEN_OR_RIGHT_EQUAL = '< x ',\n}\n\nexport const MULTIPLE_VALUE_COMPARATORS = [\n  COMPARATOR.BETWEEN,\n  COMPARATOR.BETWEEN_OR_EQUAL,\n  COMPARATOR.BETWEEN_OR_LEFT_EQUAL,\n  COMPARATOR.BETWEEN_OR_RIGHT_EQUAL,\n];\n\nexport type ConditionalFormattingConfig = {\n  operator?: COMPARATOR;\n  targetValue?: number;\n  targetValueLeft?: number;\n  targetValueRight?: number;\n  column?: string;\n  colorScheme?: string;\n};\n\nexport type ConditionalFormattingControlProps = ControlComponentProps<\n  ConditionalFormattingConfig[]\n> & {\n  columnOptions: { label: string; value: string }[];\n  removeIrrelevantConditions: boolean;\n  verboseMap: Record<string, string>;\n  label: string;\n  description: string;\n};\n\nexport type FormattingPopoverProps = PopoverProps & {\n  columns: { label: string; value: string }[];\n  onChange: (value: ConditionalFormattingConfig) => void;\n  config?: ConditionalFormattingConfig;\n  title: string;\n  children: ReactNode;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled, SupersetTheme, t, useTheme } from '@superset-ui/core';\nimport { Form, FormItem, FormProps } from 'src/components/Form';\nimport Select from 'src/components/Select/Select';\nimport { Col, Row } from 'src/components';\nimport { InputNumber } from 'src/components/Input';\nimport Button from 'src/components/Button';\nimport {\n  COMPARATOR,\n  ConditionalFormattingConfig,\n  MULTIPLE_VALUE_COMPARATORS,\n} from './types';\n\nconst FullWidthInputNumber = styled(InputNumber)`\n  width: 100%;\n`;\n\nconst JustifyEnd = styled.div`\n  display: flex;\n  justify-content: flex-end;\n`;\n\nconst colorSchemeOptions = (theme: SupersetTheme) => [\n  { value: theme.colors.success.light1, label: t('success') },\n  { value: theme.colors.alert.light1, label: t('alert') },\n  { value: theme.colors.error.light1, label: t('error') },\n  { value: theme.colors.success.dark1, label: t('success dark') },\n  { value: theme.colors.alert.dark1, label: t('alert dark') },\n  { value: theme.colors.error.dark1, label: t('error dark') },\n];\n\nconst operatorOptions = [\n  { value: COMPARATOR.NONE, label: t('None') },\n  { value: COMPARATOR.GREATER_THAN, label: '>' },\n  { value: COMPARATOR.LESS_THAN, label: '<' },\n  { value: COMPARATOR.GREATER_OR_EQUAL, label: '' },\n  { value: COMPARATOR.LESS_OR_EQUAL, label: '' },\n  { value: COMPARATOR.EQUAL, label: '=' },\n  { value: COMPARATOR.NOT_EQUAL, label: '' },\n  { value: COMPARATOR.BETWEEN, label: '< x <' },\n  { value: COMPARATOR.BETWEEN_OR_EQUAL, label: ' x ' },\n  { value: COMPARATOR.BETWEEN_OR_LEFT_EQUAL, label: ' x <' },\n  { value: COMPARATOR.BETWEEN_OR_RIGHT_EQUAL, label: '< x ' },\n];\n\nconst targetValueValidator =\n  (\n    compare: (targetValue: number, compareValue: number) => boolean,\n    rejectMessage: string,\n  ) =>\n  (targetValue: number | string) =>\n  (_: any, compareValue: number | string) => {\n    if (\n      !targetValue ||\n      !compareValue ||\n      compare(Number(targetValue), Number(compareValue))\n    ) {\n      return Promise.resolve();\n    }\n    return Promise.reject(new Error(rejectMessage));\n  };\n\nconst targetValueLeftValidator = targetValueValidator(\n  (target: number, val: number) => target > val,\n  t('This value should be smaller than the right target value'),\n);\n\nconst targetValueRightValidator = targetValueValidator(\n  (target: number, val: number) => target < val,\n  t('This value should be greater than the left target value'),\n);\n\nconst isOperatorMultiValue = (operator?: COMPARATOR) =>\n  operator && MULTIPLE_VALUE_COMPARATORS.includes(operator);\n\nconst isOperatorNone = (operator?: COMPARATOR) =>\n  !operator || operator === COMPARATOR.NONE;\n\nconst rulesRequired = [{ required: true, message: t('Required') }];\n\ntype GetFieldValue = Pick<Required<FormProps>['form'], 'getFieldValue'>;\nconst rulesTargetValueLeft = [\n  { required: true, message: t('Required') },\n  ({ getFieldValue }: GetFieldValue) => ({\n    validator: targetValueLeftValidator(getFieldValue('targetValueRight')),\n  }),\n];\n\nconst rulesTargetValueRight = [\n  { required: true, message: t('Required') },\n  ({ getFieldValue }: GetFieldValue) => ({\n    validator: targetValueRightValidator(getFieldValue('targetValueLeft')),\n  }),\n];\n\nconst targetValueLeftDeps = ['targetValueRight'];\nconst targetValueRightDeps = ['targetValueLeft'];\n\nconst shouldFormItemUpdate = (\n  prevValues: ConditionalFormattingConfig,\n  currentValues: ConditionalFormattingConfig,\n) =>\n  isOperatorNone(prevValues.operator) !==\n    isOperatorNone(currentValues.operator) ||\n  isOperatorMultiValue(prevValues.operator) !==\n    isOperatorMultiValue(currentValues.operator);\n\nconst operatorField = (\n  <FormItem\n    name=\"operator\"\n    label={t('Operator')}\n    rules={rulesRequired}\n    initialValue={operatorOptions[0].value}\n  >\n    <Select ariaLabel={t('Operator')} options={operatorOptions} />\n  </FormItem>\n);\n\nconst renderOperatorFields = ({ getFieldValue }: GetFieldValue) =>\n  isOperatorNone(getFieldValue('operator')) ? (\n    <Row gutter={12}>\n      <Col span={6}>{operatorField}</Col>\n    </Row>\n  ) : isOperatorMultiValue(getFieldValue('operator')) ? (\n    <Row gutter={12}>\n      <Col span={9}>\n        <FormItem\n          name=\"targetValueLeft\"\n          label={t('Left value')}\n          rules={rulesTargetValueLeft}\n          dependencies={targetValueLeftDeps}\n          validateTrigger=\"onBlur\"\n          trigger=\"onBlur\"\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n      <Col span={6}>{operatorField}</Col>\n      <Col span={9}>\n        <FormItem\n          name=\"targetValueRight\"\n          label={t('Right value')}\n          rules={rulesTargetValueRight}\n          dependencies={targetValueRightDeps}\n          validateTrigger=\"onBlur\"\n          trigger=\"onBlur\"\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n    </Row>\n  ) : (\n    <Row gutter={12}>\n      <Col span={6}>{operatorField}</Col>\n      <Col span={18}>\n        <FormItem\n          name=\"targetValue\"\n          label={t('Target value')}\n          rules={rulesRequired}\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n    </Row>\n  );\n\nexport const FormattingPopoverContent = ({\n  config,\n  onChange,\n  columns = [],\n}: {\n  config?: ConditionalFormattingConfig;\n  onChange: (config: ConditionalFormattingConfig) => void;\n  columns: { label: string; value: string }[];\n}) => {\n  const theme = useTheme();\n  const colorScheme = colorSchemeOptions(theme);\n  return (\n    <Form\n      onFinish={onChange}\n      initialValues={config}\n      requiredMark=\"optional\"\n      layout=\"vertical\"\n    >\n      <Row gutter={12}>\n        <Col span={12}>\n          <FormItem\n            name=\"column\"\n            label={t('Column')}\n            rules={rulesRequired}\n            initialValue={columns[0]?.value}\n          >\n            <Select ariaLabel={t('Select column')} options={columns} />\n          </FormItem>\n        </Col>\n        <Col span={12}>\n          <FormItem\n            name=\"colorScheme\"\n            label={t('Color scheme')}\n            rules={rulesRequired}\n            initialValue={colorScheme[0].value}\n          >\n            <Select ariaLabel={t('Color scheme')} options={colorScheme} />\n          </FormItem>\n        </Col>\n      </Row>\n      <FormItem noStyle shouldUpdate={shouldFormItemUpdate}>\n        {renderOperatorFields}\n      </FormItem>\n      <FormItem>\n        <JustifyEnd>\n          <Button htmlType=\"submit\" buttonStyle=\"primary\">\n            {t('Apply')}\n          </Button>\n        </JustifyEnd>\n      </FormItem>\n    </Form>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport Popover from 'src/components/Popover';\nimport { FormattingPopoverContent } from './FormattingPopoverContent';\nimport { ConditionalFormattingConfig, FormattingPopoverProps } from './types';\n\nexport const FormattingPopover = ({\n  title,\n  columns,\n  onChange,\n  config,\n  children,\n  ...props\n}: FormattingPopoverProps) => {\n  const [visible, setVisible] = useState(false);\n\n  const handleSave = useCallback(\n    (newConfig: ConditionalFormattingConfig) => {\n      setVisible(false);\n      onChange(newConfig);\n    },\n    [onChange],\n  );\n\n  return (\n    <Popover\n      title={title}\n      content={\n        <FormattingPopoverContent\n          onChange={handleSave}\n          config={config}\n          columns={columns}\n        />\n      }\n      visible={visible}\n      onVisibleChange={setVisible}\n      trigger={['click']}\n      overlayStyle={{ width: '450px' }}\n      {...props}\n    >\n      {children}\n    </Popover>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, css, t, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { FormattingPopover } from './FormattingPopover';\nimport {\n  COMPARATOR,\n  ConditionalFormattingConfig,\n  ConditionalFormattingControlProps,\n} from './types';\nimport {\n  AddControlLabel,\n  CaretContainer,\n  Label,\n  OptionControlContainer,\n} from '../OptionControls';\n\nconst FormattersContainer = styled.div`\n  ${({ theme }) => css`\n    padding: ${theme.gridUnit}px;\n    border: solid 1px ${theme.colors.grayscale.light2};\n    border-radius: ${theme.gridUnit}px;\n  `}\n`;\n\nexport const FormatterContainer = styled(OptionControlContainer)`\n  &,\n  & > div {\n    margin-bottom: ${({ theme }) => theme.gridUnit}px;\n    :last-child {\n      margin-bottom: 0;\n    }\n  }\n`;\n\nexport const CloseButton = styled.button`\n  ${({ theme }) => css`\n    color: ${theme.colors.grayscale.light1};\n    height: 100%;\n    width: ${theme.gridUnit * 6}px;\n    border: none;\n    border-right: solid 1px ${theme.colors.grayscale.dark2}0C;\n    padding: 0;\n    outline: none;\n    border-bottom-left-radius: 3px;\n    border-top-left-radius: 3px;\n  `}\n`;\n\nconst ConditionalFormattingControl = ({\n  value,\n  onChange,\n  columnOptions,\n  verboseMap,\n  removeIrrelevantConditions,\n  ...props\n}: ConditionalFormattingControlProps) => {\n  const theme = useTheme();\n  const [conditionalFormattingConfigs, setConditionalFormattingConfigs] =\n    useState<ConditionalFormattingConfig[]>(value ?? []);\n\n  useEffect(() => {\n    if (onChange) {\n      onChange(conditionalFormattingConfigs);\n    }\n  }, [conditionalFormattingConfigs, onChange]);\n\n  useEffect(() => {\n    if (removeIrrelevantConditions) {\n      // remove formatter when corresponding column is removed from controls\n      const newFormattingConfigs = conditionalFormattingConfigs.filter(config =>\n        columnOptions.some((option: any) => option?.value === config?.column),\n      );\n      if (\n        newFormattingConfigs.length !== conditionalFormattingConfigs.length &&\n        removeIrrelevantConditions\n      ) {\n        setConditionalFormattingConfigs(newFormattingConfigs);\n      }\n    }\n  }, [conditionalFormattingConfigs, columnOptions, removeIrrelevantConditions]);\n\n  const onDelete = (index: number) => {\n    setConditionalFormattingConfigs(prevConfigs =>\n      prevConfigs.filter((_, i) => i !== index),\n    );\n  };\n\n  const onSave = (config: ConditionalFormattingConfig) => {\n    setConditionalFormattingConfigs(prevConfigs => [...prevConfigs, config]);\n  };\n\n  const onEdit = (newConfig: ConditionalFormattingConfig, index: number) => {\n    const newConfigs = [...conditionalFormattingConfigs];\n    newConfigs.splice(index, 1, newConfig);\n    setConditionalFormattingConfigs(newConfigs);\n  };\n\n  const createLabel = ({\n    column,\n    operator,\n    targetValue,\n    targetValueLeft,\n    targetValueRight,\n  }: ConditionalFormattingConfig) => {\n    const columnName = (column && verboseMap?.[column]) ?? column;\n    switch (operator) {\n      case COMPARATOR.NONE:\n        return `${columnName}`;\n      case COMPARATOR.BETWEEN:\n        return `${targetValueLeft} ${COMPARATOR.LESS_THAN} ${columnName} ${COMPARATOR.LESS_THAN} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_OR_EQUAL} ${columnName} ${COMPARATOR.LESS_OR_EQUAL} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_LEFT_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_OR_EQUAL} ${columnName} ${COMPARATOR.LESS_THAN} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_RIGHT_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_THAN} ${columnName} ${COMPARATOR.LESS_OR_EQUAL} ${targetValueRight}`;\n      default:\n        return `${columnName} ${operator} ${targetValue}`;\n    }\n  };\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <FormattersContainer>\n        {conditionalFormattingConfigs.map((config, index) => (\n          <FormatterContainer key={index}>\n            <CloseButton onClick={() => onDelete(index)}>\n              <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n            </CloseButton>\n            <FormattingPopover\n              title={t('Edit formatter')}\n              config={config}\n              columns={columnOptions}\n              onChange={(newConfig: ConditionalFormattingConfig) =>\n                onEdit(newConfig, index)\n              }\n              destroyTooltipOnHide\n            >\n              <OptionControlContainer withCaret>\n                <Label>{createLabel(config)}</Label>\n                <CaretContainer>\n                  <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n                </CaretContainer>\n              </OptionControlContainer>\n            </FormattingPopover>\n          </FormatterContainer>\n        ))}\n        <FormattingPopover\n          title={t('Add new formatter')}\n          columns={columnOptions}\n          onChange={onSave}\n          destroyTooltipOnHide\n        >\n          <AddControlLabel>\n            <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n            {t('Add new color formatter')}\n          </AddControlLabel>\n        </FormattingPopover>\n      </FormattersContainer>\n    </div>\n  );\n};\n\nexport default ConditionalFormattingControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useMemo } from 'react';\nimport { useDrop } from 'react-dnd';\nimport { t, useTheme } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport {\n  AddControlLabel,\n  DndLabelsContainer,\n  HeaderContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport {\n  DatasourcePanelDndItem,\n  DndItemValue,\n} from 'src/explore/components/DatasourcePanel/types';\nimport Icons from 'src/components/Icons';\nimport { DndItemType } from '../../DndItemType';\n\nexport type DndSelectLabelProps = {\n  name: string;\n  accept: DndItemType | DndItemType[];\n  ghostButtonText: string;\n  onDrop: (item: DatasourcePanelDndItem) => void;\n  canDrop: (item: DatasourcePanelDndItem) => boolean;\n  canDropValue?: (value: DndItemValue) => boolean;\n  onDropValue?: (value: DndItemValue) => void;\n  valuesRenderer: () => ReactNode;\n  displayGhostButton?: boolean;\n  onClickGhostButton: () => void;\n};\n\nexport default function DndSelectLabel({\n  displayGhostButton = true,\n  accept,\n  valuesRenderer,\n  ...props\n}: DndSelectLabelProps) {\n  const theme = useTheme();\n\n  const [{ isOver, canDrop }, datasourcePanelDrop] = useDrop({\n    accept,\n\n    drop: (item: DatasourcePanelDndItem) => {\n      props.onDrop(item);\n      props.onDropValue?.(item.value);\n    },\n\n    canDrop: (item: DatasourcePanelDndItem) =>\n      props.canDrop(item) && (props.canDropValue?.(item.value) ?? true),\n\n    collect: monitor => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop(),\n      type: monitor.getItemType(),\n    }),\n  });\n\n  const values = useMemo(() => valuesRenderer(), [valuesRenderer]);\n\n  function renderGhostButton() {\n    return (\n      <AddControlLabel\n        cancelHover={!props.onClickGhostButton}\n        onClick={props.onClickGhostButton}\n      >\n        <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n        {t(props.ghostButtonText)}\n      </AddControlLabel>\n    );\n  }\n\n  return (\n    <div ref={datasourcePanelDrop}>\n      <HeaderContainer>\n        <ControlHeader {...props} />\n      </HeaderContainer>\n      <DndLabelsContainer\n        data-test=\"dnd-labels-container\"\n        canDrop={canDrop}\n        isOver={isOver}\n      >\n        {values}\n        {displayGhostButton && renderGhostButton()}\n      </DndLabelsContainer>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport {\n  CaretContainer,\n  CloseContainer,\n  OptionControlContainer,\n  Label,\n} from 'src/explore/components/controls/OptionControls';\nimport { OptionProps } from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport default function Option({\n  children,\n  index,\n  clickClose,\n  withCaret,\n  isExtra,\n  datasourceWarningMessage,\n  canDelete = true,\n}: OptionProps) {\n  const theme = useTheme();\n  const onClickClose = useCallback(\n    e => {\n      e.stopPropagation();\n      clickClose(index);\n    },\n    [clickClose, index],\n  );\n  return (\n    <OptionControlContainer data-test=\"option-label\" withCaret={withCaret}>\n      {canDelete && (\n        <CloseContainer\n          role=\"button\"\n          data-test=\"remove-control-button\"\n          onClick={onClickClose}\n        >\n          <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n        </CloseContainer>\n      )}\n      <Label data-test=\"control-label\">{children}</Label>\n      {(!!datasourceWarningMessage || isExtra) && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={\n            datasourceWarningMessage ||\n            t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)\n          }\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport {\n  useDrag,\n  useDrop,\n  DropTargetMonitor,\n  DragSourceMonitor,\n} from 'react-dnd';\nimport { DragContainer } from 'src/explore/components/controls/OptionControls';\nimport {\n  OptionProps,\n  OptionItemInterface,\n} from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { StyledColumnOption } from 'src/explore/components/optionRenderers';\nimport { styled, isAdhocColumn } from '@superset-ui/core';\nimport { ColumnMeta } from '@superset-ui/chart-controls';\nimport Option from './Option';\n\nexport const OptionLabel = styled.div`\n  width: 100%;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nexport default function OptionWrapper(\n  props: OptionProps & {\n    type: string;\n    onShiftOptions: (dragIndex: number, hoverIndex: number) => void;\n  },\n) {\n  const {\n    index,\n    label,\n    tooltipTitle,\n    column,\n    type,\n    onShiftOptions,\n    clickClose,\n    withCaret,\n    isExtra,\n    datasourceWarningMessage,\n    canDelete = true,\n    ...rest\n  } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const labelRef = useRef<HTMLDivElement>(null);\n\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type,\n      dragIndex: index,\n    },\n    collect: (monitor: DragSourceMonitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const [, drop] = useDrop({\n    accept: type,\n\n    hover: (item: OptionItemInterface, monitor: DropTargetMonitor) => {\n      if (!ref.current) {\n        return;\n      }\n      const { dragIndex } = item;\n      const hoverIndex = index;\n\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset\n        ? clientOffset.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n\n      // Time to actually perform the action\n      onShiftOptions(dragIndex, hoverIndex);\n      // eslint-disable-next-line no-param-reassign\n      item.dragIndex = hoverIndex;\n    },\n  });\n\n  const shouldShowTooltip =\n    (!isDragging && tooltipTitle && label && tooltipTitle !== label) ||\n    (!isDragging &&\n      labelRef &&\n      labelRef.current &&\n      labelRef.current.scrollWidth > labelRef.current.clientWidth);\n\n  const LabelContent = () => {\n    if (!shouldShowTooltip) {\n      return <span>{label}</span>;\n    }\n    return (\n      <Tooltip title={tooltipTitle || label}>\n        <span>{label}</span>\n      </Tooltip>\n    );\n  };\n\n  const ColumnOption = () => {\n    const transformedCol =\n      column && isAdhocColumn(column)\n        ? { verbose_name: column.label, expression: column.sqlExpression }\n        : column;\n    return (\n      <StyledColumnOption\n        column={transformedCol as ColumnMeta}\n        labelRef={labelRef}\n        showType\n      />\n    );\n  };\n\n  const Label = () => {\n    if (label) {\n      return (\n        <OptionLabel ref={labelRef}>\n          <LabelContent />\n        </OptionLabel>\n      );\n    }\n    if (column) {\n      return (\n        <OptionLabel>\n          <ColumnOption />\n        </OptionLabel>\n      );\n    }\n    return null;\n  };\n\n  drag(drop(ref));\n\n  return (\n    <DragContainer ref={ref} {...rest}>\n      <Option\n        index={index}\n        clickClose={clickClose}\n        withCaret={withCaret}\n        isExtra={isExtra}\n        datasourceWarningMessage={datasourceWarningMessage}\n        canDelete={canDelete}\n      >\n        <Label />\n      </Option>\n    </DragContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ColumnMeta, isColumnMeta } from '@superset-ui/chart-controls';\nimport {\n  AdhocColumn,\n  ensureIsArray,\n  QueryFormColumn,\n  isPhysicalColumn,\n} from '@superset-ui/core';\n\nconst getColumnNameOrAdhocColumn = (\n  column: ColumnMeta | AdhocColumn,\n): QueryFormColumn => {\n  if (isColumnMeta(column)) {\n    return column.column_name;\n  }\n  return column as AdhocColumn;\n};\n\nexport class OptionSelector {\n  values: (ColumnMeta | AdhocColumn)[];\n\n  options: Record<string, ColumnMeta>;\n\n  multi: boolean;\n\n  constructor(\n    options: Record<string, ColumnMeta>,\n    multi: boolean,\n    initialValues?: QueryFormColumn[] | QueryFormColumn | null,\n  ) {\n    this.options = options;\n    this.multi = multi;\n    this.values = ensureIsArray(initialValues)\n      .map(value => {\n        if (value && isPhysicalColumn(value) && value in options) {\n          return options[value];\n        }\n        if (!isPhysicalColumn(value)) {\n          return value;\n        }\n        return null;\n      })\n      .filter(Boolean) as ColumnMeta[];\n  }\n\n  add(value: QueryFormColumn) {\n    if (isPhysicalColumn(value) && value in this.options) {\n      this.values.push(this.options[value]);\n    } else if (!isPhysicalColumn(value)) {\n      this.values.push(value as AdhocColumn);\n    }\n  }\n\n  del(idx: number) {\n    this.values.splice(idx, 1);\n  }\n\n  replace(idx: number, value: QueryFormColumn) {\n    if (this.values[idx]) {\n      this.values[idx] = isPhysicalColumn(value) ? this.options[value] : value;\n    }\n  }\n\n  swap(a: number, b: number) {\n    [this.values[a], this.values[b]] = [this.values[b], this.values[a]];\n  }\n\n  has(value: QueryFormColumn): boolean {\n    return this.values.some(col => {\n      if (isPhysicalColumn(value)) {\n        return (\n          (col as ColumnMeta).column_name === value ||\n          (col as AdhocColumn).label === value\n        );\n      }\n      return (\n        (col as ColumnMeta).column_name === value.label ||\n        (col as AdhocColumn).label === value.label\n      );\n    });\n  }\n\n  getValues(): QueryFormColumn[] | QueryFormColumn | undefined {\n    if (!this.multi) {\n      return this.values.length > 0\n        ? getColumnNameOrAdhocColumn(this.values[0])\n        : undefined;\n    }\n    return this.values.map(getColumnNameOrAdhocColumn);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport React, {\n  Dispatch,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useSelector } from 'react-redux';\nimport {\n  AdhocColumn,\n  isAdhocColumn,\n  t,\n  styled,\n  css,\n  DatasourceType,\n} from '@superset-ui/core';\nimport { ColumnMeta, isSavedExpression } from '@superset-ui/chart-controls';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\n\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { StyledColumnOption } from 'src/explore/components/optionRenderers';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\nimport { ExplorePageState } from 'src/explore/types';\nimport useResizeButton from './useResizeButton';\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\ninterface ColumnSelectPopoverProps {\n  columns: ColumnMeta[];\n  editedColumn?: ColumnMeta | AdhocColumn;\n  onChange: (column: ColumnMeta | AdhocColumn) => void;\n  onClose: () => void;\n  setLabel: (title: string) => void;\n  getCurrentTab: (tab: string) => void;\n  label: string;\n  isTemporal?: boolean;\n  setDatasetModal?: Dispatch<SetStateAction<boolean>>;\n}\n\nconst getInitialColumnValues = (\n  editedColumn?: ColumnMeta | AdhocColumn,\n): [AdhocColumn?, ColumnMeta?, ColumnMeta?] => {\n  if (!editedColumn) {\n    return [undefined, undefined, undefined];\n  }\n  if (isAdhocColumn(editedColumn)) {\n    return [editedColumn, undefined, undefined];\n  }\n  if (isSavedExpression(editedColumn)) {\n    return [undefined, editedColumn, undefined];\n  }\n  return [undefined, undefined, editedColumn];\n};\n\nconst ColumnSelectPopover = ({\n  columns,\n  editedColumn,\n  onChange,\n  onClose,\n  setDatasetModal,\n  setLabel,\n  getCurrentTab,\n  label,\n  isTemporal,\n}: ColumnSelectPopoverProps) => {\n  const datasourceType = useSelector<ExplorePageState, string | undefined>(\n    state => state.explore.datasource.type,\n  );\n  const [initialLabel] = useState(label);\n  const [initialAdhocColumn, initialCalculatedColumn, initialSimpleColumn] =\n    getInitialColumnValues(editedColumn);\n\n  const [adhocColumn, setAdhocColumn] = useState<AdhocColumn | undefined>(\n    initialAdhocColumn,\n  );\n  const [selectedCalculatedColumn, setSelectedCalculatedColumn] = useState<\n    ColumnMeta | undefined\n  >(initialCalculatedColumn);\n  const [selectedSimpleColumn, setSelectedSimpleColumn] = useState<\n    ColumnMeta | undefined\n  >(initialSimpleColumn);\n\n  const [resizeButton, width, height] = useResizeButton(\n    POPOVER_INITIAL_WIDTH,\n    POPOVER_INITIAL_HEIGHT,\n  );\n\n  const sqlEditorRef = useRef(null);\n\n  const [calculatedColumns, simpleColumns] = useMemo(\n    () =>\n      columns?.reduce(\n        (acc: [ColumnMeta[], ColumnMeta[]], column: ColumnMeta) => {\n          if (column.expression) {\n            acc[0].push(column);\n          } else {\n            acc[1].push(column);\n          }\n          return acc;\n        },\n        [[], []],\n      ),\n    [columns],\n  );\n\n  const onSqlExpressionChange = useCallback(\n    sqlExpression => {\n      setAdhocColumn({ label, sqlExpression, expressionType: 'SQL' });\n      setSelectedSimpleColumn(undefined);\n      setSelectedCalculatedColumn(undefined);\n    },\n    [label],\n  );\n\n  const onCalculatedColumnChange = useCallback(\n    selectedColumnName => {\n      const selectedColumn = calculatedColumns.find(\n        col => col.column_name === selectedColumnName,\n      );\n      setSelectedCalculatedColumn(selectedColumn);\n      setSelectedSimpleColumn(undefined);\n      setAdhocColumn(undefined);\n      setLabel(\n        selectedColumn?.verbose_name || selectedColumn?.column_name || '',\n      );\n    },\n    [calculatedColumns, setLabel],\n  );\n\n  const onSimpleColumnChange = useCallback(\n    selectedColumnName => {\n      const selectedColumn = simpleColumns.find(\n        col => col.column_name === selectedColumnName,\n      );\n      setSelectedCalculatedColumn(undefined);\n      setSelectedSimpleColumn(selectedColumn);\n      setAdhocColumn(undefined);\n      setLabel(\n        selectedColumn?.verbose_name || selectedColumn?.column_name || '',\n      );\n    },\n    [setLabel, simpleColumns],\n  );\n\n  const defaultActiveTabKey = initialAdhocColumn\n    ? 'sqlExpression'\n    : initialSimpleColumn || calculatedColumns.length === 0\n    ? 'simple'\n    : 'saved';\n\n  useEffect(() => {\n    getCurrentTab(defaultActiveTabKey);\n  }, [defaultActiveTabKey, getCurrentTab]);\n\n  const onSave = useCallback(() => {\n    if (adhocColumn && adhocColumn.label !== label) {\n      adhocColumn.label = label;\n    }\n    const selectedColumn =\n      adhocColumn || selectedCalculatedColumn || selectedSimpleColumn;\n    if (!selectedColumn) {\n      return;\n    }\n    onChange(selectedColumn);\n    onClose();\n  }, [\n    adhocColumn,\n    label,\n    onChange,\n    onClose,\n    selectedCalculatedColumn,\n    selectedSimpleColumn,\n  ]);\n\n  const onResetStateAndClose = useCallback(() => {\n    setSelectedCalculatedColumn(initialCalculatedColumn);\n    setSelectedSimpleColumn(initialSimpleColumn);\n    setAdhocColumn(initialAdhocColumn);\n    onClose();\n  }, [\n    initialAdhocColumn,\n    initialCalculatedColumn,\n    initialSimpleColumn,\n    onClose,\n  ]);\n\n  const onTabChange = useCallback(\n    tab => {\n      getCurrentTab(tab);\n      // @ts-ignore\n      sqlEditorRef.current?.editor.focus();\n    },\n    [getCurrentTab],\n  );\n\n  const onSqlEditorFocus = useCallback(() => {\n    // @ts-ignore\n    sqlEditorRef.current?.editor.resize();\n  }, []);\n\n  const setDatasetAndClose = () => {\n    if (setDatasetModal) {\n      setDatasetModal(true);\n    }\n    onClose();\n  };\n\n  const stateIsValid =\n    adhocColumn || selectedCalculatedColumn || selectedSimpleColumn;\n  const hasUnsavedChanges =\n    initialLabel !== label ||\n    selectedCalculatedColumn?.column_name !==\n      initialCalculatedColumn?.column_name ||\n    selectedSimpleColumn?.column_name !== initialSimpleColumn?.column_name ||\n    adhocColumn?.sqlExpression !== initialAdhocColumn?.sqlExpression;\n\n  const savedExpressionsLabel = t('Saved expressions');\n  const simpleColumnsLabel = t('Column');\n\n  return (\n    <Form layout=\"vertical\" id=\"metrics-edit-popover\">\n      <Tabs\n        id=\"adhoc-metric-edit-tabs\"\n        defaultActiveKey={defaultActiveTabKey}\n        onChange={onTabChange}\n        className=\"adhoc-metric-edit-tabs\"\n        allowOverflow\n        css={css`\n          height: ${height}px;\n          width: ${width}px;\n        `}\n      >\n        <Tabs.TabPane key=\"saved\" tab={t('Saved')}>\n          {calculatedColumns.length > 0 ? (\n            <FormItem label={savedExpressionsLabel}>\n              <StyledSelect\n                ariaLabel={savedExpressionsLabel}\n                value={selectedCalculatedColumn?.column_name}\n                onChange={onCalculatedColumnChange}\n                allowClear\n                autoFocus={!selectedCalculatedColumn}\n                placeholder={t('%s column(s)', calculatedColumns.length)}\n                options={calculatedColumns.map(calculatedColumn => ({\n                  value: calculatedColumn.column_name,\n                  label:\n                    calculatedColumn.verbose_name ||\n                    calculatedColumn.column_name,\n                  customLabel: (\n                    <StyledColumnOption column={calculatedColumn} showType />\n                  ),\n                  key: calculatedColumn.column_name,\n                }))}\n              />\n            </FormItem>\n          ) : datasourceType === DatasourceType.Table ? (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={\n                isTemporal\n                  ? t('No temporal columns found')\n                  : t('No saved expressions found')\n              }\n              description={\n                isTemporal\n                  ? t(\n                      'Add calculated temporal columns to dataset in \"Edit datasource\" modal',\n                    )\n                  : t(\n                      'Add calculated columns to dataset in \"Edit datasource\" modal',\n                    )\n              }\n            />\n          ) : (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={\n                isTemporal\n                  ? t('No temporal columns found')\n                  : t('No saved expressions found')\n              }\n              description={\n                isTemporal ? (\n                  <>\n                    <span\n                      role=\"button\"\n                      tabIndex={0}\n                      onClick={setDatasetAndClose}\n                    >\n                      {t('Create a dataset')}\n                    </span>{' '}\n                    {t(' to mark a column as a time column')}\n                  </>\n                ) : (\n                  <>\n                    <span\n                      role=\"button\"\n                      tabIndex={0}\n                      onClick={setDatasetAndClose}\n                    >\n                      {t('Create a dataset')}\n                    </span>{' '}\n                    {t(' to add calculated columns')}\n                  </>\n                )\n              }\n            />\n          )}\n        </Tabs.TabPane>\n        <Tabs.TabPane key=\"simple\" tab={t('Simple')}>\n          {isTemporal && simpleColumns.length === 0 ? (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={t('No temporal columns found')}\n              description={\n                datasourceType === DatasourceType.Table ? (\n                  t('Mark a column as temporal in \"Edit datasource\" modal')\n                ) : (\n                  <>\n                    <span\n                      role=\"button\"\n                      tabIndex={0}\n                      onClick={setDatasetAndClose}\n                    >\n                      {t('Create a dataset')}\n                    </span>{' '}\n                    {t(' to mark a column as a time column')}\n                  </>\n                )\n              }\n            />\n          ) : (\n            <FormItem label={simpleColumnsLabel}>\n              <Select\n                ariaLabel={simpleColumnsLabel}\n                value={selectedSimpleColumn?.column_name}\n                onChange={onSimpleColumnChange}\n                allowClear\n                autoFocus={!selectedSimpleColumn}\n                placeholder={t('%s column(s)', simpleColumns.length)}\n                options={simpleColumns.map(simpleColumn => ({\n                  value: simpleColumn.column_name,\n                  label: simpleColumn.verbose_name || simpleColumn.column_name,\n                  customLabel: (\n                    <StyledColumnOption column={simpleColumn} showType />\n                  ),\n                  key: simpleColumn.column_name,\n                }))}\n              />\n            </FormItem>\n          )}\n        </Tabs.TabPane>\n\n        <Tabs.TabPane key=\"sqlExpression\" tab={t('Custom SQL')}>\n          <SQLEditor\n            value={\n              adhocColumn?.sqlExpression ||\n              selectedSimpleColumn?.column_name ||\n              selectedCalculatedColumn?.expression\n            }\n            onFocus={onSqlEditorFocus}\n            showLoadingForImport\n            onChange={onSqlExpressionChange}\n            width=\"100%\"\n            height={`${height - 80}px`}\n            showGutter={false}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n            ref={sqlEditorRef}\n          />\n        </Tabs.TabPane>\n      </Tabs>\n      <div>\n        <Button buttonSize=\"small\" onClick={onResetStateAndClose} cta>\n          {t('Close')}\n        </Button>\n        <Button\n          disabled={!stateIsValid || !hasUnsavedChanges}\n          buttonStyle=\"primary\"\n          buttonSize=\"small\"\n          onClick={onSave}\n          data-test=\"ColumnEdit#save\"\n          cta\n        >\n          {t('Save')}\n        </Button>\n        {resizeButton}\n      </div>\n    </Form>\n  );\n};\n\nexport default ColumnSelectPopover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useCallback, useEffect, useState } from 'react';\nimport throttle from 'lodash/throttle';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\n\nconst RESIZE_THROTTLE_MS = 50;\n\nexport default function useResizeButton(\n  minWidth: number,\n  minHeight: number,\n): [JSX.Element, number, number] {\n  const [width, setWidth] = useState(POPOVER_INITIAL_WIDTH);\n  const [height, setHeight] = useState(POPOVER_INITIAL_HEIGHT);\n  const [clientX, setClientX] = useState(0);\n  const [clientY, setClientY] = useState(0);\n  const [dragStartX, setDragStartX] = useState(0);\n  const [dragStartY, setDragStartY] = useState(0);\n  const [dragStartWidth, setDragStartWidth] = useState(width);\n  const [dragStartHeight, setDragStartHeight] = useState(height);\n  const [isDragging, setIsDragging] = useState(false);\n\n  const onMouseMove = useCallback((ev: MouseEvent): void => {\n    ev.preventDefault();\n    setClientX(ev.clientX);\n    setClientY(ev.clientY);\n  }, []);\n\n  const onMouseUp = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n\n  const onDragDown = useCallback((ev: React.MouseEvent): void => {\n    setDragStartX(ev.clientX);\n    setDragStartY(ev.clientY);\n    setIsDragging(true);\n  }, []);\n\n  useEffect(() => {\n    if (isDragging) {\n      document.addEventListener('mousemove', onMouseMove);\n    } else {\n      setDragStartWidth(width);\n      setDragStartHeight(height);\n      document.removeEventListener('mousemove', onMouseMove);\n    }\n  }, [onMouseMove, isDragging]);\n\n  const handleResize = useCallback(\n    throttle(\n      ({\n        dragStartX,\n        dragStartY,\n        dragStartWidth,\n        dragStartHeight,\n        clientX,\n        clientY,\n        minWidth,\n        minHeight,\n      }: {\n        dragStartX: number;\n        dragStartY: number;\n        dragStartWidth: number;\n        dragStartHeight: number;\n        clientX: number;\n        clientY: number;\n        minWidth: number;\n        minHeight: number;\n      }): void => {\n        setWidth(Math.max(dragStartWidth + (clientX - dragStartX), minWidth));\n        setHeight(\n          Math.max(dragStartHeight + (clientY - dragStartY), minHeight),\n        );\n      },\n      RESIZE_THROTTLE_MS,\n    ),\n    [setHeight, setWidth],\n  );\n\n  useEffect(() => {\n    if (isDragging) {\n      handleResize({\n        dragStartX,\n        dragStartY,\n        dragStartWidth,\n        dragStartHeight,\n        clientX,\n        clientY,\n        minWidth,\n        minHeight,\n      });\n    }\n  }, [\n    isDragging,\n    clientX,\n    clientY,\n    dragStartWidth,\n    dragStartHeight,\n    dragStartX,\n    dragStartY,\n  ]);\n\n  useEffect(() => {\n    document.addEventListener('mouseup', onMouseUp);\n    return () => document.removeEventListener('mouseup', onMouseUp);\n  }, [onMouseUp]);\n\n  return [\n    <i\n      role=\"button\"\n      aria-label=\"Resize\"\n      tabIndex={0}\n      onMouseDown={onDragDown}\n      className=\"fa fa-expand edit-popover-resize text-muted\"\n    />,\n    width,\n    height,\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport { t, styled } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Tooltip } from 'src/components/Tooltip';\n\nconst StyledInput = styled(Input)`\n  border-radius: ${({ theme }) => theme.borderRadius};\n  height: 26px;\n  padding-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nexport const DndColumnSelectPopoverTitle = ({\n  title,\n  onChange,\n  isEditDisabled,\n  hasCustomLabel,\n}) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [isEditMode, setIsEditMode] = useState(false);\n\n  const onMouseOver = useCallback(() => {\n    setIsHovered(true);\n  }, []);\n\n  const onMouseOut = useCallback(() => {\n    setIsHovered(false);\n  }, []);\n\n  const onClick = useCallback(() => {\n    setIsEditMode(true);\n  }, []);\n\n  const onBlur = useCallback(() => {\n    setIsEditMode(false);\n  }, []);\n\n  const onInputBlur = useCallback(\n    e => {\n      if (e.target.value === '') {\n        onChange(e);\n      }\n      onBlur();\n    },\n    [onBlur, onChange],\n  );\n\n  const defaultLabel = t('My column');\n\n  if (isEditDisabled) {\n    return <span>{title || defaultLabel}</span>;\n  }\n\n  return isEditMode ? (\n    <StyledInput\n      type=\"text\"\n      placeholder={title}\n      value={hasCustomLabel ? title : ''}\n      autoFocus\n      onChange={onChange}\n      onBlur={onInputBlur}\n    />\n  ) : (\n    <Tooltip placement=\"top\" title={t('Click to edit label')}>\n      <span\n        className=\"AdhocMetricEditPopoverTitle inline-editable\"\n        data-test=\"AdhocMetricEditTitle#trigger\"\n        onMouseOver={onMouseOver}\n        onMouseOut={onMouseOut}\n        onClick={onClick}\n        onBlur={onBlur}\n        role=\"button\"\n        tabIndex={0}\n      >\n        {title || defaultLabel}\n        &nbsp;\n        <i\n          className=\"fa fa-pencil\"\n          style={{ color: isHovered ? 'black' : 'grey' }}\n        />\n      </span>\n    </Tooltip>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { AdhocColumn, t, isAdhocColumn } from '@superset-ui/core';\nimport { ColumnMeta, isColumnMeta } from '@superset-ui/chart-controls';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport ColumnSelectPopover from './ColumnSelectPopover';\nimport { DndColumnSelectPopoverTitle } from './DndColumnSelectPopoverTitle';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\ninterface ColumnSelectPopoverTriggerProps {\n  columns: ColumnMeta[];\n  editedColumn?: ColumnMeta | AdhocColumn;\n  onColumnEdit: (editedColumn: ColumnMeta | AdhocColumn) => void;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  children: React.ReactNode;\n  isTemporal?: boolean;\n}\n\nconst defaultPopoverLabel = t('My column');\nconst editableTitleTab = 'sqlExpression';\n\nconst ColumnSelectPopoverTrigger = ({\n  columns,\n  editedColumn,\n  onColumnEdit,\n  isControlledComponent,\n  children,\n  isTemporal,\n  ...props\n}: ColumnSelectPopoverTriggerProps) => {\n  // @ts-ignore\n  const datasource = useSelector(state => state.explore.datasource);\n  const [popoverLabel, setPopoverLabel] = useState(defaultPopoverLabel);\n  const [popoverVisible, setPopoverVisible] = useState(false);\n  const [isTitleEditDisabled, setIsTitleEditDisabled] = useState(true);\n  const [hasCustomLabel, setHasCustomLabel] = useState(false);\n  const [showDatasetModal, setDatasetModal] = useState(false);\n\n  let initialPopoverLabel = defaultPopoverLabel;\n  if (editedColumn && isColumnMeta(editedColumn)) {\n    initialPopoverLabel = editedColumn.verbose_name || editedColumn.column_name;\n  } else if (editedColumn && isAdhocColumn(editedColumn)) {\n    initialPopoverLabel = editedColumn.label || defaultPopoverLabel;\n  }\n\n  useEffect(() => {\n    setPopoverLabel(initialPopoverLabel);\n  }, [initialPopoverLabel, popoverVisible]);\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    setPopoverVisible(false);\n  }, []);\n\n  const { visible, handleTogglePopover, handleClosePopover } =\n    isControlledComponent\n      ? {\n          visible: props.visible,\n          handleTogglePopover: props.togglePopover!,\n          handleClosePopover: props.closePopover!,\n        }\n      : {\n          visible: popoverVisible,\n          handleTogglePopover: togglePopover,\n          handleClosePopover: closePopover,\n        };\n\n  const getCurrentTab = useCallback((tab: string) => {\n    setIsTitleEditDisabled(tab !== editableTitleTab);\n  }, []);\n\n  const overlayContent = useMemo(\n    () => (\n      <ExplorePopoverContent>\n        <ColumnSelectPopover\n          editedColumn={editedColumn}\n          columns={columns}\n          setDatasetModal={setDatasetModal}\n          onClose={handleClosePopover}\n          onChange={onColumnEdit}\n          label={popoverLabel}\n          setLabel={setPopoverLabel}\n          getCurrentTab={getCurrentTab}\n          isTemporal={isTemporal}\n        />\n      </ExplorePopoverContent>\n    ),\n    [\n      columns,\n      editedColumn,\n      getCurrentTab,\n      handleClosePopover,\n      isTemporal,\n      onColumnEdit,\n      popoverLabel,\n    ],\n  );\n\n  const onLabelChange = useCallback((e: any) => {\n    setPopoverLabel(e.target.value);\n    setHasCustomLabel(true);\n  }, []);\n\n  const popoverTitle = useMemo(\n    () => (\n      <DndColumnSelectPopoverTitle\n        title={popoverLabel}\n        onChange={onLabelChange}\n        isEditDisabled={isTitleEditDisabled}\n        hasCustomLabel={hasCustomLabel}\n      />\n    ),\n    [hasCustomLabel, isTitleEditDisabled, onLabelChange, popoverLabel],\n  );\n\n  return (\n    <>\n      {showDatasetModal && (\n        <SaveDatasetModal\n          visible={showDatasetModal}\n          onHide={() => setDatasetModal(false)}\n          buttonTextOnSave={t('Save')}\n          buttonTextOnOverwrite={t('Overwrite')}\n          modalDescription={t(\n            'Save this query as a virtual dataset to continue exploring',\n          )}\n          datasource={datasource}\n        />\n      )}\n      <ControlPopover\n        trigger=\"click\"\n        content={overlayContent}\n        defaultVisible={visible}\n        visible={visible}\n        onVisibleChange={handleTogglePopover}\n        title={popoverTitle}\n        destroyTooltipOnHide\n      >\n        {children}\n      </ControlPopover>\n    </>\n  );\n};\n\nexport default ColumnSelectPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useMemo, useState } from 'react';\nimport {\n  AdhocColumn,\n  tn,\n  QueryFormColumn,\n  t,\n  isAdhocColumn,\n} from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  isColumnMeta,\n  withDndFallback,\n} from '@superset-ui/chart-controls';\nimport { isEmpty } from 'lodash';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport OptionWrapper from 'src/explore/components/controls/DndColumnSelectControl/OptionWrapper';\nimport { OptionSelector } from 'src/explore/components/controls/DndColumnSelectControl/utils';\nimport { DatasourcePanelDndItem } from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport ColumnSelectPopoverTrigger from './ColumnSelectPopoverTrigger';\nimport { DndControlProps } from './types';\nimport SelectControl from '../SelectControl';\n\nexport type DndColumnSelectProps = DndControlProps<QueryFormColumn> & {\n  options: ColumnMeta[];\n  isTemporal?: boolean;\n};\n\nfunction DndColumnSelect(props: DndColumnSelectProps) {\n  const {\n    value,\n    options,\n    multi = true,\n    onChange,\n    canDelete = true,\n    ghostButtonText,\n    name,\n    label,\n    isTemporal,\n  } = props;\n  const [newColumnPopoverVisible, setNewColumnPopoverVisible] = useState(false);\n\n  const optionSelector = useMemo(() => {\n    const optionsMap = Object.fromEntries(\n      options.map(option => [option.column_name, option]),\n    );\n\n    return new OptionSelector(optionsMap, multi, value);\n  }, [multi, options, value]);\n\n  const onDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const column = item.value as ColumnMeta;\n      if (!optionSelector.multi && !isEmpty(optionSelector.values)) {\n        optionSelector.replace(0, column.column_name);\n      } else {\n        optionSelector.add(column.column_name);\n      }\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const canDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const columnName = (item.value as ColumnMeta).column_name;\n      return (\n        columnName in optionSelector.options && !optionSelector.has(columnName)\n      );\n    },\n    [optionSelector],\n  );\n\n  const onClickClose = useCallback(\n    (index: number) => {\n      optionSelector.del(index);\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const onShiftOptions = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      optionSelector.swap(dragIndex, hoverIndex);\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const valuesRenderer = useCallback(\n    () =>\n      optionSelector.values.map((column, idx) => {\n        const datasourceWarningMessage =\n          isAdhocColumn(column) && column.datasourceWarning\n            ? t('This column might be incompatible with current dataset')\n            : undefined;\n        return (\n          <ColumnSelectPopoverTrigger\n            key={idx}\n            columns={options}\n            onColumnEdit={newColumn => {\n              if (isColumnMeta(newColumn)) {\n                optionSelector.replace(idx, newColumn.column_name);\n              } else {\n                optionSelector.replace(idx, newColumn as AdhocColumn);\n              }\n              onChange(optionSelector.getValues());\n            }}\n            editedColumn={column}\n            isTemporal={isTemporal}\n          >\n            <OptionWrapper\n              key={idx}\n              index={idx}\n              clickClose={onClickClose}\n              onShiftOptions={onShiftOptions}\n              type={`${DndItemType.ColumnOption}_${name}_${label}`}\n              canDelete={canDelete}\n              column={column}\n              datasourceWarningMessage={datasourceWarningMessage}\n              withCaret\n            />\n          </ColumnSelectPopoverTrigger>\n        );\n      }),\n    [\n      canDelete,\n      isTemporal,\n      label,\n      name,\n      onChange,\n      onClickClose,\n      onShiftOptions,\n      optionSelector,\n      options,\n    ],\n  );\n\n  const addNewColumnWithPopover = useCallback(\n    (newColumn: ColumnMeta | AdhocColumn) => {\n      if (isColumnMeta(newColumn)) {\n        optionSelector.add(newColumn.column_name);\n      } else {\n        optionSelector.add(newColumn as AdhocColumn);\n      }\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewColumnPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const openPopover = useCallback(() => {\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const labelGhostButtonText = useMemo(\n    () =>\n      ghostButtonText ??\n      tn(\n        'Drop a column here or click',\n        'Drop columns here or click',\n        multi ? 2 : 1,\n      ),\n    [ghostButtonText, multi],\n  );\n\n  return (\n    <div>\n      <DndSelectLabel\n        onDrop={onDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DndItemType.Column}\n        displayGhostButton={multi || optionSelector.values.length === 0}\n        ghostButtonText={labelGhostButtonText}\n        onClickGhostButton={openPopover}\n        {...props}\n      />\n      <ColumnSelectPopoverTrigger\n        columns={options}\n        onColumnEdit={addNewColumnWithPopover}\n        isControlledComponent\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n        visible={newColumnPopoverVisible}\n        isTemporal={isTemporal}\n      >\n        <div />\n      </ColumnSelectPopoverTrigger>\n    </div>\n  );\n}\n\nconst DndColumnSelectWithFallback = withDndFallback(\n  DndColumnSelect,\n  SelectControl,\n);\n\nexport { DndColumnSelectWithFallback as DndColumnSelect };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { OptionSortType } from 'src/explore/types';\nimport { useGetTimeRangeLabel } from 'src/explore/components/controls/FilterControl/utils';\nimport OptionWrapper from './OptionWrapper';\n\nexport interface DndAdhocFilterOptionProps {\n  adhocFilter: AdhocFilter;\n  onFilterEdit: (changedFilter: AdhocFilter) => void;\n  onClickClose: (index: number) => void;\n  onShiftOptions: (dragIndex: number, hoverIndex: number) => void;\n  options: OptionSortType[];\n  datasource: Record<string, any>;\n  partitionColumn?: string;\n  index: number;\n}\n\nexport default function DndAdhocFilterOption({\n  adhocFilter,\n  options,\n  datasource,\n  onFilterEdit,\n  onShiftOptions,\n  onClickClose,\n  partitionColumn,\n  index,\n}: DndAdhocFilterOptionProps) {\n  const { actualTimeRange, title } = useGetTimeRangeLabel(adhocFilter);\n\n  return (\n    <AdhocFilterPopoverTrigger\n      key={index}\n      adhocFilter={adhocFilter}\n      options={options}\n      datasource={datasource}\n      onFilterEdit={onFilterEdit}\n      partitionColumn={partitionColumn}\n    >\n      <OptionWrapper\n        key={index}\n        index={index}\n        label={actualTimeRange ?? adhocFilter.getDefaultLabel()}\n        tooltipTitle={title ?? adhocFilter.getTooltipTitle()}\n        clickClose={onClickClose}\n        onShiftOptions={onShiftOptions}\n        type={DndItemType.FilterOption}\n        withCaret\n        isExtra={adhocFilter.isExtra}\n        datasourceWarningMessage={\n          adhocFilter.datasourceWarning\n            ? t('This filter might be incompatible with current dataset')\n            : undefined\n        }\n      />\n    </AdhocFilterPopoverTrigger>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with work for additional information\n * regarding copyright ownership.  The ASF licenses file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  hasGenericChartAxes,\n  logging,\n  Metric,\n  QueryFormData,\n  QueryFormMetric,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  isColumnMeta,\n  isTemporalColumn,\n  withDndFallback,\n} from '@superset-ui/chart-controls';\nimport Modal from 'src/components/Modal';\nimport {\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n  Operators,\n} from 'src/explore/constants';\nimport { Datasource, OptionSortType } from 'src/explore/types';\nimport { OptionValueType } from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  DatasourcePanelDndItem,\n  DndItemValue,\n  isSavedMetric,\n} from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport { ControlComponentProps } from 'src/explore/components/Control';\nimport AdhocFilterControl from '../FilterControl/AdhocFilterControl';\nimport DndAdhocFilterOption from './DndAdhocFilterOption';\nimport { useDefaultTimeFilter } from '../DateFilterControl/utils';\nimport { CLAUSES, EXPRESSION_TYPES } from '../FilterControl/types';\n\nconst { warning } = Modal;\n\nconst EMPTY_OBJECT = {};\nconst DND_ACCEPTED_TYPES = [\n  DndItemType.Column,\n  DndItemType.Metric,\n  DndItemType.MetricOption,\n  DndItemType.AdhocMetricOption,\n];\n\nconst isDictionaryForAdhocFilter = (value: OptionValueType) =>\n  !(value instanceof AdhocFilter) && value?.expressionType;\n\nexport interface DndFilterSelectProps\n  extends ControlComponentProps<OptionValueType[]> {\n  columns: ColumnMeta[];\n  savedMetrics: Metric[];\n  selectedMetrics: QueryFormMetric[];\n  datasource: Datasource;\n  canDelete?: (\n    valueToBeDeleted: OptionValueType,\n    values: OptionValueType[],\n  ) => true | string;\n}\n\nconst DndFilterSelect = (props: DndFilterSelectProps) => {\n  const {\n    datasource,\n    onChange = () => {},\n    name: controlName,\n    canDelete,\n  } = props;\n\n  const propsValues = Array.from(props.value ?? []);\n  const [values, setValues] = useState(\n    propsValues.map((filter: OptionValueType) =>\n      isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n    ),\n  );\n  const [partitionColumn, setPartitionColumn] = useState(undefined);\n  const [newFilterPopoverVisible, setNewFilterPopoverVisible] = useState(false);\n  const [droppedItem, setDroppedItem] = useState<\n    DndItemValue | typeof EMPTY_OBJECT\n  >({});\n\n  const optionsForSelect = (\n    columns: ColumnMeta[],\n    formData: QueryFormData | null | undefined,\n  ) => {\n    const options: OptionSortType[] = [\n      ...columns,\n      ...[...(formData?.metrics || []), formData?.metric].map(\n        metric =>\n          metric &&\n          (typeof metric === 'string'\n            ? { saved_metric_name: metric }\n            : new AdhocMetric(metric)),\n      ),\n    ].filter(option => option);\n\n    return options\n      .reduce(\n        (\n          results: (OptionSortType & { filterOptionName: string })[],\n          option,\n        ) => {\n          if ('saved_metric_name' in option && option.saved_metric_name) {\n            results.push({\n              ...option,\n              filterOptionName: option.saved_metric_name,\n            });\n          } else if ('column_name' in option && option.column_name) {\n            results.push({\n              ...option,\n              filterOptionName: `_col_${option.column_name}`,\n            });\n          } else if (option instanceof AdhocMetric) {\n            results.push({\n              ...option,\n              filterOptionName: `_adhocmetric_${option.label}`,\n            });\n          }\n          return results;\n        },\n        [],\n      )\n      .sort(\n        (a: OptionSortType, b: OptionSortType) =>\n          (a.saved_metric_name || a.column_name || a.label)?.localeCompare(\n            b.saved_metric_name || b.column_name || b.label || '',\n          ) ?? 0,\n      );\n  };\n  const [options, setOptions] = useState(\n    optionsForSelect(props.columns, props.formData),\n  );\n\n  useEffect(() => {\n    if (datasource && datasource.type === 'table') {\n      const dbId = datasource.database?.id;\n      const {\n        datasource_name: name,\n        schema,\n        is_sqllab_view: isSqllabView,\n      } = datasource;\n\n      if (!isSqllabView && dbId && name && schema) {\n        SupersetClient.get({\n          endpoint: `/api/v1/database/${dbId}/table_extra/${name}/${schema}/`,\n        })\n          .then(({ json }: { json: Record<string, any> }) => {\n            if (json?.partitions) {\n              const { partitions } = json;\n              // for now only show latest_partition option\n              // when table datasource has only 1 partition key.\n              if (\n                partitions?.cols &&\n                Object.keys(partitions.cols).length === 1\n              ) {\n                setPartitionColumn(partitions.cols[0]);\n              }\n            }\n          })\n          .catch((error: Record<string, any>) => {\n            logging.error('fetch extra_table_metadata:', error.statusText);\n          });\n      }\n    }\n  }, [datasource]);\n\n  useEffect(() => {\n    setOptions(optionsForSelect(props.columns, props.formData));\n  }, [props.columns, props.formData]);\n\n  useEffect(() => {\n    setValues(\n      (props.value || []).map((filter: OptionValueType) =>\n        isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n      ),\n    );\n  }, [props.value]);\n\n  const removeValue = useCallback(\n    (index: number) => {\n      const valuesCopy = [...values];\n      valuesCopy.splice(index, 1);\n      setValues(valuesCopy);\n      onChange(valuesCopy);\n    },\n    [onChange, values],\n  );\n\n  const onClickClose = useCallback(\n    (index: number) => {\n      const result = canDelete?.(values[index], values);\n      if (typeof result === 'string') {\n        warning({ title: t('Warning'), content: result });\n        return;\n      }\n      removeValue(index);\n    },\n    [canDelete, removeValue, values],\n  );\n\n  const onShiftOptions = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      const newValues = [...values];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValues(newValues);\n    },\n    [values],\n  );\n\n  const getMetricExpression = useCallback(\n    (savedMetricName: string) =>\n      props.savedMetrics.find(\n        (savedMetric: Metric) => savedMetric.metric_name === savedMetricName,\n      )?.expression,\n    [props.savedMetrics],\n  );\n\n  const mapOption = useCallback(\n    (option: OptionValueType) => {\n      // already a AdhocFilter, skip\n      if (option instanceof AdhocFilter) {\n        return option;\n      }\n      const filterOptions = option as Record<string, any>;\n      // via datasource saved metric\n      if (filterOptions.saved_metric_name) {\n        return new AdhocFilter({\n          expressionType: EXPRESSION_TYPES.SQL,\n          subject: getMetricExpression(filterOptions.saved_metric_name),\n          operator:\n            OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n          operatorId: Operators.GREATER_THAN,\n          comparator: 0,\n          clause: CLAUSES.HAVING,\n        });\n      }\n      // has a custom label, meaning it's custom column\n      if (filterOptions.label) {\n        return new AdhocFilter({\n          expressionType: EXPRESSION_TYPES.SQL,\n          subject: new AdhocMetric(option).translateToSql(),\n          operator:\n            OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n          operatorId: Operators.GREATER_THAN,\n          comparator: 0,\n          clause: CLAUSES.HAVING,\n        });\n      }\n      // add a new filter item\n      if (filterOptions.column_name) {\n        return new AdhocFilter({\n          expressionType: EXPRESSION_TYPES.SIMPLE,\n          subject: filterOptions.column_name,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.EQUALS].operation,\n          operatorId: Operators.EQUALS,\n          comparator: '',\n          clause: CLAUSES.WHERE,\n          isNew: true,\n        });\n      }\n      return null;\n    },\n    [datasource.type, getMetricExpression],\n  );\n\n  const onFilterEdit = useCallback(\n    (changedFilter: AdhocFilter) => {\n      onChange(\n        values.map((value: AdhocFilter) => {\n          if (value.filterOptionName === changedFilter.filterOptionName) {\n            return changedFilter;\n          }\n          return value;\n        }),\n      );\n    },\n    [onChange, values],\n  );\n\n  const onNewFilter = useCallback(\n    (newFilter: AdhocFilter) => {\n      const mappedOption = mapOption(newFilter);\n      if (mappedOption) {\n        const newValues = [...values, mappedOption];\n        setValues(newValues);\n        onChange(newValues);\n      }\n    },\n    [mapOption, onChange, values],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewFilterPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const valuesRenderer = useCallback(\n    () =>\n      values.map((adhocFilter: AdhocFilter, index: number) => (\n        <DndAdhocFilterOption\n          index={index}\n          adhocFilter={adhocFilter}\n          options={options}\n          datasource={datasource}\n          onFilterEdit={onFilterEdit}\n          partitionColumn={partitionColumn}\n          onClickClose={onClickClose}\n          onShiftOptions={onShiftOptions}\n        />\n      )),\n    [\n      onClickClose,\n      onFilterEdit,\n      onShiftOptions,\n      options,\n      partitionColumn,\n      datasource,\n      values,\n    ],\n  );\n\n  const handleClickGhostButton = useCallback(() => {\n    setDroppedItem({});\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const defaultTimeFilter = useDefaultTimeFilter();\n  const adhocFilter = useMemo(() => {\n    if (isSavedMetric(droppedItem)) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        clause: CLAUSES.HAVING,\n        sqlExpression: droppedItem?.expression,\n      });\n    }\n    if (droppedItem instanceof AdhocMetric) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        clause: CLAUSES.HAVING,\n        sqlExpression: (droppedItem as AdhocMetric)?.translateToSql(),\n      });\n    }\n    const config: Partial<AdhocFilter> = {\n      subject: (droppedItem as ColumnMeta)?.column_name,\n    };\n    if (config.subject) {\n      config.operator = OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.IN].operation;\n      config.operatorId = Operators.IN;\n    }\n    if (\n      hasGenericChartAxes &&\n      isColumnMeta(droppedItem) &&\n      isTemporalColumn(droppedItem?.column_name, props.datasource)\n    ) {\n      config.operator = Operators.TEMPORAL_RANGE;\n      config.operatorId = Operators.TEMPORAL_RANGE;\n      config.comparator = defaultTimeFilter;\n    }\n    return new AdhocFilter(config);\n  }, [droppedItem]);\n\n  const canDrop = useCallback(() => true, []);\n  const handleDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      setDroppedItem(item.value);\n      togglePopover(true);\n    },\n    [controlName, togglePopover],\n  );\n\n  return (\n    <>\n      <DndSelectLabel\n        onDrop={handleDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DND_ACCEPTED_TYPES}\n        ghostButtonText={t('Drop columns/metrics here or click')}\n        onClickGhostButton={handleClickGhostButton}\n        {...props}\n      />\n      <AdhocFilterPopoverTrigger\n        adhocFilter={adhocFilter}\n        options={options}\n        datasource={datasource}\n        onFilterEdit={onNewFilter}\n        partitionColumn={partitionColumn}\n        isControlledComponent\n        visible={newFilterPopoverVisible}\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n        requireSave={!!droppedItem}\n      />\n    </>\n  );\n};\n\nconst DndFilterSelectWithFallback = withDndFallback(\n  DndFilterSelect,\n  AdhocFilterControl,\n);\n\nexport { DndFilterSelectWithFallback as DndFilterSelect };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ColumnMeta, Metric } from '@superset-ui/chart-controls';\nimport { DndItemType } from '../DndItemType';\n\nexport type DndItemValue = ColumnMeta | Metric;\n\nexport interface DatasourcePanelDndItem {\n  value: DndItemValue;\n  type: DndItemType;\n}\n\nexport function isDatasourcePanelDndItem(\n  item: any,\n): item is DatasourcePanelDndItem {\n  return item?.value && item?.type;\n}\n\nexport function isSavedMetric(item: any): item is Metric {\n  return item?.metric_name;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with work for additional information\n * regarding copyright ownership.  The ASF licenses file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  ensureIsArray,\n  GenericDataType,\n  isAdhocMetricSimple,\n  isSavedMetric,\n  Metric,\n  QueryFormMetric,\n  t,\n  tn,\n} from '@superset-ui/core';\nimport { ColumnMeta, withDndFallback } from '@superset-ui/chart-controls';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport AdhocMetricPopoverTrigger from 'src/explore/components/controls/MetricControl/AdhocMetricPopoverTrigger';\nimport MetricDefinitionValue from 'src/explore/components/controls/MetricControl/MetricDefinitionValue';\nimport {\n  DatasourcePanelDndItem,\n  isDatasourcePanelDndItem,\n} from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport { AGGREGATES } from 'src/explore/constants';\nimport MetricsControl from '../MetricControl/MetricsControl';\n\nconst EMPTY_OBJECT = {};\nconst DND_ACCEPTED_TYPES = [DndItemType.Column, DndItemType.Metric];\n\nconst isDictionaryForAdhocMetric = (value: QueryFormMetric) =>\n  value &&\n  !(value instanceof AdhocMetric) &&\n  typeof value !== 'string' &&\n  value.expressionType;\n\nconst coerceMetrics = (\n  addedMetrics: QueryFormMetric | QueryFormMetric[] | undefined | null,\n  savedMetrics: Metric[],\n  columns: ColumnMeta[],\n) => {\n  if (!addedMetrics) {\n    return [];\n  }\n  const metricsCompatibleWithDataset = ensureIsArray(addedMetrics).filter(\n    metric => {\n      if (isSavedMetric(metric)) {\n        return savedMetrics.some(\n          savedMetric => savedMetric.metric_name === metric,\n        );\n      }\n      if (isAdhocMetricSimple(metric)) {\n        return columns.some(\n          column => column.column_name === metric.column.column_name,\n        );\n      }\n      return true;\n    },\n  );\n\n  return metricsCompatibleWithDataset.map(metric => {\n    if (!isDictionaryForAdhocMetric(metric)) {\n      return metric;\n    }\n    if (isAdhocMetricSimple(metric)) {\n      const column = columns.find(\n        col => col.column_name === metric.column.column_name,\n      );\n      if (column) {\n        return new AdhocMetric({ ...metric, column });\n      }\n    }\n    return new AdhocMetric(metric);\n  });\n};\n\nconst getOptionsForSavedMetrics = (\n  savedMetrics: savedMetricType[],\n  currentMetricValues: (string | AdhocMetric)[],\n  currentMetric?: string,\n) =>\n  savedMetrics?.filter(savedMetric =>\n    Array.isArray(currentMetricValues)\n      ? !currentMetricValues.includes(savedMetric.metric_name ?? '') ||\n        savedMetric.metric_name === currentMetric\n      : savedMetric,\n  ) ?? [];\n\ntype ValueType = Metric | AdhocMetric | QueryFormMetric;\n\nconst DndMetricSelect = (props: any) => {\n  const { onChange, multi } = props;\n\n  const handleChange = useCallback(\n    opts => {\n      // if clear out options\n      if (opts === null) {\n        onChange(null);\n        return;\n      }\n\n      const transformedOpts = ensureIsArray(opts);\n      const optionValues = transformedOpts\n        .map(option => {\n          // pre-defined metric\n          if (option.metric_name) {\n            return option.metric_name;\n          }\n          return option;\n        })\n        .filter(option => option);\n      onChange(multi ? optionValues : optionValues[0]);\n    },\n    [multi, onChange],\n  );\n\n  const [value, setValue] = useState<ValueType[]>(\n    coerceMetrics(props.value, props.savedMetrics, props.columns),\n  );\n  const [droppedItem, setDroppedItem] = useState<\n    DatasourcePanelDndItem | typeof EMPTY_OBJECT\n  >({});\n  const [newMetricPopoverVisible, setNewMetricPopoverVisible] = useState(false);\n\n  useEffect(() => {\n    setValue(coerceMetrics(props.value, props.savedMetrics, props.columns));\n  }, [\n    JSON.stringify(props.value),\n    JSON.stringify(props.savedMetrics),\n    JSON.stringify(props.columns),\n  ]);\n\n  const canDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const isMetricAlreadyInValues =\n        item.type === 'metric' ? value.includes(item.value.metric_name) : false;\n      return !isMetricAlreadyInValues;\n    },\n    [value],\n  );\n\n  const onNewMetric = useCallback(\n    (newMetric: Metric) => {\n      const newValue = props.multi ? [...value, newMetric] : [newMetric];\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, props.multi, value],\n  );\n\n  const onMetricEdit = useCallback(\n    (changedMetric: Metric | AdhocMetric, oldMetric: Metric | AdhocMetric) => {\n      if (oldMetric instanceof AdhocMetric && oldMetric.equals(changedMetric)) {\n        return;\n      }\n      const newValue = value.map(value => {\n        if (\n          // compare saved metrics\n          ('metric_name' in oldMetric && value === oldMetric.metric_name) ||\n          // compare adhoc metrics\n          typeof (value as AdhocMetric).optionName !== 'undefined'\n            ? (value as AdhocMetric).optionName ===\n              (oldMetric as AdhocMetric).optionName\n            : false\n        ) {\n          return changedMetric;\n        }\n        return value;\n      });\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onRemoveMetric = useCallback(\n    (index: number) => {\n      if (!Array.isArray(value)) {\n        return;\n      }\n      const valuesCopy = [...value];\n      valuesCopy.splice(index, 1);\n      setValue(valuesCopy);\n      handleChange(valuesCopy);\n    },\n    [handleChange, value],\n  );\n\n  const moveLabel = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      const newValues = [...value];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValue(newValues);\n    },\n    [value],\n  );\n\n  const newSavedMetricOptions = useMemo(\n    () => getOptionsForSavedMetrics(props.savedMetrics, props.value),\n    [props.savedMetrics, props.value],\n  );\n\n  const getSavedMetricOptionsForMetric = useCallback(\n    index =>\n      getOptionsForSavedMetrics(\n        props.savedMetrics,\n        props.value,\n        props.value?.[index],\n      ),\n    [props.savedMetrics, props.value],\n  );\n\n  const handleDropLabel = useCallback(\n    () => onChange(multi ? value : value[0]),\n    [multi, onChange, value],\n  );\n\n  const valueRenderer = useCallback(\n    (option: ValueType, index: number) => (\n      <MetricDefinitionValue\n        key={index}\n        index={index}\n        option={option}\n        onMetricEdit={onMetricEdit}\n        onRemoveMetric={onRemoveMetric}\n        columns={props.columns}\n        savedMetrics={props.savedMetrics}\n        savedMetricsOptions={getSavedMetricOptionsForMetric(index)}\n        datasource={props.datasource}\n        onMoveLabel={moveLabel}\n        onDropLabel={handleDropLabel}\n        type={`${DndItemType.AdhocMetricOption}_${props.name}_${props.label}`}\n        multi={multi}\n        datasourceWarningMessage={\n          option instanceof AdhocMetric && option.datasourceWarning\n            ? t('This metric might be incompatible with current dataset')\n            : undefined\n        }\n      />\n    ),\n    [\n      getSavedMetricOptionsForMetric,\n      handleDropLabel,\n      moveLabel,\n      multi,\n      onMetricEdit,\n      onRemoveMetric,\n      props.columns,\n      props.datasource,\n      props.label,\n      props.name,\n      props.savedMetrics,\n    ],\n  );\n\n  const valuesRenderer = useCallback(\n    () => value.map((value, index) => valueRenderer(value, index)),\n    [value, valueRenderer],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewMetricPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const handleDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      if (item.type === DndItemType.Metric) {\n        onNewMetric(item.value as Metric);\n      }\n      if (item.type === DndItemType.Column) {\n        setDroppedItem(item);\n        togglePopover(true);\n      }\n    },\n    [onNewMetric, togglePopover],\n  );\n\n  const handleClickGhostButton = useCallback(() => {\n    setDroppedItem({});\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const adhocMetric = useMemo(() => {\n    if (\n      isDatasourcePanelDndItem(droppedItem) &&\n      droppedItem.type === DndItemType.Column\n    ) {\n      const itemValue = droppedItem.value as ColumnMeta;\n      const config: Partial<AdhocMetric> = {\n        column: itemValue,\n      };\n      if (itemValue.type_generic === GenericDataType.NUMERIC) {\n        config.aggregate = AGGREGATES.SUM;\n      } else if (\n        itemValue.type_generic === GenericDataType.STRING ||\n        itemValue.type_generic === GenericDataType.BOOLEAN ||\n        itemValue.type_generic === GenericDataType.TEMPORAL\n      ) {\n        config.aggregate = AGGREGATES.COUNT_DISTINCT;\n      }\n      return new AdhocMetric(config);\n    }\n    return new AdhocMetric({});\n  }, [droppedItem]);\n\n  const ghostButtonText = tn(\n    'Drop a column/metric here or click',\n    'Drop columns/metrics here or click',\n    multi ? 2 : 1,\n  );\n\n  return (\n    <div className=\"metrics-select\">\n      <DndSelectLabel\n        onDrop={handleDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DND_ACCEPTED_TYPES}\n        ghostButtonText={ghostButtonText}\n        displayGhostButton={multi || value.length === 0}\n        onClickGhostButton={handleClickGhostButton}\n        {...props}\n      />\n      <AdhocMetricPopoverTrigger\n        adhocMetric={adhocMetric}\n        onMetricEdit={onNewMetric}\n        columns={props.columns}\n        savedMetricsOptions={newSavedMetricOptions}\n        savedMetric={EMPTY_OBJECT as savedMetricType}\n        datasource={props.datasource}\n        isControlledComponent\n        visible={newMetricPopoverVisible}\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n        isNew\n      >\n        <div />\n      </AdhocMetricPopoverTrigger>\n    </div>\n  );\n};\n\nconst DndMetricSelectWithFallback = withDndFallback(\n  DndMetricSelect,\n  MetricsControl,\n);\n\nexport { DndMetricSelectWithFallback as DndMetricSelect };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { sharedControlComponents } from '@superset-ui/chart-controls';\nimport AnnotationLayerControl from './AnnotationLayerControl';\nimport BoundsControl from './BoundsControl';\nimport CheckboxControl from './CheckboxControl';\nimport CollectionControl from './CollectionControl';\nimport ColorPickerControl from './ColorPickerControl';\nimport ColorSchemeControl from './ColorSchemeControl';\nimport DatasourceControl from './DatasourceControl';\nimport DateFilterControl from './DateFilterControl';\nimport FixedOrMetricControl from './FixedOrMetricControl';\nimport HiddenControl from './HiddenControl';\nimport SelectAsyncControl from './SelectAsyncControl';\nimport SelectControl from './SelectControl';\nimport SliderControl from './SliderControl';\nimport SpatialControl from './SpatialControl';\nimport TextAreaControl from './TextAreaControl';\nimport TextControl from './TextControl';\nimport TimeSeriesColumnControl from './TimeSeriesColumnControl';\nimport ViewportControl from './ViewportControl';\nimport VizTypeControl from './VizTypeControl';\nimport MetricsControl from './MetricControl/MetricsControl';\nimport AdhocFilterControl from './FilterControl/AdhocFilterControl';\nimport FilterBoxItemControl from './FilterBoxItemControl';\nimport ConditionalFormattingControl from './ConditionalFormattingControl';\nimport DndColumnSelectControl, {\n  DndColumnSelect,\n  DndFilterSelect,\n  DndMetricSelect,\n} from './DndColumnSelectControl';\nimport XAxisSortControl from './XAxisSortControl';\n\nconst controlMap = {\n  AnnotationLayerControl,\n  BoundsControl,\n  CheckboxControl,\n  CollectionControl,\n  ColorPickerControl,\n  ColorSchemeControl,\n  DatasourceControl,\n  DateFilterControl,\n  DndColumnSelectControl,\n  DndColumnSelect,\n  DndFilterSelect,\n  DndMetricSelect,\n  FixedOrMetricControl,\n  HiddenControl,\n  SelectAsyncControl,\n  SelectControl,\n  SliderControl,\n  SpatialControl,\n  TextAreaControl,\n  TextControl,\n  TimeSeriesColumnControl,\n  ViewportControl,\n  VizTypeControl,\n  MetricsControl,\n  AdhocFilterControl,\n  FilterBoxItemControl,\n  ConditionalFormattingControl,\n  XAxisSortControl,\n  ...sharedControlComponents,\n};\nexport default controlMap;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { Input } from 'src/components/Input';\n\ninterface HiddenControlsProps {\n  onChange: () => void;\n  value: string | number | readonly string[] | undefined;\n}\n\nexport default function HiddenControl(props: HiddenControlsProps) {\n  // This wouldn't be necessary but might as well\n  return <Input type=\"hidden\" value={props.value} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport Slider from 'src/components/Slider';\nimport ControlHeader, {\n  ControlHeaderProps,\n} from 'src/explore/components/ControlHeader';\n\ntype SliderControlProps = ControlHeaderProps & {\n  onChange: (value: number) => void;\n  value: number;\n  default?: number;\n};\n\nexport default function SliderControl({\n  default: defaultValue,\n  name,\n  label,\n  description,\n  renderTrigger,\n  rightNode,\n  leftNode,\n  validationErrors,\n  hovered,\n  warning,\n  danger,\n  onClick,\n  tooltipOnClick,\n  onChange = () => {},\n  ...rest\n}: SliderControlProps) {\n  const headerProps = {\n    name,\n    label,\n    description,\n    renderTrigger,\n    rightNode,\n    leftNode,\n    validationErrors,\n    onClick,\n    hovered,\n    tooltipOnClick,\n    warning,\n    danger,\n  };\n  return (\n    <>\n      <ControlHeader {...headerProps} />\n      <Slider {...rest} onChange={onChange} defaultValue={defaultValue} />\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport SelectControl from './SelectControl';\n\nexport default function XAxisSortControl(props: {\n  onChange: (val: string | undefined) => void;\n  value: string | null;\n  shouldReset: boolean;\n}) {\n  const [value, setValue] = useState(props.value);\n  useEffect(() => {\n    if (props.shouldReset) {\n      props.onChange(undefined);\n      setValue(null);\n    }\n  }, [props.shouldReset, props.value]);\n\n  return <SelectControl {...props} value={value} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useCallback, useState, useEffect } from 'react';\nimport { isEqual } from 'lodash';\nimport {\n  ControlType,\n  ControlComponentProps as BaseControlComponentProps,\n} from '@superset-ui/chart-controls';\nimport {\n  styled,\n  JsonValue,\n  QueryFormData,\n  usePrevious,\n} from '@superset-ui/core';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport { ExploreActions } from 'src/explore/actions/exploreActions';\nimport controlMap from './controls';\n\nexport type ControlProps = {\n  // the actual action dispatcher (via bindActionCreators) has identical\n  // signature to the original action factory.\n  actions: Partial<ExploreActions> & Pick<ExploreActions, 'setControlValue'>;\n  type: ControlType;\n  label?: ReactNode;\n  name: string;\n  description?: ReactNode;\n  tooltipOnClick?: () => ReactNode;\n  places?: number;\n  rightNode?: ReactNode;\n  formData?: QueryFormData | null;\n  value?: JsonValue;\n  validationErrors?: any[];\n  hidden?: boolean;\n  renderTrigger?: boolean;\n  default?: JsonValue;\n  isVisible?: boolean;\n  resetOnHide?: boolean;\n};\n\n/**\n *\n */\nexport type ControlComponentProps<ValueType extends JsonValue = JsonValue> =\n  Omit<ControlProps, 'value'> & BaseControlComponentProps<ValueType>;\n\nconst StyledControl = styled.div`\n  padding-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport default function Control(props: ControlProps) {\n  const {\n    actions: { setControlValue },\n    name,\n    type,\n    hidden,\n    isVisible,\n    resetOnHide = true,\n  } = props;\n\n  const [hovered, setHovered] = useState(false);\n  const wasVisible = usePrevious(isVisible);\n  const onChange = useCallback(\n    (value: any, errors: any[]) => setControlValue(name, value, errors),\n    [name, setControlValue],\n  );\n\n  useEffect(() => {\n    if (\n      wasVisible === true &&\n      isVisible === false &&\n      props.default !== undefined &&\n      !isEqual(props.value, props.default) &&\n      resetOnHide\n    ) {\n      // reset control value if setting to invisible\n      setControlValue?.(name, props.default);\n    }\n  }, [\n    name,\n    wasVisible,\n    isVisible,\n    setControlValue,\n    props.value,\n    props.default,\n  ]);\n\n  if (!type || isVisible === false) return null;\n\n  const ControlComponent = typeof type === 'string' ? controlMap[type] : type;\n  if (!ControlComponent) {\n    // eslint-disable-next-line no-console\n    console.warn(`Unknown controlType: ${type}`);\n    return null;\n  }\n\n  return (\n    <StyledControl\n      className=\"Control\"\n      data-test={name}\n      style={hidden ? { display: 'none' } : undefined}\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n    >\n      <ErrorBoundary>\n        <ControlComponent onChange={onChange} hovered={hovered} {...props} />\n      </ErrorBoundary>\n    </StyledControl>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, ReactNode, useMemo, useRef } from 'react';\nimport { t, css, useTheme, SupersetTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { FormLabel } from 'src/components/Form';\nimport Icons from 'src/components/Icons';\n\ntype ValidationError = string;\n\nexport type ControlHeaderProps = {\n  name?: string;\n  label?: ReactNode;\n  description?: ReactNode;\n  validationErrors?: ValidationError[];\n  renderTrigger?: boolean;\n  rightNode?: ReactNode;\n  leftNode?: ReactNode;\n  onClick?: () => void;\n  hovered?: boolean;\n  tooltipOnClick?: () => void;\n  warning?: string;\n  danger?: string;\n};\n\nconst iconStyles = css`\n  &.anticon {\n    font-size: unset;\n    .anticon {\n      line-height: unset;\n      vertical-align: unset;\n    }\n  }\n`;\n\nconst ControlHeader: FC<ControlHeaderProps> = ({\n  name,\n  label,\n  description,\n  validationErrors = [],\n  renderTrigger = false,\n  rightNode,\n  leftNode,\n  onClick,\n  hovered = false,\n  tooltipOnClick = () => {},\n  warning,\n  danger,\n}) => {\n  const { gridUnit, colors } = useTheme();\n  const hasHadNoErrors = useRef(false);\n  const labelColor = useMemo(() => {\n    if (!validationErrors.length) {\n      hasHadNoErrors.current = true;\n    }\n\n    if (hasHadNoErrors.current) {\n      if (validationErrors.length) {\n        return colors.error.base;\n      }\n\n      return 'unset';\n    }\n\n    return colors.alert.base;\n  }, [colors.error.base, colors.alert.base, validationErrors.length]);\n\n  if (!label) {\n    return null;\n  }\n\n  const renderOptionalIcons = () => {\n    if (!hovered) {\n      return null;\n    }\n\n    return (\n      <span\n        css={() => css`\n          position: absolute;\n          top: 50%;\n          right: 0;\n          padding-left: ${gridUnit}px;\n          transform: translate(100%, -50%);\n          white-space: nowrap;\n        `}\n      >\n        {description && (\n          <span>\n            <Tooltip\n              id=\"description-tooltip\"\n              title={description}\n              placement=\"top\"\n            >\n              <Icons.InfoCircleOutlined\n                css={iconStyles}\n                onClick={tooltipOnClick}\n              />\n            </Tooltip>{' '}\n          </span>\n        )}\n        {renderTrigger && (\n          <span>\n            <InfoTooltipWithTrigger\n              label={t('bolt')}\n              tooltip={t('Changing this control takes effect instantly')}\n              placement=\"top\"\n              icon=\"bolt\"\n            />{' '}\n          </span>\n        )}\n      </span>\n    );\n  };\n\n  return (\n    <div className=\"ControlHeader\" data-test={`${name}-header`}>\n      <div className=\"pull-left\">\n        <FormLabel\n          css={(theme: SupersetTheme) => css`\n            margin-bottom: ${theme.gridUnit * 0.5}px;\n            position: relative;\n          `}\n        >\n          {leftNode && <span>{leftNode}</span>}\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={onClick}\n            style={{ cursor: onClick ? 'pointer' : '' }}\n          >\n            {label}\n          </span>{' '}\n          {warning && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={warning}>\n                <Icons.AlertSolid iconColor={colors.alert.base} iconSize=\"s\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {danger && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={danger}>\n                <Icons.ErrorSolid iconColor={colors.error.base} iconSize=\"s\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {validationErrors?.length > 0 && (\n            <span data-test=\"error-tooltip\">\n              <Tooltip\n                id=\"error-tooltip\"\n                placement=\"top\"\n                title={validationErrors?.join(' ')}\n              >\n                <Icons.ExclamationCircleOutlined\n                  css={css`\n                    ${iconStyles}\n                    color: ${labelColor};\n                  `}\n                />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {renderOptionalIcons()}\n        </FormLabel>\n      </div>\n      {rightNode && <div className=\"pull-right\">{rightNode}</div>}\n      <div className=\"clearfix\" />\n    </div>\n  );\n};\n\nexport default ControlHeader;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\n\nconst NUM_COLUMNS = 12;\n\ntype Control = React.ReactElement | null;\n\nexport default function ControlRow({ controls }: { controls: Control[] }) {\n  const isHiddenControl = useCallback(\n    (control: Control) =>\n      control?.props.type === 'HiddenControl' ||\n      control?.props.isVisible === false,\n    [],\n  );\n  // Invisible control should not be counted\n  // in the columns number\n  const countableControls = controls.filter(\n    control => !isHiddenControl(control),\n  );\n  const colSize = countableControls.length\n    ? NUM_COLUMNS / countableControls.length\n    : NUM_COLUMNS;\n  return (\n    <div className=\"row\">\n      {controls.map((control, i) => (\n        <div\n          className={`col-lg-${colSize} col-xs-12`}\n          style={{\n            display: isHiddenControl(control) ? 'none' : 'block',\n          }}\n          key={i}\n        >\n          {control}\n        </div>\n      ))}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState, useEffect } from 'react';\nimport {\n  css,\n  GenericDataType,\n  getTimeFormatter,\n  safeHtmlSpan,\n  styled,\n  t,\n  TimeFormats,\n  useTheme,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport { Column } from 'react-table';\nimport debounce from 'lodash/debounce';\nimport { Space } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport {\n  BOOL_FALSE_DISPLAY,\n  BOOL_TRUE_DISPLAY,\n  NULL_DISPLAY,\n  SLOW_DEBOUNCE,\n} from 'src/constants';\nimport { Radio } from 'src/components/Radio';\nimport Icons from 'src/components/Icons';\nimport Button from 'src/components/Button';\nimport Popover from 'src/components/Popover';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport RowCountLabel from 'src/explore/components/RowCountLabel';\nimport { getTimeColumns, setTimeColumns } from './utils';\n\nexport const CellNull = styled('span')`\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nexport const CopyButton = styled(Button)`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n\n  // needed to override button's first-of-type margin: 0\n  && {\n    margin: 0 ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  i {\n    padding: 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport const CopyToClipboardButton = ({\n  data,\n  columns,\n}: {\n  data?: Record<string, any>;\n  columns?: string[];\n}) => {\n  const theme = useTheme();\n  return (\n    <CopyToClipboard\n      text={\n        data && columns ? prepareCopyToClipboardTabularData(data, columns) : ''\n      }\n      wrapped={false}\n      copyNode={\n        <Icons.CopyOutlined\n          iconColor={theme.colors.grayscale.base}\n          iconSize=\"l\"\n          aria-label={t('Copy')}\n          role=\"button\"\n          css={css`\n            &.anticon > * {\n              line-height: 0;\n            }\n          `}\n        />\n      }\n    />\n  );\n};\n\nexport const FilterInput = ({\n  onChangeHandler,\n}: {\n  onChangeHandler(filterText: string): void;\n}) => {\n  const theme = useTheme();\n  const debouncedChangeHandler = debounce(onChangeHandler, SLOW_DEBOUNCE);\n  return (\n    <Input\n      prefix={<Icons.Search iconColor={theme.colors.grayscale.base} />}\n      placeholder={t('Search')}\n      onChange={(event: any) => {\n        const filterText = event.target.value;\n        debouncedChangeHandler(filterText);\n      }}\n      css={css`\n        width: 200px;\n        margin-right: ${theme.gridUnit * 2}px;\n      `}\n    />\n  );\n};\n\nexport const RowCount = ({\n  data,\n  loading,\n}: {\n  data?: Record<string, any>[];\n  loading: boolean;\n}) => <RowCountLabel rowcount={data?.length ?? 0} loading={loading} />;\n\nenum FormatPickerValue {\n  Formatted = 'formatted',\n  Original = 'original',\n}\n\nconst FormatPicker = ({\n  onChange,\n  value,\n}: {\n  onChange: any;\n  value: FormatPickerValue;\n}) => (\n  <Radio.Group value={value} onChange={onChange}>\n    <Space direction=\"vertical\">\n      <Radio value={FormatPickerValue.Formatted}>{t('Formatted date')}</Radio>\n      <Radio value={FormatPickerValue.Original}>{t('Original value')}</Radio>\n    </Space>\n  </Radio.Group>\n);\n\nconst FormatPickerContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n\n  padding: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst FormatPickerLabel = styled.span`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  text-transform: uppercase;\n`;\n\nconst DataTableTemporalHeaderCell = ({\n  columnName,\n  onTimeColumnChange,\n  datasourceId,\n  isOriginalTimeColumn,\n}: {\n  columnName: string;\n  onTimeColumnChange: (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => void;\n  datasourceId?: string;\n  isOriginalTimeColumn: boolean;\n}) => {\n  const theme = useTheme();\n\n  const onChange = (e: any) => {\n    onTimeColumnChange(columnName, e.target.value);\n  };\n\n  const overlayContent = useMemo(\n    () =>\n      datasourceId ? ( // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n        <FormatPickerContainer onClick={e => e.stopPropagation()}>\n          {/* hack to disable click propagation from popover content to table header, which triggers sorting column */}\n          <Global\n            styles={css`\n              .column-formatting-popover .ant-popover-inner-content {\n                padding: 0;\n              }\n            `}\n          />\n          <FormatPickerLabel>{t('Column Formatting')}</FormatPickerLabel>\n          <FormatPicker\n            onChange={onChange}\n            value={\n              isOriginalTimeColumn\n                ? FormatPickerValue.Original\n                : FormatPickerValue.Formatted\n            }\n          />\n        </FormatPickerContainer>\n      ) : null,\n    [datasourceId, isOriginalTimeColumn],\n  );\n\n  return datasourceId ? (\n    <span>\n      <Popover\n        overlayClassName=\"column-formatting-popover\"\n        trigger=\"click\"\n        content={overlayContent}\n        placement=\"bottomLeft\"\n        arrowPointAtCenter\n      >\n        <Icons.SettingOutlined\n          iconSize=\"m\"\n          iconColor={theme.colors.grayscale.light1}\n          css={{ marginRight: `${theme.gridUnit}px` }}\n          onClick={e => e.stopPropagation()}\n        />\n      </Popover>\n      {columnName}\n    </span>\n  ) : (\n    <span>{columnName}</span>\n  );\n};\n\nexport const useFilteredTableData = (\n  filterText: string,\n  data?: Record<string, any>[],\n) => {\n  const rowsAsStrings = useMemo(\n    () =>\n      data?.map((row: Record<string, any>) =>\n        Object.values(row).map(value =>\n          value ? value.toString().toLowerCase() : t('N/A'),\n        ),\n      ) ?? [],\n    [data],\n  );\n\n  return useMemo(() => {\n    if (!data?.length) {\n      return [];\n    }\n    return data.filter((_, index: number) =>\n      rowsAsStrings[index].some(value =>\n        value?.includes(filterText.toLowerCase()),\n      ),\n    );\n  }, [data, filterText, rowsAsStrings]);\n};\n\nconst timeFormatter = getTimeFormatter(TimeFormats.DATABASE_DATETIME);\n\nexport const useTableColumns = (\n  colnames?: string[],\n  coltypes?: GenericDataType[],\n  data?: Record<string, any>[],\n  datasourceId?: string,\n  isVisible?: boolean,\n  moreConfigs?: { [key: string]: Partial<Column> },\n  allowHTML?: boolean,\n) => {\n  const [originalFormattedTimeColumns, setOriginalFormattedTimeColumns] =\n    useState<string[]>(getTimeColumns(datasourceId));\n\n  const onTimeColumnChange = (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => {\n    if (!datasourceId) {\n      return;\n    }\n    if (\n      columnType === FormatPickerValue.Original &&\n      !originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.push(columnName);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    } else if (\n      columnType === FormatPickerValue.Formatted &&\n      originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.splice(cols.indexOf(columnName), 1);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    }\n  };\n\n  useEffect(() => {\n    if (isVisible) {\n      setOriginalFormattedTimeColumns(getTimeColumns(datasourceId));\n    }\n  }, [datasourceId, isVisible]);\n\n  return useMemo(\n    () =>\n      colnames && data?.length\n        ? colnames\n            .filter((column: string) => Object.keys(data[0]).includes(column))\n            .map((key, index) => {\n              const colType = coltypes?.[index];\n              const firstValue = data[0][key];\n              const originalFormattedTimeColumnIndex =\n                colType === GenericDataType.TEMPORAL\n                  ? originalFormattedTimeColumns.indexOf(key)\n                  : -1;\n              const isOriginalTimeColumn =\n                originalFormattedTimeColumns.includes(key);\n              return {\n                // react-table requires a non-empty id, therefore we introduce a fallback value in case the key is empty\n                id: key || index,\n                accessor: row => row[key],\n                Header:\n                  colType === GenericDataType.TEMPORAL &&\n                  typeof firstValue !== 'string' ? (\n                    <DataTableTemporalHeaderCell\n                      columnName={key}\n                      datasourceId={datasourceId}\n                      onTimeColumnChange={onTimeColumnChange}\n                      isOriginalTimeColumn={isOriginalTimeColumn}\n                    />\n                  ) : (\n                    key\n                  ),\n                Cell: ({ value }) => {\n                  if (value === true) {\n                    return BOOL_TRUE_DISPLAY;\n                  }\n                  if (value === false) {\n                    return BOOL_FALSE_DISPLAY;\n                  }\n                  if (value === null) {\n                    return <CellNull>{NULL_DISPLAY}</CellNull>;\n                  }\n                  if (\n                    colType === GenericDataType.TEMPORAL &&\n                    originalFormattedTimeColumnIndex === -1 &&\n                    typeof value === 'number'\n                  ) {\n                    return timeFormatter(value);\n                  }\n                  if (typeof value === 'string' && allowHTML) {\n                    return safeHtmlSpan(value);\n                  }\n                  return String(value);\n                },\n                ...moreConfigs?.[key],\n              } as Column;\n            })\n        : [],\n    [\n      colnames,\n      data,\n      coltypes,\n      datasourceId,\n      moreConfigs,\n      originalFormattedTimeColumns,\n    ],\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ensureIsArray } from '@superset-ui/core';\nimport {\n  LocalStorageKeys,\n  setItem,\n  getItem,\n} from 'src/utils/localStorageHelpers';\n\nexport const getTimeColumns = (datasourceId?: string): string[] => {\n  const colsMap = getItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {},\n  );\n  if (datasourceId === undefined) {\n    return [];\n  }\n  return ensureIsArray(colsMap[datasourceId]);\n};\n\nexport const setTimeColumns = (datasourceId: string, columns: string[]) => {\n  const colsMap = getItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {},\n  );\n  setItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {\n      ...colsMap,\n      [datasourceId]: columns,\n    },\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * All possible draggable items for the chart controls.\n */\nexport enum DndItemType {\n  // an existing column in table\n  Column = 'column',\n  // a selected column option in ColumnSelectControl\n  ColumnOption = 'columnOption',\n  // an adhoc column option in ColumnSelectControl\n  AdhocColumnOption = 'adhocColumn',\n\n  // a saved metric\n  Metric = 'metric',\n  // a selected saved metric in MetricsControl\n  MetricOption = 'metricOption',\n  // an adhoc metric option in MetricsControl\n  AdhocMetricOption = 'adhocMetric',\n\n  // an adhoc filter option\n  FilterOption = 'filterOption',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\n\nexport const ExplorePopoverContent = styled.div`\n  .edit-popover-resize {\n    transform: scaleX(-1);\n    float: right;\n    margin-top: ${({ theme }) => theme.gridUnit * 4}px;\n    margin-right: ${({ theme }) => theme.gridUnit * -2}px;\n    cursor: nwse-resize;\n  }\n  .filter-sql-editor {\n    border: ${({ theme }) => theme.colors.grayscale.light2} solid thin;\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { getNumberFormatter, t, tn } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\n\ntype RowCountLabelProps = {\n  rowcount?: number;\n  limit?: number;\n  loading?: boolean;\n};\n\nexport default function RowCountLabel(props: RowCountLabelProps) {\n  const { rowcount = 0, limit, loading } = props;\n  const limitReached = rowcount === limit;\n  const type =\n    limitReached || (rowcount === 0 && !loading) ? 'danger' : 'default';\n  const formattedRowCount = getNumberFormatter()(rowcount);\n  const label = (\n    <Label type={type}>\n      {loading ? (\n        t('Loading...')\n      ) : (\n        <span data-test=\"row-count-label\">\n          {tn('%s row', '%s rows', rowcount, formattedRowCount)}\n        </span>\n      )}\n    </Label>\n  );\n  return limitReached ? (\n    <Tooltip id=\"tt-rowcount-tooltip\" title={<span>{t('Limit reached')}</span>}>\n      {label}\n    </Tooltip>\n  ) : (\n    label\n  );\n}\n\nexport type { RowCountLabelProps };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { css, SupersetTheme } from '@superset-ui/core';\nimport React, { useRef, useState } from 'react';\nimport { Tooltip } from 'src/components/Tooltip';\n\ntype ColorSchemeLabelProps = {\n  colors: string[];\n  id: string;\n  label: string;\n};\n\nexport default function ColorSchemeLabel(props: ColorSchemeLabelProps) {\n  const { id, label, colors } = props;\n  const [showTooltip, setShowTooltip] = useState<boolean>(false);\n  const labelNameRef = useRef<HTMLElement>(null);\n  const labelColorsRef = useRef<HTMLElement>(null);\n  const handleShowTooltip = () => {\n    const labelNameElement = labelNameRef.current;\n    const labelColorsElement = labelColorsRef.current;\n    if (\n      labelNameElement &&\n      labelColorsElement &&\n      (labelNameElement.scrollWidth > labelNameElement.offsetWidth ||\n        labelNameElement.scrollHeight > labelNameElement.offsetHeight ||\n        labelColorsElement.scrollWidth > labelColorsElement.offsetWidth ||\n        labelColorsElement.scrollHeight > labelColorsElement.offsetHeight)\n    ) {\n      setShowTooltip(true);\n    }\n  };\n  const handleHideTooltip = () => {\n    setShowTooltip(false);\n  };\n\n  const colorsList = () =>\n    colors.map((color: string, i: number) => (\n      <span\n        data-test=\"color\"\n        key={`${id}-${i}`}\n        css={(theme: { gridUnit: number }) => css`\n          padding-left: ${theme.gridUnit / 2}px;\n          :before {\n            content: '';\n            display: inline-block;\n            background-color: ${color};\n            border: 1px solid ${color === 'white' ? 'black' : color};\n            width: 9px;\n            height: 10px;\n          }\n        `}\n      />\n    ));\n\n  const tooltipContent = () => (\n    <>\n      <span>{label}</span>\n      <div>{colorsList()}</div>\n    </>\n  );\n\n  return (\n    <Tooltip\n      data-testid=\"tooltip\"\n      overlayClassName=\"color-scheme-tooltip\"\n      title={tooltipContent}\n      key={id}\n      visible={showTooltip}\n    >\n      <span\n        className=\"color-scheme-option\"\n        onMouseEnter={handleShowTooltip}\n        onMouseLeave={handleHideTooltip}\n        css={css`\n          display: flex;\n          align-items: center;\n          justify-content: flex-start;\n        `}\n        data-test={id}\n      >\n        <span\n          className=\"color-scheme-label\"\n          ref={labelNameRef}\n          css={(theme: SupersetTheme) => css`\n            min-width: 125px;\n            padding-right: ${theme.gridUnit * 2}px;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            white-space: nowrap;\n          `}\n        >\n          {label}\n        </span>\n        <span\n          ref={labelColorsRef}\n          css={(theme: SupersetTheme) => css`\n            flex: 100%;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            white-space: nowrap;\n            padding-right: ${theme.gridUnit}px;\n          `}\n        >\n          {colorsList()}\n        </span>\n      </span>\n    </Tooltip>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo } from 'react';\nimport { ColorScheme, SequentialScheme, styled, t } from '@superset-ui/core';\nimport { isFunction } from 'lodash';\nimport { Select } from 'src/components';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport ColorSchemeLabel from './ColorSchemeLabel';\n\nexport interface ColorSchemes {\n  [key: string]: ColorScheme;\n}\n\nexport interface ColorSchemeControlProps {\n  hasCustomLabelColors: boolean;\n  dashboardId?: number;\n  label: string;\n  name: string;\n  onChange?: (value: string) => void;\n  value: string;\n  clearable: boolean;\n  defaultScheme?: string;\n  choices: string[][] | (() => string[][]);\n  schemes: ColorSchemes | (() => ColorSchemes);\n  isLinear: boolean;\n}\n\nconst StyledAlert = styled(Icons.AlertSolid)`\n  color: ${({ theme }) => theme.colors.alert.base};\n`;\n\nconst CUSTOM_LABEL_ALERT = t(\n  `This color scheme is being overridden by custom label colors.\n    Check the JSON metadata in the Advanced settings`,\n);\n\nconst DASHBOARD_ALERT = t(\n  `The color scheme is determined by the related dashboard.\n        Edit the color scheme in the dashboard properties.`,\n);\n\nconst Label = ({\n  label,\n  hasCustomLabelColors,\n  dashboardId,\n}: Pick<\n  ColorSchemeControlProps,\n  'label' | 'hasCustomLabelColors' | 'dashboardId'\n>) => {\n  if (hasCustomLabelColors || dashboardId) {\n    const alertTitle = hasCustomLabelColors\n      ? CUSTOM_LABEL_ALERT\n      : DASHBOARD_ALERT;\n    return (\n      <>\n        {label}{' '}\n        <Tooltip title={alertTitle}>\n          <StyledAlert iconSize=\"s\" />\n        </Tooltip>\n      </>\n    );\n  }\n  return <>{label}</>;\n};\n\nconst ColorSchemeControl = ({\n  hasCustomLabelColors = false,\n  dashboardId,\n  label = t('Color scheme'),\n  name,\n  onChange = () => {},\n  value,\n  clearable = false,\n  defaultScheme,\n  choices = [],\n  schemes = {},\n  isLinear,\n  ...rest\n}: ColorSchemeControlProps) => {\n  const currentScheme = useMemo(() => {\n    if (dashboardId) {\n      return 'dashboard';\n    }\n    let result = value || defaultScheme;\n    if (result === 'SUPERSET_DEFAULT') {\n      const schemesObject = isFunction(schemes) ? schemes() : schemes;\n      result = schemesObject?.SUPERSET_DEFAULT?.id;\n    }\n    return result;\n  }, [dashboardId, defaultScheme, schemes, value]);\n\n  const options = useMemo(() => {\n    if (dashboardId) {\n      return [\n        {\n          value: 'dashboard',\n          label: t('dashboard'),\n          customLabel: (\n            <Tooltip title={DASHBOARD_ALERT}>{t('Dashboard scheme')}</Tooltip>\n          ),\n        },\n      ];\n    }\n    const schemesObject = isFunction(schemes) ? schemes() : schemes;\n    const controlChoices = isFunction(choices) ? choices() : choices;\n    const allColorOptions: string[] = [];\n    const filteredColorOptions = controlChoices.filter(o => {\n      const option = o[0];\n      const isValidColorOption =\n        option !== 'SUPERSET_DEFAULT' && !allColorOptions.includes(option);\n      allColorOptions.push(option);\n      return isValidColorOption;\n    });\n\n    return filteredColorOptions.map(([value]) => {\n      const currentScheme = schemesObject[value];\n\n      // For categorical scheme, display all the colors\n      // For sequential scheme, show 10 or interpolate to 10.\n      // Sequential schemes usually have at most 10 colors.\n      let colors: string[] = [];\n      if (currentScheme) {\n        colors = isLinear\n          ? (currentScheme as SequentialScheme).getColors(10)\n          : currentScheme.colors;\n      }\n      return {\n        customLabel: (\n          <ColorSchemeLabel\n            id={currentScheme.id}\n            label={currentScheme.label}\n            colors={colors}\n          />\n        ),\n        label: schemesObject?.[value]?.label || value,\n        value,\n      };\n    });\n  }, [choices, dashboardId, isLinear, schemes]);\n\n  // We can't pass on change directly because it receives a second\n  // parameter and it would be interpreted as the error parameter\n  const handleOnChange = (value: string) => onChange(value);\n\n  return (\n    <Select\n      header={\n        <ControlHeader\n          {...rest}\n          label={\n            <Label\n              label={label}\n              hasCustomLabelColors={hasCustomLabelColors}\n              dashboardId={dashboardId}\n            />\n          }\n        />\n      }\n      ariaLabel={t('Select color scheme')}\n      allowClear={clearable}\n      disabled={!!dashboardId}\n      name={`select-${name}`}\n      onChange={handleOnChange}\n      options={options}\n      placeholder={t('Select scheme')}\n      value={currentScheme}\n    />\n  );\n};\n\nexport default ColorSchemeControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useRef, useEffect, useState } from 'react';\n\nimport Popover, {\n  PopoverProps as BasePopoverProps,\n  TooltipPlacement,\n} from 'src/components/Popover';\n\nconst sectionContainerId = 'controlSections';\nexport const getSectionContainerElement = () =>\n  document.getElementById(sectionContainerId)?.lastElementChild as HTMLElement;\n\nconst getElementYVisibilityRatioOnContainer = (node: HTMLElement) => {\n  const containerHeight = window?.innerHeight;\n  const nodePositionInViewport = node?.getBoundingClientRect()?.top;\n  if (!containerHeight || !nodePositionInViewport) {\n    return 0;\n  }\n\n  return nodePositionInViewport / containerHeight;\n};\n\nexport type PopoverProps = BasePopoverProps & {\n  getVisibilityRatio?: typeof getElementYVisibilityRatioOnContainer;\n};\n\nconst ControlPopover: React.FC<PopoverProps> = ({\n  getPopupContainer,\n  getVisibilityRatio = getElementYVisibilityRatioOnContainer,\n  visible: visibleProp,\n  destroyTooltipOnHide = false,\n  ...props\n}) => {\n  const triggerElementRef = useRef<HTMLElement>();\n\n  const [visible, setVisible] = useState(\n    visibleProp === undefined ? props.defaultVisible : visibleProp,\n  );\n  const [placement, setPlacement] = React.useState<TooltipPlacement>('right');\n\n  const calculatePlacement = useCallback(() => {\n    const visibilityRatio = getVisibilityRatio(triggerElementRef.current!);\n    if (visibilityRatio < 0.35 && placement !== 'rightTop') {\n      setPlacement('rightTop');\n    } else if (visibilityRatio > 0.65 && placement !== 'rightBottom') {\n      setPlacement('rightBottom');\n    } else {\n      setPlacement('right');\n    }\n  }, [getVisibilityRatio]);\n\n  const changeContainerScrollStatus = useCallback(\n    visible => {\n      const element = getSectionContainerElement();\n      if (element) {\n        element.style.setProperty(\n          'overflow-y',\n          visible ? 'hidden' : 'auto',\n          'important',\n        );\n      }\n    },\n    [calculatePlacement],\n  );\n\n  const handleGetPopupContainer = useCallback(\n    (triggerNode: HTMLElement) => {\n      triggerElementRef.current = triggerNode;\n\n      return getPopupContainer?.(triggerNode) || document.body;\n    },\n    [calculatePlacement, getPopupContainer],\n  );\n\n  const handleOnVisibleChange = useCallback(\n    (visible: boolean | undefined) => {\n      if (visible === undefined) {\n        changeContainerScrollStatus(visible);\n      }\n\n      setVisible(!!visible);\n      props.onVisibleChange?.(!!visible);\n    },\n    [props, changeContainerScrollStatus],\n  );\n\n  const handleDocumentKeyDownListener = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setVisible(false);\n        props.onVisibleChange?.(false);\n      }\n    },\n    [props],\n  );\n\n  useEffect(() => {\n    if (visibleProp !== undefined) {\n      setVisible(!!visibleProp);\n    }\n  }, [visibleProp]);\n\n  useEffect(() => {\n    if (visible !== undefined) {\n      changeContainerScrollStatus(visible);\n    }\n  }, [visible, changeContainerScrollStatus]);\n\n  useEffect(() => {\n    if (visible) {\n      document.addEventListener('keydown', handleDocumentKeyDownListener);\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleDocumentKeyDownListener);\n    };\n  }, [handleDocumentKeyDownListener, visible]);\n\n  useEffect(() => {\n    if (visible) {\n      calculatePlacement();\n    }\n  }, [visible, calculatePlacement]);\n\n  return (\n    <Popover\n      {...props}\n      visible={visible}\n      arrowPointAtCenter\n      placement={placement}\n      onVisibleChange={handleOnVisibleChange}\n      getPopupContainer={handleGetPopupContainer}\n      destroyTooltipOnHide={destroyTooltipOnHide}\n    />\n  );\n};\n\nexport default ControlPopover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport {\n  COMMON_RANGE_OPTIONS,\n  COMMON_RANGE_SET,\n  DATE_FILTER_TEST_KEY,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CommonRangeType,\n  FrameComponentProps,\n} from 'src/explore/components/controls/DateFilterControl/types';\n\nexport function CommonFrame(props: FrameComponentProps) {\n  let commonRange = 'Last week';\n  if (COMMON_RANGE_SET.has(props.value as CommonRangeType)) {\n    commonRange = props.value;\n  } else {\n    props.onChange(commonRange);\n  }\n\n  return (\n    <>\n      <div\n        className=\"section-title\"\n        data-test={DATE_FILTER_TEST_KEY.commonFrame}\n      >\n        {t('Configure Time Range: Last...')}\n      </div>\n      <Radio.Group\n        value={commonRange}\n        onChange={(e: any) => props.onChange(e.target.value)}\n      >\n        {COMMON_RANGE_OPTIONS.map(({ value, label }) => (\n          <Radio key={value} value={value} className=\"vertical-radio\">\n            {label}\n          </Radio>\n        ))}\n      </Radio.Group>\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect } from 'react';\nimport { t } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport {\n  CALENDAR_RANGE_OPTIONS,\n  CALENDAR_RANGE_SET,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CalendarRangeType,\n  PreviousCalendarWeek,\n  FrameComponentProps,\n} from '../types';\n\nexport function CalendarFrame({ onChange, value }: FrameComponentProps) {\n  useEffect(() => {\n    if (!CALENDAR_RANGE_SET.has(value as CalendarRangeType)) {\n      onChange(PreviousCalendarWeek);\n    }\n  }, [onChange, value]);\n\n  if (!CALENDAR_RANGE_SET.has(value as CalendarRangeType)) {\n    return null;\n  }\n\n  return (\n    <>\n      <div className=\"section-title\">\n        {t('Configure Time Range: Previous...')}\n      </div>\n      <Radio.Group\n        value={value}\n        onChange={(e: any) => onChange(e.target.value)}\n      >\n        {CALENDAR_RANGE_OPTIONS.map(({ value, label }) => (\n          <Radio key={value} value={value} className=\"vertical-radio\">\n            {label}\n          </Radio>\n        ))}\n      </Radio.Group>\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useSelector } from 'react-redux';\nimport { t } from '@superset-ui/core';\nimport { Moment } from 'moment';\nimport { isInteger } from 'lodash';\n// @ts-ignore\nimport { locales } from 'antd/dist/antd-with-locales';\nimport { Col, Row } from 'src/components';\nimport { InputNumber } from 'src/components/Input';\nimport { DatePicker } from 'src/components/DatePicker';\nimport { Radio } from 'src/components/Radio';\nimport Select from 'src/components/Select/Select';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport {\n  SINCE_GRAIN_OPTIONS,\n  SINCE_MODE_OPTIONS,\n  UNTIL_GRAIN_OPTIONS,\n  UNTIL_MODE_OPTIONS,\n  MOMENT_FORMAT,\n  MIDNIGHT,\n  customTimeRangeDecode,\n  customTimeRangeEncode,\n  dttmToMoment,\n  LOCALE_MAPPING,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CustomRangeKey,\n  FrameComponentProps,\n} from 'src/explore/components/controls/DateFilterControl/types';\nimport { ExplorePageState } from 'src/explore/types';\n\nexport function CustomFrame(props: FrameComponentProps) {\n  const { customRange, matchedFlag } = customTimeRangeDecode(props.value);\n  if (!matchedFlag) {\n    props.onChange(customTimeRangeEncode(customRange));\n  }\n  const {\n    sinceDatetime,\n    sinceMode,\n    sinceGrain,\n    sinceGrainValue,\n    untilDatetime,\n    untilMode,\n    untilGrain,\n    untilGrainValue,\n    anchorValue,\n    anchorMode,\n  } = { ...customRange };\n\n  function onChange(control: CustomRangeKey, value: string) {\n    props.onChange(\n      customTimeRangeEncode({\n        ...customRange,\n        [control]: value,\n      }),\n    );\n  }\n\n  function onGrainValue(\n    control: 'sinceGrainValue' | 'untilGrainValue',\n    value: string | number,\n  ) {\n    // only positive values in grainValue controls\n    if (isInteger(value) && value > 0) {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          [control]: value,\n        }),\n      );\n    }\n  }\n\n  function onAnchorMode(option: any) {\n    const radioValue = option.target.value;\n    if (radioValue === 'now') {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          anchorValue: 'now',\n          anchorMode: radioValue,\n        }),\n      );\n    } else {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          anchorValue: MIDNIGHT,\n          anchorMode: radioValue,\n        }),\n      );\n    }\n  }\n\n  // check if there is a locale defined for explore\n  const localFromFlaskBabel = useSelector(\n    (state: ExplorePageState) => state?.common?.locale,\n  );\n  // An undefined datePickerLocale is acceptable if no match is found in the LOCALE_MAPPING[localFromFlaskBabel] lookup\n  // and will fall back to antd's default locale when the antd DataPicker's prop locale === undefined\n  // This also protects us from the case where state is populated with a locale that antd locales does not recognize\n  const datePickerLocale =\n    locales[LOCALE_MAPPING[localFromFlaskBabel]]?.DatePicker;\n\n  return (\n    <div data-test=\"custom-frame\">\n      <div className=\"section-title\">{t('Configure custom time range')}</div>\n      <Row gutter={24}>\n        <Col span={12}>\n          <div className=\"control-label\">\n            {t('START (INCLUSIVE)')}{' '}\n            <InfoTooltipWithTrigger\n              tooltip={t('Start date included in time range')}\n              placement=\"right\"\n            />\n          </div>\n          <Select\n            ariaLabel={t('START (INCLUSIVE)')}\n            options={SINCE_MODE_OPTIONS}\n            value={sinceMode}\n            onChange={(value: string) => onChange('sinceMode', value)}\n          />\n          {sinceMode === 'specific' && (\n            <Row>\n              <DatePicker\n                showTime\n                defaultValue={dttmToMoment(sinceDatetime)}\n                onChange={(datetime: Moment) =>\n                  onChange('sinceDatetime', datetime.format(MOMENT_FORMAT))\n                }\n                allowClear={false}\n                locale={datePickerLocale}\n              />\n            </Row>\n          )}\n          {sinceMode === 'relative' && (\n            <Row gutter={8}>\n              <Col span={11}>\n                {/* Make sure sinceGrainValue looks like a positive integer */}\n                <InputNumber\n                  placeholder={t('Relative quantity')}\n                  value={Math.abs(sinceGrainValue)}\n                  min={1}\n                  defaultValue={1}\n                  onChange={value =>\n                    onGrainValue('sinceGrainValue', value || 1)\n                  }\n                  onStep={value => onGrainValue('sinceGrainValue', value || 1)}\n                />\n              </Col>\n              <Col span={13}>\n                <Select\n                  ariaLabel={t('Relative period')}\n                  options={SINCE_GRAIN_OPTIONS}\n                  value={sinceGrain}\n                  onChange={(value: string) => onChange('sinceGrain', value)}\n                />\n              </Col>\n            </Row>\n          )}\n        </Col>\n        <Col span={12}>\n          <div className=\"control-label\">\n            {t('END (EXCLUSIVE)')}{' '}\n            <InfoTooltipWithTrigger\n              tooltip={t('End date excluded from time range')}\n              placement=\"right\"\n            />\n          </div>\n          <Select\n            ariaLabel={t('END (EXCLUSIVE)')}\n            options={UNTIL_MODE_OPTIONS}\n            value={untilMode}\n            onChange={(value: string) => onChange('untilMode', value)}\n          />\n          {untilMode === 'specific' && (\n            <Row>\n              <DatePicker\n                showTime\n                defaultValue={dttmToMoment(untilDatetime)}\n                onChange={(datetime: Moment) =>\n                  onChange('untilDatetime', datetime.format(MOMENT_FORMAT))\n                }\n                allowClear={false}\n                locale={datePickerLocale}\n              />\n            </Row>\n          )}\n          {untilMode === 'relative' && (\n            <Row gutter={8}>\n              <Col span={11}>\n                <InputNumber\n                  placeholder={t('Relative quantity')}\n                  value={untilGrainValue}\n                  min={1}\n                  defaultValue={1}\n                  onChange={value =>\n                    onGrainValue('untilGrainValue', value || 1)\n                  }\n                  onStep={value => onGrainValue('untilGrainValue', value || 1)}\n                />\n              </Col>\n              <Col span={13}>\n                <Select\n                  ariaLabel={t('Relative period')}\n                  options={UNTIL_GRAIN_OPTIONS}\n                  value={untilGrain}\n                  onChange={(value: string) => onChange('untilGrain', value)}\n                />\n              </Col>\n            </Row>\n          )}\n        </Col>\n      </Row>\n      {sinceMode === 'relative' && untilMode === 'relative' && (\n        <div className=\"control-anchor-to\">\n          <div className=\"control-label\">{t('Anchor to')}</div>\n          <Row align=\"middle\">\n            <Col>\n              <Radio.Group\n                onChange={onAnchorMode}\n                defaultValue=\"now\"\n                value={anchorMode}\n              >\n                <Radio key=\"now\" value=\"now\">\n                  {t('NOW')}\n                </Radio>\n                <Radio key=\"specific\" value=\"specific\">\n                  {t('Date/Time')}\n                </Radio>\n              </Radio.Group>\n            </Col>\n            {anchorMode !== 'now' && (\n              <Col>\n                <DatePicker\n                  showTime\n                  defaultValue={dttmToMoment(anchorValue)}\n                  onChange={(datetime: Moment) =>\n                    onChange('anchorValue', datetime.format(MOMENT_FORMAT))\n                  }\n                  allowClear={false}\n                  className=\"control-anchor-to-datetime\"\n                  locale={datePickerLocale}\n                />\n              </Col>\n            )}\n          </Row>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme, t } from '@superset-ui/core';\n\nimport { Tooltip } from 'src/components/Tooltip';\nimport { ClassNames } from '@emotion/react';\n\nconst TIME_PICKER_HELPER = (\n  <>\n    <div>\n      <h3>DATETIME</h3>\n      <p>{t('Return to specific datetime.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>datetime([string])</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`datetime(\"2020-03-01 12:00:00\")\ndatetime(\"now\")\ndatetime(\"last year\")`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>DATEADD</h3>\n      <p>{t('Moves the given set of dates by a specified interval.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`dateadd([datetime], [integer], [dateunit])\ndateunit = (year | quarter | month | week | day | hour | minute | second)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`dateadd(datetime(\"today\"), -13, day)\ndateadd(datetime(\"2020-03-01\"), 2, day)`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>DATETRUNC</h3>\n      <p>\n        {t(\n          'Truncates the specified date to the accuracy specified by the date unit.',\n        )}\n      </p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`datetrunc([datetime], [dateunit])\ndateunit = (year | quarter | month | week)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`datetrunc(datetime(\"2020-03-01\"), week)\ndatetrunc(datetime(\"2020-03-01\"), month)`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>LASTDAY</h3>\n      <p>{t('Get the last date by the date unit.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`lastday([datetime], [dateunit])\ndateunit = (year | month | week)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>lastday(datetime(\"today\"), month)</code>\n      </pre>\n    </div>\n    <div>\n      <h3>HOLIDAY</h3>\n      <p>{t('Get the specify date for the holiday')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`holiday([string])\nholiday([holiday string], [datetime])\nholiday([holiday string], [datetime], [country name])`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`holiday(\"new year\")\nholiday(\"christmas\", datetime(\"2019\"))\nholiday(\"christmas\", dateadd(datetime(\"2019\"), 1, year))\nholiday(\"christmas\", datetime(\"2 years ago\"))\nholiday(\"Easter Monday\", datetime(\"2019\"), \"UK\")`}</code>\n      </pre>\n    </div>\n  </>\n);\n\nconst StyledTooltip = (props: any) => {\n  const theme = useTheme();\n  return (\n    <ClassNames>\n      {({ css }) => (\n        <Tooltip\n          overlayClassName={css`\n            .ant-tooltip-content {\n              min-width: ${theme.gridUnit * 125}px;\n              max-height: 410px;\n              overflow-y: scroll;\n\n              .ant-tooltip-inner {\n                max-width: ${theme.gridUnit * 125}px;\n                h3 {\n                  font-size: ${theme.typography.sizes.m}px;\n                  font-weight: ${theme.typography.weights.bold};\n                }\n                h4 {\n                  font-size: ${theme.typography.sizes.m}px;\n                  font-weight: ${theme.typography.weights.bold};\n                }\n                pre {\n                  border: none;\n                  text-align: left;\n                  word-break: break-word;\n                  font-size: ${theme.typography.sizes.s}px;\n                }\n              }\n            }\n          `}\n          {...props}\n        />\n      )}\n    </ClassNames>\n  );\n};\n\nexport default function DateFunctionTooltip(props: any) {\n  return <StyledTooltip title={TIME_PICKER_HELPER} {...props} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { SEPARATOR } from 'src/explore/components/controls/DateFilterControl/utils';\nimport { Input } from 'src/components/Input';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { FrameComponentProps } from 'src/explore/components/controls/DateFilterControl/types';\nimport DateFunctionTooltip from './DateFunctionTooltip';\n\nfunction getAdvancedRange(value: string): string {\n  if (value.includes(SEPARATOR)) {\n    return value;\n  }\n  if (value.startsWith('Last')) {\n    return [value, ''].join(SEPARATOR);\n  }\n  if (value.startsWith('Next')) {\n    return ['', value].join(SEPARATOR);\n  }\n  return SEPARATOR;\n}\n\nexport function AdvancedFrame(props: FrameComponentProps) {\n  const advancedRange = getAdvancedRange(props.value || '');\n  const [since, until] = advancedRange.split(SEPARATOR);\n  if (advancedRange !== props.value) {\n    props.onChange(getAdvancedRange(props.value || ''));\n  }\n\n  function onChange(control: 'since' | 'until', value: string) {\n    if (control === 'since') {\n      props.onChange(`${value}${SEPARATOR}${until}`);\n    } else {\n      props.onChange(`${since}${SEPARATOR}${value}`);\n    }\n  }\n\n  return (\n    <>\n      <div className=\"section-title\">\n        {t('Configure Advanced Time Range ')}\n        <DateFunctionTooltip placement=\"rightBottom\">\n          <i className=\"fa fa-info-circle text-muted\" />\n        </DateFunctionTooltip>\n      </div>\n      <div className=\"control-label\">\n        {t('START (INCLUSIVE)')}{' '}\n        <InfoTooltipWithTrigger\n          tooltip={t('Start date included in time range')}\n          placement=\"right\"\n        />\n      </div>\n      <Input\n        key=\"since\"\n        value={since}\n        onChange={e => onChange('since', e.target.value)}\n      />\n      <div className=\"control-label\">\n        {t('END (EXCLUSIVE)')}{' '}\n        <InfoTooltipWithTrigger\n          tooltip={t('End date excluded from time range')}\n          placement=\"right\"\n        />\n      </div>\n      <Input\n        key=\"until\"\n        value={until}\n        onChange={e => onChange('until', e.target.value)}\n      />\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { forwardRef, ReactNode, RefObject } from 'react';\nimport { css, styled, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\n\nexport type DateLabelProps = {\n  label: ReactNode;\n  isActive?: boolean;\n  isPlaceholder?: boolean;\n  onClick?: (event: React.MouseEvent) => void;\n};\n\n// This is the color that antd components (such as Select or Input) use on hover\n// TODO: use theme.colors.primary.base here and in antd components\nconst ACTIVE_BORDER_COLOR = '#45BED6';\n\nconst LabelContainer = styled.div<{\n  isActive?: boolean;\n  isPlaceholder?: boolean;\n}>`\n  ${({ theme, isActive, isPlaceholder }) => css`\n    width: 100%;\n    height: ${theme.gridUnit * 8}px;\n\n    display: flex;\n    align-items: center;\n    flex-wrap: nowrap;\n\n    padding: 0 ${theme.gridUnit * 3}px;\n\n    background-color: ${theme.colors.grayscale.light5};\n\n    border: 1px solid\n      ${isActive ? ACTIVE_BORDER_COLOR : theme.colors.grayscale.light2};\n    border-radius: ${theme.borderRadius}px;\n\n    cursor: pointer;\n\n    transition: border-color 0.3s cubic-bezier(0.65, 0.05, 0.36, 1);\n    :hover,\n    :focus {\n      border-color: ${ACTIVE_BORDER_COLOR};\n    }\n\n    .date-label-content {\n      color: ${isPlaceholder\n        ? theme.colors.grayscale.light1\n        : theme.colors.grayscale.dark1};\n      overflow: hidden;\n      text-overflow: ellipsis;\n      min-width: 0;\n      flex-shrink: 1;\n      white-space: nowrap;\n    }\n\n    span[role='img'] {\n      margin-left: auto;\n      padding-left: ${theme.gridUnit}px;\n\n      & > span[role='img'] {\n        line-height: 0;\n      }\n    }\n  `}\n`;\n\nexport const DateLabel = forwardRef(\n  (props: DateLabelProps, ref: RefObject<HTMLSpanElement>) => {\n    const theme = useTheme();\n    return (\n      <LabelContainer {...props} tabIndex={0}>\n        <span className=\"date-label-content\" ref={ref}>\n          {props.label}\n        </span>\n        <Icons.CalendarOutlined\n          iconSize=\"s\"\n          iconColor={theme.colors.grayscale.base}\n        />\n      </LabelContainer>\n    );\n  },\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useState, useEffect, useMemo } from 'react';\nimport {\n  css,\n  styled,\n  t,\n  useTheme,\n  NO_TIME_RANGE,\n  SupersetTheme,\n  useCSSTextTruncation,\n} from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Modal from 'src/components/Modal';\nimport { Divider } from 'src/components';\nimport Icons from 'src/components/Icons';\nimport Select from 'src/components/Select/Select';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { noOp } from 'src/utils/common';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nimport { DateFilterControlProps, FrameType } from './types';\nimport {\n  DATE_FILTER_TEST_KEY,\n  fetchTimeRange,\n  FRAME_OPTIONS,\n  guessFrame,\n  useDefaultTimeFilter,\n} from './utils';\nimport {\n  CommonFrame,\n  CalendarFrame,\n  CustomFrame,\n  AdvancedFrame,\n  DateLabel,\n} from './components';\n\nconst StyledRangeType = styled(Select)`\n  width: 272px;\n`;\n\nconst ContentStyleWrapper = styled.div`\n  ${({ theme }) => css`\n    .ant-row {\n      margin-top: 8px;\n    }\n\n    .ant-input-number {\n      width: 100%;\n    }\n\n    .ant-picker {\n      padding: 4px 17px 4px;\n      border-radius: 4px;\n      width: 100%;\n    }\n\n    .ant-divider-horizontal {\n      margin: 16px 0;\n    }\n\n    .control-label {\n      font-size: 11px;\n      font-weight: ${theme.typography.weights.medium};\n      color: ${theme.colors.grayscale.light2};\n      line-height: 16px;\n      text-transform: uppercase;\n      margin: 8px 0;\n    }\n\n    .vertical-radio {\n      display: block;\n      height: 40px;\n      line-height: 40px;\n    }\n\n    .section-title {\n      font-style: normal;\n      font-weight: ${theme.typography.weights.bold};\n      font-size: 15px;\n      line-height: 24px;\n      margin-bottom: 8px;\n    }\n\n    .control-anchor-to {\n      margin-top: 16px;\n    }\n\n    .control-anchor-to-datetime {\n      width: 217px;\n    }\n\n    .footer {\n      text-align: right;\n    }\n  `}\n`;\n\nconst IconWrapper = styled.span`\n  span {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    vertical-align: middle;\n  }\n  .text {\n    vertical-align: middle;\n  }\n  .error {\n    color: ${({ theme }) => theme.colors.error.base};\n  }\n`;\n\nconst getTooltipTitle = (\n  isLabelTruncated: boolean,\n  label: string | undefined,\n  range: string | undefined,\n) =>\n  isLabelTruncated ? (\n    <div>\n      {label && <strong>{label}</strong>}\n      {range && (\n        <div\n          css={(theme: SupersetTheme) => css`\n            margin-top: ${theme.gridUnit}px;\n          `}\n        >\n          {range}\n        </div>\n      )}\n    </div>\n  ) : (\n    range || null\n  );\n\nexport default function DateFilterLabel(props: DateFilterControlProps) {\n  const {\n    onChange,\n    onOpenPopover = noOp,\n    onClosePopover = noOp,\n    overlayStyle = 'Popover',\n    isOverflowingFilterBar = false,\n  } = props;\n  const defaultTimeFilter = useDefaultTimeFilter();\n\n  const value = props.value ?? defaultTimeFilter;\n  const [actualTimeRange, setActualTimeRange] = useState<string>(value);\n\n  const [show, setShow] = useState<boolean>(false);\n  const guessedFrame = useMemo(() => guessFrame(value), [value]);\n  const [frame, setFrame] = useState<FrameType>(guessedFrame);\n  const [lastFetchedTimeRange, setLastFetchedTimeRange] = useState(value);\n  const [timeRangeValue, setTimeRangeValue] = useState(value);\n  const [validTimeRange, setValidTimeRange] = useState<boolean>(false);\n  const [evalResponse, setEvalResponse] = useState<string>(value);\n  const [tooltipTitle, setTooltipTitle] = useState<ReactNode | null>(value);\n  const theme = useTheme();\n  const [labelRef, labelIsTruncated] = useCSSTextTruncation<HTMLSpanElement>();\n\n  useEffect(() => {\n    if (value === NO_TIME_RANGE) {\n      setActualTimeRange(NO_TIME_RANGE);\n      setTooltipTitle(null);\n      setValidTimeRange(true);\n      return;\n    }\n    fetchTimeRange(value).then(({ value: actualRange, error }) => {\n      if (error) {\n        setEvalResponse(error || '');\n        setValidTimeRange(false);\n        setTooltipTitle(value || null);\n      } else {\n        /*\n          HRT == human readable text\n          ADR == actual datetime range\n          +--------------+------+----------+--------+----------+-----------+\n          |              | Last | Previous | Custom | Advanced | No Filter |\n          +--------------+------+----------+--------+----------+-----------+\n          | control pill | HRT  | HRT      | ADR    | ADR      |   HRT     |\n          +--------------+------+----------+--------+----------+-----------+\n          | tooltip      | ADR  | ADR      | HRT    | HRT      |   ADR     |\n          +--------------+------+----------+--------+----------+-----------+\n        */\n        if (\n          guessedFrame === 'Common' ||\n          guessedFrame === 'Calendar' ||\n          guessedFrame === 'No filter'\n        ) {\n          setActualTimeRange(value);\n          setTooltipTitle(\n            getTooltipTitle(labelIsTruncated, value, actualRange),\n          );\n        } else {\n          setActualTimeRange(actualRange || '');\n          setTooltipTitle(\n            getTooltipTitle(labelIsTruncated, actualRange, value),\n          );\n        }\n        setValidTimeRange(true);\n      }\n      setLastFetchedTimeRange(value);\n      setEvalResponse(actualRange || value);\n    });\n  }, [guessedFrame, labelIsTruncated, labelRef, value]);\n\n  useDebouncedEffect(\n    () => {\n      if (timeRangeValue === NO_TIME_RANGE) {\n        setEvalResponse(NO_TIME_RANGE);\n        setLastFetchedTimeRange(NO_TIME_RANGE);\n        setValidTimeRange(true);\n        return;\n      }\n      if (lastFetchedTimeRange !== timeRangeValue) {\n        fetchTimeRange(timeRangeValue).then(({ value: actualRange, error }) => {\n          if (error) {\n            setEvalResponse(error || '');\n            setValidTimeRange(false);\n          } else {\n            setEvalResponse(actualRange || '');\n            setValidTimeRange(true);\n          }\n          setLastFetchedTimeRange(timeRangeValue);\n        });\n      }\n    },\n    SLOW_DEBOUNCE,\n    [timeRangeValue],\n  );\n\n  function onSave() {\n    onChange(timeRangeValue);\n    setShow(false);\n    onClosePopover();\n  }\n\n  function onOpen() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(true);\n    onOpenPopover();\n  }\n\n  function onHide() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(false);\n    onClosePopover();\n  }\n\n  const toggleOverlay = () => {\n    if (show) {\n      onHide();\n    } else {\n      onOpen();\n    }\n  };\n\n  function onChangeFrame(value: FrameType) {\n    if (value === NO_TIME_RANGE) {\n      setTimeRangeValue(NO_TIME_RANGE);\n    }\n    setFrame(value);\n  }\n\n  const overlayContent = (\n    <ContentStyleWrapper>\n      <div className=\"control-label\">{t('RANGE TYPE')}</div>\n      <StyledRangeType\n        ariaLabel={t('RANGE TYPE')}\n        options={FRAME_OPTIONS}\n        value={frame}\n        onChange={onChangeFrame}\n      />\n      {frame !== 'No filter' && <Divider />}\n      {frame === 'Common' && (\n        <CommonFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Calendar' && (\n        <CalendarFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Advanced' && (\n        <AdvancedFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Custom' && (\n        <CustomFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'No filter' && (\n        <div data-test={DATE_FILTER_TEST_KEY.noFilter} />\n      )}\n      <Divider />\n      <div>\n        <div className=\"section-title\">{t('Actual time range')}</div>\n        {validTimeRange && <div>{evalResponse}</div>}\n        {!validTimeRange && (\n          <IconWrapper className=\"warning\">\n            <Icons.ErrorSolidSmall iconColor={theme.colors.error.base} />\n            <span className=\"text error\">{evalResponse}</span>\n          </IconWrapper>\n        )}\n      </div>\n      <Divider />\n      <div className=\"footer\">\n        <Button\n          buttonStyle=\"secondary\"\n          cta\n          key=\"cancel\"\n          onClick={onHide}\n          data-test={DATE_FILTER_TEST_KEY.cancelButton}\n        >\n          {t('CANCEL')}\n        </Button>\n        <Button\n          buttonStyle=\"primary\"\n          cta\n          disabled={!validTimeRange}\n          key=\"apply\"\n          onClick={onSave}\n          data-test={DATE_FILTER_TEST_KEY.applyButton}\n        >\n          {t('APPLY')}\n        </Button>\n      </div>\n    </ContentStyleWrapper>\n  );\n\n  const title = (\n    <IconWrapper>\n      <Icons.EditAlt iconColor={theme.colors.grayscale.base} />\n      <span className=\"text\">{t('Edit time range')}</span>\n    </IconWrapper>\n  );\n\n  const popoverContent = (\n    <ControlPopover\n      placement=\"right\"\n      trigger=\"click\"\n      content={overlayContent}\n      title={title}\n      defaultVisible={show}\n      visible={show}\n      onVisibleChange={toggleOverlay}\n      overlayStyle={{ width: '600px' }}\n      getPopupContainer={triggerNode =>\n        isOverflowingFilterBar\n          ? (triggerNode.parentNode as HTMLElement)\n          : document.body\n      }\n      destroyTooltipOnHide\n    >\n      <Tooltip placement=\"top\" title={tooltipTitle}>\n        <DateLabel\n          label={actualTimeRange}\n          isActive={show}\n          isPlaceholder={actualTimeRange === NO_TIME_RANGE}\n          data-test={DATE_FILTER_TEST_KEY.popoverOverlay}\n          ref={labelRef}\n        />\n      </Tooltip>\n    </ControlPopover>\n  );\n\n  const modalContent = (\n    <>\n      <Tooltip placement=\"top\" title={tooltipTitle}>\n        <DateLabel\n          onClick={toggleOverlay}\n          label={actualTimeRange}\n          isActive={show}\n          isPlaceholder={actualTimeRange === NO_TIME_RANGE}\n          data-test={DATE_FILTER_TEST_KEY.modalOverlay}\n          ref={labelRef}\n        />\n      </Tooltip>\n      {/* the zIndex value is from trying so that the Modal doesn't overlay the AdhocFilter when GENERIC_CHART_AXES is enabled */}\n      <Modal\n        title={title}\n        show={show}\n        onHide={toggleOverlay}\n        width=\"600px\"\n        hideFooter\n        zIndex={1030}\n      >\n        {overlayContent}\n      </Modal>\n    </>\n  );\n\n  return (\n    <>\n      <ControlHeader {...props} />\n      {overlayStyle === 'Modal' ? modalContent : popoverContent}\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport type SelectOptionType = {\n  value: string;\n  label: string;\n};\n\nexport type FrameType =\n  | 'Common'\n  | 'Calendar'\n  | 'Custom'\n  | 'Advanced'\n  | 'No filter';\n\nexport type DateTimeGrainType =\n  | 'second'\n  | 'minute'\n  | 'hour'\n  | 'day'\n  | 'week'\n  | 'month'\n  | 'quarter'\n  | 'year';\n\nexport type CustomRangeKey =\n  | 'sinceMode'\n  | 'sinceDatetime'\n  | 'sinceGrain'\n  | 'sinceGrainValue'\n  | 'untilMode'\n  | 'untilDatetime'\n  | 'untilGrain'\n  | 'untilGrainValue'\n  | 'anchorMode'\n  | 'anchorValue';\n\nexport type DateTimeModeType = 'specific' | 'relative' | 'now' | 'today';\n\nexport type CustomRangeType = {\n  sinceMode: DateTimeModeType;\n  sinceDatetime: string;\n  sinceGrain: DateTimeGrainType;\n  sinceGrainValue: number;\n  untilMode: DateTimeModeType;\n  untilDatetime: string;\n  untilGrain: DateTimeGrainType;\n  untilGrainValue: number;\n  anchorMode: 'now' | 'specific';\n  anchorValue: string;\n};\n\nexport type CustomRangeDecodeType = {\n  customRange: CustomRangeType;\n  matchedFlag: boolean;\n};\n\nexport type CommonRangeType =\n  | 'Last day'\n  | 'Last week'\n  | 'Last month'\n  | 'Last quarter'\n  | 'Last year';\n\nexport const PreviousCalendarWeek = 'previous calendar week';\nexport const PreviousCalendarMonth = 'previous calendar month';\nexport const PreviousCalendarYear = 'previous calendar year';\nexport type CalendarRangeType =\n  | typeof PreviousCalendarWeek\n  | typeof PreviousCalendarMonth\n  | typeof PreviousCalendarYear;\n\nexport type FrameComponentProps = {\n  onChange: (timeRange: string) => void;\n  value: string;\n};\n\nexport interface DateFilterControlProps {\n  name: string;\n  onChange: (timeRange: string) => void;\n  value?: string;\n  onOpenPopover?: () => void;\n  onClosePopover?: () => void;\n  overlayStyle?: 'Modal' | 'Popover';\n  isOverflowingFilterBar?: boolean;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { SupersetClient, NO_TIME_RANGE, JsonObject } from '@superset-ui/core';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { useSelector } from 'react-redux';\nimport {\n  COMMON_RANGE_VALUES_SET,\n  CALENDAR_RANGE_VALUES_SET,\n  customTimeRangeDecode,\n} from '.';\nimport { FrameType } from '../types';\n\nexport const SEPARATOR = ' : ';\n\nexport const buildTimeRangeString = (since: string, until: string): string =>\n  `${since}${SEPARATOR}${until}`;\n\nconst formatDateEndpoint = (dttm: string, isStart?: boolean): string =>\n  dttm.replace('T00:00:00', '') || (isStart ? '-' : '');\n\nexport const formatTimeRange = (\n  timeRange: string,\n  columnPlaceholder = 'col',\n) => {\n  const splitDateRange = timeRange.split(SEPARATOR);\n  if (splitDateRange.length === 1) return timeRange;\n  return `${formatDateEndpoint(\n    splitDateRange[0],\n    true,\n  )}  ${columnPlaceholder} < ${formatDateEndpoint(splitDateRange[1])}`;\n};\n\nexport const guessFrame = (timeRange: string): FrameType => {\n  if (COMMON_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Common';\n  }\n  if (CALENDAR_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Calendar';\n  }\n  if (timeRange === NO_TIME_RANGE) {\n    return 'No filter';\n  }\n  if (customTimeRangeDecode(timeRange).matchedFlag) {\n    return 'Custom';\n  }\n  return 'Advanced';\n};\n\nexport const fetchTimeRange = async (\n  timeRange: string,\n  columnPlaceholder = 'col',\n) => {\n  const query = rison.encode_uri(timeRange);\n  const endpoint = `/api/v1/time_range/?q=${query}`;\n  try {\n    const response = await SupersetClient.get({ endpoint });\n    const timeRangeString = buildTimeRangeString(\n      response?.json?.result?.since || '',\n      response?.json?.result?.until || '',\n    );\n    return {\n      value: formatTimeRange(timeRangeString, columnPlaceholder),\n    };\n  } catch (response) {\n    const clientError = await getClientErrorObject(response);\n    return {\n      error: clientError.message || clientError.error || response.statusText,\n    };\n  }\n};\n\nexport function useDefaultTimeFilter() {\n  return (\n    useSelector(\n      (state: JsonObject) => state?.common?.conf?.DEFAULT_TIME_FILTER,\n    ) ?? NO_TIME_RANGE\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\nimport { t } from '@superset-ui/core';\nimport {\n  SelectOptionType,\n  PreviousCalendarWeek,\n  PreviousCalendarMonth,\n  PreviousCalendarYear,\n  CommonRangeType,\n  CalendarRangeType,\n} from 'src/explore/components/controls/DateFilterControl/types';\n\nexport const FRAME_OPTIONS: SelectOptionType[] = [\n  { value: 'Common', label: t('Last') },\n  { value: 'Calendar', label: t('Previous') },\n  { value: 'Custom', label: t('Custom') },\n  { value: 'Advanced', label: t('Advanced') },\n  { value: 'No filter', label: t('No filter') },\n];\n\nexport const COMMON_RANGE_OPTIONS: SelectOptionType[] = [\n  { value: 'Last day', label: t('last day') },\n  { value: 'Last week', label: t('last week') },\n  { value: 'Last month', label: t('last month') },\n  { value: 'Last quarter', label: t('last quarter') },\n  { value: 'Last year', label: t('last year') },\n];\nexport const COMMON_RANGE_VALUES_SET = new Set(\n  COMMON_RANGE_OPTIONS.map(({ value }) => value),\n);\n\nexport const CALENDAR_RANGE_OPTIONS: SelectOptionType[] = [\n  { value: PreviousCalendarWeek, label: t('previous calendar week') },\n  {\n    value: PreviousCalendarMonth,\n    label: t('previous calendar month'),\n  },\n  { value: PreviousCalendarYear, label: t('previous calendar year') },\n];\nexport const CALENDAR_RANGE_VALUES_SET = new Set(\n  CALENDAR_RANGE_OPTIONS.map(({ value }) => value),\n);\n\nconst GRAIN_OPTIONS = [\n  { value: 'second', label: (rel: string) => t('Seconds %s', rel) },\n  { value: 'minute', label: (rel: string) => t('Minutes %s', rel) },\n  { value: 'hour', label: (rel: string) => t('Hours %s', rel) },\n  { value: 'day', label: (rel: string) => t('Days %s', rel) },\n  { value: 'week', label: (rel: string) => t('Weeks %s', rel) },\n  { value: 'month', label: (rel: string) => t('Months %s', rel) },\n  { value: 'quarter', label: (rel: string) => t('Quarters %s', rel) },\n  { value: 'year', label: (rel: string) => t('Years %s', rel) },\n];\n\nexport const SINCE_GRAIN_OPTIONS: SelectOptionType[] = GRAIN_OPTIONS.map(\n  item => ({\n    value: item.value,\n    label: item.label(t('Before')),\n  }),\n);\n\nexport const UNTIL_GRAIN_OPTIONS: SelectOptionType[] = GRAIN_OPTIONS.map(\n  item => ({\n    value: item.value,\n    label: item.label(t('After')),\n  }),\n);\n\nexport const SINCE_MODE_OPTIONS: SelectOptionType[] = [\n  { value: 'specific', label: t('Specific Date/Time') },\n  { value: 'relative', label: t('Relative Date/Time') },\n  { value: 'now', label: t('Now') },\n  { value: 'today', label: t('Midnight') },\n];\n\nexport const UNTIL_MODE_OPTIONS: SelectOptionType[] =\n  SINCE_MODE_OPTIONS.slice();\n\nexport const COMMON_RANGE_SET: Set<CommonRangeType> = new Set([\n  'Last day',\n  'Last week',\n  'Last month',\n  'Last quarter',\n  'Last year',\n]);\n\nexport const CALENDAR_RANGE_SET: Set<CalendarRangeType> = new Set([\n  PreviousCalendarWeek,\n  PreviousCalendarMonth,\n  PreviousCalendarYear,\n]);\n\nexport const MOMENT_FORMAT = 'YYYY-MM-DD[T]HH:mm:ss';\nexport const SEVEN_DAYS_AGO = moment()\n  .utc()\n  .startOf('day')\n  .subtract(7, 'days')\n  .format(MOMENT_FORMAT);\nexport const MIDNIGHT = moment().utc().startOf('day').format(MOMENT_FORMAT);\n\nexport const LOCALE_MAPPING = {\n  en: 'en_US',\n  fr: 'fr_FR',\n  es: 'es_ES',\n  it: 'it_IT',\n  zh: 'zh_CN',\n  ja: 'ja_JP',\n  de: 'de_DE',\n  pt: 'pt_PT',\n  pt_BR: 'pt_BR',\n  ru: 'ru_RU',\n  ko: 'ko_KR',\n  sk: 'sk_SK',\n  sl: 'sl_SI',\n  nl: 'nl_NL',\n};\n\nexport enum DATE_FILTER_TEST_KEY {\n  commonFrame = 'common-frame',\n  modalOverlay = 'modal-overlay',\n  popoverOverlay = 'time-range-trigger',\n  noFilter = 'no-filter',\n  cancelButton = 'cancel-button',\n  applyButton = 'date-filter-control__apply-button',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment, { Moment } from 'moment';\nimport {\n  CustomRangeDecodeType,\n  CustomRangeType,\n  DateTimeGrainType,\n  DateTimeModeType,\n} from 'src/explore/components/controls/DateFilterControl/types';\nimport { SEPARATOR } from './dateFilterUtils';\nimport { SEVEN_DAYS_AGO, MIDNIGHT, MOMENT_FORMAT } from './constants';\n\n/**\n * RegExp to test a string for a full ISO 8601 Date\n * Does not do any sort of date validation, only checks if the string is according to the ISO 8601 spec.\n *  YYYY-MM-DDThh:mm:ss\n *  YYYY-MM-DDThh:mm:ssTZD\n *  YYYY-MM-DDThh:mm:ss.sTZD\n * @see: https://www.w3.org/TR/NOTE-datetime\n */\nconst iso8601 = String.raw`\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.\\d+)?(?:(?:[+-]\\d\\d:\\d\\d)|Z)?`;\nconst datetimeConstant = String.raw`(?:TODAY|NOW)`;\nconst grainValue = String.raw`[+-]?[1-9][0-9]*`;\nconst grain = String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`;\nconst CUSTOM_RANGE_EXPRESSION = RegExp(\n  String.raw`^DATEADD\\(DATETIME\\(\"(${iso8601}|${datetimeConstant})\"\\),\\s(${grainValue}),\\s(${grain})\\)$`,\n  'i',\n);\nexport const ISO8601_AND_CONSTANT = RegExp(\n  String.raw`^${iso8601}$|^${datetimeConstant}$`,\n  'i',\n);\nconst DATETIME_CONSTANT = ['now', 'today'];\nconst defaultCustomRange: CustomRangeType = {\n  sinceDatetime: SEVEN_DAYS_AGO,\n  sinceMode: 'relative',\n  sinceGrain: 'day',\n  sinceGrainValue: -7,\n  untilDatetime: MIDNIGHT,\n  untilMode: 'specific',\n  untilGrain: 'day',\n  untilGrainValue: 7,\n  anchorMode: 'now',\n  anchorValue: 'now',\n};\nconst SPECIFIC_MODE = ['specific', 'today', 'now'];\n\nexport const dttmToMoment = (dttm: string): Moment => {\n  if (dttm === 'now') {\n    return moment().utc().startOf('second');\n  }\n  if (dttm === 'today') {\n    return moment().utc().startOf('day');\n  }\n  return moment(dttm);\n};\n\nexport const dttmToString = (dttm: string): string =>\n  dttmToMoment(dttm).format(MOMENT_FORMAT);\n\nexport const customTimeRangeDecode = (\n  timeRange: string,\n): CustomRangeDecodeType => {\n  const splitDateRange = timeRange.split(SEPARATOR);\n\n  if (splitDateRange.length === 2) {\n    const [since, until] = splitDateRange;\n\n    // specific : specific\n    if (ISO8601_AND_CONSTANT.test(since) && ISO8601_AND_CONSTANT.test(until)) {\n      const sinceMode = (\n        DATETIME_CONSTANT.includes(since) ? since : 'specific'\n      ) as DateTimeModeType;\n      const untilMode = (\n        DATETIME_CONSTANT.includes(until) ? until : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceDatetime: since,\n          untilDatetime: until,\n          sinceMode,\n          untilMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // relative : specific\n    const sinceCapturedGroup = since.match(CUSTOM_RANGE_EXPRESSION);\n    if (\n      sinceCapturedGroup &&\n      ISO8601_AND_CONSTANT.test(until) &&\n      since.includes(until)\n    ) {\n      const [dttm, grainValue, grain] = sinceCapturedGroup.slice(1);\n      const untilMode = (\n        DATETIME_CONSTANT.includes(until) ? until : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceGrain: grain as DateTimeGrainType,\n          sinceGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          sinceMode: 'relative',\n          untilMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // specific : relative\n    const untilCapturedGroup = until.match(CUSTOM_RANGE_EXPRESSION);\n    if (\n      ISO8601_AND_CONSTANT.test(since) &&\n      untilCapturedGroup &&\n      until.includes(since)\n    ) {\n      const [dttm, grainValue, grain] = [...untilCapturedGroup.slice(1)];\n      const sinceMode = (\n        DATETIME_CONSTANT.includes(since) ? since : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          untilGrain: grain as DateTimeGrainType,\n          untilGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          untilMode: 'relative',\n          sinceMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // relative : relative\n    if (sinceCapturedGroup && untilCapturedGroup) {\n      const [sinceDttm, sinceGrainValue, sinceGrain] = [\n        ...sinceCapturedGroup.slice(1),\n      ];\n      const [untileDttm, untilGrainValue, untilGrain] = [\n        ...untilCapturedGroup.slice(1),\n      ];\n      if (sinceDttm === untileDttm) {\n        return {\n          customRange: {\n            ...defaultCustomRange,\n            sinceGrain: sinceGrain as DateTimeGrainType,\n            sinceGrainValue: parseInt(sinceGrainValue, 10),\n            sinceDatetime: sinceDttm,\n            untilGrain: untilGrain as DateTimeGrainType,\n            untilGrainValue: parseInt(untilGrainValue, 10),\n            untilDatetime: untileDttm,\n            anchorValue: sinceDttm,\n            sinceMode: 'relative',\n            untilMode: 'relative',\n            anchorMode: sinceDttm === 'now' ? 'now' : 'specific',\n          },\n          matchedFlag: true,\n        };\n      }\n    }\n  }\n\n  return {\n    customRange: defaultCustomRange,\n    matchedFlag: false,\n  };\n};\n\nexport const customTimeRangeEncode = (customRange: CustomRangeType): string => {\n  const {\n    sinceDatetime,\n    sinceMode,\n    sinceGrain,\n    sinceGrainValue,\n    untilDatetime,\n    untilMode,\n    untilGrain,\n    untilGrainValue,\n    anchorValue,\n  } = { ...customRange };\n  // specific : specific\n  if (SPECIFIC_MODE.includes(sinceMode) && SPECIFIC_MODE.includes(untilMode)) {\n    const since =\n      sinceMode === 'specific' ? dttmToString(sinceDatetime) : sinceMode;\n    const until =\n      untilMode === 'specific' ? dttmToString(untilDatetime) : untilMode;\n    return `${since} : ${until}`;\n  }\n\n  // specific : relative\n  if (SPECIFIC_MODE.includes(sinceMode) && untilMode === 'relative') {\n    const since =\n      sinceMode === 'specific' ? dttmToString(sinceDatetime) : sinceMode;\n    const until = `DATEADD(DATETIME(\"${since}\"), ${untilGrainValue}, ${untilGrain})`;\n    return `${since} : ${until}`;\n  }\n\n  // relative : specific\n  if (sinceMode === 'relative' && SPECIFIC_MODE.includes(untilMode)) {\n    const until =\n      untilMode === 'specific' ? dttmToString(untilDatetime) : untilMode;\n    const since = `DATEADD(DATETIME(\"${until}\"), ${-Math.abs(\n      sinceGrainValue,\n    )}, ${sinceGrain})`;\n    return `${since} : ${until}`;\n  }\n\n  // relative : relative\n  const since = `DATEADD(DATETIME(\"${anchorValue}\"), ${-Math.abs(\n    sinceGrainValue,\n  )}, ${sinceGrain})`;\n  const until = `DATEADD(DATETIME(\"${anchorValue}\"), ${untilGrainValue}, ${untilGrain})`;\n  return `${since} : ${until}`;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useState } from 'react';\nimport { ensureIsArray, SupersetClient, t } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport rison from 'rison';\nimport { AdvancedDataTypesState, Props } from './index';\n\nconst INITIAL_ADVANCED_DATA_TYPES_STATE: AdvancedDataTypesState = {\n  parsedAdvancedDataType: '',\n  advancedDataTypeOperatorList: [],\n  errorMessage: '',\n};\n\nconst useAdvancedDataTypes = (validHandler: (isValid: boolean) => void) => {\n  const [advancedDataTypesState, setAdvancedDataTypesState] =\n    useState<AdvancedDataTypesState>(INITIAL_ADVANCED_DATA_TYPES_STATE);\n  const [subjectAdvancedDataType, setSubjectAdvancedDataType] = useState<\n    string | undefined\n  >();\n\n  const fetchAdvancedDataTypeValueCallback = useCallback(\n    (\n      comp: string | string[],\n      advancedDataTypesState: AdvancedDataTypesState,\n      subjectAdvancedDataType?: string,\n    ) => {\n      const values = ensureIsArray(comp);\n      if (!subjectAdvancedDataType) {\n        setAdvancedDataTypesState(INITIAL_ADVANCED_DATA_TYPES_STATE);\n        return;\n      }\n      debounce(() => {\n        const queryParams = rison.encode({\n          type: subjectAdvancedDataType,\n          values,\n        });\n        const endpoint = `/api/v1/advanced_data_type/convert?q=${queryParams}`;\n        SupersetClient.get({ endpoint })\n          .then(({ json }) => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: json.result.display_value,\n              advancedDataTypeOperatorList: json.result.valid_filter_operators,\n              errorMessage: json.result.error_message,\n            });\n            // Changed due to removal of status field\n            validHandler(!json.result.error_message);\n          })\n          .catch(() => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: '',\n              advancedDataTypeOperatorList:\n                advancedDataTypesState.advancedDataTypeOperatorList,\n              errorMessage: t('Failed to retrieve advanced type'),\n            });\n            validHandler(false);\n          });\n      }, 600)();\n    },\n    [validHandler],\n  );\n\n  const fetchSubjectAdvancedDataType = (props: Props) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option &&\n          option.column_name === props.adhocFilter.subject) ||\n        ('optionName' in option &&\n          option.optionName === props.adhocFilter.subject),\n    );\n    if (option && 'advanced_data_type' in option) {\n      setSubjectAdvancedDataType(option.advanced_data_type);\n    } else {\n      props.validHandler(true);\n    }\n  };\n\n  return {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    setAdvancedDataTypesState,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  };\n};\n\nexport default useAdvancedDataTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport FormItem from 'src/components/Form/FormItem';\nimport { Select } from 'src/components';\nimport {\n  FeatureFlag,\n  hasGenericChartAxes,\n  isDefined,\n  styled,\n  SupersetClient,\n  SupersetTheme,\n  t,\n} from '@superset-ui/core';\nimport {\n  Operators,\n  OPERATORS_OPTIONS,\n  HAVING_OPERATORS,\n  MULTI_OPERATORS,\n  CUSTOM_OPERATORS,\n  DISABLE_INPUT_OPERATORS,\n  AGGREGATES,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Input } from 'src/components/Input';\nimport { optionLabel } from 'src/utils/common';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport {\n  ColumnMeta,\n  Dataset,\n  isTemporalColumn,\n} from '@superset-ui/chart-controls';\nimport useAdvancedDataTypes from './useAdvancedDataTypes';\nimport { useDatePickerInAdhocFilter } from '../utils';\nimport { useDefaultTimeFilter } from '../../DateFilterControl/utils';\nimport { CLAUSES, EXPRESSION_TYPES } from '../types';\n\nconst StyledInput = styled(Input)`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport const StyledFormItem = styled(FormItem)`\n  &.ant-row.ant-form-item {\n    margin: 0;\n  }\n`;\n\nconst SelectWithLabel = styled(Select)<{ labelText: string }>`\n  .ant-select-selector::after {\n    content: ${({ labelText }) => labelText || '\\\\A0'};\n    display: inline-block;\n    white-space: nowrap;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n    width: max-content;\n  }\n`;\n\nexport interface SimpleExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  column: ColumnMeta;\n  aggregate: keyof typeof AGGREGATES;\n  label: string;\n}\nexport interface SQLExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  sqlExpression: string;\n  label: string;\n}\n\nexport interface MetricColumnType {\n  saved_metric_name: string;\n}\n\nexport type ColumnType =\n  | ColumnMeta\n  | SimpleExpressionType\n  | SQLExpressionType\n  | MetricColumnType;\n\nexport interface Props {\n  adhocFilter: AdhocFilter;\n  onChange: (filter: AdhocFilter) => void;\n  options: ColumnType[];\n  datasource: Dataset;\n  partitionColumn: string;\n  operators?: Operators[];\n  validHandler: (isValid: boolean) => void;\n}\n\nexport interface AdvancedDataTypesState {\n  parsedAdvancedDataType: string;\n  advancedDataTypeOperatorList: string[];\n  errorMessage: string;\n}\n\nexport const useSimpleTabFilterProps = (props: Props) => {\n  const defaultTimeFilter = useDefaultTimeFilter();\n\n  const isOperatorRelevant = (operator: Operators, subject: string) => {\n    const column = props.datasource.columns?.find(\n      col => col.column_name === subject,\n    );\n    const isColumnBoolean =\n      !!column && (column.type === 'BOOL' || column.type === 'BOOLEAN');\n    const isColumnNumber =\n      !!column && (column.type === 'INT' || column.type === 'INTEGER');\n    const isColumnFunction = !!column && !!column.expression;\n\n    if (operator && operator === Operators.LATEST_PARTITION) {\n      const { partitionColumn } = props;\n      return partitionColumn && subject && subject === partitionColumn;\n    }\n    if (operator && operator === Operators.TEMPORAL_RANGE) {\n      // hide the TEMPORAL_RANGE operator\n      return false;\n    }\n    if (operator === Operators.IS_TRUE || operator === Operators.IS_FALSE) {\n      return isColumnBoolean || isColumnNumber || isColumnFunction;\n    }\n    if (isColumnBoolean) {\n      return (\n        operator === Operators.IS_NULL || operator === Operators.IS_NOT_NULL\n      );\n    }\n    return (\n      props.adhocFilter.clause !== CLAUSES.HAVING ||\n      HAVING_OPERATORS.indexOf(operator) !== -1\n    );\n  };\n  const onSubjectChange = (id: string) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option && option.column_name === id) ||\n        ('optionName' in option && option.optionName === id),\n    );\n    let subject = '';\n    let clause;\n    // infer the new clause based on what subject was selected.\n    if (option && 'column_name' in option) {\n      subject = option.column_name;\n      clause = CLAUSES.WHERE;\n    } else if (option && 'saved_metric_name' in option) {\n      subject = option.saved_metric_name;\n      clause = CLAUSES.HAVING;\n    } else if (option?.label) {\n      subject = option.label;\n      clause = CLAUSES.HAVING;\n    }\n    let { operator, operatorId, comparator } = props.adhocFilter;\n    operator =\n      operator && operatorId && isOperatorRelevant(operatorId, subject)\n        ? OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation\n        : null;\n    if (!isDefined(operator)) {\n      // if operator is `null`, use the `IN` and reset the comparator.\n      operator = Operators.IN;\n      operatorId = Operators.IN;\n      comparator = undefined;\n    }\n\n    if (hasGenericChartAxes && isTemporalColumn(id, props.datasource)) {\n      subject = id;\n      operator = Operators.TEMPORAL_RANGE;\n      operatorId = Operators.TEMPORAL_RANGE;\n      comparator = defaultTimeFilter;\n    }\n\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject,\n        clause,\n        operator,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n        operatorId,\n        comparator,\n      }),\n    );\n  };\n  const onOperatorChange = (operatorId: Operators) => {\n    const currentComparator = props.adhocFilter.comparator;\n    let newComparator;\n    // convert between list of comparators and individual comparators\n    // (e.g. `in ('North America', 'Africa')` to `== 'North America'`)\n    if (MULTI_OPERATORS.has(operatorId)) {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator\n        : [currentComparator].filter(element => element);\n    } else {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator[0]\n        : currentComparator;\n    }\n    if (operatorId === Operators.IS_TRUE || operatorId === Operators.IS_FALSE) {\n      newComparator = Operators.IS_TRUE === operatorId;\n    }\n    if (operatorId && CUSTOM_OPERATORS.has(operatorId)) {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          subject: props.adhocFilter.subject,\n          clause: CLAUSES.WHERE,\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          expressionType: EXPRESSION_TYPES.SQL,\n          datasource: props.datasource,\n        }),\n      );\n    } else {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          comparator: newComparator,\n          expressionType: EXPRESSION_TYPES.SIMPLE,\n        }),\n      );\n    }\n  };\n  const onComparatorChange = (comparator: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        comparator,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    );\n  };\n  const clearOperator = (): void => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        operatorId: undefined,\n        operator: undefined,\n      }),\n    );\n  };\n  const onDatePickerChange = (columnName: string, timeRange: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject: columnName,\n        operator: Operators.TEMPORAL_RANGE,\n        comparator: timeRange,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    );\n  };\n  return {\n    onSubjectChange,\n    onOperatorChange,\n    onComparatorChange,\n    isOperatorRelevant,\n    clearOperator,\n    onDatePickerChange,\n  };\n};\n\nconst AdhocFilterEditPopoverSimpleTabContent: React.FC<Props> = props => {\n  const {\n    onSubjectChange,\n    onOperatorChange,\n    isOperatorRelevant,\n    onComparatorChange,\n    onDatePickerChange,\n  } = useSimpleTabFilterProps(props);\n  const [suggestions, setSuggestions] = useState<\n    Record<'label' | 'value', any>[]\n  >([]);\n  const [comparator, setComparator] = useState(props.adhocFilter.comparator);\n  const [loadingComparatorSuggestions, setLoadingComparatorSuggestions] =\n    useState(false);\n\n  const {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  } = useAdvancedDataTypes(props.validHandler);\n  // TODO: This does not need to exist, just use the advancedTypeOperatorList list\n  const isOperatorRelevantWrapper = (operator: Operators, subject: string) =>\n    subjectAdvancedDataType\n      ? isOperatorRelevant(operator, subject) &&\n        advancedDataTypesState.advancedDataTypeOperatorList.includes(operator)\n      : isOperatorRelevant(operator, subject);\n  const onInputComparatorChange = (\n    event: React.ChangeEvent<HTMLInputElement>,\n  ) => {\n    const { value } = event.target;\n    setComparator(value);\n    onComparatorChange(value);\n  };\n\n  const renderSubjectOptionLabel = (option: ColumnType) => (\n    <FilterDefinitionOption option={option} />\n  );\n\n  const getOptionsRemaining = () => {\n    // if select is multi/value is array, we show the options not selected\n    const valuesFromSuggestionsLength = Array.isArray(comparator)\n      ? comparator.filter(v => suggestions.includes(v)).length\n      : 0;\n    return suggestions?.length - valuesFromSuggestionsLength ?? 0;\n  };\n  const createSuggestionsPlaceholder = () => {\n    const optionsRemaining = getOptionsRemaining();\n    const placeholder = t('%s option(s)', optionsRemaining);\n    return optionsRemaining ? placeholder : '';\n  };\n\n  const handleSubjectChange = (subject: string) => {\n    setComparator(undefined);\n    onSubjectChange(subject);\n  };\n\n  let columns = props.options;\n  const { subject, operator, operatorId } = props.adhocFilter;\n\n  const subjectSelectProps = {\n    ariaLabel: t('Select subject'),\n    value: subject ?? undefined,\n    onChange: handleSubjectChange,\n    notFoundContent: t(\n      'No such column found. To filter on a metric, try the Custom SQL tab.',\n    ),\n    autoFocus: !subject,\n    placeholder: '',\n  };\n\n  subjectSelectProps.placeholder =\n    props.adhocFilter.clause === CLAUSES.WHERE\n      ? t('%s column(s)', columns.length)\n      : t('To filter on a metric, use Custom SQL tab.');\n  columns = props.options.filter(\n    option => 'column_name' in option && option.column_name,\n  );\n\n  const operatorSelectProps = {\n    placeholder: t(\n      '%s operator(s)',\n      (props.operators ?? OPERATORS_OPTIONS).filter(op =>\n        isOperatorRelevantWrapper(op, subject),\n      ).length,\n    ),\n    value: operatorId,\n    onChange: onOperatorChange,\n    autoFocus: !!subjectSelectProps.value && !operator,\n    ariaLabel: t('Select operator'),\n  };\n\n  const shouldFocusComparator =\n    !!subjectSelectProps.value && !!operatorSelectProps.value;\n\n  const comparatorSelectProps = {\n    allowClear: true,\n    allowNewOptions: true,\n    ariaLabel: t('Comparator option'),\n    mode: MULTI_OPERATORS.has(operatorId)\n      ? ('multiple' as const)\n      : ('single' as const),\n    loading: loadingComparatorSuggestions,\n    value: comparator,\n    onChange: onComparatorChange,\n    notFoundContent: t('Type a value here'),\n    disabled: DISABLE_INPUT_OPERATORS.includes(operatorId),\n    placeholder: createSuggestionsPlaceholder(),\n    autoFocus: shouldFocusComparator,\n  };\n\n  const labelText =\n    comparator && comparator.length > 0 && createSuggestionsPlaceholder();\n\n  const datePicker = useDatePickerInAdhocFilter({\n    columnName: props.adhocFilter.subject,\n    timeRange:\n      props.adhocFilter.operator === Operators.TEMPORAL_RANGE\n        ? props.adhocFilter.comparator\n        : undefined,\n    datasource: props.datasource,\n    onChange: onDatePickerChange,\n  });\n\n  useEffect(() => {\n    const refreshComparatorSuggestions = () => {\n      const { datasource } = props;\n      const col = props.adhocFilter.subject;\n      const having = props.adhocFilter.clause === CLAUSES.HAVING;\n\n      if (col && datasource && datasource.filter_select && !having) {\n        const controller = new AbortController();\n        const { signal } = controller;\n        if (loadingComparatorSuggestions) {\n          controller.abort();\n        }\n        setLoadingComparatorSuggestions(true);\n        SupersetClient.get({\n          signal,\n          endpoint: `/api/v1/datasource/${datasource.type}/${datasource.id}/column/${col}/values/`,\n        })\n          .then(({ json }) => {\n            setSuggestions(\n              json.result.map(\n                (suggestion: null | number | boolean | string) => ({\n                  value: suggestion,\n                  label: optionLabel(suggestion),\n                }),\n              ),\n            );\n            setLoadingComparatorSuggestions(false);\n          })\n          .catch(() => {\n            setSuggestions([]);\n            setLoadingComparatorSuggestions(false);\n          });\n      }\n    };\n    if (!datePicker) {\n      refreshComparatorSuggestions();\n    }\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      fetchSubjectAdvancedDataType(props);\n    }\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      fetchAdvancedDataTypeValueCallback(\n        comparator === undefined ? '' : comparator,\n        advancedDataTypesState,\n        subjectAdvancedDataType,\n      );\n    }\n  }, [comparator, subjectAdvancedDataType, fetchAdvancedDataTypeValueCallback]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      setComparator(props.adhocFilter.comparator);\n    }\n  }, [props.adhocFilter.comparator]);\n\n  // another name for columns, just for following previous naming.\n  const subjectComponent = (\n    <Select\n      css={(theme: SupersetTheme) => ({\n        marginTop: theme.gridUnit * 4,\n        marginBottom: theme.gridUnit * 4,\n      })}\n      data-test=\"select-element\"\n      options={columns.map(column => ({\n        value:\n          ('column_name' in column && column.column_name) ||\n          ('optionName' in column && column.optionName) ||\n          '',\n        label:\n          ('saved_metric_name' in column && column.saved_metric_name) ||\n          ('column_name' in column && column.column_name) ||\n          ('label' in column && column.label),\n        key:\n          ('id' in column && column.id) ||\n          ('optionName' in column && column.optionName) ||\n          undefined,\n        customLabel: renderSubjectOptionLabel(column),\n      }))}\n      {...subjectSelectProps}\n    />\n  );\n\n  const operatorsAndOperandComponent = (\n    <>\n      <Select\n        css={(theme: SupersetTheme) => ({ marginBottom: theme.gridUnit * 4 })}\n        options={(props.operators ?? OPERATORS_OPTIONS)\n          .filter(op => isOperatorRelevantWrapper(op, subject))\n          .map((option, index) => ({\n            value: option,\n            label: OPERATOR_ENUM_TO_OPERATOR_TYPE[option].display,\n            key: option,\n            order: index,\n          }))}\n        {...operatorSelectProps}\n      />\n      {MULTI_OPERATORS.has(operatorId) || suggestions.length > 0 ? (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <SelectWithLabel\n            labelText={labelText}\n            options={suggestions}\n            {...comparatorSelectProps}\n          />\n        </Tooltip>\n      ) : (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <StyledInput\n            data-test=\"adhoc-filter-simple-value\"\n            name=\"filter-value\"\n            ref={ref => {\n              if (ref && shouldFocusComparator) {\n                ref.focus();\n              }\n            }}\n            onChange={onInputComparatorChange}\n            value={comparator}\n            placeholder={t('Filter value (case sensitive)')}\n            disabled={DISABLE_INPUT_OPERATORS.includes(operatorId)}\n          />\n        </Tooltip>\n      )}\n    </>\n  );\n  return (\n    <>\n      {subjectComponent}\n      {datePicker ?? operatorsAndOperandComponent}\n    </>\n  );\n};\n\nexport default AdhocFilterEditPopoverSimpleTabContent;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { CLAUSES, EXPRESSION_TYPES } from '../types';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n  activeKey: PropTypes.string.isRequired,\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n      this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n\n    this.selectProps = {\n      ariaLabel: t('Select column'),\n    };\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const clauseSelectProps = {\n      placeholder: t('choose WHERE or HAVING...'),\n      value: adhocFilter.clause,\n      onChange: this.onSqlExpressionClauseChange,\n    };\n    const keywords = sqlKeywords.concat(\n      options\n        .map(option => {\n          if (option.column_name) {\n            return {\n              name: option.column_name,\n              value: option.column_name,\n              score: 50,\n              meta: 'option',\n            };\n          }\n          return null;\n        })\n        .filter(Boolean),\n    );\n    const selectOptions = Object.keys(CLAUSES).map(clause => ({\n      label: clause,\n      value: clause,\n    }));\n\n    return (\n      <span>\n        <div className=\"filter-edit-clause-section\">\n          <StyledSelect\n            options={selectOptions}\n            {...this.selectProps}\n            {...clauseSelectProps}\n          />\n          <span className=\"filter-edit-clause-info\">\n            <strong>WHERE</strong> {t('Filters by columns')}\n            <br />\n            <strong>HAVING</strong> {t('Filters by metrics')}\n          </span>\n        </div>\n        <div css={theme => ({ marginTop: theme.gridUnit * 4 })}>\n          <SQLEditor\n            ref={this.handleAceEditorRef}\n            keywords={keywords}\n            height={`${height - 130}px`}\n            onChange={this.onSqlExpressionChange}\n            width=\"100%\"\n            showGutter={false}\n            value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n          />\n        </div>\n      </span>\n    );\n  }\n}\nAdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\nimport { EXPRESSION_TYPES } from '../types';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  requireSave: PropTypes.bool,\n};\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n    padding-left: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-section {\n    display: inline-flex;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nconst FilterActionsContainer = styled.div`\n  margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.setSimpleTabIsValid = this.setSimpleTabIsValid.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n      activeKey: this.props?.adhocFilter?.expressionType || 'SIMPLE',\n      isSimpleTabValid: true,\n    };\n\n    this.popoverContentRef = React.createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  setSimpleTabIsValid(isValid) {\n    this.setState({ isSimpleTabValid: isValid });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY),\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey,\n    });\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      theme,\n      operators,\n      requireSave,\n      ...popoverProps\n    } = this.props;\n\n    const { adhocFilter } = this.state;\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges =\n      requireSave || !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      <FilterPopoverContentContainer\n        id=\"filter-edit-popover\"\n        {...popoverProps}\n        data-test=\"filter-edit-popover\"\n        ref={this.popoverContentRef}\n      >\n        <Tabs\n          id=\"adhoc-filter-edit-tabs\"\n          defaultActiveKey={adhocFilter.expressionType}\n          className=\"adhoc-filter-edit-tabs\"\n          data-test=\"adhoc-filter-edit-tabs\"\n          style={{ minHeight: this.state.height, width: this.state.width }}\n          allowOverflow\n          onChange={this.onTabChange}\n        >\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={t('Simple')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSimpleTabContent\n                operators={operators}\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={options}\n                datasource={datasource}\n                onHeightChange={this.adjustHeight}\n                partitionColumn={partitionColumn}\n                popoverRef={this.popoverContentRef.current}\n                validHandler={this.setSimpleTabIsValid}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SQL}\n            tab={t('Custom SQL')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSqlTabContent\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={this.props.options}\n                height={this.state.height}\n                activeKey={this.state.activeKey}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n        </Tabs>\n        <FilterActionsContainer>\n          <Button buttonSize=\"small\" onClick={this.props.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            data-test=\"adhoc-filter-edit-popover-save-button\"\n            disabled={\n              !stateIsValid ||\n              !this.state.isSimpleTabValid ||\n              !hasUnsavedChanges\n            }\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <ResizeIcon\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </FilterActionsContainer>\n      </FilterPopoverContentContainer>\n    );\n  }\n}\n\nAdhocFilterEditPopover.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { OptionSortType } from 'src/explore/types';\nimport AdhocFilterEditPopover from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopover';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport { Operators } from 'src/explore/constants';\nimport ControlPopover from '../../ControlPopover/ControlPopover';\n\ninterface AdhocFilterPopoverTriggerProps {\n  sections?: string[];\n  operators?: Operators[];\n  adhocFilter: AdhocFilter;\n  options: OptionSortType[];\n  datasource: Record<string, any>;\n  onFilterEdit: (editedFilter: AdhocFilter) => void;\n  partitionColumn?: string;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  requireSave?: boolean;\n}\n\ninterface AdhocFilterPopoverTriggerState {\n  popoverVisible: boolean;\n}\n\nclass AdhocFilterPopoverTrigger extends React.PureComponent<\n  AdhocFilterPopoverTriggerProps,\n  AdhocFilterPopoverTriggerState\n> {\n  constructor(props: AdhocFilterPopoverTriggerProps) {\n    super(props);\n    this.onPopoverResize = this.onPopoverResize.bind(this);\n    this.closePopover = this.closePopover.bind(this);\n    this.togglePopover = this.togglePopover.bind(this);\n    this.state = {\n      popoverVisible: false,\n    };\n  }\n\n  onPopoverResize() {\n    this.forceUpdate();\n  }\n\n  closePopover() {\n    this.togglePopover(false);\n  }\n\n  togglePopover(visible: boolean) {\n    this.setState({\n      popoverVisible: visible,\n    });\n  }\n\n  render() {\n    const { adhocFilter, isControlledComponent } = this.props;\n\n    const { visible, togglePopover, closePopover } = isControlledComponent\n      ? {\n          visible: this.props.visible,\n          togglePopover: this.props.togglePopover,\n          closePopover: this.props.closePopover,\n        }\n      : {\n          visible: this.state.popoverVisible,\n          togglePopover: this.togglePopover,\n          closePopover: this.closePopover,\n        };\n    const overlayContent = (\n      <ExplorePopoverContent>\n        <AdhocFilterEditPopover\n          adhocFilter={adhocFilter}\n          options={this.props.options}\n          datasource={this.props.datasource}\n          partitionColumn={this.props.partitionColumn}\n          onResize={this.onPopoverResize}\n          onClose={closePopover}\n          sections={this.props.sections}\n          operators={this.props.operators}\n          onChange={this.props.onFilterEdit}\n          requireSave={this.props.requireSave}\n        />\n      </ExplorePopoverContent>\n    );\n\n    return (\n      <ControlPopover\n        trigger=\"click\"\n        content={overlayContent}\n        defaultVisible={visible}\n        visible={visible}\n        onVisibleChange={togglePopover}\n        destroyTooltipOnHide\n      >\n        {this.props.children}\n      </ControlPopover>\n    );\n  }\n}\n\nexport default AdhocFilterPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport enum EXPRESSION_TYPES {\n  SIMPLE = 'SIMPLE',\n  SQL = 'SQL',\n}\n\nexport enum CLAUSES {\n  HAVING = 'HAVING',\n  WHERE = 'WHERE',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useState } from 'react';\nimport { NO_TIME_RANGE } from '@superset-ui/core';\nimport { fetchTimeRange } from 'src/explore/components/controls/DateFilterControl';\nimport { Operators } from 'src/explore/constants';\nimport AdhocFilter from '../AdhocFilter';\nimport { EXPRESSION_TYPES } from '../types';\n\ninterface Results {\n  actualTimeRange?: string;\n  title?: string;\n}\n\nexport const useGetTimeRangeLabel = (adhocFilter: AdhocFilter): Results => {\n  const [actualTimeRange, setActualTimeRange] = useState<Results>({});\n\n  useEffect(() => {\n    if (\n      adhocFilter.operator !== Operators.TEMPORAL_RANGE ||\n      adhocFilter.expressionType !== EXPRESSION_TYPES.SIMPLE\n    ) {\n      setActualTimeRange({});\n    }\n    if (\n      adhocFilter.operator === Operators.TEMPORAL_RANGE &&\n      adhocFilter.comparator === NO_TIME_RANGE\n    ) {\n      setActualTimeRange({\n        actualTimeRange: `${adhocFilter.subject} (${NO_TIME_RANGE})`,\n        title: NO_TIME_RANGE,\n      });\n    }\n\n    if (\n      adhocFilter.operator === Operators.TEMPORAL_RANGE &&\n      adhocFilter.expressionType === EXPRESSION_TYPES.SIMPLE &&\n      adhocFilter.comparator !== NO_TIME_RANGE &&\n      actualTimeRange.title !== adhocFilter.comparator\n    ) {\n      fetchTimeRange(adhocFilter.comparator, adhocFilter.subject).then(\n        ({ value, error }) => {\n          if (error) {\n            setActualTimeRange({\n              actualTimeRange: `${adhocFilter.subject} (${adhocFilter.comparator})`,\n              title: error,\n            });\n          } else {\n            setActualTimeRange({\n              actualTimeRange: value ?? '',\n              title: adhocFilter.comparator,\n            });\n          }\n        },\n      );\n    }\n  }, [adhocFilter]);\n\n  return actualTimeRange;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\n\nimport { hasGenericChartAxes, t } from '@superset-ui/core';\nimport { Dataset, isTemporalColumn } from '@superset-ui/chart-controls';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl/DateFilterLabel';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\ninterface DatePickerInFilterProps {\n  columnName: string;\n  timeRange?: string;\n  datasource: Dataset;\n  onChange: (columnName: string, timeRange: string) => void;\n}\n\nexport const useDatePickerInAdhocFilter = ({\n  columnName,\n  timeRange,\n  datasource,\n  onChange,\n}: DatePickerInFilterProps): React.ReactElement | undefined => {\n  const onTimeRangeChange = (val: string) => onChange(columnName, val);\n\n  return hasGenericChartAxes && isTemporalColumn(columnName, datasource) ? (\n    <>\n      <ControlHeader label={t('Time Range')} />\n      <DateFilterControl\n        value={timeRange}\n        name=\"time_range\"\n        onChange={onTimeRangeChange}\n        overlayStyle=\"Modal\"\n      />\n    </>\n  ) : undefined;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  isFreeFormAdhocFilter,\n  isSimpleAdhocFilter,\n  SimpleAdhocFilter,\n} from '@superset-ui/core';\nimport {\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n  Operators,\n} from 'src/explore/constants';\nimport { getSimpleSQLExpression } from 'src/explore/exploreUtils';\n\nexport const OPERATORS_TO_SQL = {\n  '==': '=',\n  '!=': '<>',\n  '>': '>',\n  '<': '<',\n  '>=': '>=',\n  '<=': '<=',\n  IN: 'IN',\n  'NOT IN': 'NOT IN',\n  LIKE: 'LIKE',\n  ILIKE: 'ILIKE',\n  REGEX: 'REGEX',\n  'IS NOT NULL': 'IS NOT NULL',\n  'IS NULL': 'IS NULL',\n  'IS TRUE': 'IS TRUE',\n  'IS FALSE': 'IS FALSE',\n  'LATEST PARTITION': ({\n    datasource,\n  }: {\n    datasource: { schema: string; datasource_name: string };\n  }) =>\n    `= '{{ presto.latest_partition('${datasource.schema}.${datasource.datasource_name}') }}'`,\n};\n\nexport const translateToSql = (\n  adhocFilter: AdhocFilter,\n  { useSimple }: { useSimple: boolean } = { useSimple: false },\n) => {\n  if (isSimpleAdhocFilter(adhocFilter) || useSimple) {\n    const { subject, operator } = adhocFilter as SimpleAdhocFilter;\n    const comparator =\n      'comparator' in adhocFilter ? adhocFilter.comparator : undefined;\n    const op =\n      operator &&\n      // 'LATEST PARTITION' supported callback only\n      operator ===\n        OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.LATEST_PARTITION].operation\n        ? OPERATORS_TO_SQL[operator](adhocFilter)\n        : OPERATORS_TO_SQL[operator];\n    return getSimpleSQLExpression(subject, op, comparator);\n  }\n  if (isFreeFormAdhocFilter(adhocFilter)) {\n    return adhocFilter.sqlExpression;\n  }\n  return '';\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport { useDrag, useDrop, DropTargetMonitor } from 'react-dnd';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport { StyledMetricOption } from '../../optionRenderers';\n\nexport const DragContainer = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n  :last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const OptionControlContainer = styled.div<{\n  withCaret?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  background-color: ${({ theme }) => theme.colors.grayscale.light3};\n  border-radius: 3px;\n  cursor: ${({ withCaret }) => (withCaret ? 'pointer' : 'default')};\n`;\nexport const Label = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${theme.gridUnit}px;\n    svg {\n      margin-right: ${theme.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${theme.gridUnit * 2}px;\n      margin-left: ${theme.gridUnit}px;\n      font-weight: ${theme.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}\n`;\n\nconst LabelText = styled.span`\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nexport const CaretContainer = styled.div`\n  height: 100%;\n  border-left: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  margin-left: auto;\n`;\n\nexport const CloseContainer = styled.div`\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 6}px;\n  border-right: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  cursor: pointer;\n`;\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const HeaderContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nexport const LabelsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: solid 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const DndLabelsContainer = styled.div<{\n  canDrop?: boolean;\n  isOver?: boolean;\n}>`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: ${({ canDrop, isOver, theme }) => {\n    if (canDrop) {\n      return `dashed 1px ${theme.colors.info.dark1}`;\n    }\n    if (isOver && !canDrop) {\n      return `dashed 1px ${theme.colors.error.dark1}`;\n    }\n    return `solid 1px ${theme.colors.grayscale.light2}`;\n  }};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const AddControlLabel = styled.div<{\n  cancelHover?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n  border: dashed 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n  cursor: ${({ cancelHover }) => (cancelHover ? 'inherit' : 'pointer')};\n\n  :hover {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light4};\n  }\n\n  :active {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light3};\n  }\n`;\n\nexport const AddIconButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: ${({ theme }) => theme.gridUnit * 4}px;\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n  padding: 0;\n  background-color: ${({ theme }) => theme.colors.primary.dark1};\n  border: none;\n  border-radius: 2px;\n\n  :disabled {\n    cursor: not-allowed;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\ninterface DragItem {\n  index: number;\n  type: string;\n}\n\nexport const OptionControlLabel = ({\n  label,\n  savedMetric,\n  adhocMetric,\n  onRemove,\n  onMoveLabel,\n  onDropLabel,\n  withCaret,\n  isFunction,\n  type,\n  index,\n  isExtra,\n  datasourceWarningMessage,\n  tooltipTitle,\n  multi = true,\n  ...props\n}: {\n  label: string | React.ReactNode;\n  savedMetric?: savedMetricType;\n  adhocMetric?: AdhocMetric;\n  onRemove: () => void;\n  onMoveLabel: (dragIndex: number, hoverIndex: number) => void;\n  onDropLabel: () => void;\n  withCaret?: boolean;\n  isFunction?: boolean;\n  isDraggable?: boolean;\n  type: string;\n  index: number;\n  isExtra?: boolean;\n  datasourceWarningMessage?: string;\n  tooltipTitle?: string;\n  multi?: boolean;\n}) => {\n  const theme = useTheme();\n  const ref = useRef<HTMLDivElement>(null);\n  const labelRef = useRef<HTMLDivElement>(null);\n  const hasMetricName = savedMetric?.metric_name;\n  const [, drop] = useDrop({\n    accept: type,\n    drop() {\n      if (!multi) {\n        return;\n      }\n      onDropLabel?.();\n    },\n    hover(item: DragItem, monitor: DropTargetMonitor) {\n      if (!multi) {\n        return;\n      }\n      if (!ref.current) {\n        return;\n      }\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset?.y\n        ? clientOffset?.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n      // Time to actually perform the action\n      onMoveLabel?.(dragIndex, hoverIndex);\n      // Note: we're mutating the monitor item here!\n      // Generally it's better to avoid mutations,\n      // but it's good here for the sake of performance\n      // to avoid expensive index searches.\n      // eslint-disable-next-line no-param-reassign\n      item.index = hoverIndex;\n    },\n  });\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type,\n      index,\n      value: savedMetric?.metric_name ? savedMetric : adhocMetric,\n    },\n    collect: monitor => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const getLabelContent = () => {\n    const shouldShowTooltip =\n      (!isDragging &&\n        typeof label === 'string' &&\n        tooltipTitle &&\n        label &&\n        tooltipTitle !== label) ||\n      (!isDragging &&\n        labelRef &&\n        labelRef.current &&\n        labelRef.current.scrollWidth > labelRef.current.clientWidth);\n\n    if (savedMetric && hasMetricName) {\n      return (\n        <StyledMetricOption\n          metric={savedMetric}\n          labelRef={labelRef}\n          shouldShowTooltip={!isDragging}\n        />\n      );\n    }\n    if (!shouldShowTooltip) {\n      return <LabelText ref={labelRef}>{label}</LabelText>;\n    }\n    return (\n      <Tooltip title={tooltipTitle || label}>\n        <LabelText ref={labelRef}>{label}</LabelText>\n      </Tooltip>\n    );\n  };\n\n  const getOptionControlContent = () => (\n    <OptionControlContainer\n      withCaret={withCaret}\n      data-test=\"option-label\"\n      {...props}\n    >\n      <CloseContainer\n        role=\"button\"\n        data-test=\"remove-control-button\"\n        onClick={onRemove}\n      >\n        <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n      </CloseContainer>\n      <Label data-test=\"control-label\">\n        {isFunction && <Icons.FieldDerived />}\n        {getLabelContent()}\n      </Label>\n      {(!!datasourceWarningMessage || isExtra) && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={\n            datasourceWarningMessage ||\n            t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)\n          }\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n\n  drag(drop(ref));\n  return <DragContainer ref={ref}>{getOptionControlContent()}</DragContainer>;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { legacyValidateNumber, legacyValidateInteger } from '@superset-ui/core';\nimport debounce from 'lodash/debounce';\nimport { FAST_DEBOUNCE } from 'src/constants';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Input } from 'src/components/Input';\n\ntype InputValueType = string | number;\n\nexport interface TextControlProps<T extends InputValueType = InputValueType> {\n  label?: string;\n  disabled?: boolean;\n  isFloat?: boolean;\n  isInt?: boolean;\n  onChange?: (value: T, errors: any) => {};\n  onFocus?: () => {};\n  placeholder?: string;\n  value?: T | null;\n  controlId?: string;\n  renderTrigger?: boolean;\n}\n\nexport interface TextControlState {\n  value: string;\n}\n\nconst safeStringify = (value?: InputValueType | null) =>\n  value == null ? '' : String(value);\n\nexport default class TextControl<\n  T extends InputValueType = InputValueType,\n> extends React.Component<TextControlProps<T>, TextControlState> {\n  initialValue?: TextControlProps['value'];\n\n  constructor(props: TextControlProps<T>) {\n    super(props);\n    this.initialValue = props.value;\n    this.state = {\n      value: safeStringify(this.initialValue),\n    };\n  }\n\n  onChange = (inputValue: string) => {\n    let parsedValue: InputValueType = inputValue;\n    // Validation & casting\n    const errors = [];\n    if (inputValue !== '' && this.props.isFloat) {\n      const error = legacyValidateNumber(inputValue);\n      if (error) {\n        errors.push(error);\n      } else {\n        parsedValue = inputValue.match(/.*([.0])$/g)\n          ? inputValue\n          : parseFloat(inputValue);\n      }\n    }\n    if (inputValue !== '' && this.props.isInt) {\n      const error = legacyValidateInteger(inputValue);\n      if (error) {\n        errors.push(error);\n      } else {\n        parsedValue = parseInt(inputValue, 10);\n      }\n    }\n    this.props.onChange?.(parsedValue as T, errors);\n  };\n\n  debouncedOnChange = debounce((inputValue: string) => {\n    this.onChange(inputValue);\n  }, FAST_DEBOUNCE);\n\n  onChangeWrapper = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.target;\n    this.setState({ value }, () => {\n      this.debouncedOnChange(value);\n    });\n  };\n\n  render() {\n    let { value } = this.state;\n    if (this.initialValue !== this.props.value) {\n      this.initialValue = this.props.value;\n      value = safeStringify(this.props.value);\n    }\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Input\n          type=\"text\"\n          data-test=\"inline-name\"\n          placeholder={this.props.placeholder}\n          onChange={this.onChangeWrapper}\n          onFocus={this.props.onFocus}\n          value={value}\n          disabled={this.props.disabled}\n          aria-label={this.props.label}\n        />\n      </div>\n    );\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport SyntaxHighlighter from 'react-syntax-highlighter/dist/cjs/light';\nimport github from 'react-syntax-highlighter/dist/cjs/styles/hljs/github';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { CopyButton } from 'src/explore/components/DataTableControl';\nimport markdownSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/markdown';\nimport htmlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/htmlbars';\nimport sqlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/sql';\nimport jsonSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/json';\n\nconst CopyButtonViewQuery = styled(CopyButton)`\n  && {\n    margin: 0 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nSyntaxHighlighter.registerLanguage('markdown', markdownSyntax);\nSyntaxHighlighter.registerLanguage('html', htmlSyntax);\nSyntaxHighlighter.registerLanguage('sql', sqlSyntax);\nSyntaxHighlighter.registerLanguage('json', jsonSyntax);\n\ninterface ViewQueryProps {\n  sql: string;\n  language?: string;\n}\n\nconst StyledSyntaxContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst StyledSyntaxHighlighter = styled(SyntaxHighlighter)`\n  flex: 1;\n`;\n\nconst ViewQuery: React.FC<ViewQueryProps> = props => {\n  const { sql, language = 'sql' } = props;\n  return (\n    <StyledSyntaxContainer key={sql}>\n      <CopyToClipboard\n        text={sql}\n        shouldShowText={false}\n        copyNode={\n          <CopyButtonViewQuery buttonSize=\"xsmall\">\n            <i className=\"fa fa-clipboard\" />\n          </CopyButtonViewQuery>\n        }\n      />\n      <StyledSyntaxHighlighter language={language} style={github}>\n        {sql}\n      </StyledSyntaxHighlighter>\n    </StyledSyntaxContainer>\n  );\n};\n\nexport default ViewQuery;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ChangeEventHandler,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport Fuse from 'fuse.js';\nimport cx from 'classnames';\nimport {\n  t,\n  styled,\n  css,\n  ChartMetadata,\n  SupersetTheme,\n  useTheme,\n  chartLabelWeight,\n  chartLabelExplanations,\n} from '@superset-ui/core';\nimport { AntdCollapse } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Input } from 'src/components/Input';\nimport Label from 'src/components/Label';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Icons from 'src/components/Icons';\nimport { nativeFilterGate } from 'src/dashboard/components/nativeFilters/utils';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\ninterface VizTypeGalleryProps {\n  onChange: (vizType: string | null) => void;\n  onDoubleClick: () => void;\n  selectedViz: string | null;\n  className?: string;\n  denyList: string[];\n}\n\ntype VizEntry = {\n  key: string;\n  value: ChartMetadata;\n};\n\nenum SECTIONS {\n  ALL_CHARTS = 'ALL_CHARTS',\n  CATEGORY = 'CATEGORY',\n  TAGS = 'TAGS',\n  RECOMMENDED_TAGS = 'RECOMMENDED_TAGS',\n}\n\nconst DEFAULT_ORDER = [\n  'line',\n  'big_number',\n  'big_number_total',\n  'table',\n  'pivot_table_v2',\n  'echarts_timeseries_line',\n  'echarts_area',\n  'echarts_timeseries_bar',\n  'echarts_timeseries_scatter',\n  'pie',\n  'mixed_timeseries',\n  'filter_box',\n  'dist_bar',\n  'area',\n  'bar',\n  'deck_polygon',\n  'time_table',\n  'histogram',\n  'deck_scatter',\n  'deck_hex',\n  'time_pivot',\n  'deck_arc',\n  'heatmap',\n  'deck_grid',\n  'deck_screengrid',\n  'treemap_v2',\n  'box_plot',\n  'sunburst',\n  'sankey',\n  'word_cloud',\n  'mapbox',\n  'kepler',\n  'cal_heatmap',\n  'rose',\n  'bubble',\n  'deck_geojson',\n  'horizon',\n  'deck_multi',\n  'compare',\n  'partition',\n  'event_flow',\n  'deck_path',\n  'graph_chart',\n  'world_map',\n  'paired_ttest',\n  'para',\n  'country_map',\n];\n\nconst typesWithDefaultOrder = new Set(DEFAULT_ORDER);\n\nconst THUMBNAIL_GRID_UNITS = 24;\n\nexport const MAX_ADVISABLE_VIZ_GALLERY_WIDTH = 1090;\n\nconst OTHER_CATEGORY = t('Other');\n\nconst ALL_CHARTS = t('All charts');\n\nconst RECOMMENDED_TAGS = [t('Popular'), t('ECharts'), t('Advanced-Analytics')];\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nconst VizPickerLayout = styled.div<{ isSelectedVizMetadata: boolean }>`\n  ${({ isSelectedVizMetadata }) => `\n    display: grid;\n    grid-template-rows: ${\n      isSelectedVizMetadata\n        ? `auto minmax(100px, 1fr) minmax(200px, 35%)`\n        : 'auto minmax(100px, 1fr)'\n    };\n    // em is used here because the sidebar should be sized to fit the longest standard tag\n    grid-template-columns: minmax(14em, auto) 5fr;\n    grid-template-areas:\n      'sidebar search'\n      'sidebar main'\n      'details details';\n    height: 70vh;\n    overflow: auto;\n  `}\n`;\n\nconst SectionTitle = styled.h3`\n  margin-top: 0;\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  font-size: ${({ theme }) => theme.typography.sizes.l}px;\n  font-weight: ${({ theme }) => theme.typography.weights.bold};\n  line-height: ${({ theme }) => theme.gridUnit * 6}px;\n`;\n\nconst LeftPane = styled.div`\n  grid-area: sidebar;\n  display: flex;\n  flex-direction: column;\n  border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  overflow: auto;\n\n  .ant-collapse .ant-collapse-item {\n    .ant-collapse-header {\n      font-size: ${({ theme }) => theme.typography.sizes.s}px;\n      color: ${({ theme }) => theme.colors.grayscale.base};\n      padding-left: ${({ theme }) => theme.gridUnit * 2}px;\n      padding-bottom: ${({ theme }) => theme.gridUnit}px;\n    }\n    .ant-collapse-content .ant-collapse-content-box {\n      display: flex;\n      flex-direction: column;\n      padding: 0 ${({ theme }) => theme.gridUnit * 2}px;\n    }\n  }\n`;\n\nconst RightPane = styled.div`\n  grid-area: main;\n  overflow-y: auto;\n`;\n\nconst SearchWrapper = styled.div`\n  ${({ theme }) => `\n    grid-area: search;\n    margin-top: ${theme.gridUnit * 3}px;\n    margin-bottom: ${theme.gridUnit}px;\n    margin-left: ${theme.gridUnit * 3}px;\n    margin-right: ${theme.gridUnit * 3}px;\n    .ant-input-affix-wrapper {\n      padding-left: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\n/** Styles to line up prefix/suffix icons in the search input */\nconst InputIconAlignment = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n`;\n\nconst SelectorLabel = styled.button`\n  ${({ theme }) => `\n    all: unset; // remove default button styles\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    margin: ${theme.gridUnit}px 0;\n    padding: 0 ${theme.gridUnit}px;\n    border-radius: ${theme.borderRadius}px;\n    line-height: 2em;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    position: relative;\n\n    &:focus {\n      outline: initial;\n    }\n\n    &.selected {\n      background-color: ${theme.colors.primary.base};\n      color: ${theme.colors.primary.light5};\n\n      svg {\n        color: ${theme.colors.primary.light5};\n      }\n\n      &:hover {\n        .cancel {\n          visibility: visible;\n        }\n      }\n    }\n\n    & span:first-of-type svg {\n      margin-top: ${theme.gridUnit * 1.5}px;\n    }\n\n    .cancel {\n      visibility: hidden;\n    }\n  `}\n`;\n\nconst IconsPane = styled.div`\n  overflow: auto;\n  display: grid;\n  grid-template-columns: repeat(\n    auto-fill,\n    ${({ theme }) => theme.gridUnit * THUMBNAIL_GRID_UNITS}px\n  );\n  grid-auto-rows: max-content;\n  justify-content: space-evenly;\n  grid-gap: ${({ theme }) => theme.gridUnit * 2}px;\n  justify-items: center;\n  // for some reason this padding doesn't seem to apply at the bottom of the container. Why is a mystery.\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst DetailsPane = (theme: SupersetTheme) => css`\n  grid-area: details;\n  border-top: 1px solid ${theme.colors.grayscale.light2};\n`;\n\nconst DetailsPopulated = (theme: SupersetTheme) => css`\n  padding: ${theme.gridUnit * 4}px;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: auto auto 1fr;\n  grid-template-areas:\n    'viz-name examples-header'\n    'viz-tags examples'\n    'description examples';\n`;\n\n// overflow hidden on the details pane and overflow auto on the description\n// (plus grid layout) enables the description to scroll while the header stays in place.\nconst TagsWrapper = styled.div`\n  grid-area: viz-tags;\n  width: ${({ theme }) => theme.gridUnit * 120}px;\n  padding-right: ${({ theme }) => theme.gridUnit * 14}px;\n  padding-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst Description = styled.p`\n  grid-area: description;\n  overflow: auto;\n  padding-right: ${({ theme }) => theme.gridUnit * 14}px;\n  margin: 0;\n`;\n\nconst Examples = styled.div`\n  grid-area: examples;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  overflow: auto;\n  gap: ${({ theme }) => theme.gridUnit * 4}px;\n\n  img {\n    height: 100%;\n    border-radius: ${({ theme }) => theme.gridUnit}px;\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n`;\n\nconst thumbnailContainerCss = (theme: SupersetTheme) => css`\n  cursor: pointer;\n  width: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n  position: relative;\n\n  img {\n    min-width: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n    min-height: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n    border: 1px solid ${theme.colors.grayscale.light2};\n    border-radius: ${theme.gridUnit}px;\n    transition: border-color ${theme.transitionTiming};\n  }\n\n  &.selected img {\n    border: 2px solid ${theme.colors.primary.light2};\n  }\n\n  &:hover:not(.selected) img {\n    border: 1px solid ${theme.colors.grayscale.light1};\n  }\n\n  .viztype-label {\n    margin-top: ${theme.gridUnit * 2}px;\n    text-align: center;\n  }\n`;\n\nconst HighlightLabel = styled.div`\n  ${({ theme }) => `\n    border: 1px solid ${theme.colors.primary.dark1};\n    box-sizing: border-box;\n    border-radius: ${theme.gridUnit}px;\n    background: ${theme.colors.grayscale.light5};\n    line-height: ${theme.gridUnit * 2.5}px;\n    color: ${theme.colors.primary.dark1};\n    font-size: ${theme.typography.sizes.s}px;\n    font-weight: ${theme.typography.weights.bold};\n    text-align: center;\n    padding: ${theme.gridUnit * 0.5}px ${theme.gridUnit}px;\n    text-transform: uppercase;\n    cursor: pointer;\n\n    div {\n      transform: scale(0.83,0.83);\n    }\n  `}\n`;\n\nconst ThumbnailLabelWrapper = styled.div`\n  position: absolute;\n  right: ${({ theme }) => theme.gridUnit}px;\n  top: ${({ theme }) => theme.gridUnit * 19}px;\n`;\n\nconst TitleLabelWrapper = styled.div`\n  display: inline-block !important;\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nfunction vizSortFactor(entry: VizEntry) {\n  if (typesWithDefaultOrder.has(entry.key)) {\n    return DEFAULT_ORDER.indexOf(entry.key);\n  }\n  return DEFAULT_ORDER.length;\n}\n\ninterface ThumbnailProps {\n  entry: VizEntry;\n  selectedViz: string | null;\n  setSelectedViz: (viz: string) => void;\n  onDoubleClick: () => void;\n}\n\nconst Thumbnail: React.FC<ThumbnailProps> = ({\n  entry,\n  selectedViz,\n  setSelectedViz,\n  onDoubleClick,\n}) => {\n  const theme = useTheme();\n  const { key, value: type } = entry;\n  const isSelected = selectedViz === entry.key;\n\n  return (\n    <div\n      role=\"button\"\n      // using css instead of a styled component to preserve\n      // the data-test attribute\n      css={thumbnailContainerCss(theme)}\n      tabIndex={0}\n      className={isSelected ? 'selected' : ''}\n      onClick={() => setSelectedViz(key)}\n      onDoubleClick={onDoubleClick}\n      data-test=\"viztype-selector-container\"\n    >\n      <img\n        alt={type.name}\n        width=\"100%\"\n        className={`viztype-selector ${isSelected ? 'selected' : ''}`}\n        src={type.thumbnail}\n      />\n      <div\n        className=\"viztype-label\"\n        data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viztype-label`}\n      >\n        {type.name}\n      </div>\n      {type.label && (\n        <ThumbnailLabelWrapper>\n          <HighlightLabel>\n            <div>{t(type.label)}</div>\n          </HighlightLabel>\n        </ThumbnailLabelWrapper>\n      )}\n    </div>\n  );\n};\n\ninterface ThumbnailGalleryProps {\n  vizEntries: VizEntry[];\n  selectedViz: string | null;\n  setSelectedViz: (viz: string) => void;\n  onDoubleClick: () => void;\n}\n\n/** A list of viz thumbnails, used within the viz picker modal */\nconst ThumbnailGallery: React.FC<ThumbnailGalleryProps> = ({\n  vizEntries,\n  ...props\n}) => (\n  <IconsPane data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viz-row`}>\n    {vizEntries.map(entry => (\n      <Thumbnail key={entry.key} {...props} entry={entry} />\n    ))}\n  </IconsPane>\n);\n\nconst Selector: React.FC<{\n  selector: string;\n  sectionId: string;\n  icon: JSX.Element;\n  isSelected: boolean;\n  onClick: (selector: string, sectionId: string) => void;\n  className?: string;\n}> = ({ selector, sectionId, icon, isSelected, onClick, className }) => {\n  const btnRef = useRef<HTMLButtonElement>(null);\n\n  // see Element.scrollIntoViewIfNeeded()\n  // see: https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoViewIfNeeded\n  useEffect(() => {\n    if (isSelected) {\n      // We need to wait for the modal to open and then scroll, so we put it in the microtask queue\n      queueMicrotask(() =>\n        scrollIntoView(btnRef.current as HTMLButtonElement, {\n          behavior: 'smooth',\n          scrollMode: 'if-needed',\n        }),\n      );\n    }\n  }, []);\n\n  return (\n    <SelectorLabel\n      ref={btnRef}\n      key={selector}\n      name={selector}\n      className={cx(className, isSelected && 'selected')}\n      onClick={() => onClick(selector, sectionId)}\n    >\n      {icon}\n      {selector}\n    </SelectorLabel>\n  );\n};\n\nconst doesVizMatchSelector = (viz: ChartMetadata, selector: string) =>\n  selector === viz.category ||\n  (selector === OTHER_CATEGORY && viz.category == null) ||\n  (viz.tags || []).indexOf(selector) > -1;\n\nexport default function VizTypeGallery(props: VizTypeGalleryProps) {\n  const { selectedViz, onChange, onDoubleClick, className } = props;\n  const { mountedPluginMetadata } = usePluginContext();\n  const searchInputRef = useRef<HTMLInputElement>();\n  const [searchInputValue, setSearchInputValue] = useState('');\n  const [isSearchFocused, setIsSearchFocused] = useState(true);\n  const isActivelySearching = isSearchFocused && !!searchInputValue;\n\n  const selectedVizMetadata: ChartMetadata | null = selectedViz\n    ? mountedPluginMetadata[selectedViz]\n    : null;\n\n  const chartMetadata: VizEntry[] = useMemo(() => {\n    const result = Object.entries(mountedPluginMetadata)\n      .map(([key, value]) => ({ key, value }))\n      .filter(({ key }) => !props.denyList.includes(key))\n      .filter(\n        ({ value }) =>\n          nativeFilterGate(value.behaviors || []) && !value.deprecated,\n      );\n    result.sort((a, b) => vizSortFactor(a) - vizSortFactor(b));\n    return result;\n  }, [mountedPluginMetadata]);\n\n  const chartsByCategory = useMemo(() => {\n    const result: Record<string, VizEntry[]> = {};\n    chartMetadata.forEach(entry => {\n      const category = entry.value.category || OTHER_CATEGORY;\n      if (!result[category]) {\n        result[category] = [];\n      }\n      result[category].push(entry);\n    });\n    return result;\n  }, [chartMetadata]);\n\n  const categories = useMemo(\n    () =>\n      Object.keys(chartsByCategory).sort((a, b) => {\n        // make sure Other goes at the end\n        if (a === OTHER_CATEGORY) return 1;\n        if (b === OTHER_CATEGORY) return -1;\n        // sort alphabetically\n        return a.localeCompare(b);\n      }),\n    [chartsByCategory],\n  );\n\n  const chartsByTags = useMemo(() => {\n    const result: Record<string, VizEntry[]> = {};\n    chartMetadata.forEach(entry => {\n      const tags = entry.value.tags || [];\n      tags.forEach(tag => {\n        if (!result[tag]) {\n          result[tag] = [];\n        }\n        result[tag].push(entry);\n      });\n    });\n    return result;\n  }, [chartMetadata]);\n\n  const tags = useMemo(\n    () =>\n      Object.keys(chartsByTags)\n        .sort((a, b) =>\n          // sort alphabetically\n          a.localeCompare(b),\n        )\n        .filter(tag => RECOMMENDED_TAGS.indexOf(tag) === -1),\n    [chartsByTags],\n  );\n\n  const sortedMetadata = useMemo(\n    () => chartMetadata.sort((a, b) => a.key.localeCompare(b.key)),\n    [chartMetadata],\n  );\n\n  const [activeSelector, setActiveSelector] = useState<string>(\n    () => selectedVizMetadata?.category || RECOMMENDED_TAGS[0],\n  );\n\n  const [activeSection, setActiveSection] = useState<string>(() =>\n    selectedVizMetadata?.category\n      ? SECTIONS.CATEGORY\n      : SECTIONS.RECOMMENDED_TAGS,\n  );\n\n  // get a fuse instance for fuzzy search\n  const fuse = useMemo(\n    () =>\n      new Fuse(chartMetadata, {\n        ignoreLocation: true,\n        threshold: 0.3,\n        keys: [\n          {\n            name: 'value.name',\n            weight: 4,\n          },\n          {\n            name: 'value.tags',\n            weight: 2,\n          },\n          'value.description',\n        ],\n      }),\n    [chartMetadata],\n  );\n\n  const searchResults = useMemo(() => {\n    if (searchInputValue.trim() === '') {\n      return [];\n    }\n    return fuse\n      .search(searchInputValue)\n      .map(result => result.item)\n      .sort((a, b) => {\n        const aLabel = a.value?.label;\n        const bLabel = b.value?.label;\n        const aOrder =\n          aLabel && chartLabelWeight[aLabel]\n            ? chartLabelWeight[aLabel].weight\n            : 0;\n        const bOrder =\n          bLabel && chartLabelWeight[bLabel]\n            ? chartLabelWeight[bLabel].weight\n            : 0;\n        return bOrder - aOrder;\n      });\n  }, [searchInputValue, fuse]);\n\n  const focusSearch = useCallback(() => {\n    // \"start searching\" is actually a two-stage process.\n    // When you first click on the search bar, the input is focused and nothing else happens.\n    // Once you begin typing, the selected category is cleared and the displayed viz entries change.\n    setIsSearchFocused(true);\n  }, []);\n\n  const changeSearch: ChangeEventHandler<HTMLInputElement> = useCallback(\n    event => setSearchInputValue(event.target.value),\n    [],\n  );\n\n  const stopSearching = useCallback(() => {\n    // stopping a search takes you back to the category you were looking at before.\n    // Unlike focusSearch, this is a simple one-step process.\n    setIsSearchFocused(false);\n    setSearchInputValue('');\n    searchInputRef.current!.blur();\n  }, []);\n\n  const clickSelector = useCallback(\n    (selector: string, sectionId: string) => {\n      if (isSearchFocused) {\n        stopSearching();\n      }\n      setActiveSelector(selector);\n      setActiveSection(sectionId);\n      // clear the selected viz if it is not present in the new category or tags\n      const isSelectedVizCompatible =\n        selectedVizMetadata &&\n        doesVizMatchSelector(selectedVizMetadata, selector);\n      if (selector !== activeSelector && !isSelectedVizCompatible) {\n        onChange(null);\n      }\n    },\n    [\n      stopSearching,\n      isSearchFocused,\n      activeSelector,\n      selectedVizMetadata,\n      onChange,\n    ],\n  );\n\n  const sectionMap = useMemo(\n    () => ({\n      [SECTIONS.RECOMMENDED_TAGS]: {\n        title: t('Recommended tags'),\n        icon: <Icons.Tags />,\n        selectors: RECOMMENDED_TAGS,\n      },\n      [SECTIONS.CATEGORY]: {\n        title: t('Category'),\n        icon: <Icons.Category />,\n        selectors: categories,\n      },\n      [SECTIONS.TAGS]: {\n        title: t('Tags'),\n        icon: <Icons.Tags />,\n        selectors: tags,\n      },\n    }),\n    [categories, tags],\n  );\n\n  const getVizEntriesToDisplay = () => {\n    if (isActivelySearching) {\n      return searchResults;\n    }\n    if (\n      activeSelector === ALL_CHARTS &&\n      activeSection === SECTIONS.ALL_CHARTS\n    ) {\n      return sortedMetadata;\n    }\n    if (\n      activeSection === SECTIONS.CATEGORY &&\n      chartsByCategory[activeSelector]\n    ) {\n      return chartsByCategory[activeSelector];\n    }\n    if (\n      (activeSection === SECTIONS.TAGS ||\n        activeSection === SECTIONS.RECOMMENDED_TAGS) &&\n      chartsByTags[activeSelector]\n    ) {\n      return chartsByTags[activeSelector];\n    }\n    return [];\n  };\n\n  return (\n    <VizPickerLayout\n      className={className}\n      isSelectedVizMetadata={Boolean(selectedVizMetadata)}\n    >\n      <LeftPane>\n        <Selector\n          css={({ gridUnit }) =>\n            // adjust style for not being inside a collapse\n            css`\n              margin: ${gridUnit * 2}px;\n              margin-bottom: 0;\n            `\n          }\n          sectionId={SECTIONS.ALL_CHARTS}\n          selector={ALL_CHARTS}\n          icon={<Icons.Ballot />}\n          isSelected={\n            !isActivelySearching &&\n            ALL_CHARTS === activeSelector &&\n            SECTIONS.ALL_CHARTS === activeSection\n          }\n          onClick={clickSelector}\n        />\n        <AntdCollapse\n          expandIconPosition=\"right\"\n          ghost\n          defaultActiveKey={Object.keys(sectionMap)}\n        >\n          {Object.keys(sectionMap).map(sectionId => {\n            const section = sectionMap[sectionId];\n\n            return (\n              <AntdCollapse.Panel\n                header={<span className=\"header\">{section.title}</span>}\n                key={sectionId}\n              >\n                {section.selectors.map((selector: string) => (\n                  <Selector\n                    key={selector}\n                    selector={selector}\n                    sectionId={sectionId}\n                    icon={section.icon}\n                    isSelected={\n                      !isActivelySearching &&\n                      selector === activeSelector &&\n                      sectionId === activeSection\n                    }\n                    onClick={clickSelector}\n                  />\n                ))}\n              </AntdCollapse.Panel>\n            );\n          })}\n        </AntdCollapse>\n      </LeftPane>\n\n      <SearchWrapper>\n        <Input\n          type=\"text\"\n          ref={searchInputRef as any /* cast required because emotion */}\n          value={searchInputValue}\n          placeholder={t('Search all charts')}\n          onChange={changeSearch}\n          onFocus={focusSearch}\n          data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__search-input`}\n          prefix={\n            <InputIconAlignment>\n              <Icons.Search iconSize=\"m\" />\n            </InputIconAlignment>\n          }\n          suffix={\n            <InputIconAlignment>\n              {searchInputValue && (\n                <Icons.XLarge iconSize=\"m\" onClick={stopSearching} />\n              )}\n            </InputIconAlignment>\n          }\n        />\n      </SearchWrapper>\n\n      <RightPane>\n        <ThumbnailGallery\n          vizEntries={getVizEntriesToDisplay()}\n          selectedViz={selectedViz}\n          setSelectedViz={onChange}\n          onDoubleClick={onDoubleClick}\n        />\n      </RightPane>\n\n      {selectedVizMetadata ? (\n        <div\n          css={(theme: SupersetTheme) => [\n            DetailsPane(theme),\n            DetailsPopulated(theme),\n          ]}\n        >\n          <>\n            <SectionTitle\n              css={css`\n                grid-area: viz-name;\n                position: relative;\n              `}\n            >\n              {selectedVizMetadata?.name}\n              {selectedVizMetadata?.label && (\n                <Tooltip\n                  id=\"viz-badge-tooltip\"\n                  placement=\"top\"\n                  title={\n                    selectedVizMetadata.labelExplanation ??\n                    chartLabelExplanations[selectedVizMetadata.label]\n                  }\n                >\n                  <TitleLabelWrapper>\n                    <HighlightLabel>\n                      <div>{t(selectedVizMetadata.label)}</div>\n                    </HighlightLabel>\n                  </TitleLabelWrapper>\n                </Tooltip>\n              )}\n            </SectionTitle>\n            <TagsWrapper>\n              {selectedVizMetadata?.tags.map(tag => (\n                <Label key={tag}>{tag}</Label>\n              ))}\n            </TagsWrapper>\n            <Description>\n              {selectedVizMetadata?.description ||\n                t('No description available.')}\n            </Description>\n            <SectionTitle\n              css={css`\n                grid-area: examples-header;\n              `}\n            >\n              {!!selectedVizMetadata?.exampleGallery?.length && t('Examples')}\n            </SectionTitle>\n            <Examples>\n              {(selectedVizMetadata?.exampleGallery || []).map(example => (\n                <img\n                  src={example.url}\n                  alt={example.caption}\n                  title={example.caption}\n                />\n              ))}\n            </Examples>\n          </>\n        </div>\n      ) : null}\n    </VizPickerLayout>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport {\n  MetricOption,\n  ColumnOption,\n  MetricOptionProps,\n  ColumnOptionProps,\n} from '@superset-ui/chart-controls';\n\nconst OptionContainer = styled.div`\n  width: 100%;\n  > span {\n    display: flex;\n    align-items: center;\n  }\n\n  .option-label {\n    display: inline-block;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    & ~ i {\n      margin-left: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n  .type-label {\n    margin-right: ${({ theme }) => theme.gridUnit * 3}px;\n    width: ${({ theme }) => theme.gridUnit * 7}px;\n    display: inline-block;\n    text-align: center;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n`;\n\nexport const StyledMetricOption = (props: MetricOptionProps) => (\n  <OptionContainer>\n    <MetricOption {...props} />\n  </OptionContainer>\n);\n\nexport const StyledColumnOption = (props: ColumnOptionProps) => (\n  <OptionContainer>\n    <ColumnOption {...props} />\n  </OptionContainer>\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nexport const AGGREGATES = {\n  AVG: 'AVG',\n  COUNT: 'COUNT',\n  COUNT_DISTINCT: 'COUNT_DISTINCT',\n  MAX: 'MAX',\n  MIN: 'MIN',\n  SUM: 'SUM',\n};\nexport const AGGREGATES_OPTIONS = Object.values(AGGREGATES);\n\nexport enum Operators {\n  EQUALS = 'EQUALS',\n  NOT_EQUALS = 'NOT_EQUALS',\n  LESS_THAN = 'LESS_THAN',\n  LESS_THAN_OR_EQUAL = 'LESS_THAN_OR_EQUAL',\n  GREATER_THAN = 'GREATER_THAN',\n  GREATER_THAN_OR_EQUAL = 'GREATER_THAN_OR_EQUAL',\n  IN = 'IN',\n  NOT_IN = 'NOT_IN',\n  LIKE = 'LIKE',\n  ILIKE = 'ILIKE',\n  IS_NOT_NULL = 'IS_NOT_NULL',\n  IS_NULL = 'IS_NULL',\n  LATEST_PARTITION = 'LATEST_PARTITION',\n  IS_TRUE = 'IS_TRUE',\n  IS_FALSE = 'IS_FALSE',\n  TEMPORAL_RANGE = 'TEMPORAL_RANGE',\n}\n\nexport interface OperatorType {\n  display: string;\n  operation: string;\n}\n\nexport const OPERATOR_ENUM_TO_OPERATOR_TYPE: {\n  [key in Operators]: OperatorType;\n} = {\n  [Operators.EQUALS]: { display: t('Equal to (=)'), operation: '==' },\n  [Operators.NOT_EQUALS]: { display: t('Not equal to ()'), operation: '!=' },\n  [Operators.LESS_THAN]: { display: t('Less than (<)'), operation: '<' },\n  [Operators.LESS_THAN_OR_EQUAL]: {\n    display: t('Less or equal (<=)'),\n    operation: '<=',\n  },\n  [Operators.GREATER_THAN]: { display: t('Greater than (>)'), operation: '>' },\n  [Operators.GREATER_THAN_OR_EQUAL]: {\n    display: t('Greater or equal (>=)'),\n    operation: '>=',\n  },\n  [Operators.IN]: { display: t('In'), operation: 'IN' },\n  [Operators.NOT_IN]: { display: t('Not in'), operation: 'NOT IN' },\n  [Operators.LIKE]: { display: t('Like'), operation: 'LIKE' },\n  [Operators.ILIKE]: {\n    display: t('Like (case insensitive)'),\n    operation: 'ILIKE',\n  },\n  [Operators.IS_NOT_NULL]: {\n    display: t('Is not null'),\n    operation: 'IS NOT NULL',\n  },\n  [Operators.IS_NULL]: { display: t('Is null'), operation: 'IS NULL' },\n  [Operators.LATEST_PARTITION]: {\n    display: t('use latest_partition template'),\n    operation: 'LATEST PARTITION',\n  },\n  [Operators.IS_TRUE]: { display: t('Is true'), operation: '==' },\n  [Operators.IS_FALSE]: { display: t('Is false'), operation: '==' },\n  [Operators.TEMPORAL_RANGE]: {\n    display: t('TEMPORAL_RANGE'),\n    operation: 'TEMPORAL_RANGE',\n  },\n};\n\nexport const OPERATORS_OPTIONS = Object.values(Operators) as Operators[];\n\nexport const TABLE_ONLY_OPERATORS = [Operators.LIKE, Operators.ILIKE];\nexport const HAVING_OPERATORS = [\n  Operators.EQUALS,\n  Operators.NOT_EQUALS,\n  Operators.LESS_THAN,\n  Operators.LESS_THAN_OR_EQUAL,\n  Operators.GREATER_THAN,\n  Operators.GREATER_THAN_OR_EQUAL,\n];\nexport const MULTI_OPERATORS = new Set([Operators.IN, Operators.NOT_IN]);\n// CUSTOM_OPERATORS will show operator in simple mode,\n// but will generate customized sqlExpression\nexport const CUSTOM_OPERATORS = new Set([\n  Operators.LATEST_PARTITION,\n  Operators.TEMPORAL_RANGE,\n]);\n// DISABLE_INPUT_OPERATORS will disable filter value input\n// in adhocFilter control\nexport const DISABLE_INPUT_OPERATORS = [\n  Operators.IS_NOT_NULL,\n  Operators.IS_NULL,\n  Operators.LATEST_PARTITION,\n  Operators.IS_TRUE,\n  Operators.IS_FALSE,\n];\n\nexport const sqlaAutoGeneratedMetricNameRegex =\n  /^(sum|min|max|avg|count|count_distinct)__.*$/i;\nexport const sqlaAutoGeneratedMetricRegex =\n  /^(LONG|DOUBLE|FLOAT)?(SUM|AVG|MAX|MIN|COUNT)\\([A-Z0-9_.\"]*\\)$/i;\n\nexport const TIME_FILTER_LABELS = {\n  time_range: t('Time range'),\n  granularity_sqla: t('Time column'),\n  time_grain_sqla: t('Time grain'),\n  granularity: t('Time granularity'),\n};\n\nexport const FILTER_CONFIG_ATTRIBUTES = {\n  CLEARABLE: 'clearable',\n  DEFAULT_VALUE: 'defaultValue',\n  MULTIPLE: 'multiple',\n  SEARCH_ALL_OPTIONS: 'searchAllOptions',\n  SORT_ASCENDING: 'asc',\n  SORT_METRIC: 'metric',\n};\n\nexport const FILTER_OPTIONS_LIMIT = 1000;\n\n/**\n * Map control names to their key in extra_filters\n */\nexport const TIME_FILTER_MAP = {\n  time_range: '__time_range',\n  granularity_sqla: '__time_col',\n  time_grain_sqla: '__time_grain',\n  granularity: '__granularity',\n};\n\nexport const POPOVER_INITIAL_HEIGHT = 240;\nexport const POPOVER_INITIAL_WIDTH = 320;\nexport const UNSAVED_CHART_ID = 0;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { ControlPanelSectionConfig } from '@superset-ui/chart-controls';\n\nexport const datasourceAndVizType: ControlPanelSectionConfig = {\n  controlSetRows: [\n    ['datasource'],\n    ['viz_type'],\n    [\n      {\n        name: 'slice_id',\n        config: {\n          type: 'HiddenControl',\n          label: t('Chart ID'),\n          hidden: true,\n          description: t('The id of the active chart'),\n        },\n      },\n      {\n        name: 'cache_timeout',\n        config: {\n          type: 'HiddenControl',\n          label: t('Cache Timeout (seconds)'),\n          hidden: true,\n          description: t('The number of seconds before expiring the cache'),\n        },\n      },\n      {\n        name: 'url_params',\n        config: {\n          type: 'HiddenControl',\n          label: t('URL parameters'),\n          hidden: true,\n          description: t('Extra parameters for use in jinja templated queries'),\n        },\n      },\n    ],\n  ],\n};\n\nexport const colorScheme: ControlPanelSectionConfig = {\n  label: t('Color scheme'),\n  controlSetRows: [['color_scheme']],\n};\n\nexport const sqlaTimeSeries: ControlPanelSectionConfig = {\n  label: t('Time'),\n  description: t('Time related form attributes'),\n  expanded: true,\n  controlSetRows: [['granularity_sqla'], ['time_range']],\n};\n\nexport const annotations: ControlPanelSectionConfig = {\n  label: t('Annotations and layers'),\n  tabOverride: 'data',\n  expanded: true,\n  controlSetRows: [\n    [\n      {\n        name: 'annotation_layers',\n        config: {\n          type: 'AnnotationLayerControl',\n          label: '',\n          default: [],\n          description: t('Annotation layers'),\n          renderTrigger: true,\n          tabOverride: 'data',\n        },\n      },\n    ],\n  ],\n};\n\nexport const NVD3TimeSeries: ControlPanelSectionConfig[] = [\n  {\n    label: t('Query'),\n    expanded: true,\n    controlSetRows: [\n      ['metrics'],\n      ['adhoc_filters'],\n      ['groupby'],\n      ['limit', 'timeseries_limit_metric'],\n      ['order_desc'],\n      [\n        {\n          name: 'contribution',\n          config: {\n            type: 'CheckboxControl',\n            label: t('Contribution'),\n            default: false,\n            description: t('Compute the contribution to the total'),\n          },\n        },\n      ],\n      ['row_limit', null],\n    ],\n  },\n  {\n    label: t('Advanced analytics'),\n    tabOverride: 'data',\n    description: t(\n      'This section contains options ' +\n        'that allow for advanced analytical post processing ' +\n        'of query results',\n    ),\n    controlSetRows: [\n      [<div className=\"section-header\">{t('Rolling window')}</div>],\n      [\n        {\n          name: 'rolling_type',\n          config: {\n            type: 'SelectControl',\n            label: t('Rolling function'),\n            default: 'None',\n            choices: [\n              ['None', t('None')],\n              ['mean', t('mean')],\n              ['sum', t('sum')],\n              ['std', t('std')],\n              ['cumsum', t('cumsum')],\n            ],\n            description: t(\n              'Defines a rolling window function to apply, works along ' +\n                'with the [Periods] text box',\n            ),\n          },\n        },\n        {\n          name: 'rolling_periods',\n          config: {\n            type: 'TextControl',\n            label: t('Periods'),\n            isInt: true,\n            description: t(\n              'Defines the size of the rolling window function, ' +\n                'relative to the time granularity selected',\n            ),\n          },\n        },\n        {\n          name: 'min_periods',\n          config: {\n            type: 'TextControl',\n            label: t('Min periods'),\n            isInt: true,\n            description: t(\n              'The minimum number of rolling periods required to show ' +\n                'a value. For instance if you do a cumulative sum on 7 days ' +\n                'you may want your \"Min Period\" to be 7, so that all data points ' +\n                'shown are the total of 7 periods. This will hide the \"ramp up\" ' +\n                'taking place over the first 7 periods',\n            ),\n          },\n        },\n      ],\n      [<div className=\"section-header\">{t('Time comparison')}</div>],\n      [\n        {\n          name: 'time_compare',\n          config: {\n            type: 'SelectControl',\n            multi: true,\n            freeForm: true,\n            label: t('Time shift'),\n            choices: [\n              ['1 day', t('1 day')],\n              ['1 week', t('1 week')],\n              ['28 days', t('28 days')],\n              ['30 days', t('30 days')],\n              ['52 weeks', t('52 weeks')],\n              ['1 year', t('1 year')],\n              ['104 weeks', t('104 weeks')],\n              ['2 years', t('2 years')],\n              ['156 weeks', t('156 weeks')],\n              ['3 years', t('3 years')],\n            ],\n            description: t(\n              'Overlay one or more timeseries from a ' +\n                'relative time period. Expects relative time deltas ' +\n                'in natural language (example: 24 hours, 7 days, ' +\n                '52 weeks, 365 days). Free text is supported.',\n            ),\n          },\n        },\n        {\n          name: 'comparison_type',\n          config: {\n            type: 'SelectControl',\n            label: t('Calculation type'),\n            default: 'values',\n            choices: [\n              ['values', t('Actual values')],\n              ['absolute', t('Difference')],\n              ['percentage', t('Percentage change')],\n              ['ratio', t('Ratio')],\n            ],\n            description: t(\n              'How to display time shifts: as individual lines; as the ' +\n                'difference between the main time series and each time shift; ' +\n                'as the percentage change; or as the ratio between series and time shifts.',\n            ),\n          },\n        },\n      ],\n      [<div className=\"section-header\">{t('Resample')}</div>],\n      [\n        {\n          name: 'resample_rule',\n          config: {\n            type: 'SelectControl',\n            freeForm: true,\n            label: t('Rule'),\n            default: null,\n            choices: [\n              ['1T', t('1T')],\n              ['1H', t('1H')],\n              ['1D', t('1D')],\n              ['7D', t('7D')],\n              ['1M', t('1M')],\n              ['1AS', t('1AS')],\n            ],\n            description: t('Pandas resample rule'),\n          },\n        },\n        {\n          name: 'resample_method',\n          config: {\n            type: 'SelectControl',\n            freeForm: true,\n            label: t('Method'),\n            default: null,\n            choices: [\n              ['asfreq', t('asfreq')],\n              ['bfill', t('bfill')],\n              ['ffill', t('ffill')],\n              ['median', t('median')],\n              ['mean', t('mean')],\n              ['sum', t('sum')],\n            ],\n            description: t('Pandas resample method'),\n          },\n        },\n      ],\n    ],\n  },\n];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport {\n  DatasourceType,\n  getChartControlPanelRegistry,\n} from '@superset-ui/core';\nimport {\n  ControlPanelConfig,\n  expandControlConfig,\n  isControlPanelSectionConfig,\n} from '@superset-ui/chart-controls';\n\nimport * as SECTIONS from 'src/explore/controlPanels/sections';\n\nconst getMemoizedSectionsToRender = memoizeOne(\n  (datasourceType: DatasourceType, controlPanelConfig: ControlPanelConfig) => {\n    const {\n      sectionOverrides = {},\n      controlOverrides,\n      controlPanelSections = [],\n    } = controlPanelConfig;\n\n    // default control panel sections\n    const sections = { ...SECTIONS };\n\n    // apply section overrides\n    Object.entries(sectionOverrides).forEach(([section, overrides]) => {\n      if (typeof overrides === 'object' && overrides.constructor === Object) {\n        sections[section] = {\n          ...sections[section],\n          ...overrides,\n        };\n      } else {\n        sections[section] = overrides;\n      }\n    });\n\n    const { datasourceAndVizType } = sections;\n\n    // list of datasource-specific controls that should be removed if the datasource is a specific type\n    const filterControlsForTypes = [DatasourceType.Query, DatasourceType.Table];\n    const invalidControls = filterControlsForTypes.includes(datasourceType)\n      ? ['granularity']\n      : ['granularity_sqla', 'time_grain_sqla'];\n\n    return [datasourceAndVizType]\n      .concat(controlPanelSections.filter(isControlPanelSectionConfig))\n      .map(section => {\n        const { controlSetRows } = section;\n        return {\n          ...section,\n          controlSetRows:\n            controlSetRows?.map(row =>\n              row\n                .filter(\n                  control =>\n                    typeof control !== 'string' ||\n                    !invalidControls.includes(control),\n                )\n                .map(item => expandControlConfig(item, controlOverrides)),\n            ) || [],\n        };\n      });\n  },\n);\n\n/**\n * Get the clean and processed control panel sections\n */\nexport function getSectionsToRender(\n  vizType: string,\n  datasourceType: DatasourceType,\n) {\n  const controlPanelConfig =\n    // TODO: update `chartControlPanelRegistry` type to use ControlPanelConfig\n    (getChartControlPanelRegistry().get(vizType) as ControlPanelConfig) || {};\n  return getMemoizedSectionsToRender(datasourceType, controlPanelConfig);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport { getChartControlPanelRegistry } from '@superset-ui/core';\nimport {\n  ControlPanelConfig,\n  ControlPanelSectionConfig,\n  expandControlConfig,\n  isControlPanelSectionConfig,\n} from '@superset-ui/chart-controls';\n\n/**\n * Find control item from control panel config.\n */\nexport function findControlItem(\n  controlPanelSections: (ControlPanelSectionConfig | null)[],\n  controlKey: string,\n) {\n  return (\n    controlPanelSections\n      .filter(isControlPanelSectionConfig)\n      .map(section => section.controlSetRows)\n      .flat(2)\n      .find(\n        control =>\n          controlKey === control ||\n          (control !== null &&\n            typeof control === 'object' &&\n            'name' in control &&\n            control.name === controlKey),\n      ) ?? null\n  );\n}\n\nconst getMemoizedControlConfig = memoizeOne(\n  (controlKey, controlPanelConfig: ControlPanelConfig) => {\n    const { controlOverrides = {}, controlPanelSections = [] } =\n      controlPanelConfig;\n    const control = expandControlConfig(\n      findControlItem(controlPanelSections, controlKey),\n      controlOverrides,\n    );\n    return control && 'config' in control ? control.config : control;\n  },\n);\n\nexport const getControlConfig = function getControlConfig(\n  controlKey: string,\n  vizType: string,\n) {\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  return getMemoizedControlConfig(\n    controlKey,\n    // TODO: the ChartControlPanelRegistry is incorrectly typed and needs to\n    // be fixed\n    controlPanelConfig as ControlPanelConfig,\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport {\n  DatasourceType,\n  ensureIsArray,\n  JsonValue,\n  QueryFormData,\n} from '@superset-ui/core';\nimport {\n  ControlConfig,\n  ControlPanelState,\n  ControlState,\n  ControlType,\n  ControlValueValidator,\n  CustomControlItem,\n} from '@superset-ui/chart-controls';\nimport { getSectionsToRender } from './getSectionsToRender';\nimport { getControlConfig } from './getControlConfig';\n\ntype ValidationError = JsonValue;\n\nfunction execControlValidator<T = ControlType>(\n  control: ControlState<T>,\n  processedState: ControlState<T>,\n) {\n  const validators = control.validators as ControlValueValidator[] | undefined;\n  const { externalValidationErrors = [] } = control;\n  const errors: ValidationError[] = [];\n  if (validators && validators.length > 0) {\n    validators.forEach(validator => {\n      const error = validator.call(control, control.value, processedState);\n      if (error) {\n        errors.push(error);\n      }\n    });\n  }\n  const validationErrors = [...errors, ...externalValidationErrors];\n  // always reset validation errors even when there is no validator\n  return { ...control, validationErrors };\n}\n\n/**\n * Clear control values that are no longer in the `choices` list.\n */\nfunction handleMissingChoice<T = ControlType>(control: ControlState<T>) {\n  // If the value is not valid anymore based on choices, clear it\n  if (\n    control.type === 'SelectControl' &&\n    !control.freeForm &&\n    control.choices &&\n    control.value\n  ) {\n    const alteredControl = { ...control };\n    const choices = control.choices as [JsonValue, ReactNode][];\n    const value = ensureIsArray(control.value);\n    const choiceValues = choices.map(c => c[0]);\n    if (control.multi && value.length > 0) {\n      alteredControl.value = value.filter(el => choiceValues.includes(el));\n      return alteredControl;\n    }\n    if (!control.multi && !choiceValues.includes(value[0])) {\n      alteredControl.value = null;\n      return alteredControl;\n    }\n  }\n  return control;\n}\n\nexport function applyMapStateToPropsToControl<T = ControlType>(\n  controlState: ControlState<T>,\n  controlPanelState: Partial<ControlPanelState> | null,\n) {\n  const { mapStateToProps } = controlState;\n  let state = { ...controlState };\n  let { value } = state; // value is current user-input value\n  if (mapStateToProps && controlPanelState) {\n    state = {\n      ...controlState,\n      ...mapStateToProps.call(controlState, controlPanelState, controlState),\n    };\n    // `mapStateToProps` may also provide a value\n    value = value || state.value;\n  }\n\n  // InitialValue is used for setting value for the control,\n  // this value is not recalculated. The default value will override it.\n  if (typeof state.initialValue === 'function') {\n    state.initialValue = state.initialValue(state, controlPanelState);\n    // if default is still a function, discard\n    if (typeof state.initialValue === 'function') {\n      delete state.initialValue;\n    }\n  }\n  if (state.initialValue) {\n    value = state.initialValue;\n    delete state.initialValue;\n  }\n\n  // If default is a function, evaluate it\n  if (typeof state.default === 'function') {\n    state.default = state.default(state, controlPanelState);\n    // if default is still a function, discard\n    if (typeof state.default === 'function') {\n      delete state.default;\n    }\n  }\n  // If no current value, set it as default\n  if (state.default && value === undefined) {\n    value = state.default;\n  }\n  // If a choice control went from multi=false to true, wrap value in array\n  if (value && state.multi && !Array.isArray(value)) {\n    value = [value];\n  }\n  state.value = value;\n  return execControlValidator(handleMissingChoice(state), state);\n}\n\nexport function getControlStateFromControlConfig<T = ControlType>(\n  controlConfig: ControlConfig<T> | null,\n  controlPanelState: Partial<ControlPanelState> | null,\n  value?: JsonValue,\n) {\n  // skip invalid config values\n  if (!controlConfig) {\n    return null;\n  }\n  const controlState = { ...controlConfig, value } as ControlState<T>;\n  // only apply mapStateToProps when control states have been initialized\n  // or when explicitly didn't provide control panel state (mostly for testing)\n  if (controlPanelState?.controls || controlPanelState === null) {\n    return applyMapStateToPropsToControl(controlState, controlPanelState);\n  }\n  return controlState;\n}\n\nexport function getControlState(\n  controlKey: string,\n  vizType: string,\n  state: Partial<ControlPanelState>,\n  value?: JsonValue,\n) {\n  return getControlStateFromControlConfig(\n    getControlConfig(controlKey, vizType),\n    state,\n    value,\n  );\n}\n\nexport function getAllControlsState(\n  vizType: string,\n  datasourceType: DatasourceType,\n  state: ControlPanelState | null,\n  formData: QueryFormData,\n) {\n  const controlsState = {};\n  getSectionsToRender(vizType, datasourceType).forEach(section =>\n    section.controlSetRows.forEach(fieldsetRow =>\n      fieldsetRow.forEach((field: CustomControlItem) => {\n        if (field?.config && field.name) {\n          const { config, name } = field;\n          controlsState[name] = getControlStateFromControlConfig(\n            config,\n            state,\n            formData[name],\n          );\n        }\n      }),\n    ),\n  );\n  return controlsState;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { QueryFormData } from '@superset-ui/core';\nimport { ControlStateMapping } from '@superset-ui/chart-controls';\n\nexport function getFormDataFromControls(\n  controlsState: ControlStateMapping,\n): QueryFormData {\n  const formData = {};\n  Object.keys(controlsState).forEach(controlName => {\n    const control = controlsState[controlName];\n    formData[controlName] = control.value;\n  });\n  return formData as QueryFormData;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ControlState, Dataset, Metric } from '@superset-ui/chart-controls';\nimport {\n  Column,\n  isAdhocMetricSimple,\n  isAdhocMetricSQL,\n  isSavedMetric,\n  isSimpleAdhocFilter,\n  JsonValue,\n  SimpleAdhocFilter,\n} from '@superset-ui/core';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\n\nconst isControlValueCompatibleWithDatasource = (\n  datasource: Dataset,\n  controlState: ControlState,\n  value: any,\n) => {\n  if (controlState.options && typeof value === 'string') {\n    if (\n      controlState.options.some(\n        (option: [string | number, string] | { column_name: string }) =>\n          Array.isArray(option)\n            ? option[0] === value\n            : option.column_name === value,\n      )\n    ) {\n      return datasource.columns.some(column => column.column_name === value);\n    }\n  }\n  if (\n    controlState.savedMetrics &&\n    isSavedMetric(value) &&\n    controlState.savedMetrics.some(\n      (savedMetric: Metric) => savedMetric.metric_name === value,\n    )\n  ) {\n    return datasource.metrics.some(\n      (metric: Metric) => metric.metric_name === value,\n    );\n  }\n  if (\n    controlState.columns &&\n    (isAdhocMetricSimple(value) || isSimpleAdhocFilter(value)) &&\n    controlState.columns.some(\n      (column: Column) =>\n        column.column_name === (value as AdhocMetric).column?.column_name ||\n        column.column_name === (value as SimpleAdhocFilter).subject,\n    )\n  ) {\n    return datasource.columns.some(\n      (column: Column) =>\n        column.column_name === (value as AdhocMetric).column?.column_name ||\n        column.column_name === (value as SimpleAdhocFilter).subject,\n    );\n  }\n  if (isAdhocMetricSQL(value)) {\n    Object.assign(value, { datasourceWarning: true });\n    return true;\n  }\n  return false;\n};\n\nexport const getControlValuesCompatibleWithDatasource = (\n  datasource: Dataset,\n  controlState: ControlState,\n  value: JsonValue,\n) => {\n  if (value === undefined || value === null) {\n    return undefined;\n  }\n  if (Array.isArray(value)) {\n    const compatibleValues = value.filter(val =>\n      isControlValueCompatibleWithDatasource(datasource, controlState, val),\n    );\n    return compatibleValues.length > 0\n      ? compatibleValues\n      : controlState.default;\n  }\n  return isControlValueCompatibleWithDatasource(datasource, controlState, value)\n    ? value\n    : controlState.default;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { omit } from 'lodash';\nimport {\n  ensureIsArray,\n  getChartControlPanelRegistry,\n  QueryFormColumn,\n  QueryFormData,\n  QueryFormMetric,\n} from '@superset-ui/core';\nimport {\n  ControlStateMapping,\n  getStandardizedControls,\n  isStandardizedFormData,\n  StandardizedControls,\n  StandardizedFormDataInterface,\n} from '@superset-ui/chart-controls';\nimport { getControlsState } from 'src/explore/store';\nimport { getFormDataFromControls } from './getFormDataFromControls';\n\nexport const sharedMetricsKey = [\n  'metric', // via sharedControls, scalar\n  'metrics', // via sharedControls, array\n  'metric_2', // via sharedControls, scalar\n  'size', // via sharedControls, scalar\n  'x', // via sharedControls, scalar\n  'y', // via sharedControls, scalar\n  'secondary_metric', // via sharedControls, scalar\n];\nexport const sharedColumnsKey = [\n  'groupby', // via sharedControls, array\n  'columns', // via sharedControls, array\n  'groupbyColumns', // via pivot table v2, array\n  'groupbyRows', // via pivot table v2, array\n  'entity', // via sharedControls, scalar\n  'series', // via sharedControls, scalar\n  'series_columns', // via sharedControls, array\n];\n\nexport const publicControls = [\n  // time section\n  'granularity_sqla', // via sharedControls\n  'time_grain_sqla', // via sharedControls\n  'time_range', // via sharedControls\n  // filters\n  'adhoc_filters', // via sharedControls\n  // subquery limit(series limit)\n  'limit', // via sharedControls\n  // order by clause\n  'timeseries_limit_metric', // via sharedControls\n  'series_limit_metric', // via sharedControls\n  // desc or asc in order by clause\n  'order_desc', // via sharedControls\n  // outer query limit\n  'row_limit', // via sharedControls\n  // x asxs column\n  'x_axis', // via sharedControls\n  // advanced analytics - rolling window\n  'rolling_type', // via sections.advancedAnalytics\n  'rolling_periods', // via sections.advancedAnalytics\n  'min_periods', // via sections.advancedAnalytics\n  // advanced analytics - time comparison\n  'time_compare', // via sections.advancedAnalytics\n  'comparison_type', // via sections.advancedAnalytics\n  // advanced analytics - resample\n  'resample_rule', // via sections.advancedAnalytics\n  'resample_method', // via sections.advancedAnalytics\n];\n\nexport class StandardizedFormData {\n  private sfd: StandardizedFormDataInterface;\n\n  constructor(sourceFormData: QueryFormData) {\n    /*\n     * Support form_data for smooth switching between different viz\n     * */\n    const formData = Object.freeze(sourceFormData);\n\n    // generates an ordered map, the key is viz_type and the value is form_data. the last item is current viz.\n    const mfd = formData?.standardizedFormData?.memorizedFormData;\n    const vizType = formData.viz_type;\n    let memorizedFormData = new Map<string, QueryFormData>();\n    let controls: StandardizedControls;\n    if (\n      Array.isArray(mfd) &&\n      mfd.length > 0 &&\n      formData.datasource === mfd.slice(-1)[0][1]?.datasource\n    ) {\n      memorizedFormData = new Map(\n        formData.standardizedFormData.memorizedFormData,\n      );\n      if (memorizedFormData.has(vizType)) {\n        memorizedFormData.delete(vizType);\n      }\n      memorizedFormData.set(vizType, formData);\n      controls = StandardizedFormData.getStandardizedControls(formData);\n    } else {\n      // reset the `memorizedFormData` if a request between different datasource.\n      const restFormData = omit(\n        formData,\n        'standardizedFormData',\n      ) as QueryFormData;\n      memorizedFormData.set(vizType, restFormData);\n      controls = StandardizedFormData.getStandardizedControls(restFormData);\n    }\n\n    this.sfd = {\n      controls,\n      memorizedFormData,\n    };\n  }\n\n  static getStandardizedControls(\n    formData: QueryFormData,\n  ): StandardizedControls {\n    // 1. initial StandardizedControls\n    const controls: StandardizedControls = {\n      metrics: [],\n      columns: [],\n    };\n\n    // 2. collect current sharedControls\n    Object.entries(formData).forEach(([key, value]) => {\n      if (sharedMetricsKey.includes(key)) {\n        controls.metrics.push(...ensureIsArray<QueryFormMetric>(value));\n      }\n      if (sharedColumnsKey.includes(key)) {\n        controls.columns.push(...ensureIsArray<QueryFormColumn>(value));\n      }\n    });\n\n    // 3. append inherit sharedControls\n    if (isStandardizedFormData(formData)) {\n      const { metrics, columns } = formData.standardizedFormData.controls;\n      controls.metrics.push(...metrics);\n      controls.columns.push(...columns);\n    }\n\n    return controls;\n  }\n\n  private getLatestFormData(vizType: string): QueryFormData {\n    if (this.has(vizType)) {\n      return this.get(vizType);\n    }\n    return this.memorizedFormData.slice(-1)[0][1];\n  }\n\n  private get standardizedControls() {\n    return this.sfd.controls;\n  }\n\n  private get memorizedFormData() {\n    return Array.from(this.sfd.memorizedFormData.entries());\n  }\n\n  serialize() {\n    return {\n      controls: this.standardizedControls,\n      memorizedFormData: this.memorizedFormData,\n    };\n  }\n\n  has(vizType: string): boolean {\n    return this.sfd.memorizedFormData.has(vizType);\n  }\n\n  get(vizType: string): QueryFormData {\n    return this.sfd.memorizedFormData.get(vizType) as QueryFormData;\n  }\n\n  transform(\n    targetVizType: string,\n    exploreState: Record<string, any>,\n  ): {\n    formData: QueryFormData;\n    controlsState: ControlStateMapping;\n  } {\n    /*\n     * Transfrom form_data between different viz. Return new form_data and controlsState.\n     * 1. get memorized form_data by viz type or get previous form_data\n     * 2. collect public control values\n     * 3. generate initial targetControlsState\n     * 4. attach `standardizedFormData` to the initial form_data\n     * 5. call formDataOverrides to transform initial form_data if the plugin was defined\n     * 6. use final form_data to generate controlsState\n     * 7. to refresh validator message\n     * */\n    const latestFormData = this.getLatestFormData(targetVizType);\n    const publicFormData = {};\n    publicControls.forEach(key => {\n      if (key in exploreState.form_data) {\n        publicFormData[key] = exploreState.form_data[key];\n      }\n    });\n    const targetControlsState = getControlsState(exploreState, {\n      ...latestFormData,\n      ...publicFormData,\n      viz_type: targetVizType,\n    });\n    const targetFormData = {\n      ...getFormDataFromControls(targetControlsState),\n      standardizedFormData: this.serialize(),\n    };\n\n    let rv = {\n      formData: targetFormData,\n      controlsState: targetControlsState,\n    };\n\n    const controlPanel = getChartControlPanelRegistry().get(targetVizType);\n    if (controlPanel?.formDataOverrides) {\n      getStandardizedControls().setStandardizedControls(targetFormData);\n      const transformed = {\n        ...controlPanel.formDataOverrides(targetFormData),\n        standardizedFormData: {\n          controls: { ...getStandardizedControls().controls },\n          memorizedFormData: this.memorizedFormData,\n        },\n      };\n      getStandardizedControls().clear();\n      rv = {\n        formData: transformed,\n        controlsState: getControlsState(exploreState, transformed),\n      };\n    }\n\n    // refresh validator message\n    rv.controlsState = getControlsState(\n      { ...exploreState, controls: rv.controlsState },\n      rv.formData,\n    );\n    return rv;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { omit } from 'lodash';\nimport { SupersetClient, JsonObject } from '@superset-ui/core';\n\ntype Payload = {\n  datasource_id: number;\n  datasource_type: string;\n  form_data: string;\n  chart_id?: number;\n};\n\nconst TEMPORARY_CONTROLS = ['url_params'];\n\nexport const sanitizeFormData = (formData: JsonObject): JsonObject =>\n  omit(formData, TEMPORARY_CONTROLS);\n\nconst assembleEndpoint = (key?: string, tabId?: string) => {\n  let endpoint = 'api/v1/explore/form_data';\n  if (key) {\n    endpoint = endpoint.concat(`/${key}`);\n  }\n  if (tabId) {\n    endpoint = endpoint.concat(`?tab_id=${tabId}`);\n  }\n  return endpoint;\n};\n\nconst assemblePayload = (\n  datasourceId: number,\n  datasourceType: string,\n  formData: JsonObject,\n  chartId?: number,\n) => {\n  const payload: Payload = {\n    datasource_id: datasourceId,\n    datasource_type: datasourceType,\n    form_data: JSON.stringify(sanitizeFormData(formData)),\n  };\n  if (chartId) {\n    payload.chart_id = chartId;\n  }\n  return payload;\n};\n\nexport const postFormData = (\n  datasourceId: number,\n  datasourceType: string,\n  formData: JsonObject,\n  chartId?: number,\n  tabId?: string,\n): Promise<string> =>\n  SupersetClient.post({\n    endpoint: assembleEndpoint(undefined, tabId),\n    jsonPayload: assemblePayload(\n      datasourceId,\n      datasourceType,\n      formData,\n      chartId,\n    ),\n  }).then(r => r.json.key);\n\nexport const putFormData = (\n  datasourceId: number,\n  datasourceType: string,\n  key: string,\n  formData: JsonObject,\n  chartId?: number,\n  tabId?: string,\n): Promise<string> =>\n  SupersetClient.put({\n    endpoint: assembleEndpoint(key, tabId),\n    jsonPayload: assemblePayload(\n      datasourceId,\n      datasourceType,\n      formData,\n      chartId,\n    ),\n  }).then(r => r.json.message);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nexport const PAGE_SIZE = 25;\nexport const SORT_BY = [{ id: 'changed_on_delta_humanized', desc: true }];\nexport const PASSWORDS_NEEDED_MESSAGE = t(\n  'The passwords for the databases below are needed in order to ' +\n    'import them together with the datasets. Please note that the ' +\n    '\"Secure Extra\" and \"Certificate\" sections of ' +\n    'the database configuration are not present in export files, and ' +\n    'should be added manually after the import if they are needed.',\n);\nexport const CONFIRM_OVERWRITE_MESSAGE = t(\n  'You are importing one or more datasets that already exist. ' +\n    'Overwriting might cause you to lose some of your work. Are you ' +\n    'sure you want to overwrite?',\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Filter } from 'src/views/CRUD/types';\nimport { NavBarProps, MenuObjectProps } from 'src/types/bootstrapTypes';\n\nexport enum WelcomeTable {\n  Charts = 'CHARTS',\n  Dashboards = 'DASHBOARDS',\n  Recents = 'RECENTS',\n  SavedQueries = 'SAVED_QUERIES',\n}\n\nexport type WelcomePageLastTab = 'examples' | 'all' | [string, Filter[]];\n\nexport interface ExtensionConfigs {\n  ALLOWED_EXTENSIONS: Array<any>;\n  CSV_EXTENSIONS: Array<any>;\n  COLUMNAR_EXTENSIONS: Array<any>;\n  EXCEL_EXTENSIONS: Array<any>;\n  HAS_GSHEETS_INSTALLED: boolean;\n}\nexport interface RightMenuProps {\n  align: 'flex-start' | 'flex-end';\n  settings: MenuObjectProps[];\n  navbarRight: NavBarProps;\n  isFrontendRoute: (path?: string) => boolean;\n  environmentTag: {\n    text: string;\n    color: string;\n  };\n}\n\nexport enum GlobalMenuDataOptions {\n  GOOGLE_SHEETS = 'gsheets',\n  DB_CONNECTION = 'dbconnection',\n  DATASET_CREATION = 'datasetCreation',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { makeApi } from '@superset-ui/core';\nimport { useEffect, useMemo, useRef, useState } from 'react';\n\nexport enum ResourceStatus {\n  LOADING = 'loading',\n  COMPLETE = 'complete',\n  ERROR = 'error',\n}\n\n/**\n * An object containing the data fetched from the API,\n * as well as loading and error info\n */\nexport type Resource<T> = LoadingState | CompleteState<T> | ErrorState;\n\n// Trying out something a little different: a separate type per status.\n// This should let Typescript know whether a Resource has a result or error.\n// It's possible that I'm expecting too much from Typescript here.\n// If this ends up causing problems, we can change the type to:\n//\n// export type Resource<T> = {\n//   status: ResourceStatus;\n//   result: null | T;\n//   error: null | Error;\n// }\n\ntype LoadingState = {\n  status: ResourceStatus.LOADING;\n  result: null;\n  error: null;\n};\n\ntype CompleteState<T> = {\n  status: ResourceStatus.COMPLETE;\n  result: T;\n  error: null;\n};\n\ntype ErrorState = {\n  status: ResourceStatus.ERROR;\n  result: null;\n  error: Error;\n};\n\nconst initialState: LoadingState = {\n  status: ResourceStatus.LOADING,\n  result: null,\n  error: null,\n};\n\n/**\n * A general-purpose hook to fetch the response from an endpoint.\n * Returns the full response body from the API, including metadata.\n *\n * Note: You likely want {useApiV1Resource} instead of this!\n *\n * TODO Store the state in redux or something, share state between hook instances.\n *\n * TODO Include a function in the returned resource object to refresh the data.\n *\n * A core design decision here is composition > configuration,\n * and every hook should only have one job.\n * Please address new needs with new hooks if possible,\n * rather than adding config options to this hook.\n *\n * @param endpoint The url where the resource is located.\n */\nexport function useApiResourceFullBody<RESULT>(\n  endpoint: string,\n): Resource<RESULT> {\n  const [resource, setResource] = useState<Resource<RESULT>>(initialState);\n  const cancelRef = useRef<() => void>(() => {});\n\n  useEffect(() => {\n    // If refresh is implemented, this will need to change.\n    // The previous values should stay during refresh.\n    setResource(initialState);\n\n    // when this effect runs, the endpoint has changed.\n    // cancel any current calls so that state doesn't get messed up.\n    cancelRef.current();\n    let cancelled = false;\n    cancelRef.current = () => {\n      cancelled = true;\n    };\n\n    const fetchResource = makeApi<{}, RESULT>({\n      method: 'GET',\n      endpoint,\n    });\n\n    fetchResource({})\n      .then(result => {\n        if (!cancelled) {\n          setResource({\n            status: ResourceStatus.COMPLETE,\n            result,\n            error: null,\n          });\n        }\n      })\n      .catch(error => {\n        if (!cancelled) {\n          setResource({\n            status: ResourceStatus.ERROR,\n            result: null,\n            error,\n          });\n        }\n      });\n\n    // Cancel the request when the component un-mounts\n    return () => {\n      cancelled = true;\n    };\n  }, [endpoint]);\n\n  return resource;\n}\n\n/**\n * For when you want to transform the result of an api resource hook before using it.\n *\n * @param resource the Resource object returned from useApiV1Resource\n * @param transformFn a callback that transforms the result object into the shape you want.\n * Make sure to use a persistent function for this so it doesn't constantly recalculate!\n */\nexport function useTransformedResource<IN, OUT>(\n  resource: Resource<IN>,\n  transformFn: (result: IN) => OUT,\n): Resource<OUT> {\n  return useMemo(() => {\n    if (resource.status !== ResourceStatus.COMPLETE) {\n      // While incomplete, there is no result - no need to transform.\n      return resource;\n    }\n    try {\n      return {\n        ...resource,\n        result: transformFn(resource.result),\n      };\n    } catch (e) {\n      return {\n        status: ResourceStatus.ERROR,\n        result: null,\n        error: e,\n      };\n    }\n  }, [resource, transformFn]);\n}\n\n// returns the \"result\" field from a fetched API v1 endpoint\nconst extractInnerResult = <T>(responseBody: { result: T }) =>\n  responseBody.result;\n\n/**\n * A general-purpose hook to fetch a Superset resource from a v1 API endpoint.\n * Handles request lifecycle and async logic so you don't have to.\n *\n * This returns the data under the \"result\" field in the API response body.\n * If you need the full response body, use {useFullApiResource} instead.\n *\n * @param endpoint The url where the resource is located.\n */\nexport function useApiV1Resource<RESULT>(endpoint: string): Resource<RESULT> {\n  return useTransformedResource(\n    useApiResourceFullBody<{ result: RESULT }>(endpoint),\n    extractInnerResult,\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { createApi, BaseQueryFn } from '@reduxjs/toolkit/query/react';\nimport {\n  SupersetClient,\n  ParseMethod,\n  SupersetClientResponse,\n  JsonValue,\n  RequestBase,\n} from '@superset-ui/core';\n\nexport type { JsonResponse, TextResponse } from '@superset-ui/core';\n\nexport const supersetClientQuery: BaseQueryFn<\n  Pick<RequestBase, 'method' | 'body' | 'jsonPayload' | 'postPayload'> & {\n    endpoint: string;\n    parseMethod?: ParseMethod;\n    transformResponse?: (response: SupersetClientResponse) => JsonValue;\n    urlParams?: Record<string, number | string | undefined | boolean>;\n  }\n> = (\n  {\n    endpoint,\n    urlParams,\n    transformResponse,\n    method = 'GET',\n    parseMethod = 'json',\n    ...rest\n  },\n  api,\n) =>\n  SupersetClient.request({\n    ...rest,\n    endpoint: `${endpoint}${urlParams ? `?q=${rison.encode(urlParams)}` : ''}`,\n    method,\n    parseMethod,\n    signal: api.signal,\n  })\n    .then(data => ({\n      data: transformResponse?.(data) ?? data,\n    }))\n    .catch(response =>\n      getClientErrorObject(response).then(errorObj => ({\n        error: errorObj,\n      })),\n    );\n\nexport const api = createApi({\n  reducerPath: 'queryApi',\n  tagTypes: [\n    'Schemas',\n    'Tables',\n    'DatabaseFunctions',\n    'QueryValidations',\n    'TableMetadatas',\n  ],\n  endpoints: () => ({}),\n  baseQuery: supersetClientQuery,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// Log event names ------------------------------------------------------------\nexport const LOG_ACTIONS_LOAD_CHART = 'load_chart';\nexport const LOG_ACTIONS_RENDER_CHART = 'render_chart';\nexport const LOG_ACTIONS_HIDE_BROWSER_TAB = 'hide_browser_tab';\n\nexport const LOG_ACTIONS_MOUNT_DASHBOARD = 'mount_dashboard';\nexport const LOG_ACTIONS_MOUNT_EXPLORER = 'mount_explorer';\n\nexport const LOG_ACTIONS_SELECT_DASHBOARD_TAB = 'select_dashboard_tab';\nexport const LOG_ACTIONS_FORCE_REFRESH_CHART = 'force_refresh_chart';\nexport const LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS = 'change_explore_controls';\nexport const LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD = 'toggle_edit_dashboard';\nexport const LOG_ACTIONS_FORCE_REFRESH_DASHBOARD = 'force_refresh_dashboard';\nexport const LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD =\n  'periodic_render_dashboard';\nexport const LOG_ACTIONS_EXPLORE_DASHBOARD_CHART = 'explore_dashboard_chart';\nexport const LOG_ACTIONS_EXPORT_CSV_DASHBOARD_CHART =\n  'export_csv_dashboard_chart';\nexport const LOG_ACTIONS_EXPORT_XLSX_DASHBOARD_CHART =\n  'export_xlsx_dashboard_chart';\nexport const LOG_ACTIONS_CHANGE_DASHBOARD_FILTER = 'change_dashboard_filter';\nexport const LOG_ACTIONS_DATASET_CREATION_EMPTY_CANCELLATION =\n  'dataset_creation_empty_cancellation';\nexport const LOG_ACTIONS_DATASET_CREATION_DATABASE_CANCELLATION =\n  'dataset_creation_database_cancellation';\nexport const LOG_ACTIONS_DATASET_CREATION_SCHEMA_CANCELLATION =\n  'dataset_creation_schema_cancellation';\nexport const LOG_ACTIONS_DATASET_CREATION_TABLE_CANCELLATION =\n  'dataset_creation_table_cancellation';\nexport const LOG_ACTIONS_DATASET_CREATION_SUCCESS = 'dataset_creation_success';\nexport const LOG_ACTIONS_SPA_NAVIGATION = 'spa_navigation';\nexport const LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA =\n  'confirm_overwrite_dashboard_metadata';\nexport const LOG_ACTIONS_DASHBOARD_DOWNLOAD_AS_IMAGE =\n  'dashboard_download_as_image';\nexport const LOG_ACTIONS_CHART_DOWNLOAD_AS_IMAGE = 'chart_download_as_image';\nexport const LOG_ACTIONS_SQLLAB_WARN_LOCAL_STORAGE_USAGE =\n  'sqllab_warn_local_storage_usage';\nexport const LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY =\n  'sqllab_fetch_failed_query';\nexport const LOG_ACTIONS_DRILL_BY_MODAL_OPENED = 'drill_by_modal_opened';\nexport const LOG_ACTIONS_FURTHER_DRILL_BY = 'further_drill_by';\nexport const LOG_ACTIONS_DRILL_BY_EDIT_CHART = 'drill_by_edit_chart';\nexport const LOG_ACTIONS_DRILL_BY_BREADCRUMB_CLICKED =\n  'drill_by_breadcrumb_clicked';\nexport const LOG_ACTIONS_SQLLAB_MONITOR_LOCAL_STORAGE_USAGE =\n  'sqllab_monitor_local_storage_usage';\n\n// Log event types --------------------------------------------------------------\nexport const LOG_EVENT_TYPE_TIMING = new Set([\n  LOG_ACTIONS_LOAD_CHART,\n  LOG_ACTIONS_RENDER_CHART,\n  LOG_ACTIONS_HIDE_BROWSER_TAB,\n  LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY,\n]);\nexport const LOG_EVENT_TYPE_USER = new Set([\n  LOG_ACTIONS_MOUNT_DASHBOARD,\n  LOG_ACTIONS_SELECT_DASHBOARD_TAB,\n  LOG_ACTIONS_EXPLORE_DASHBOARD_CHART,\n  LOG_ACTIONS_FORCE_REFRESH_CHART,\n  LOG_ACTIONS_EXPORT_CSV_DASHBOARD_CHART,\n  LOG_ACTIONS_CHANGE_DASHBOARD_FILTER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n  LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD,\n  LOG_ACTIONS_FORCE_REFRESH_DASHBOARD,\n  LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD,\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA,\n  LOG_ACTIONS_DASHBOARD_DOWNLOAD_AS_IMAGE,\n  LOG_ACTIONS_CHART_DOWNLOAD_AS_IMAGE,\n]);\n\nexport const LOG_EVENT_DATASET_TYPE_DATASET_CREATION = [\n  LOG_ACTIONS_DATASET_CREATION_EMPTY_CANCELLATION,\n  LOG_ACTIONS_DATASET_CREATION_DATABASE_CANCELLATION,\n  LOG_ACTIONS_DATASET_CREATION_SCHEMA_CANCELLATION,\n  LOG_ACTIONS_DATASET_CREATION_TABLE_CANCELLATION,\n  LOG_ACTIONS_DATASET_CREATION_SUCCESS,\n];\n\nexport const Logger = {\n  timeOriginOffset: 0,\n\n  markTimeOrigin() {\n    this.timeOriginOffset = window.performance.now();\n  },\n\n  // note that this returns ms since last navigation, NOT ms since epoch\n  getTimestamp() {\n    return Math.round(window.performance.now() - this.timeOriginOffset);\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\n\nexport const LOG_EVENT = 'LOG_EVENT';\n\nexport function logEvent(eventName: string, eventData: Record<string, any>) {\n  return (dispatch: Dispatch) =>\n    dispatch({\n      type: LOG_EVENT,\n      payload: {\n        eventName,\n        eventData,\n      },\n    });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  FeatureFlag,\n  makeApi,\n  SupersetClient,\n  logging,\n} from '@superset-ui/core';\nimport { SupersetError } from 'src/components/ErrorMessage/types';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { isFeatureEnabled } from '../featureFlags';\nimport {\n  getClientErrorObject,\n  parseErrorJson,\n} from '../utils/getClientErrorObject';\n\ntype AsyncEvent = {\n  id?: string | null;\n  channel_id: string;\n  job_id: string;\n  user_id?: string;\n  status: string;\n  errors?: SupersetError[];\n  result_url: string | null;\n};\n\ntype CachedDataResponse = {\n  status: string;\n  data: any;\n};\ntype AppConfig = Record<string, any>;\ntype ListenerFn = (asyncEvent: AsyncEvent) => Promise<any>;\n\nconst TRANSPORT_POLLING = 'polling';\nconst TRANSPORT_WS = 'ws';\nconst JOB_STATUS = {\n  PENDING: 'pending',\n  RUNNING: 'running',\n  ERROR: 'error',\n  DONE: 'done',\n};\nconst LOCALSTORAGE_KEY = 'last_async_event_id';\nconst POLLING_URL = '/api/v1/async_event/';\nconst MAX_RETRIES = 6;\nconst RETRY_DELAY = 100;\n\nlet config: AppConfig;\nlet transport: string;\nlet pollingDelayMs: number;\nlet pollingTimeoutId: number;\nlet listenersByJobId: Record<string, ListenerFn>;\nlet retriesByJobId: Record<string, number>;\nlet lastReceivedEventId: string | null | undefined;\n\nconst addListener = (id: string, fn: any) => {\n  listenersByJobId[id] = fn;\n};\n\nconst removeListener = (id: string) => {\n  if (!listenersByJobId[id]) return;\n  delete listenersByJobId[id];\n};\n\nconst fetchCachedData = async (\n  asyncEvent: AsyncEvent,\n): Promise<CachedDataResponse> => {\n  let status = 'success';\n  let data;\n  try {\n    const { json } = await SupersetClient.get({\n      endpoint: String(asyncEvent.result_url),\n    });\n    data = 'result' in json ? json.result : json;\n  } catch (response) {\n    status = 'error';\n    data = await getClientErrorObject(response);\n  }\n\n  return { status, data };\n};\n\nexport const waitForAsyncData = async (asyncResponse: AsyncEvent) =>\n  new Promise((resolve, reject) => {\n    const jobId = asyncResponse.job_id;\n    const listener = async (asyncEvent: AsyncEvent) => {\n      switch (asyncEvent.status) {\n        case JOB_STATUS.DONE: {\n          let { data, status } = await fetchCachedData(asyncEvent); // eslint-disable-line prefer-const\n          data = ensureIsArray(data);\n          if (status === 'success') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n          break;\n        }\n        case JOB_STATUS.ERROR: {\n          const err = parseErrorJson(asyncEvent);\n          reject(err);\n          break;\n        }\n        default: {\n          logging.warn('received event with status', asyncEvent.status);\n        }\n      }\n      removeListener(jobId);\n    };\n    addListener(jobId, listener);\n  });\n\nconst fetchEvents = makeApi<\n  { last_id?: string | null },\n  { result: AsyncEvent[] }\n>({\n  method: 'GET',\n  endpoint: POLLING_URL,\n});\n\nconst setLastId = (asyncEvent: AsyncEvent) => {\n  lastReceivedEventId = asyncEvent.id;\n  try {\n    localStorage.setItem(LOCALSTORAGE_KEY, lastReceivedEventId as string);\n  } catch (err) {\n    logging.warn('Error saving event Id to localStorage', err);\n  }\n};\n\nexport const processEvents = async (events: AsyncEvent[]) => {\n  events.forEach((asyncEvent: AsyncEvent) => {\n    const jobId = asyncEvent.job_id;\n    const listener = listenersByJobId[jobId];\n    if (listener) {\n      listener(asyncEvent);\n      delete retriesByJobId[jobId];\n    } else {\n      // handle race condition where event is received\n      // before listener is registered\n      if (!retriesByJobId[jobId]) retriesByJobId[jobId] = 0;\n      retriesByJobId[jobId] += 1;\n\n      if (retriesByJobId[jobId] <= MAX_RETRIES) {\n        setTimeout(() => {\n          processEvents([asyncEvent]);\n        }, RETRY_DELAY * retriesByJobId[jobId]);\n      } else {\n        delete retriesByJobId[jobId];\n        logging.warn('listener not found for job_id', asyncEvent.job_id);\n      }\n    }\n    setLastId(asyncEvent);\n  });\n};\n\nconst loadEventsFromApi = async () => {\n  const eventArgs = lastReceivedEventId ? { last_id: lastReceivedEventId } : {};\n  if (Object.keys(listenersByJobId).length) {\n    try {\n      const { result: events } = await fetchEvents(eventArgs);\n      if (events?.length) await processEvents(events);\n    } catch (err) {\n      logging.warn(err);\n    }\n  }\n\n  if (transport === TRANSPORT_POLLING) {\n    pollingTimeoutId = window.setTimeout(loadEventsFromApi, pollingDelayMs);\n  }\n};\n\nconst wsConnectMaxRetries = 6;\nconst wsConnectErrorDelay = 2500;\nlet wsConnectRetries = 0;\nlet wsConnectTimeout: any;\nlet ws: WebSocket;\n\nconst wsConnect = (): void => {\n  let url = config.GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL;\n  if (lastReceivedEventId) url += `?last_id=${lastReceivedEventId}`;\n  ws = new WebSocket(url);\n\n  ws.addEventListener('open', () => {\n    logging.log('WebSocket connected');\n    clearTimeout(wsConnectTimeout);\n    wsConnectRetries = 0;\n  });\n\n  ws.addEventListener('close', () => {\n    wsConnectTimeout = setTimeout(() => {\n      wsConnectRetries += 1;\n      if (wsConnectRetries <= wsConnectMaxRetries) {\n        wsConnect();\n      } else {\n        logging.warn('WebSocket not available, falling back to async polling');\n        loadEventsFromApi();\n      }\n    }, wsConnectErrorDelay);\n  });\n\n  ws.addEventListener('error', () => {\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/readyState\n    if (ws.readyState < 2) ws.close();\n  });\n\n  ws.addEventListener('message', async event => {\n    let events: AsyncEvent[] = [];\n    try {\n      events = [JSON.parse(event.data)];\n      await processEvents(events);\n    } catch (err) {\n      logging.warn(err);\n    }\n  });\n};\n\nexport const init = (appConfig?: AppConfig) => {\n  if (!isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) return;\n  if (pollingTimeoutId) clearTimeout(pollingTimeoutId);\n\n  listenersByJobId = {};\n  retriesByJobId = {};\n  lastReceivedEventId = null;\n\n  config = appConfig || getBootstrapData().common.conf;\n  transport = config.GLOBAL_ASYNC_QUERIES_TRANSPORT || TRANSPORT_POLLING;\n  pollingDelayMs = config.GLOBAL_ASYNC_QUERIES_POLLING_DELAY || 500;\n\n  try {\n    lastReceivedEventId = localStorage.getItem(LOCALSTORAGE_KEY);\n  } catch (err) {\n    logging.warn('Failed to fetch last event Id from localStorage');\n  }\n\n  if (transport === TRANSPORT_POLLING) {\n    loadEventsFromApi();\n  }\n  if (transport === TRANSPORT_WS) {\n    wsConnect();\n  }\n};\n\ninit();\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport { UserRoles } from 'src/types/bootstrapTypes';\n\nexport const findPermission = memoizeOne(\n  (perm: string, view: string, roles?: UserRoles | null) =>\n    !!roles &&\n    Object.values(roles).some(permissions =>\n      permissions.some(([perm_, view_]) => perm_ === perm && view_ === view),\n    ),\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dataset } from '@superset-ui/chart-controls';\n\nexport const getDatasourceUid = (datasource: Dataset) =>\n  datasource.uid ?? `${datasource.id ?? 'None'}__${datasource.type}`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TableTab } from 'src/views/CRUD/types';\nimport { DashboardContextForExplore } from 'src/types/DashboardContextForExplore';\n\nexport enum LocalStorageKeys {\n  /**\n   * START LEGACY LOCAL STORAGE KEYS\n   *\n   * Do not follow the patterns here for key names. Keys should instead be namespaced to avoid\n   * collisions.\n   *\n   * TODO: Update all local storage keys to follow the new pattern. This is a breaking change,\n   * and therefore should be done in a major release.\n   */\n  filter_box_transition_snoozed_at = 'filter_box_transition_snoozed_at',\n  db = 'db',\n  chart_split_sizes = 'chart_split_sizes',\n  controls_width = 'controls_width',\n  datasource_width = 'datasource_width',\n  is_datapanel_open = 'is_datapanel_open',\n  homepage_chart_filter = 'homepage_chart_filter',\n  homepage_dashboard_filter = 'homepage_dashboard_filter',\n  homepage_collapse_state = 'homepage_collapse_state',\n  homepage_activity_filter = 'homepage_activity_filter',\n  datasetname_set_successful = 'datasetname_set_successful',\n  /** END LEGACY LOCAL STORAGE KEYS */\n\n  /**\n   * New local storage keys should be namespaced to avoid collisions. Keys should be named in the\n   * form [namespace]__[key].\n   *\n   * Example:\n   * sqllab__is_autocomplete_enabled\n   */\n  sqllab__is_autocomplete_enabled = 'sqllab__is_autocomplete_enabled',\n  explore__data_table_original_formatted_time_columns = 'explore__data_table_original_formatted_time_columns',\n  dashboard__custom_filter_bar_widths = 'dashboard__custom_filter_bar_widths',\n  dashboard__explore_context = 'dashboard__explore_context',\n  dashboard__editor_show_only_my_charts = 'dashboard__editor_show_only_my_charts',\n  common__resizable_sidebar_widths = 'common__resizable_sidebar_widths',\n}\n\nexport type LocalStorageValues = {\n  filter_box_transition_snoozed_at: Record<number, number>;\n  db: object | null;\n  chart_split_sizes: [number, number];\n  controls_width: number;\n  datasource_width: number;\n  is_datapanel_open: boolean;\n  homepage_chart_filter: TableTab;\n  homepage_dashboard_filter: TableTab;\n  homepage_collapse_state: string[];\n  datasetname_set_successful: boolean;\n  homepage_activity_filter: TableTab | null;\n  sqllab__is_autocomplete_enabled: boolean;\n  explore__data_table_original_formatted_time_columns: Record<string, string[]>;\n  dashboard__custom_filter_bar_widths: Record<string, number>;\n  dashboard__explore_context: Record<string, DashboardContextForExplore>;\n  dashboard__editor_show_only_my_charts: boolean;\n  common__resizable_sidebar_widths: Record<string, number>;\n};\n\n/*\n * This function should not be used directly, as it doesn't provide any type safety or any\n * guarantees that the globally namespaced localstorage key is correct.\n *\n * Instead, use getItem and setItem. Any legacy uses should be updated/migrated in future\n * Superset versions (as they may require breaking changes).\n * */\nexport function dangerouslyGetItemDoNotUse(\n  key: string,\n  defaultValue: any,\n): any {\n  try {\n    const value = localStorage.getItem(key);\n    if (value === null) {\n      return defaultValue;\n    }\n    return JSON.parse(value);\n  } catch {\n    return defaultValue;\n  }\n}\n\n/*\n * This function should not be used directly, as it doesn't provide any type safety or any\n * guarantees that the globally namespaced localstorage key is correct.\n *\n * Instead, use getItem and setItem. Any legacy uses should be updated/migrated in future\n * Superset versions (as they may require breaking changes).\n * */\nexport function dangerouslySetItemDoNotUse(key: string, value: any): void {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch {\n    // Catch in case localStorage is unavailable\n  }\n}\n\nexport function getItem<K extends LocalStorageKeys>(\n  key: K,\n  defaultValue: LocalStorageValues[K],\n): LocalStorageValues[K] {\n  return dangerouslyGetItemDoNotUse(key, defaultValue);\n}\n\nexport function setItem<K extends LocalStorageKeys>(\n  key: K,\n  value: LocalStorageValues[K],\n): void {\n  dangerouslySetItemDoNotUse(key, value);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * A Stringify function that will not crash when it runs into circular JSON references,\n * unlike JSON.stringify. Any circular references are simply omitted, as if there had\n * been no data present\n * @param object any JSON object to be stringified\n */\nexport function safeStringify(object: any): string {\n  const cache = new Set();\n  return JSON.stringify(object, (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (cache.has(value)) {\n        // We've seen this object before\n        try {\n          // Quick deep copy to duplicate if this is a repeat rather than a circle.\n          return JSON.parse(JSON.stringify(value));\n        } catch (err) {\n          // Discard key if value cannot be duplicated.\n          return; // eslint-disable-line consistent-return\n        }\n      }\n      // Store the value in our cache.\n      cache.add(value);\n    }\n    return value;\n  });\n}\n","/* Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nconst loadModule = () => {\n  try {\n    // eslint-disable-next-line global-require, import/no-unresolved\n    return require('../../../superset_text') || {};\n  } catch (e) {\n    return {};\n  }\n};\n\nconst supersetText = loadModule();\n\nexport default supersetText;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  isDefined,\n  JsonObject,\n  QueryFormData,\n  SupersetClient,\n} from '@superset-ui/core';\nimport rison from 'rison';\nimport { isEmpty } from 'lodash';\nimport {\n  RESERVED_CHART_URL_PARAMS,\n  RESERVED_DASHBOARD_URL_PARAMS,\n  URL_PARAMS,\n} from '../constants';\nimport { getActiveFilters } from '../dashboard/util/activeDashboardFilters';\nimport serializeActiveFilterValues from '../dashboard/util/serializeActiveFilterValues';\n\nexport type UrlParamType = 'string' | 'number' | 'boolean' | 'object' | 'rison';\nexport type UrlParam = typeof URL_PARAMS[keyof typeof URL_PARAMS];\nexport function getUrlParam(\n  param: UrlParam & { type: 'string' },\n): string | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'number' },\n): number | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'boolean' },\n): boolean | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'object' },\n): object | null;\nexport function getUrlParam(param: UrlParam & { type: 'rison' }): object | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'rison | string' },\n): string | object | null;\nexport function getUrlParam({ name, type }: UrlParam): unknown {\n  const urlParam = new URLSearchParams(window.location.search).get(name);\n  switch (type) {\n    case 'number':\n      if (!urlParam) {\n        return null;\n      }\n      if (urlParam.toLowerCase() === 'true') {\n        return 1;\n      }\n      if (urlParam.toLowerCase() === 'false') {\n        return 0;\n      }\n      if (!Number.isNaN(Number(urlParam))) {\n        return Number(urlParam);\n      }\n      return null;\n    case 'object':\n      if (!urlParam) {\n        return null;\n      }\n      return JSON.parse(urlParam);\n    case 'boolean':\n      if (!urlParam) {\n        return null;\n      }\n      return urlParam.toLowerCase() !== 'false' && urlParam !== '0';\n    case 'rison':\n      if (!urlParam) {\n        return null;\n      }\n      try {\n        return rison.decode(urlParam);\n      } catch {\n        return urlParam;\n      }\n    default:\n      return urlParam;\n  }\n}\n\nfunction getUrlParams(excludedParams: string[]): URLSearchParams {\n  const urlParams = new URLSearchParams();\n  const currentParams = new URLSearchParams(window.location.search);\n  currentParams.forEach((value, key) => {\n    if (!excludedParams.includes(key)) urlParams.append(key, value);\n  });\n  return urlParams;\n}\n\nexport type UrlParamEntries = [string, string][];\n\nfunction getUrlParamEntries(urlParams: URLSearchParams): UrlParamEntries {\n  const urlEntries: [string, string][] = [];\n  urlParams.forEach((value, key) => urlEntries.push([key, value]));\n  return urlEntries;\n}\n\nfunction getChartUrlParams(excludedUrlParams?: string[]): UrlParamEntries {\n  const excludedParams = excludedUrlParams || RESERVED_CHART_URL_PARAMS;\n  const urlParams = getUrlParams(excludedParams);\n  const filterBoxFilters = getActiveFilters();\n  if (\n    !isEmpty(filterBoxFilters) &&\n    !excludedParams.includes(URL_PARAMS.preselectFilters.name)\n  )\n    urlParams.append(\n      URL_PARAMS.preselectFilters.name,\n      JSON.stringify(serializeActiveFilterValues(getActiveFilters())),\n    );\n  return getUrlParamEntries(urlParams);\n}\n\nfunction getDashboardUrlParams(): UrlParamEntries {\n  const urlParams = getUrlParams(RESERVED_DASHBOARD_URL_PARAMS);\n  const filterBoxFilters = getActiveFilters();\n  if (!isEmpty(filterBoxFilters))\n    urlParams.append(\n      URL_PARAMS.preselectFilters.name,\n      JSON.stringify(serializeActiveFilterValues(getActiveFilters())),\n    );\n  return getUrlParamEntries(urlParams);\n}\n\nfunction getPermalink(endpoint: string, jsonPayload: JsonObject) {\n  return SupersetClient.post({\n    endpoint,\n    jsonPayload,\n  }).then(result => result.json.url as string);\n}\n\nexport function getChartPermalink(\n  formData: Pick<QueryFormData, 'datasource'>,\n  excludedUrlParams?: string[],\n) {\n  return getPermalink('/api/v1/explore/permalink', {\n    formData,\n    urlParams: getChartUrlParams(excludedUrlParams),\n  });\n}\n\nexport function getDashboardPermalink({\n  dashboardId,\n  dataMask,\n  activeTabs,\n  anchor, // the anchor part of the link which corresponds to the tab/chart id\n}: {\n  dashboardId: string | number;\n  /**\n   * Current applied data masks (for native filters).\n   */\n  dataMask: JsonObject;\n  /**\n   * Current active tabs in the dashboard.\n   */\n  activeTabs: string[];\n  /**\n   * The \"anchor\" component for the permalink. It will be scrolled into view\n   * and highlighted upon page load.\n   */\n  anchor?: string;\n}) {\n  // only encode filter box state if non-empty\n  return getPermalink(`/api/v1/dashboard/${dashboardId}/permalink`, {\n    urlParams: getDashboardUrlParams(),\n    dataMask,\n    activeTabs,\n    anchor,\n  });\n}\n\nconst externalUrlRegex =\n  /^([^:/?#]+:)?(?:(\\/\\/)?([^/?#]*))?([^?#]+)?(\\?[^#]*)?(#.*)?/;\n\n// group 1 matches protocol\n// group 2 matches '//'\n// group 3 matches hostname\nexport function isUrlExternal(url: string) {\n  const match = url.match(externalUrlRegex) || [];\n  return (\n    (typeof match[1] === 'string' && match[1].length > 0) ||\n    match[2] === '//' ||\n    (typeof match[3] === 'string' && match[3].length > 0)\n  );\n}\n\nexport function parseUrl(url: string) {\n  const match = url.match(externalUrlRegex) || [];\n  // if url is external but start with protocol or '//',\n  // it can't be used correctly with <a> element\n  // in such case, add '//' prefix\n  if (isUrlExternal(url) && !isDefined(match[1]) && !url.startsWith('//')) {\n    return `//${url}`;\n  }\n  return url;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { useState, useEffect, useCallback } from 'react';\nimport { makeApi, SupersetClient, t, JsonObject } from '@superset-ui/core';\n\nimport {\n  createErrorHandler,\n  getAlreadyExists,\n  getPasswordsNeeded,\n  hasTerminalValidation,\n  getSSHPasswordsNeeded,\n  getSSHPrivateKeysNeeded,\n  getSSHPrivateKeyPasswordsNeeded,\n} from 'src/views/CRUD/utils';\nimport { FetchDataConfig } from 'src/components/ListView';\nimport { FilterValue } from 'src/components/ListView/types';\nimport Chart, { Slice } from 'src/types/Chart';\nimport copyTextToClipboard from 'src/utils/copy';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport SupersetText from 'src/utils/textUtils';\nimport { FavoriteStatus, ImportResourceName, DatabaseObject } from './types';\n\ninterface ListViewResourceState<D extends object = any> {\n  loading: boolean;\n  collection: D[];\n  count: number;\n  permissions: string[];\n  lastFetchDataConfig: FetchDataConfig | null;\n  bulkSelectEnabled: boolean;\n  lastFetched?: string;\n}\n\nconst parsedErrorMessage = (\n  errorMessage: Record<string, string[] | string> | string,\n) => {\n  if (typeof errorMessage === 'string') {\n    return errorMessage;\n  }\n  return Object.entries(errorMessage)\n    .map(([key, value]) => {\n      if (Array.isArray(value)) {\n        return `(${key}) ${value.join(', ')}`;\n      }\n      return `(${key}) ${value}`;\n    })\n    .join('\\n');\n};\n\nexport function useListViewResource<D extends object = any>(\n  resource: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n  infoEnable = true,\n  defaultCollectionValue: D[] = [],\n  baseFilters?: FilterValue[], // must be memoized\n  initialLoadingState = true,\n) {\n  const [state, setState] = useState<ListViewResourceState<D>>({\n    count: 0,\n    collection: defaultCollectionValue,\n    loading: initialLoadingState,\n    lastFetchDataConfig: null,\n    permissions: [],\n    bulkSelectEnabled: false,\n  });\n\n  function updateState(update: Partial<ListViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  function toggleBulkSelect() {\n    updateState({ bulkSelectEnabled: !state.bulkSelectEnabled });\n  }\n\n  useEffect(() => {\n    if (!infoEnable) return;\n    SupersetClient.get({\n      endpoint: `/api/v1/${resource}/_info?q=${rison.encode({\n        keys: ['permissions'],\n      })}`,\n    }).then(\n      ({ json: infoJson = {} }) => {\n        updateState({\n          permissions: infoJson.permissions,\n        });\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t(\n            'An error occurred while fetching %s info: %s',\n            resourceLabel,\n            errMsg,\n          ),\n        ),\n      ),\n    );\n  }, []);\n\n  function hasPerm(perm: string) {\n    if (!state.permissions.length) {\n      return false;\n    }\n\n    return Boolean(state.permissions.find(p => p === perm));\n  }\n\n  const fetchData = useCallback(\n    ({\n      pageIndex,\n      pageSize,\n      sortBy,\n      filters: filterValues,\n    }: FetchDataConfig) => {\n      // set loading state, cache the last config for refreshing data.\n      updateState({\n        lastFetchDataConfig: {\n          filters: filterValues,\n          pageIndex,\n          pageSize,\n          sortBy,\n        },\n        loading: true,\n      });\n\n      const filterExps = (baseFilters || [])\n        .concat(filterValues)\n        .map(({ id, operator: opr, value }) => ({\n          col: id,\n          opr,\n          value:\n            value && typeof value === 'object' && 'value' in value\n              ? value.value\n              : value,\n        }));\n\n      const queryParams = rison.encode_uri({\n        order_column: sortBy[0].id,\n        order_direction: sortBy[0].desc ? 'desc' : 'asc',\n        page: pageIndex,\n        page_size: pageSize,\n        ...(filterExps.length ? { filters: filterExps } : {}),\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/${resource}/?q=${queryParams}`,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              collection: json.result,\n              count: json.count,\n              lastFetched: new Date().toISOString(),\n            });\n          },\n          createErrorHandler(errMsg =>\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                errMsg,\n              ),\n            ),\n          ),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [baseFilters],\n  );\n\n  return {\n    state: {\n      loading: state.loading,\n      resourceCount: state.count,\n      resourceCollection: state.collection,\n      bulkSelectEnabled: state.bulkSelectEnabled,\n      lastFetched: state.lastFetched,\n    },\n    setResourceCollection: (update: D[]) =>\n      updateState({\n        collection: update,\n      }),\n    hasPerm,\n    fetchData,\n    toggleBulkSelect,\n    refreshData: (provideConfig?: FetchDataConfig) => {\n      if (state.lastFetchDataConfig) {\n        return fetchData(state.lastFetchDataConfig);\n      }\n      if (provideConfig) {\n        return fetchData(provideConfig);\n      }\n      return null;\n    },\n  };\n}\n\n// In the same vein as above, a hook for viewing a single instance of a resource (given id)\ninterface SingleViewResourceState<D extends object = any> {\n  loading: boolean;\n  resource: D | null;\n  error: any | null;\n}\n\nexport function useSingleViewResource<D extends object = any>(\n  resourceName: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n  path_suffix = '',\n) {\n  const [state, setState] = useState<SingleViewResourceState<D>>({\n    loading: false,\n    resource: null,\n    error: null,\n  });\n\n  function updateState(update: Partial<SingleViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const fetchResource = useCallback(\n    (resourceID: number) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      const baseEndpoint = `/api/v1/${resourceName}/${resourceID}`;\n      const endpoint =\n        path_suffix !== '' ? `${baseEndpoint}/${path_suffix}` : baseEndpoint;\n      return SupersetClient.get({\n        endpoint,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: json.result,\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                parsedErrorMessage(errMsg),\n              ),\n            );\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const createResource = useCallback(\n    (resource: D, hideToast = false) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { id: json.id, ...json.result },\n              error: null,\n            });\n            return json.id;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            // we did not want toasts for db-connection-ui but did not want to disable it everywhere\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while creating %ss: %s',\n                  resourceLabel,\n                  parsedErrorMessage(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const updateResource = useCallback(\n    (resourceID: number, resource: D, hideToast = false, setLoading = true) => {\n      // Set loading state\n      if (setLoading) {\n        updateState({\n          loading: true,\n        });\n      }\n\n      return SupersetClient.put({\n        endpoint: `/api/v1/${resourceName}/${resourceID}`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { ...json.result, id: json.id },\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler(errMsg => {\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while fetching %ss: %s',\n                  resourceLabel,\n                  JSON.stringify(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n\n            return errMsg;\n          }),\n        )\n        .finally(() => {\n          if (setLoading) {\n            updateState({ loading: false });\n          }\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const clearError = () =>\n    updateState({\n      error: null,\n    });\n\n  return {\n    state,\n    setResource: (update: D) =>\n      updateState({\n        resource: update,\n      }),\n    fetchResource,\n    createResource,\n    updateResource,\n    clearError,\n  };\n}\n\ninterface ImportResourceState {\n  loading: boolean;\n  passwordsNeeded: string[];\n  alreadyExists: string[];\n  sshPasswordNeeded: string[];\n  sshPrivateKeyNeeded: string[];\n  sshPrivateKeyPasswordNeeded: string[];\n  failed: boolean;\n}\n\nexport function useImportResource(\n  resourceName: ImportResourceName,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n) {\n  const [state, setState] = useState<ImportResourceState>({\n    loading: false,\n    passwordsNeeded: [],\n    alreadyExists: [],\n    sshPasswordNeeded: [],\n    sshPrivateKeyNeeded: [],\n    sshPrivateKeyPasswordNeeded: [],\n    failed: false,\n  });\n\n  function updateState(update: Partial<ImportResourceState>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const importResource = useCallback(\n    (\n      bundle: File,\n      databasePasswords: Record<string, string> = {},\n      sshTunnelPasswords: Record<string, string> = {},\n      sshTunnelPrivateKey: Record<string, string> = {},\n      sshTunnelPrivateKeyPasswords: Record<string, string> = {},\n      overwrite = false,\n    ) => {\n      // Set loading state\n      updateState({\n        loading: true,\n        failed: false,\n      });\n\n      const formData = new FormData();\n      formData.append('formData', bundle);\n\n      const RE_EXPORT_TEXT = t(\n        'Please re-export your file and try importing again',\n      );\n\n      /* The import bundle never contains database passwords; if required\n       * they should be provided by the user during import.\n       */\n      if (databasePasswords) {\n        formData.append('passwords', JSON.stringify(databasePasswords));\n      }\n      /* If the imported model already exists the user needs to confirm\n       * that they want to overwrite it.\n       */\n      if (overwrite) {\n        formData.append('overwrite', 'true');\n      }\n      /* The import bundle may contain ssh tunnel passwords; if required\n       * they should be provided by the user during import.\n       */\n      if (sshTunnelPasswords) {\n        formData.append(\n          'ssh_tunnel_passwords',\n          JSON.stringify(sshTunnelPasswords),\n        );\n      }\n      /* The import bundle may contain ssh tunnel private_key; if required\n       * they should be provided by the user during import.\n       */\n      if (sshTunnelPrivateKey) {\n        formData.append(\n          'ssh_tunnel_private_keys',\n          JSON.stringify(sshTunnelPrivateKey),\n        );\n      }\n      /* The import bundle may contain ssh tunnel private_key_password; if required\n       * they should be provided by the user during import.\n       */\n      if (sshTunnelPrivateKeyPasswords) {\n        formData.append(\n          'ssh_tunnel_private_key_passwords',\n          JSON.stringify(sshTunnelPrivateKeyPasswords),\n        );\n      }\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/import/`,\n        body: formData,\n        headers: { Accept: 'application/json' },\n      })\n        .then(() => {\n          updateState({\n            passwordsNeeded: [],\n            alreadyExists: [],\n            sshPasswordNeeded: [],\n            sshPrivateKeyNeeded: [],\n            sshPrivateKeyPasswordNeeded: [],\n            failed: false,\n          });\n          return true;\n        })\n        .catch(response =>\n          getClientErrorObject(response).then(error => {\n            updateState({\n              failed: true,\n            });\n            if (!error.errors) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  error.message || error.error,\n                ),\n              );\n              return false;\n            }\n            if (hasTerminalValidation(error.errors)) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  [\n                    ...error.errors.map(payload => payload.message),\n                    RE_EXPORT_TEXT,\n                  ].join('.\\n'),\n                ),\n              );\n            } else {\n              updateState({\n                passwordsNeeded: getPasswordsNeeded(error.errors),\n                sshPasswordNeeded: getSSHPasswordsNeeded(error.errors),\n                sshPrivateKeyNeeded: getSSHPrivateKeysNeeded(error.errors),\n                sshPrivateKeyPasswordNeeded: getSSHPrivateKeyPasswordsNeeded(\n                  error.errors,\n                ),\n                alreadyExists: getAlreadyExists(error.errors),\n              });\n            }\n            return false;\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [],\n  );\n\n  return { state, importResource };\n}\n\ntype FavoriteStatusResponse = {\n  result: Array<{\n    id: string;\n    value: boolean;\n  }>;\n};\n\nconst favoriteApis = {\n  chart: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/chart/favorite_status/',\n  }),\n  dashboard: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/dashboard/favorite_status/',\n  }),\n};\n\nexport function useFavoriteStatus(\n  type: 'chart' | 'dashboard',\n  ids: Array<string | number>,\n  handleErrorMsg: (message: string) => void,\n) {\n  const [favoriteStatus, setFavoriteStatus] = useState<FavoriteStatus>({});\n\n  const updateFavoriteStatus = (update: FavoriteStatus) =>\n    setFavoriteStatus(currentState => ({ ...currentState, ...update }));\n\n  useEffect(() => {\n    if (!ids.length) {\n      return;\n    }\n    favoriteApis[type](ids).then(\n      ({ result }) => {\n        const update = result.reduce((acc, element) => {\n          acc[element.id] = element.value;\n          return acc;\n        }, {});\n        updateFavoriteStatus(update);\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t('There was an error fetching the favorite status: %s', errMsg),\n        ),\n      ),\n    );\n  }, [ids, type, handleErrorMsg]);\n\n  const saveFaveStar = useCallback(\n    (id: number, isStarred: boolean) => {\n      const endpoint = `/api/v1/${type}/${id}/favorites/`;\n      const apiCall = isStarred\n        ? SupersetClient.delete({\n            endpoint,\n          })\n        : SupersetClient.post({ endpoint });\n\n      apiCall.then(\n        () => {\n          updateFavoriteStatus({\n            [id]: !isStarred,\n          });\n        },\n        createErrorHandler(errMsg =>\n          handleErrorMsg(\n            t('There was an error saving the favorite status: %s', errMsg),\n          ),\n        ),\n      );\n    },\n    [type],\n  );\n\n  return [saveFaveStar, favoriteStatus] as const;\n}\n\nexport const useChartEditModal = (\n  setCharts: (charts: Array<Chart>) => void,\n  charts: Array<Chart>,\n) => {\n  const [sliceCurrentlyEditing, setSliceCurrentlyEditing] =\n    useState<Slice | null>(null);\n\n  function openChartEditModal(chart: Chart) {\n    setSliceCurrentlyEditing({\n      slice_id: chart.id,\n      slice_name: chart.slice_name,\n      description: chart.description,\n      cache_timeout: chart.cache_timeout,\n      certified_by: chart.certified_by,\n      certification_details: chart.certification_details,\n      is_managed_externally: chart.is_managed_externally,\n    });\n  }\n\n  function closeChartEditModal() {\n    setSliceCurrentlyEditing(null);\n  }\n\n  function handleChartUpdated(edits: Chart) {\n    // update the chart in our state with the edited info\n    const newCharts = charts.map((chart: Chart) =>\n      chart.id === edits.id ? { ...chart, ...edits } : chart,\n    );\n    setCharts(newCharts);\n  }\n\n  return {\n    sliceCurrentlyEditing,\n    handleChartUpdated,\n    openChartEditModal,\n    closeChartEditModal,\n  };\n};\n\nexport const copyQueryLink = (\n  id: number,\n  addDangerToast: (arg0: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  copyTextToClipboard(() =>\n    Promise.resolve(\n      `${window.location.origin}/superset/sqllab?savedQueryId=${id}`,\n    ),\n  )\n    .then(() => {\n      addSuccessToast(t('Link Copied!'));\n    })\n    .catch(() => {\n      addDangerToast(t('Sorry, your browser does not support copying.'));\n    });\n};\n\nexport const getDatabaseImages = () => SupersetText.DB_IMAGES;\n\nexport const getConnectionAlert = () => SupersetText.DB_CONNECTION_ALERTS;\nexport const getDatabaseDocumentationLinks = () =>\n  SupersetText.DB_CONNECTION_DOC_LINKS;\n\nexport const testDatabaseConnection = (\n  connection: DatabaseObject,\n  handleErrorMsg: (errorMsg: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  SupersetClient.post({\n    endpoint: 'api/v1/database/test_connection/',\n    body: JSON.stringify(connection),\n    headers: { 'Content-Type': 'application/json' },\n  }).then(\n    () => {\n      addSuccessToast(t('Connection looks good!'));\n    },\n    createErrorHandler((errMsg: Record<string, string[] | string> | string) => {\n      handleErrorMsg(t('ERROR: %s', parsedErrorMessage(errMsg)));\n    }),\n  );\n};\n\nexport function useAvailableDatabases() {\n  const [availableDbs, setAvailableDbs] = useState<JsonObject | null>(null);\n\n  const getAvailable = useCallback(() => {\n    SupersetClient.get({\n      endpoint: `/api/v1/database/available/`,\n    }).then(({ json }) => {\n      setAvailableDbs(json);\n    });\n  }, [setAvailableDbs]);\n\n  return [availableDbs, getAvailable] as const;\n}\n\nconst transformDB = (db: Partial<DatabaseObject> | null) => {\n  if (db && Array.isArray(db?.catalog)) {\n    return {\n      ...db,\n      catalog: Object.assign(\n        {},\n        ...db.catalog.map((x: { name: string; value: string }) => ({\n          [x.name]: x.value,\n        })),\n      ),\n    };\n  }\n  return db;\n};\n\nexport function useDatabaseValidation() {\n  const [validationErrors, setValidationErrors] = useState<JsonObject | null>(\n    null,\n  );\n  const getValidation = useCallback(\n    (database: Partial<DatabaseObject> | null, onCreate = false) => {\n      if (database?.parameters?.ssh) {\n        // when ssh tunnel is enabled we don't want to render any validation errors\n        setValidationErrors(null);\n        return [];\n      }\n\n      return (\n        SupersetClient.post({\n          endpoint: '/api/v1/database/validate_parameters/',\n          body: JSON.stringify(transformDB(database)),\n          headers: { 'Content-Type': 'application/json' },\n        })\n          .then(() => {\n            setValidationErrors(null);\n          })\n          // eslint-disable-next-line consistent-return\n          .catch(e => {\n            if (typeof e.json === 'function') {\n              return e.json().then(({ errors = [] }: JsonObject) => {\n                const parsedErrors = errors\n                  .filter((error: { error_type: string }) => {\n                    const skipValidationError = ![\n                      'CONNECTION_MISSING_PARAMETERS_ERROR',\n                      'CONNECTION_ACCESS_DENIED_ERROR',\n                    ].includes(error.error_type);\n                    return skipValidationError || onCreate;\n                  })\n                  .reduce(\n                    (\n                      obj: {},\n                      {\n                        error_type,\n                        extra,\n                        message,\n                      }: {\n                        error_type: string;\n                        extra: {\n                          invalid?: string[];\n                          missing?: string[];\n                          name: string;\n                          catalog: {\n                            name: string;\n                            url: string;\n                            idx: number;\n                          };\n                          issue_codes?: {\n                            code?: number;\n                            message?: string;\n                          }[];\n                        };\n                        message: string;\n                      },\n                    ) => {\n                      if (extra.catalog) {\n                        if (extra.catalog.name) {\n                          return {\n                            ...obj,\n                            error_type,\n                            [extra.catalog.idx]: {\n                              name: message,\n                            },\n                          };\n                        }\n                        if (extra.catalog.url) {\n                          return {\n                            ...obj,\n                            error_type,\n                            [extra.catalog.idx]: {\n                              url: message,\n                            },\n                          };\n                        }\n\n                        return {\n                          ...obj,\n                          error_type,\n                          [extra.catalog.idx]: {\n                            name: message,\n                            url: message,\n                          },\n                        };\n                      }\n                      // if extra.invalid doesn't exist then the\n                      // error can't be mapped to a parameter\n                      // so leave it alone\n                      if (extra.invalid) {\n                        return {\n                          ...obj,\n                          [extra.invalid[0]]: message,\n                          error_type,\n                        };\n                      }\n                      if (extra.missing) {\n                        return {\n                          ...obj,\n                          error_type,\n                          ...Object.assign(\n                            {},\n                            ...extra.missing.map(field => ({\n                              [field]: 'This is a required field',\n                            })),\n                          ),\n                        };\n                      }\n                      if (extra.issue_codes?.length) {\n                        return {\n                          ...obj,\n                          error_type,\n                          description: message || extra.issue_codes[0]?.message,\n                        };\n                      }\n\n                      return obj;\n                    },\n                    {},\n                  );\n                setValidationErrors(parsedErrors);\n                return parsedErrors;\n              });\n            }\n            // eslint-disable-next-line no-console\n            console.error(e);\n          })\n      );\n    },\n    [setValidationErrors],\n  );\n\n  return [validationErrors, getValidation, setValidationErrors] as const;\n}\n\nexport const reportSelector = (\n  state: Record<string, any>,\n  resourceType: string,\n  resourceId?: number,\n) => {\n  if (resourceId) {\n    return state.reports[resourceType]?.[resourceId];\n  }\n  return null;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { QueryState } from '@superset-ui/core';\nimport { User } from 'src/types/bootstrapTypes';\nimport Database from 'src/types/Database';\nimport Owner from 'src/types/Owner';\n\nexport type FavoriteStatus = {\n  [id: number]: boolean;\n};\n\nexport enum TableTab {\n  Favorite = 'Favorite',\n  Mine = 'Mine',\n  Other = 'Other',\n  Viewed = 'Viewed',\n  Created = 'Created',\n  Edited = 'Edited',\n}\n\nexport type Filter = {\n  col: string;\n  opr: string;\n  value: string | number;\n};\n\nexport interface DashboardTableProps {\n  addDangerToast: (message: string) => void;\n  addSuccessToast: (message: string) => void;\n  user?: User;\n  mine: Array<Dashboard>;\n  showThumbnails?: boolean;\n  otherTabData: Array<Dashboard>;\n  otherTabFilters: Filter[];\n  otherTabTitle: string;\n}\n\nexport interface Dashboard {\n  certified_by?: string;\n  certification_details?: string;\n  changed_by_name: string;\n  changed_on_delta_humanized?: string;\n  changed_on_utc?: string;\n  changed_by: string;\n  dashboard_title: string;\n  slice_name?: string;\n  id: number;\n  published: boolean;\n  url: string;\n  thumbnail_url: string;\n  owners: Owner[];\n  loading?: boolean;\n}\n\nexport type SavedQueryObject = {\n  id: number;\n  changed_on: string;\n  changed_on_delta_humanized: string;\n  database: {\n    database_name: string;\n    id: number;\n  };\n  db_id: number;\n  description?: string;\n  label: string;\n  schema: string;\n  sql: string | null;\n  sql_tables?: { catalog?: string; schema: string; table: string }[];\n};\n\nexport interface QueryObject {\n  id: number;\n  changed_on: string;\n  database: {\n    database_name: string;\n  };\n  schema: string;\n  sql: string;\n  executed_sql: string | null;\n  sql_tables?: { catalog?: string; schema: string; table: string }[];\n  status: QueryState;\n  tab_name: string;\n  user: {\n    first_name: string;\n    id: number;\n    last_name: string;\n    username: string;\n  };\n  start_time: number;\n  end_time: number;\n  rows: number;\n  tmp_table_name: string;\n  tracking_url: string;\n}\n\nexport enum QueryObjectColumns {\n  id = 'id',\n  changed_on = 'changed_on',\n  database = 'database',\n  database_name = 'database.database_name',\n  schema = 'schema',\n  sql = 'sql',\n  executed_sql = 'executed_sql',\n  sql_tables = 'sql_tables',\n  status = 'status',\n  tab_name = 'tab_name',\n  user = 'user',\n  user_first_name = 'user.first_name',\n  start_time = 'start_time',\n  end_time = 'end_time',\n  rows = 'rows',\n  tmp_table_name = 'tmp_table_name',\n  tracking_url = 'tracking_url',\n}\n\nexport type ImportResourceName =\n  | 'chart'\n  | 'dashboard'\n  | 'database'\n  | 'dataset'\n  | 'saved_query';\n\nexport interface Tag {\n  changed_on_delta_humanized: string;\n  name: string;\n  id: number;\n  created_by: object;\n}\n\nexport type DatabaseObject = Partial<Database> &\n  Pick<Database, 'sqlalchemy_uri'>;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  css,\n  logging,\n  styled,\n  SupersetClient,\n  SupersetClientResponse,\n  SupersetTheme,\n  t,\n} from '@superset-ui/core';\nimport Chart from 'src/types/Chart';\nimport { intersection } from 'lodash';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FetchDataConfig, FilterValue } from 'src/components/ListView';\nimport SupersetText from 'src/utils/textUtils';\nimport { findPermission } from 'src/utils/findPermission';\nimport { User } from 'src/types/bootstrapTypes';\nimport { WelcomeTable } from 'src/features/home/types';\nimport { Dashboard, Filter, TableTab } from './types';\n\n// Modifies the rison encoding slightly to match the backend's rison encoding/decoding. Applies globally.\n// Code pulled from rison.js (https://github.com/Nanonid/rison), rison is licensed under the MIT license.\n(() => {\n  const risonRef: {\n    not_idchar: string;\n    not_idstart: string;\n    id_ok: RegExp;\n    next_id: RegExp;\n  } = rison as any;\n\n  const l = [];\n  for (let hi = 0; hi < 16; hi += 1) {\n    for (let lo = 0; lo < 16; lo += 1) {\n      if (hi + lo === 0) continue;\n      const c = String.fromCharCode(hi * 16 + lo);\n      if (!/\\w|[-_./~]/.test(c))\n        l.push(`\\\\u00${hi.toString(16)}${lo.toString(16)}`);\n    }\n  }\n\n  risonRef.not_idchar = l.join('');\n  risonRef.not_idstart = '-0123456789';\n\n  const idrx = `[^${risonRef.not_idstart}${risonRef.not_idchar}][^${risonRef.not_idchar}]*`;\n\n  risonRef.id_ok = new RegExp(`^${idrx}$`);\n  risonRef.next_id = new RegExp(idrx, 'g');\n})();\n\nexport const Actions = styled.div`\n  color: ${({ theme }) => theme.colors.grayscale.base};\n`;\n\nconst createFetchResourceMethod =\n  (method: string) =>\n  (\n    resource: string,\n    relation: string,\n    handleError: (error: Response) => void,\n    user?: { userId: string | number; firstName: string; lastName: string },\n  ) =>\n  async (filterValue = '', page: number, pageSize: number) => {\n    const resourceEndpoint = `/api/v1/${resource}/${method}/${relation}`;\n    const queryParams = rison.encode_uri({\n      filter: filterValue,\n      page,\n      page_size: pageSize,\n    });\n    const { json = {} } = await SupersetClient.get({\n      endpoint: `${resourceEndpoint}?q=${queryParams}`,\n    });\n\n    let fetchedLoggedUser = false;\n    const loggedUser = user\n      ? {\n          label: `${user.firstName} ${user.lastName}`,\n          value: user.userId,\n        }\n      : undefined;\n\n    const data: { label: string; value: string | number }[] = [];\n    json?.result\n      ?.filter(({ text }: { text: string }) => text.trim().length > 0)\n      .forEach(({ text, value }: { text: string; value: string | number }) => {\n        if (\n          loggedUser &&\n          value === loggedUser.value &&\n          text === loggedUser.label\n        ) {\n          fetchedLoggedUser = true;\n        } else {\n          data.push({\n            label: text,\n            value,\n          });\n        }\n      });\n\n    if (loggedUser && (!filterValue || fetchedLoggedUser)) {\n      data.unshift(loggedUser);\n    }\n\n    return {\n      data,\n      totalCount: json?.count,\n    };\n  };\n\nexport const PAGE_SIZE = 5;\nconst getParams = (filters?: Filter[]) => {\n  const params = {\n    order_column: 'changed_on_delta_humanized',\n    order_direction: 'desc',\n    page: 0,\n    page_size: PAGE_SIZE,\n    filters,\n  };\n  if (!filters) delete params.filters;\n  return rison.encode(params);\n};\n\nexport const getEditedObjects = (userId: string | number) => {\n  const filters = {\n    edited: [\n      {\n        col: 'changed_by',\n        opr: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  const batch = [\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/?q=${getParams(filters.edited)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${getParams(filters.edited)}`,\n    }),\n  ];\n  return Promise.all(batch)\n    .then(([editedCharts, editedDashboards]) => {\n      const res = {\n        editedDash: editedDashboards.json?.result.slice(0, 3),\n        editedChart: editedCharts.json?.result.slice(0, 3),\n      };\n      return res;\n    })\n    .catch(err => err);\n};\n\nexport const getUserOwnedObjects = (\n  userId: string | number,\n  resource: string,\n  filters: Filter[] = [\n    {\n      col: 'owners',\n      opr: 'rel_m_m',\n      value: `${userId}`,\n    },\n  ],\n) =>\n  SupersetClient.get({\n    endpoint: `/api/v1/${resource}/?q=${getParams(filters)}`,\n  }).then(res => res.json?.result);\n\nexport const getRecentActivityObjs = (\n  userId: string | number,\n  recent: string,\n  addDangerToast: (arg1: string, arg2: any) => any,\n  filters: Filter[],\n) =>\n  SupersetClient.get({ endpoint: recent }).then(recentsRes => {\n    const res: any = {};\n    const newBatch = [\n      SupersetClient.get({\n        endpoint: `/api/v1/chart/?q=${getParams(filters)}`,\n      }),\n      SupersetClient.get({\n        endpoint: `/api/v1/dashboard/?q=${getParams(filters)}`,\n      }),\n    ];\n    return Promise.all(newBatch)\n      .then(([chartRes, dashboardRes]) => {\n        res.other = [...chartRes.json.result, ...dashboardRes.json.result];\n        res.viewed = recentsRes.json.result;\n        return res;\n      })\n      .catch(errMsg =>\n        addDangerToast(\n          t('There was an error fetching your recent activity:'),\n          errMsg,\n        ),\n      );\n  });\n\nexport const createFetchRelated = createFetchResourceMethod('related');\nexport const createFetchDistinct = createFetchResourceMethod('distinct');\n\nexport function createErrorHandler(\n  handleErrorFunc: (\n    errMsg?: string | Record<string, string[] | string>,\n  ) => void,\n) {\n  return async (e: SupersetClientResponse | string) => {\n    const parsedError = await getClientErrorObject(e);\n    // Taking the first error returned from the API\n    // @ts-ignore\n    const errorsArray = parsedError?.errors;\n    const config = await SupersetText;\n    if (\n      errorsArray?.length &&\n      config?.ERRORS &&\n      errorsArray[0].error_type in config.ERRORS\n    ) {\n      parsedError.message = config.ERRORS[errorsArray[0].error_type];\n    }\n    logging.error(e);\n    handleErrorFunc(parsedError.message || parsedError.error);\n  };\n}\n\nexport function handleChartDelete(\n  { id, slice_name: sliceName }: Chart,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  refreshData: (arg0?: FetchDataConfig | null) => void,\n  chartFilter?: string,\n  userId?: string | number,\n) {\n  const filters = {\n    pageIndex: 0,\n    pageSize: PAGE_SIZE,\n    sortBy: [\n      {\n        id: 'changed_on_delta_humanized',\n        desc: true,\n      },\n    ],\n    filters: [\n      {\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  SupersetClient.delete({\n    endpoint: `/api/v1/chart/${id}`,\n  }).then(\n    () => {\n      if (chartFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', sliceName));\n    },\n    () => {\n      addDangerToast(t('There was an issue deleting: %s', sliceName));\n    },\n  );\n}\n\nexport function handleDashboardDelete(\n  { id, dashboard_title: dashboardTitle }: Dashboard,\n  refreshData: (config?: FetchDataConfig | null) => void,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  dashboardFilter?: string,\n  userId?: string | number,\n) {\n  return SupersetClient.delete({\n    endpoint: `/api/v1/dashboard/${id}`,\n  }).then(\n    () => {\n      const filters = {\n        pageIndex: 0,\n        pageSize: PAGE_SIZE,\n        sortBy: [\n          {\n            id: 'changed_on_delta_humanized',\n            desc: true,\n          },\n        ],\n        filters: [\n          {\n            id: 'owners',\n            operator: 'rel_m_m',\n            value: `${userId}`,\n          },\n        ],\n      };\n      if (dashboardFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', dashboardTitle));\n    },\n    createErrorHandler(errMsg =>\n      addDangerToast(\n        t('There was an issue deleting %s: %s', dashboardTitle, errMsg),\n      ),\n    ),\n  );\n}\n\nexport function shortenSQL(sql: string, maxLines: number) {\n  let lines: string[] = sql.split('\\n');\n  if (lines.length >= maxLines) {\n    lines = lines.slice(0, maxLines);\n    lines.push('...');\n  }\n  return lines.join('\\n');\n}\n\n// loading card count for homepage\nexport const loadingCardCount = 5;\n\nconst breakpoints = [576, 768, 992, 1200];\nexport const mq = breakpoints.map(bp => `@media (max-width: ${bp}px)`);\n\nexport const CardContainer = styled.div<{\n  showThumbnails?: boolean | undefined;\n}>`\n  ${({ showThumbnails, theme }) => `\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${theme.gridUnit * 12}px ${theme.gridUnit * 4}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${showThumbnails ? '314' : '148'}px;\n    margin-top: ${theme.gridUnit * -6}px;\n    padding: ${\n      showThumbnails\n        ? `${theme.gridUnit * 8 + 3}px ${theme.gridUnit * 9}px`\n        : `${theme.gridUnit * 8 + 1}px ${theme.gridUnit * 9}px`\n    };\n  `}\n`;\n\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n  .ant-card-cover > div {\n    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */\n    height: 168px;\n  }\n`;\n\nexport const StyledIcon = (theme: SupersetTheme) => css`\n  margin: auto ${theme.gridUnit * 2}px auto 0;\n  color: ${theme.colors.grayscale.base};\n`;\n\nexport /* eslint-disable no-underscore-dangle */\nconst isNeedsPassword = (payload: any) =>\n  typeof payload === 'object' &&\n  Array.isArray(payload._schema) &&\n  !!payload._schema?.find(\n    (e: string) => e === 'Must provide a password for the database',\n  );\n\nexport /* eslint-disable no-underscore-dangle */\nconst isNeedsSSHPassword = (payload: any) =>\n  typeof payload === 'object' &&\n  Array.isArray(payload._schema) &&\n  !!payload._schema?.find(\n    (e: string) => e === 'Must provide a password for the ssh tunnel',\n  );\n\nexport /* eslint-disable no-underscore-dangle */\nconst isNeedsSSHPrivateKey = (payload: any) =>\n  typeof payload === 'object' &&\n  Array.isArray(payload._schema) &&\n  !!payload._schema?.find(\n    (e: string) => e === 'Must provide a private key for the ssh tunnel',\n  );\n\nexport /* eslint-disable no-underscore-dangle */\nconst isNeedsSSHPrivateKeyPassword = (payload: any) =>\n  typeof payload === 'object' &&\n  Array.isArray(payload._schema) &&\n  !!payload._schema?.find(\n    (e: string) =>\n      e === 'Must provide a private key password for the ssh tunnel',\n  );\n\nexport const isAlreadyExists = (payload: any) =>\n  typeof payload === 'string' &&\n  payload.includes('already exists and `overwrite=true` was not passed');\n\nexport const getPasswordsNeeded = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isNeedsPassword(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const getSSHPasswordsNeeded = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isNeedsSSHPassword(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const getSSHPrivateKeysNeeded = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isNeedsSSHPrivateKey(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const getSSHPrivateKeyPasswordsNeeded = (\n  errors: Record<string, any>[],\n) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isNeedsSSHPrivateKeyPassword(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const getAlreadyExists = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isAlreadyExists(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const hasTerminalValidation = (errors: Record<string, any>[]) =>\n  errors.some(error => {\n    const noIssuesCodes = Object.entries(error.extra).filter(\n      ([key]) => key !== 'issue_codes',\n    );\n\n    if (noIssuesCodes.length === 0) return true;\n\n    return !noIssuesCodes.every(\n      ([, payload]) =>\n        isNeedsPassword(payload) ||\n        isAlreadyExists(payload) ||\n        isNeedsSSHPassword(payload) ||\n        isNeedsSSHPrivateKey(payload) ||\n        isNeedsSSHPrivateKeyPassword(payload),\n    );\n  });\n\nexport const checkUploadExtensions = (\n  perm: Array<string>,\n  cons: Array<string>,\n) => {\n  if (perm !== undefined) {\n    return intersection(perm, cons).length > 0;\n  }\n  return false;\n};\n\nexport const uploadUserPerms = (\n  roles: Record<string, [string, string][]>,\n  csvExt: Array<string>,\n  colExt: Array<string>,\n  excelExt: Array<string>,\n  allowedExt: Array<string>,\n) => {\n  const canUploadCSV =\n    findPermission('can_this_form_get', 'CsvToDatabaseView', roles) &&\n    checkUploadExtensions(csvExt, allowedExt);\n  const canUploadColumnar =\n    checkUploadExtensions(colExt, allowedExt) &&\n    findPermission('can_this_form_get', 'ColumnarToDatabaseView', roles);\n  const canUploadExcel =\n    checkUploadExtensions(excelExt, allowedExt) &&\n    findPermission('can_this_form_get', 'ExcelToDatabaseView', roles);\n  return {\n    canUploadCSV,\n    canUploadColumnar,\n    canUploadExcel,\n    canUploadData: canUploadCSV || canUploadColumnar || canUploadExcel,\n  };\n};\n\nexport function getFilterValues(\n  tab: TableTab,\n  welcomeTable: WelcomeTable,\n  user?: User,\n  otherTabFilters?: Filter[],\n): FilterValue[] {\n  if (\n    tab === TableTab.Created ||\n    (welcomeTable === WelcomeTable.SavedQueries && tab === TableTab.Mine)\n  ) {\n    return [\n      {\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${user?.userId}`,\n      },\n    ];\n  }\n  if (welcomeTable === WelcomeTable.SavedQueries && tab === TableTab.Favorite) {\n    return [\n      {\n        id: 'id',\n        operator: 'saved_query_is_fav',\n        value: true,\n      },\n    ];\n  }\n  if (tab === TableTab.Mine && user) {\n    return [\n      {\n        id: 'owners',\n        operator: 'rel_m_m',\n        value: `${user.userId}`,\n      },\n    ];\n  }\n  if (\n    tab === TableTab.Favorite &&\n    [WelcomeTable.Dashboards, WelcomeTable.Charts].includes(welcomeTable)\n  ) {\n    return [\n      {\n        id: 'id',\n        operator:\n          welcomeTable === WelcomeTable.Dashboards\n            ? 'dashboard_is_favorite'\n            : 'chart_is_favorite',\n        value: true,\n      },\n    ];\n  }\n  if (tab === TableTab.Other) {\n    return (otherTabFilters || []).map(flt => ({\n      id: flt.col,\n      operator: flt.opr,\n      value: flt.value,\n    }));\n  }\n  return [];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  COLUMN_TYPE,\n  CHART_TYPE,\n  MARKDOWN_TYPE,\n  DYNAMIC_TYPE,\n} from './componentTypes';\n\nexport default function componentIsResizable(entity: { type: string }) {\n  return (\n    [COLUMN_TYPE, CHART_TYPE, MARKDOWN_TYPE, DYNAMIC_TYPE].indexOf(\n      entity.type,\n    ) > -1\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  DASHBOARD_GRID_TYPE,\n  CHART_TYPE,\n  COLUMN_TYPE,\n  MARKDOWN_TYPE,\n  TAB_TYPE,\n} from './componentTypes';\n\nconst typeToWrapChildLookup = {\n  [DASHBOARD_GRID_TYPE]: {\n    [CHART_TYPE]: true,\n    [COLUMN_TYPE]: true,\n    [MARKDOWN_TYPE]: true,\n  },\n\n  [TAB_TYPE]: {\n    [CHART_TYPE]: true,\n    [COLUMN_TYPE]: true,\n    [MARKDOWN_TYPE]: true,\n  },\n};\n\nexport default function shouldWrapChildInRow({ parentType, childType }) {\n  if (!parentType || !childType) return false;\n\n  const wrapChildLookup = typeToWrapChildLookup[parentType];\n  if (!wrapChildLookup) return false;\n\n  return Boolean(wrapChildLookup[childType]);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport componentIsResizable from './componentIsResizable';\nimport shouldWrapChildInRow from './shouldWrapChildInRow';\nimport newComponentFactory from './newComponentFactory';\nimport getComponentWidthFromDrop from './getComponentWidthFromDrop';\n\nimport { ROW_TYPE, TABS_TYPE, TAB_TYPE } from './componentTypes';\n\nexport default function newEntitiesFromDrop({ dropResult, layout }) {\n  const { dragging, destination } = dropResult;\n\n  const dragType = dragging.type;\n  const dropEntity = layout[destination.id];\n  const dropType = dropEntity.type;\n  let newDropChild = newComponentFactory(dragType, dragging.meta);\n  newDropChild.parents = (dropEntity.parents || []).concat(dropEntity.id);\n\n  if (componentIsResizable(dragging)) {\n    newDropChild.meta.width = // don't set a 0 width\n      getComponentWidthFromDrop({ dropResult, layout }) || undefined;\n  }\n\n  const wrapChildInRow = shouldWrapChildInRow({\n    parentType: dropType,\n    childType: dragType,\n  });\n\n  const newEntities = {\n    [newDropChild.id]: newDropChild,\n  };\n\n  if (wrapChildInRow) {\n    const rowWrapper = newComponentFactory(ROW_TYPE);\n    rowWrapper.children = [newDropChild.id];\n    rowWrapper.parents = (dropEntity.parents || []).concat(dropEntity.id);\n    newEntities[rowWrapper.id] = rowWrapper;\n    newDropChild.parents = rowWrapper.parents.concat(rowWrapper.id);\n    newDropChild = rowWrapper;\n  } else if (dragType === TABS_TYPE) {\n    // create a new tab component\n    const tabChild = newComponentFactory(TAB_TYPE);\n    tabChild.parents = (dropEntity.parents || []).concat(dropEntity.id);\n    newDropChild.children = [tabChild.id];\n    newEntities[tabChild.id] = tabChild;\n  }\n\n  const nextDropChildren = [...dropEntity.children];\n  nextDropChildren.splice(destination.index, 0, newDropChild.id);\n\n  newEntities[destination.id] = {\n    ...dropEntity,\n    children: nextDropChildren,\n  };\n\n  return newEntities;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  DASHBOARD_ROOT_ID,\n  DASHBOARD_GRID_ID,\n  NEW_COMPONENTS_SOURCE_ID,\n  DASHBOARD_HEADER_ID,\n} from '../util/constants';\nimport componentIsResizable from '../util/componentIsResizable';\nimport findParentId from '../util/findParentId';\nimport getComponentWidthFromDrop from '../util/getComponentWidthFromDrop';\nimport updateComponentParentsList from '../util/updateComponentParentsList';\nimport newComponentFactory from '../util/newComponentFactory';\nimport newEntitiesFromDrop from '../util/newEntitiesFromDrop';\nimport reorderItem from '../util/dnd-reorder';\nimport shouldWrapChildInRow from '../util/shouldWrapChildInRow';\nimport { ROW_TYPE, TAB_TYPE, TABS_TYPE } from '../util/componentTypes';\n\nimport {\n  UPDATE_COMPONENTS,\n  UPDATE_COMPONENTS_PARENTS_LIST,\n  DELETE_COMPONENT,\n  CREATE_COMPONENT,\n  MOVE_COMPONENT,\n  CREATE_TOP_LEVEL_TABS,\n  DELETE_TOP_LEVEL_TABS,\n  DASHBOARD_TITLE_CHANGED,\n} from '../actions/dashboardLayout';\n\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport function recursivelyDeleteChildren(\n  componentId,\n  componentParentId,\n  nextComponents,\n) {\n  // delete child and it's children\n  const component = nextComponents?.[componentId];\n  if (component) {\n    // eslint-disable-next-line no-param-reassign\n    delete nextComponents[componentId];\n\n    const { children = [] } = component;\n    children?.forEach?.(childId => {\n      recursivelyDeleteChildren(childId, componentId, nextComponents);\n    });\n\n    const parent = nextComponents?.[componentParentId];\n    if (Array.isArray(parent?.children)) {\n      // may have been deleted in another recursion\n      const componentIndex = parent.children.indexOf(componentId);\n      if (componentIndex > -1) {\n        const nextChildren = [...parent.children];\n        nextChildren.splice(componentIndex, 1);\n        // eslint-disable-next-line no-param-reassign\n        nextComponents[componentParentId] = {\n          ...parent,\n          children: nextChildren,\n        };\n      }\n    }\n  }\n}\n\nconst actionHandlers = {\n  [HYDRATE_DASHBOARD](state, action) {\n    return {\n      ...action.data.dashboardLayout.present,\n    };\n  },\n\n  [UPDATE_COMPONENTS](state, action) {\n    const {\n      payload: { nextComponents },\n    } = action;\n    return {\n      ...state,\n      ...nextComponents,\n    };\n  },\n\n  [DELETE_COMPONENT](state, action) {\n    const {\n      payload: { id, parentId },\n    } = action;\n\n    if (!parentId || !id || !state[id] || !state[parentId]) return state;\n\n    const nextComponents = { ...state };\n\n    recursivelyDeleteChildren(id, parentId, nextComponents);\n    const nextParent = nextComponents[parentId];\n    if (nextParent?.type === ROW_TYPE && nextParent?.children?.length === 0) {\n      const grandparentId = findParentId({\n        childId: parentId,\n        layout: nextComponents,\n      });\n      recursivelyDeleteChildren(parentId, grandparentId, nextComponents);\n    }\n\n    return nextComponents;\n  },\n\n  [CREATE_COMPONENT](state, action) {\n    const {\n      payload: { dropResult },\n    } = action;\n\n    const newEntities = newEntitiesFromDrop({ dropResult, layout: state });\n\n    return {\n      ...state,\n      ...newEntities,\n    };\n  },\n\n  [MOVE_COMPONENT](state, action) {\n    const {\n      payload: { dropResult },\n    } = action;\n    const { source, destination, dragging } = dropResult;\n\n    if (!source || !destination || !dragging) return state;\n\n    const nextEntities = reorderItem({\n      entitiesMap: state,\n      source,\n      destination,\n    });\n\n    if (componentIsResizable(nextEntities[dragging.id])) {\n      // update component width if it changed\n      const nextWidth =\n        getComponentWidthFromDrop({\n          dropResult,\n          layout: state,\n        }) || undefined; // don't set a 0 width\n      if ((nextEntities[dragging.id].meta || {}).width !== nextWidth) {\n        nextEntities[dragging.id] = {\n          ...nextEntities[dragging.id],\n          meta: {\n            ...nextEntities[dragging.id].meta,\n            width: nextWidth,\n          },\n        };\n      }\n    }\n\n    // wrap the dragged component in a row depending on destination type\n    const wrapInRow = shouldWrapChildInRow({\n      parentType: destination.type,\n      childType: dragging.type,\n    });\n\n    if (wrapInRow) {\n      const destinationEntity = nextEntities[destination.id];\n      const destinationChildren = destinationEntity.children;\n      const newRow = newComponentFactory(ROW_TYPE);\n      newRow.children = [destinationChildren[destination.index]];\n      newRow.parents = (destinationEntity.parents || []).concat(destination.id);\n      destinationChildren[destination.index] = newRow.id;\n      nextEntities[newRow.id] = newRow;\n    }\n\n    return {\n      ...state,\n      ...nextEntities,\n    };\n  },\n\n  [CREATE_TOP_LEVEL_TABS](state, action) {\n    const {\n      payload: { dropResult },\n    } = action;\n    const { source, dragging } = dropResult;\n\n    // move children of current root to be children of the dragging tab\n    const rootComponent = state[DASHBOARD_ROOT_ID];\n    const topLevelId = rootComponent.children[0];\n    const topLevelComponent = state[topLevelId];\n\n    if (source.id !== NEW_COMPONENTS_SOURCE_ID) {\n      // component already exists\n      const draggingTabs = state[dragging.id];\n      const draggingTabId = draggingTabs.children[0];\n      const draggingTab = state[draggingTabId];\n\n      // move all children except the one that is dragging\n      const childrenToMove = [...topLevelComponent.children].filter(\n        id => id !== dragging.id,\n      );\n\n      return {\n        ...state,\n        [DASHBOARD_ROOT_ID]: {\n          ...rootComponent,\n          children: [dragging.id],\n        },\n        [topLevelId]: {\n          ...topLevelComponent,\n          children: [],\n        },\n        [draggingTabId]: {\n          ...draggingTab,\n          children: [...draggingTab.children, ...childrenToMove],\n        },\n      };\n    }\n\n    // create new component\n    const newEntities = newEntitiesFromDrop({ dropResult, layout: state });\n    const newEntitiesArray = Object.values(newEntities);\n    const tabComponent = newEntitiesArray.find(\n      component => component.type === TAB_TYPE,\n    );\n    const tabsComponent = newEntitiesArray.find(\n      component => component.type === TABS_TYPE,\n    );\n\n    tabComponent.children = [...topLevelComponent.children];\n    newEntities[topLevelId] = { ...topLevelComponent, children: [] };\n    newEntities[DASHBOARD_ROOT_ID] = {\n      ...rootComponent,\n      children: [tabsComponent.id],\n    };\n\n    return {\n      ...state,\n      ...newEntities,\n    };\n  },\n\n  [DELETE_TOP_LEVEL_TABS](state) {\n    const rootComponent = state[DASHBOARD_ROOT_ID];\n    const topLevelId = rootComponent.children[0];\n    const topLevelTabs = state[topLevelId];\n\n    if (topLevelTabs.type !== TABS_TYPE) return state;\n\n    let childrenToMove = [];\n    const nextEntities = { ...state };\n\n    topLevelTabs.children.forEach(tabId => {\n      const tabComponent = state[tabId];\n      childrenToMove = [...childrenToMove, ...tabComponent.children];\n      delete nextEntities[tabId];\n    });\n\n    delete nextEntities[topLevelId];\n\n    nextEntities[DASHBOARD_ROOT_ID] = {\n      ...rootComponent,\n      children: [DASHBOARD_GRID_ID],\n    };\n\n    nextEntities[DASHBOARD_GRID_ID] = {\n      ...state[DASHBOARD_GRID_ID],\n      children: childrenToMove,\n    };\n\n    return nextEntities;\n  },\n\n  [UPDATE_COMPONENTS_PARENTS_LIST](state) {\n    const nextState = {\n      ...state,\n    };\n\n    updateComponentParentsList({\n      currentComponent: nextState[DASHBOARD_ROOT_ID],\n      layout: nextState,\n    });\n\n    return {\n      ...nextState,\n    };\n  },\n\n  [DASHBOARD_TITLE_CHANGED](state, action) {\n    return {\n      ...state,\n      [DASHBOARD_HEADER_ID]: {\n        ...state[DASHBOARD_HEADER_ID],\n        meta: {\n          ...state[DASHBOARD_HEADER_ID].meta,\n          text: action.text,\n        },\n      },\n    };\n  },\n};\n\nexport default function layoutReducer(state = {}, action) {\n  if (action.type in actionHandlers) {\n    const handler = actionHandlers[action.type];\n    return handler(state, action);\n  }\n\n  return state;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport function reorder(list, startIndex, endIndex) {\n  const result = [...list];\n  const [removed] = result.splice(startIndex, 1);\n  result.splice(endIndex, 0, removed);\n\n  return result;\n}\n\nexport default function reorderItem({ entitiesMap, source, destination }) {\n  const current = [...entitiesMap[source.id].children];\n  const next = [...entitiesMap[destination.id].children];\n  const target = current[source.index];\n\n  // moving to same list\n  if (source.id === destination.id) {\n    const reordered = reorder(current, source.index, destination.index);\n\n    const result = {\n      ...entitiesMap,\n      [source.id]: {\n        ...entitiesMap[source.id],\n        children: reordered,\n      },\n    };\n\n    return result;\n  }\n\n  // moving to different list\n  current.splice(source.index, 1); // remove from original\n  next.splice(destination.index, 0, target); // insert into next\n\n  const result = {\n    ...entitiesMap,\n    [source.id]: {\n      ...entitiesMap[source.id],\n      children: current,\n    },\n    [destination.id]: {\n      ...entitiesMap[destination.id],\n      children: next,\n    },\n  };\n\n  return result;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport undoable, { includeAction } from 'redux-undo';\nimport { UNDO_LIMIT } from '../util/constants';\nimport {\n  UPDATE_COMPONENTS,\n  DELETE_COMPONENT,\n  CREATE_COMPONENT,\n  CREATE_TOP_LEVEL_TABS,\n  DELETE_TOP_LEVEL_TABS,\n  RESIZE_COMPONENT,\n  MOVE_COMPONENT,\n  HANDLE_COMPONENT_DROP,\n} from '../actions/dashboardLayout';\n\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nimport dashboardLayout from './dashboardLayout';\n\nexport default undoable(dashboardLayout, {\n  // +1 because length of history seems max out at limit - 1\n  // +1 again so we can detect if we've exceeded the limit\n  limit: UNDO_LIMIT + 2,\n  ignoreInitialState: true,\n  filter: includeAction([\n    HYDRATE_DASHBOARD,\n    UPDATE_COMPONENTS,\n    DELETE_COMPONENT,\n    CREATE_COMPONENT,\n    CREATE_TOP_LEVEL_TABS,\n    DELETE_TOP_LEVEL_TABS,\n    RESIZE_COMPONENT,\n    MOVE_COMPONENT,\n    HANDLE_COMPONENT_DROP,\n  ]),\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { debounce } from 'lodash';\n\nclass DebouncedMessageQueue {\n  constructor({\n    callback = () => {},\n    sizeThreshold = 1000,\n    delayThreshold = 1000,\n  }) {\n    this.queue = [];\n    this.sizeThreshold = sizeThreshold;\n    this.delayThreshold = delayThreshold;\n\n    this.trigger = debounce(this.trigger.bind(this), this.delayThreshold);\n    this.callback = callback;\n  }\n\n  append(eventData) {\n    this.queue.push(eventData);\n    this.trigger();\n  }\n\n  trigger() {\n    if (this.queue.length > 0) {\n      const events = this.queue.splice(0, this.sizeThreshold);\n      this.callback.call(null, events);\n\n      // If there are remaining items, call it again.\n      if (this.queue.length > 0) {\n        this.trigger();\n      }\n    }\n  }\n}\n\nexport default DebouncedMessageQueue;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\n/* eslint prefer-const: 2 */\nimport shortid from 'shortid';\nimport { SupersetClient } from '@superset-ui/core';\n\nimport { safeStringify } from '../utils/safeStringify';\nimport { LOG_EVENT } from '../logger/actions';\nimport { LOG_EVENT_TYPE_TIMING } from '../logger/LogUtils';\nimport DebouncedMessageQueue from '../utils/DebouncedMessageQueue';\n\nconst LOG_ENDPOINT = '/superset/log/?explode=events';\nconst sendBeacon = events => {\n  if (events.length <= 0) {\n    return;\n  }\n\n  let endpoint = LOG_ENDPOINT;\n  const { source, source_id } = events[0];\n  // backend logs treat these request params as first-class citizens\n  if (source === 'dashboard') {\n    endpoint += `&dashboard_id=${source_id}`;\n  } else if (source === 'slice') {\n    endpoint += `&slice_id=${source_id}`;\n  }\n\n  if (navigator.sendBeacon) {\n    const formData = new FormData();\n    formData.append('events', safeStringify(events));\n    if (SupersetClient.getGuestToken()) {\n      // if we have a guest token, we need to send it for auth via the form\n      formData.append('guest_token', SupersetClient.getGuestToken());\n    }\n    navigator.sendBeacon(endpoint, formData);\n  } else {\n    SupersetClient.post({\n      endpoint,\n      postPayload: { events },\n      parseMethod: null,\n    });\n  }\n};\n\n// beacon API has data size limit = 2^16.\n// assume avg each log entry has 2^6 characters\nconst MAX_EVENTS_PER_REQUEST = 1024;\nconst logMessageQueue = new DebouncedMessageQueue({\n  callback: sendBeacon,\n  sizeThreshold: MAX_EVENTS_PER_REQUEST,\n  delayThreshold: 1000,\n});\nlet lastEventId = 0;\nconst loggerMiddleware = store => next => action => {\n  if (action.type !== LOG_EVENT) {\n    return next(action);\n  }\n\n  const { dashboardInfo, explore, impressionId, dashboardLayout, sqlLab } =\n    store.getState();\n  let logMetadata = {\n    impression_id: impressionId,\n    version: 'v2',\n  };\n  if (dashboardInfo?.id) {\n    logMetadata = {\n      source: 'dashboard',\n      source_id: dashboardInfo.id,\n      ...logMetadata,\n    };\n  } else if (explore?.slice) {\n    logMetadata = {\n      source: 'explore',\n      source_id: explore.slice ? explore.slice.slice_id : 0,\n      ...logMetadata,\n    };\n  } else if (sqlLab) {\n    const editor = sqlLab.queryEditors.find(\n      ({ id }) => id === sqlLab.tabHistory.slice(-1)[0],\n    );\n    logMetadata = {\n      source: 'sqlLab',\n      source_id: editor?.id,\n      db_id: editor?.dbId,\n      schema: editor?.schema,\n    };\n  }\n\n  const { eventName } = action.payload;\n  let { eventData = {} } = action.payload;\n  eventData = {\n    ...logMetadata,\n    ts: new Date().getTime(),\n    event_name: eventName,\n    ...eventData,\n  };\n  if (LOG_EVENT_TYPE_TIMING.has(eventName)) {\n    eventData = {\n      ...eventData,\n      event_type: 'timing',\n      trigger_event: lastEventId,\n    };\n  } else {\n    lastEventId = shortid.generate();\n    eventData = {\n      ...eventData,\n      event_type: 'user',\n      event_id: lastEventId,\n      visibility: document.visibilityState,\n    };\n  }\n\n  if (eventData.target_id && dashboardLayout?.present?.[eventData.target_id]) {\n    const { meta } = dashboardLayout.present[eventData.target_id];\n    // chart name or tab/header text\n    eventData.target_name = meta.chartId ? meta.sliceName : meta.text;\n  }\n\n  logMessageQueue.append(eventData);\n  return eventData;\n};\n\nexport default loggerMiddleware;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { configureStore, ConfigureStoreOptions, Store } from '@reduxjs/toolkit';\nimport thunk from 'redux-thunk';\nimport { api } from 'src/hooks/apiResources/queryApi';\nimport messageToastReducer from 'src/components/MessageToasts/reducers';\nimport charts from 'src/components/Chart/chartReducer';\nimport dataMask from 'src/dataMask/reducer';\nimport reports from 'src/reports/reducers/reports';\nimport dashboardInfo from 'src/dashboard/reducers/dashboardInfo';\nimport dashboardState from 'src/dashboard/reducers/dashboardState';\nimport dashboardFilters from 'src/dashboard/reducers/dashboardFilters';\nimport nativeFilters from 'src/dashboard/reducers/nativeFilters';\nimport dashboardDatasources from 'src/dashboard/reducers/datasources';\nimport sliceEntities from 'src/dashboard/reducers/sliceEntities';\nimport dashboardLayout from 'src/dashboard/reducers/undoableDashboardLayout';\nimport logger from 'src/middleware/loggerMiddleware';\nimport saveModal from 'src/explore/reducers/saveModalReducer';\nimport explore from 'src/explore/reducers/exploreReducer';\nimport exploreDatasources from 'src/explore/reducers/datasourcesReducer';\nimport { DatasourcesState } from 'src/dashboard/types';\nimport {\n  DatasourcesActionPayload,\n  DatasourcesAction,\n} from 'src/dashboard/actions/datasources';\nimport shortid from 'shortid';\nimport {\n  BootstrapUser,\n  UndefinedUser,\n  UserWithPermissionsAndRoles,\n} from 'src/types/bootstrapTypes';\nimport { AnyDatasourcesAction } from 'src/explore/actions/datasourcesActions';\nimport { HydrateExplore } from 'src/explore/actions/hydrateExplore';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { Dataset } from '@superset-ui/chart-controls';\n\n// Some reducers don't do anything, and redux is just used to reference the initial \"state\".\n// This may change later, as the client application takes on more responsibilities.\nconst noopReducer =\n  <STATE = unknown>(initialState: STATE) =>\n  (state: STATE = initialState) =>\n    state;\n\nconst bootstrapData = getBootstrapData();\n\nexport const USER_LOADED = 'USER_LOADED';\n\nexport type UserLoadedAction = {\n  type: typeof USER_LOADED;\n  user: UserWithPermissionsAndRoles;\n};\n\nconst userReducer = (\n  user = bootstrapData.user || {},\n  action: UserLoadedAction,\n): BootstrapUser | UndefinedUser => {\n  if (action.type === USER_LOADED) {\n    return action.user;\n  }\n  return user;\n};\n\nconst getMiddleware: ConfigureStoreOptions['middleware'] =\n  getDefaultMiddleware =>\n    process.env.REDUX_DEFAULT_MIDDLEWARE\n      ? getDefaultMiddleware({\n          immutableCheck: {\n            warnAfter: 200,\n          },\n          serializableCheck: {\n            // Ignores AbortController instances\n            ignoredActionPaths: [/queryController/g],\n            ignoredPaths: [/queryController/g],\n            warnAfter: 200,\n          },\n        }).concat(logger, api.middleware)\n      : [thunk, logger, api.middleware];\n\n// TODO: This reducer is a combination of the Dashboard and Explore reducers.\n// The correct way of handling this is to unify the actions and reducers from both\n// modules in shared files. This involves a big refactor to unify the parameter types\n// and move files around. We should tackle this in a specific PR.\nconst CombinedDatasourceReducers = (\n  datasources: DatasourcesState | undefined | { [key: string]: Dataset },\n  action: DatasourcesActionPayload | AnyDatasourcesAction | HydrateExplore,\n) => {\n  if (action.type === DatasourcesAction.SET_DATASOURCES) {\n    return dashboardDatasources(\n      datasources as DatasourcesState | undefined,\n      action as DatasourcesActionPayload,\n    );\n  }\n  return exploreDatasources(\n    datasources as { [key: string]: Dataset },\n    action as AnyDatasourcesAction | HydrateExplore,\n  );\n};\n\nconst reducers = {\n  messageToasts: messageToastReducer,\n  common: noopReducer(bootstrapData.common),\n  user: userReducer,\n  impressionId: noopReducer(shortid.generate()),\n  charts,\n  datasources: CombinedDatasourceReducers,\n  dashboardInfo,\n  dashboardFilters,\n  dataMask,\n  nativeFilters,\n  dashboardState,\n  dashboardLayout,\n  sliceEntities,\n  reports,\n  saveModal,\n  explore,\n};\n\n/* In some cases the jinja template injects two seperate React apps into basic.html\n * One for the top navigation Menu and one for the application below the Menu\n * The first app to connect to the Redux debugger wins which is the menu blocking\n * the application from being able to connect to the redux debugger.\n * setupStore with disableDebugger true enables the menu.tsx component to avoid connecting\n * to redux debugger so the application can connect to redux debugger\n */\nexport function setupStore({\n  disableDebugger = false,\n  initialState = {},\n  rootReducers = reducers,\n  ...overrides\n}: {\n  disableDebugger?: boolean;\n  initialState?: ConfigureStoreOptions['preloadedState'];\n  rootReducers?: ConfigureStoreOptions['reducer'];\n} & Partial<ConfigureStoreOptions> = {}): Store {\n  return configureStore({\n    preloadedState: initialState,\n    reducer: {\n      [api.reducerPath]: api.reducer,\n      ...rootReducers,\n    },\n    middleware: getMiddleware,\n    devTools: process.env.WEBPACK_MODE === 'development' && !disableDebugger,\n    ...overrides,\n  });\n}\n\nexport const store: Store = setupStore();\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { keyBy } from 'lodash';\nimport { DatasourcesState } from 'src/dashboard/types';\nimport {\n  DatasourcesActionPayload,\n  DatasourcesAction,\n} from '../actions/datasources';\n\nexport default function datasourcesReducer(\n  datasources: DatasourcesState | undefined,\n  action: DatasourcesActionPayload,\n) {\n  if (action.type === DatasourcesAction.SET_DATASOURCES) {\n    return {\n      ...datasources,\n      ...keyBy(action.datasources, 'uid'),\n    };\n  }\n  if (action.type === DatasourcesAction.SET_DATASOURCE) {\n    return {\n      ...datasources,\n      [action.key]: action.datasource,\n    };\n  }\n  return datasources || {};\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dataset } from '@superset-ui/chart-controls';\nimport { getDatasourceUid } from 'src/utils/getDatasourceUid';\nimport {\n  AnyDatasourcesAction,\n  SET_DATASOURCE,\n} from '../actions/datasourcesActions';\nimport { HYDRATE_EXPLORE, HydrateExplore } from '../actions/hydrateExplore';\n\nexport default function datasourcesReducer(\n  // TODO: change type to include other datasource types\n  datasources: { [key: string]: Dataset },\n  action: AnyDatasourcesAction | HydrateExplore,\n) {\n  if (action.type === SET_DATASOURCE) {\n    return {\n      ...datasources,\n      [getDatasourceUid(action.datasource)]: action.datasource,\n    };\n  }\n  if (action.type === HYDRATE_EXPLORE) {\n    return { ...(action as HydrateExplore).data.datasources };\n  }\n  return datasources || {};\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  DASHBOARD_INFO_UPDATED,\n  SET_FILTER_BAR_ORIENTATION,\n  SET_CROSS_FILTERS_ENABLED,\n} from '../actions/dashboardInfo';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport default function dashboardStateReducer(state = {}, action) {\n  switch (action.type) {\n    case DASHBOARD_INFO_UPDATED:\n      return {\n        ...state,\n        ...action.newInfo,\n        // server-side compare last_modified_time in second level\n        last_modified_time: Math.round(new Date().getTime() / 1000),\n      };\n    case HYDRATE_DASHBOARD:\n      return {\n        ...state,\n        ...action.data.dashboardInfo,\n        // set async api call data\n      };\n    case SET_FILTER_BAR_ORIENTATION:\n      return {\n        ...state,\n        filterBarOrientation: action.filterBarOrientation,\n      };\n    case SET_CROSS_FILTERS_ENABLED:\n      return {\n        ...state,\n        crossFiltersEnabled: action.crossFiltersEnabled,\n      };\n    default:\n      return state;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  ADD_SLICE,\n  ON_CHANGE,\n  ON_SAVE,\n  REMOVE_SLICE,\n  SET_COLOR_SCHEME,\n  SET_EDIT_MODE,\n  SET_MAX_UNDO_HISTORY_EXCEEDED,\n  SET_UNSAVED_CHANGES,\n  SHOW_BUILDER_PANE,\n  TOGGLE_EXPAND_SLICE,\n  TOGGLE_FAVE_STAR,\n  TOGGLE_PUBLISHED,\n  UPDATE_CSS,\n  SET_REFRESH_FREQUENCY,\n  ON_REFRESH,\n  ON_REFRESH_SUCCESS,\n  SET_DIRECT_PATH,\n  SET_FOCUSED_FILTER_FIELD,\n  UNSET_FOCUSED_FILTER_FIELD,\n  SET_ACTIVE_TABS,\n  SET_FULL_SIZE_CHART_ID,\n  ON_FILTERS_REFRESH,\n  ON_FILTERS_REFRESH_SUCCESS,\n  SET_DATASETS_STATUS,\n  SET_OVERRIDE_CONFIRM,\n  SAVE_DASHBOARD_STARTED,\n  SAVE_DASHBOARD_FINISHED,\n} from '../actions/dashboardState';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport default function dashboardStateReducer(state = {}, action) {\n  const actionHandlers = {\n    [HYDRATE_DASHBOARD]() {\n      return { ...state, ...action.data.dashboardState };\n    },\n    [UPDATE_CSS]() {\n      return { ...state, css: action.css };\n    },\n    [ADD_SLICE]() {\n      const updatedSliceIds = new Set(state.sliceIds);\n      updatedSliceIds.add(action.slice.slice_id);\n      return {\n        ...state,\n        sliceIds: Array.from(updatedSliceIds),\n      };\n    },\n    [REMOVE_SLICE]() {\n      const { sliceId } = action;\n      const updatedSliceIds = new Set(state.sliceIds);\n      updatedSliceIds.delete(sliceId);\n\n      return {\n        ...state,\n        sliceIds: Array.from(updatedSliceIds),\n      };\n    },\n    [TOGGLE_FAVE_STAR]() {\n      return { ...state, isStarred: action.isStarred };\n    },\n    [TOGGLE_PUBLISHED]() {\n      return { ...state, isPublished: action.isPublished };\n    },\n    [SET_EDIT_MODE]() {\n      return {\n        ...state,\n        editMode: action.editMode,\n      };\n    },\n    [SET_MAX_UNDO_HISTORY_EXCEEDED]() {\n      const { maxUndoHistoryExceeded = true } = action.payload;\n      return { ...state, maxUndoHistoryExceeded };\n    },\n    [SHOW_BUILDER_PANE]() {\n      return { ...state };\n    },\n    [SET_COLOR_SCHEME]() {\n      return {\n        ...state,\n        colorScheme: action.colorScheme,\n        updatedColorScheme: true,\n      };\n    },\n    [TOGGLE_EXPAND_SLICE]() {\n      const updatedExpandedSlices = { ...state.expandedSlices };\n      const { sliceId } = action;\n      if (updatedExpandedSlices[sliceId]) {\n        delete updatedExpandedSlices[sliceId];\n      } else {\n        updatedExpandedSlices[sliceId] = true;\n      }\n      return { ...state, expandedSlices: updatedExpandedSlices };\n    },\n    [ON_CHANGE]() {\n      return { ...state, hasUnsavedChanges: true };\n    },\n    [SAVE_DASHBOARD_STARTED]() {\n      return {\n        ...state,\n        dashboardIsSaving: true,\n      };\n    },\n    [SAVE_DASHBOARD_FINISHED]() {\n      return {\n        ...state,\n        dashboardIsSaving: false,\n      };\n    },\n    [ON_SAVE]() {\n      return {\n        ...state,\n        hasUnsavedChanges: false,\n        maxUndoHistoryExceeded: false,\n        editMode: false,\n        updatedColorScheme: false,\n        // server-side returns last_modified_time for latest change\n        lastModifiedTime: action.lastModifiedTime,\n      };\n    },\n    [SET_UNSAVED_CHANGES]() {\n      const { hasUnsavedChanges } = action.payload;\n      return { ...state, hasUnsavedChanges };\n    },\n    [SET_REFRESH_FREQUENCY]() {\n      return {\n        ...state,\n        refreshFrequency: action.refreshFrequency,\n        shouldPersistRefreshFrequency: action.isPersistent,\n        hasUnsavedChanges: action.isPersistent,\n      };\n    },\n    [ON_REFRESH]() {\n      return {\n        ...state,\n        isRefreshing: true,\n      };\n    },\n    [ON_FILTERS_REFRESH]() {\n      return {\n        ...state,\n        isFiltersRefreshing: true,\n      };\n    },\n    [ON_FILTERS_REFRESH_SUCCESS]() {\n      return {\n        ...state,\n        isFiltersRefreshing: false,\n      };\n    },\n    [ON_REFRESH_SUCCESS]() {\n      return {\n        ...state,\n        isRefreshing: false,\n      };\n    },\n    [SET_DIRECT_PATH]() {\n      return {\n        ...state,\n        directPathToChild: action.path,\n        directPathLastUpdated: Date.now(),\n      };\n    },\n    [SET_ACTIVE_TABS]() {\n      const newActiveTabs = new Set(state.activeTabs);\n      newActiveTabs.delete(action.prevTabId);\n      newActiveTabs.add(action.tabId);\n      return {\n        ...state,\n        activeTabs: Array.from(newActiveTabs),\n      };\n    },\n    [SET_OVERRIDE_CONFIRM]() {\n      return {\n        ...state,\n        overwriteConfirmMetadata: action.overwriteConfirmMetadata,\n      };\n    },\n    [SET_FOCUSED_FILTER_FIELD]() {\n      return {\n        ...state,\n        focusedFilterField: {\n          chartId: action.chartId,\n          column: action.column,\n        },\n      };\n    },\n    [UNSET_FOCUSED_FILTER_FIELD]() {\n      // dashboard only has 1 focused filter field at a time,\n      // but when user switch different filter boxes,\n      // browser didn't always fire onBlur and onFocus events in order.\n      if (\n        !state.focusedFilterField ||\n        action.chartId !== state.focusedFilterField.chartId ||\n        action.column !== state.focusedFilterField.column\n      ) {\n        return state;\n      }\n      return {\n        ...state,\n        focusedFilterField: null,\n      };\n    },\n    [SET_FULL_SIZE_CHART_ID]() {\n      return {\n        ...state,\n        fullSizeChartId: action.chartId,\n      };\n    },\n    [SET_DATASETS_STATUS]() {\n      return {\n        ...state,\n        datasetsStatus: action.status,\n      };\n    },\n  };\n\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { omit } from 'lodash';\nimport {\n  SET_REPORT,\n  ADD_REPORT,\n  EDIT_REPORT,\n  DELETE_REPORT,\n} from '../actions/reports';\n\nexport default function reportsReducer(state = {}, action) {\n  const actionHandlers = {\n    [SET_REPORT]() {\n      const { report, resourceId, creationMethod, filterField } = action;\n      // For now report count should only be one, but we are checking in case\n      // functionality changes.\n      const reportObject = report.result?.find(\n        report => report[filterField] === resourceId,\n      );\n\n      if (reportObject) {\n        return {\n          ...state,\n          [creationMethod]: {\n            ...state[creationMethod],\n            [resourceId]: reportObject,\n          },\n        };\n      }\n      if (state?.[creationMethod]?.[resourceId]) {\n        // remove the empty report from state\n        const newState = { ...state };\n        delete newState[creationMethod][resourceId];\n        return newState;\n      }\n      return { ...state };\n    },\n\n    [ADD_REPORT]() {\n      const { result, id } = action.json;\n      const report = { ...result, id };\n      const reportTypeId = report.dashboard || report.chart;\n      // this is the id of either the chart or the dashboard associated with the report.\n\n      return {\n        ...state,\n        [report.creation_method]: {\n          ...state[report.creation_method],\n          [reportTypeId]: report,\n        },\n      };\n    },\n\n    [EDIT_REPORT]() {\n      const report = {\n        ...action.json.result,\n        id: action.json.id,\n      };\n      const reportTypeId = report.dashboard || report.chart;\n\n      return {\n        ...state,\n        [report.creation_method]: {\n          ...state[report.creation_method],\n          [reportTypeId]: report,\n        },\n      };\n    },\n\n    [DELETE_REPORT]() {\n      const { report } = action;\n      const reportTypeId = report.dashboard || report.chart;\n      return {\n        ...state,\n        [report.creation_method]: {\n          ...omit(state[report.creation_method], reportTypeId),\n        },\n      };\n    },\n  };\n\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport * as actions from '../actions/saveModalActions';\nimport { HYDRATE_EXPLORE } from '../actions/hydrateExplore';\n\nexport default function saveModalReducer(state = {}, action) {\n  const actionHandlers = {\n    [actions.SET_SAVE_CHART_MODAL_VISIBILITY]() {\n      return { ...state, isVisible: action.isVisible };\n    },\n    [actions.FETCH_DASHBOARDS_SUCCEEDED]() {\n      return { ...state, dashboards: action.choices };\n    },\n    [actions.FETCH_DASHBOARDS_FAILED]() {\n      return {\n        ...state,\n        saveModalAlert: `fetching dashboards failed for ${action.userId}`,\n      };\n    },\n    [actions.SAVE_SLICE_FAILED]() {\n      return { ...state, saveModalAlert: 'Failed to save slice' };\n    },\n    [actions.SAVE_SLICE_SUCCESS](data) {\n      return { ...state, data };\n    },\n    [actions.REMOVE_SAVE_MODAL_ALERT]() {\n      return { ...state, saveModalAlert: null };\n    },\n    [HYDRATE_EXPLORE]() {\n      return { ...action.data.saveModal };\n    },\n  };\n\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { ensureIsArray } from '@superset-ui/core';\nimport { DYNAMIC_PLUGIN_CONTROLS_READY } from 'src/components/Chart/chartAction';\nimport { getControlsState } from 'src/explore/store';\nimport {\n  getControlConfig,\n  getControlStateFromControlConfig,\n  getControlValuesCompatibleWithDatasource,\n  StandardizedFormData,\n} from 'src/explore/controlUtils';\nimport * as actions from 'src/explore/actions/exploreActions';\nimport { HYDRATE_EXPLORE } from '../actions/hydrateExplore';\n\nexport default function exploreReducer(state = {}, action) {\n  const actionHandlers = {\n    [DYNAMIC_PLUGIN_CONTROLS_READY]() {\n      return {\n        ...state,\n        controls: action.controlsState,\n      };\n    },\n    [actions.TOGGLE_FAVE_STAR]() {\n      return {\n        ...state,\n        isStarred: action.isStarred,\n      };\n    },\n    [actions.POST_DATASOURCE_STARTED]() {\n      return {\n        ...state,\n        isDatasourceMetaLoading: true,\n      };\n    },\n    [actions.UPDATE_FORM_DATA_BY_DATASOURCE]() {\n      const newFormData = { ...state.form_data };\n      const { prevDatasource, newDatasource } = action;\n      const controls = { ...state.controls };\n      const controlsTransferred = [];\n\n      if (\n        prevDatasource.id !== newDatasource.id ||\n        prevDatasource.type !== newDatasource.type\n      ) {\n        newFormData.datasource = newDatasource.uid;\n      }\n      // reset control values for column/metric related controls\n      Object.entries(controls).forEach(([controlName, controlState]) => {\n        if (\n          // for direct column select controls\n          controlState.valueKey === 'column_name' ||\n          // for all other controls\n          'savedMetrics' in controlState ||\n          'columns' in controlState ||\n          ('options' in controlState && !Array.isArray(controlState.options))\n        ) {\n          newFormData[controlName] = getControlValuesCompatibleWithDatasource(\n            newDatasource,\n            controlState,\n            controlState.value,\n          );\n          if (\n            ensureIsArray(newFormData[controlName]).length > 0 &&\n            newFormData[controlName] !== controls[controlName].default\n          ) {\n            controlsTransferred.push(controlName);\n          }\n        }\n      });\n\n      const newState = {\n        ...state,\n        controls,\n        datasource: action.newDatasource,\n      };\n      return {\n        ...newState,\n        form_data: newFormData,\n        controls: getControlsState(newState, newFormData),\n        controlsTransferred,\n      };\n    },\n    [actions.FETCH_DATASOURCES_STARTED]() {\n      return {\n        ...state,\n        isDatasourcesLoading: true,\n      };\n    },\n    [actions.SET_FIELD_VALUE]() {\n      const { controlName, value, validationErrors } = action;\n      let new_form_data = { ...state.form_data, [controlName]: value };\n      const old_metrics_data = state.form_data.metrics;\n      const new_column_config = state.form_data.column_config;\n\n      const vizType = new_form_data.viz_type;\n\n      // if the controlName is metrics, and the metric column name is updated,\n      // need to update column config as well to keep the previou config.\n      if (controlName === 'metrics' && old_metrics_data && new_column_config) {\n        value.forEach((item, index) => {\n          if (\n            item?.label !== old_metrics_data[index]?.label &&\n            !!new_column_config[old_metrics_data[index]?.label]\n          ) {\n            new_column_config[item.label] =\n              new_column_config[old_metrics_data[index].label];\n\n            delete new_column_config[old_metrics_data[index].label];\n          }\n        });\n        new_form_data.column_config = new_column_config;\n      }\n\n      // Use the processed control config (with overrides and everything)\n      // if `controlName` does not existing in current controls,\n      const controlConfig =\n        state.controls[action.controlName] ||\n        getControlConfig(action.controlName, vizType) ||\n        {};\n\n      // will call validators again\n      const control = {\n        ...getControlStateFromControlConfig(controlConfig, state, action.value),\n      };\n\n      const column_config = {\n        ...state.controls.column_config,\n        ...(new_column_config && { value: new_column_config }),\n      };\n\n      const newState = {\n        ...state,\n        controls: {\n          ...state.controls,\n          [controlName]: control,\n          ...(controlName === 'metrics' && { column_config }),\n        },\n      };\n\n      const rerenderedControls = {};\n      if (Array.isArray(control.rerender)) {\n        control.rerender.forEach(controlName => {\n          rerenderedControls[controlName] = {\n            ...getControlStateFromControlConfig(\n              newState.controls[controlName],\n              newState,\n              newState.controls[controlName].value,\n            ),\n          };\n        });\n      }\n\n      // combine newly detected errors with errors from `onChange` event of\n      // each control component (passed via reducer action).\n      const errors = control.validationErrors || [];\n      (validationErrors || []).forEach(err => {\n        // skip duplicated errors\n        if (!errors.includes(err)) {\n          errors.push(err);\n        }\n      });\n      const hasErrors = errors && errors.length > 0;\n\n      const isVizSwitch =\n        action.controlName === 'viz_type' &&\n        action.value !== state.controls.viz_type.value;\n      let currentControlsState = state.controls;\n      if (isVizSwitch) {\n        // get StandardizedFormData from source form_data\n        const sfd = new StandardizedFormData(state.form_data);\n        const transformed = sfd.transform(action.value, state);\n        new_form_data = transformed.formData;\n        currentControlsState = transformed.controlsState;\n      }\n\n      return {\n        ...state,\n        form_data: new_form_data,\n        triggerRender: control.renderTrigger && !hasErrors,\n        controls: {\n          ...currentControlsState,\n          [action.controlName]: {\n            ...control,\n            validationErrors: errors,\n          },\n          ...rerenderedControls,\n        },\n      };\n    },\n    [actions.SET_EXPLORE_CONTROLS]() {\n      return {\n        ...state,\n        controls: getControlsState(state, action.formData),\n      };\n    },\n    [actions.SET_FORM_DATA]() {\n      return {\n        ...state,\n        form_data: action.formData,\n      };\n    },\n    [actions.UPDATE_CHART_TITLE]() {\n      return {\n        ...state,\n        sliceName: action.sliceName,\n      };\n    },\n    [actions.SET_SAVE_ACTION]() {\n      return {\n        ...state,\n        saveAction: action.saveAction,\n      };\n    },\n    [actions.CREATE_NEW_SLICE]() {\n      return {\n        ...state,\n        slice: action.slice,\n        controls: getControlsState(state, action.form_data),\n        can_add: action.can_add,\n        can_download: action.can_download,\n        can_overwrite: action.can_overwrite,\n      };\n    },\n    [actions.SLICE_UPDATED]() {\n      return {\n        ...state,\n        slice: {\n          ...state.slice,\n          ...action.slice,\n          owners: action.slice.owners\n            ? action.slice.owners.map(owner => owner.value)\n            : null,\n        },\n        sliceName: action.slice.slice_name ?? state.sliceName,\n        metadata: {\n          ...state.metadata,\n          owners: action.slice.owners\n            ? action.slice.owners.map(owner => owner.label)\n            : null,\n        },\n      };\n    },\n    [actions.SET_FORCE_QUERY]() {\n      return {\n        ...state,\n        force: action.force,\n      };\n    },\n    [HYDRATE_EXPLORE]() {\n      return {\n        ...action.data.explore,\n      };\n    },\n  };\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}\n"],"names":["untitledQueryRegex","untitledQuery","RESET_STATE","ADD_QUERY_EDITOR","UPDATE_QUERY_EDITOR","QUERY_EDITOR_SAVED","CLONE_QUERY_TO_NEW_TAB","REMOVE_QUERY_EDITOR","MERGE_TABLE","REMOVE_TABLES","END_QUERY","REMOVE_QUERY","EXPAND_TABLE","COLLAPSE_TABLE","QUERY_EDITOR_SETDB","QUERY_EDITOR_SET_SCHEMA","QUERY_EDITOR_SET_TITLE","QUERY_EDITOR_SET_AUTORUN","QUERY_EDITOR_SET_SQL","QUERY_EDITOR_SET_QUERY_LIMIT","QUERY_EDITOR_SET_TEMPLATE_PARAMS","QUERY_EDITOR_SET_SELECTED_TEXT","QUERY_EDITOR_SET_FUNCTION_NAMES","QUERY_EDITOR_PERSIST_HEIGHT","QUERY_EDITOR_TOGGLE_LEFT_BAR","MIGRATE_QUERY_EDITOR","MIGRATE_TAB_HISTORY","MIGRATE_TABLE","MIGRATE_QUERY","SET_DATABASES","SET_ACTIVE_QUERY_EDITOR","LOAD_QUERY_EDITOR","SET_TABLES","SET_ACTIVE_SOUTHPANE_TAB","REFRESH_QUERIES","SET_USER_OFFLINE","RUN_QUERY","START_QUERY","STOP_QUERY","REQUEST_QUERY_RESULTS","QUERY_SUCCESS","QUERY_FAILED","CLEAR_INACTIVE_QUERIES","CLEAR_QUERY_RESULTS","REMOVE_DATA_PREVIEW","CHANGE_DATA_PREVIEW_ID","COST_ESTIMATE_STARTED","COST_ESTIMATE_RETURNED","COST_ESTIMATE_FAILED","CREATE_DATASOURCE_STARTED","CREATE_DATASOURCE_SUCCESS","CREATE_DATASOURCE_FAILED","addInfoToast","addInfoToastAction","addSuccessToast","addSuccessToastAction","addDangerToast","addDangerToastAction","addWarningToast","addWarningToastAction","CtasEnum","TABLE","VIEW","ERR_MSG_CANT_LOAD_QUERY","t","queryClientMapping","id","db_id","label","template_parameters","fieldConverter","mapping","obj","mapKeys","value","key","convertQueryToServer","invert","convertQueryToClient","getUpToDateQuery","rootState","queryEditor","sqlLab","unsavedQueryEditor","resetState","type","updateQueryEditor","alterations","scheduleQuery","query","dispatch","SupersetClient","endpoint","postPayload","stringify","then","catch","estimateQueryCost","getState","dbId","schema","sql","selectedText","templateParams","database_id","template_params","JSON","parse","Promise","all","body","headers","json","response","getClientErrorObject","error","message","statusText","clearInactiveQueries","interval","startQuery","Object","assign","shortid","progress","startDttm","now","state","runAsync","cached","querySuccess","results","sqlEditorId","isDataPreview","isFeatureEnabled","FeatureFlag","encodeURI","latest_query_id","resolve","queryFailed","msg","link","errors","sync","eventData","has_err","start_offset","ts","Date","getTime","forEach","error_type","errorType","extra","issue_codes","map","logEvent","LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY","error_details","stopQuery","clearQueryResults","removeDataPreview","table","requestQueryResults","fetchQueryResults","displayLimit","queryParams","rison","resultsKey","rows","parseMethod","runQuery","client_id","sql_editor_id","tab","tmp_table_name","tempTable","select_as_cta","ctas","ctas_method","queryLimit","expand_data","search","window","location","COMMON_ERR_MESSAGES","runQueryFromSqlEditor","database","defaultQueryLimit","ctasMethod","qe","name","allow_run_async","updateTabState","reRunQuery","postStopQuery","setDatabases","databases","migrateQueryEditorFromLocalStorage","tables","queries","newQueryEditor","toString","oldQueryEditor","oldId","newId","queryEditorId","newTable","oldTable","migrateTable","queryId","migrateQuery","addQueryEditor","addNewQueryEditor","queryEditors","tabHistory","defaultDbId","common","activeQueryEditor","find","length","dbIds","values","firstDbId","Math","min","undefined","autorun","warning","initialTitle","resultTitle","untitledQueryNumbers","filter","match","replace","largestNumber","max","newQueryTabName","conf","DEFAULT_SQLLAB_LIMIT","cloneQueryToNewTab","sourceQueryEditor","maxRow","setActiveQueryEditor","status","loadQueryEditor","setTables","tableSchemas","tableSchema","description","columns","selectStar","primaryKey","foreignKeys","indexes","dataPreviewQueryId","tab_state_id","expanded","isMetadataLoading","isExtraMetadataLoading","switchQueryEditor","loaded","loadedQueryEditor","latestQueryId","latest_query","query_limit","remoteId","saved_query","validationResult","completed","hideLeftBar","hide_left_bar","table_schemas","setActiveSouthPaneTab","tabId","toggleLeftBar","removeQueryEditor","removeAllOtherQueryEditors","otherQueryEditor","removeQuery","queryEditorSetDb","queryEditorSetSchema","queryEditorSetAutorun","queryEditorSetTitle","saveQuery","clientId","payload","jsonPayload","result","savedQuery","addSavedQueryToTabState","saved_query_id","updateSavedQuery","e","console","queryEditorSetSql","queryEditorSetAndSaveSql","targetQueryEditor","queryEditorSetQueryLimit","queryEditorSetTemplateParams","queryEditorSetSelectedText","mergeTable","prepend","addTable","tableName","schemaName","runTablePreviewQuery","disable_data_preview","dataPreviewQuery","syncTable","tableMetadata","resultJson","initialized","changeDataPreviewId","oldQueryId","newQuery","reFetchQueryResults","expandTable","collapseTable","removeTables","tablesToRemove","Boolean","refreshQueries","alteredQueries","setUserOffline","offline","persistEditorHeight","northPercent","southPercent","popStoredQuery","urlId","parseInt","popSavedQuery","saveQueryId","queryEditorProps","popQuery","queryData","tab_name","popDatasourceQuery","datasourceKey","QUERY_TEXT","datasetId","split","select_star","createDatasourceStarted","createDatasourceSuccess","data","datasource","createDatasourceFailed","err","createDatasource","vizOptions","datasourceName","table_name","is_managed_externally","external_url","reject","createCtasDatasource","errorMsg","Error","CHART_UPDATE_STARTED","chartUpdateStarted","queryController","latestQueryFormData","CHART_UPDATE_SUCCEEDED","chartUpdateSucceeded","queriesResponse","CHART_UPDATE_STOPPED","chartUpdateStopped","CHART_UPDATE_FAILED","chartUpdateFailed","CHART_RENDERING_FAILED","chartRenderingFailed","stackTrace","CHART_RENDERING_SUCCEEDED","chartRenderingSucceeded","REMOVE_CHART","removeChart","ANNOTATION_QUERY_SUCCESS","annotationQuerySuccess","annotation","queryResponse","ANNOTATION_QUERY_STARTED","annotationQueryStarted","ANNOTATION_QUERY_FAILED","annotationQueryFailed","DYNAMIC_PLUGIN_CONTROLS_READY","dynamicPluginControlsReady","controlsState","getControlsState","explore","form_data","slice_id","async","getChartDataRequest","formData","setDataMask","resultFormat","resultType","force","method","requestParams","ownState","querySettings","domainShardingEnabled","mode","credentials","useLegacyApi","getQuerySettings","endpointType","getLegacyEndpointType","allowDomainSharding","dashboard_id","url","getExploreUrl","legacyChartDataRequest","buildV1ChartDataPayload","sliceId","dashboardId","qs","getChartDataUri","path","v1ChartDataRequest","runAnnotationQuery","timeout","isDashboardRequest","sliceKey","keys","charts","fd","requiresQuery","sourceType","granularity","time_grain_sqla","overridesKeys","overrides","time_range","sliceFormData","reduce","d","k","hasExtraFilters","extra_filters","getAnnotationJsonUrl","controller","AbortController","signal","annotationIndex","annotation_layers","findIndex","it","annotation_data","toLowerCase","TRIGGER_QUERY","triggerQuery","RENDER_TRIGGERED","renderTriggered","UPDATE_QUERY_FORM_DATA","updateQueryFormData","UPDATE_CHART_ID","updateChartId","ADD_CHART","addChart","chart","exploreJSON","logStart","Logger","chartDataRequest","dataMask","updateDataMask","chartDataRequestCaught","waitForAsyncData","resultItem","LOG_ACTIONS_LOAD_CHART","applied_filters","is_cached","force_refresh","row_count","rowcount","duration","has_extra_filters","viz_type","data_age","moment","diff","cached_dttm","appendErrorLog","errorDetails","isCached","parsedResponse","annotationLayers","GET_SAVED_CHART","getSavedChart","POST_CHART_FORM_DATA","postChartFormData","redirectSQLLab","safeStringify","refreshChart","chartKey","dashboardInfo","SUPERSET_WEBSERVER_TIMEOUT","getDatasourceSamples","datasourceType","datasourceId","perPage","page","searchParams","datasource_type","datasource_id","isDefined","per_page","clientError","cause","propTypes","children","PropTypes","onError","showMessage","ErrorBoundary","React","constructor","props","super","this","info","componentDidCatch","setState","render","firstLine","subtitle","copyText","componentStack","defaultProps","isValidFilter","chartId","dashboardState","sliceIds","ADD_FILTER","addFilter","component","dashboardFilters","REMOVE_FILTER","removeFilter","CHANGE_FILTER","changeFilter","newSelectedValues","merge","components","dashboardLayout","present","UPDATE_DIRECT_PATH_TO_FILTER","updateDirectPathToFilter","UPDATE_LAYOUT_COMPONENTS","updateLayoutComponents","UPDATE_DASHBOARD_FILTERS_SCOPE","updateDashboardFiltersScope","scopes","UPDATE_COMPONENTS","setUnsavedChangesAfterAction","action","args","nextComponents","hasUnsavedChanges","setUnsavedChanges","updateComponents","updateDashboardTitle","text","DASHBOARD_HEADER_ID","meta","DASHBOARD_TITLE_CHANGED","dashboardTitleChanged","DELETE_COMPONENT","deleteComponent","parentId","CREATE_COMPONENT","createComponent","dropResult","CREATE_TOP_LEVEL_TABS","createTopLevelTabs","DELETE_TOP_LEVEL_TABS","deleteTopLevelTabs","RESIZE_COMPONENT","resizeComponent","width","height","undoableLayout","dashboard","widthChanged","heightChanged","updatedComponents","MOVE_COMPONENT","moveComponent","HANDLE_COMPONENT_DROP","handleComponentDrop","overflowsParent","layout","childWidth","getComponentWidthFromDrop","dropOverflowsParent","source","destination","droppedOnRoot","DASHBOARD_ROOT_ID","isNewComponent","NEW_COMPONENTS_SOURCE_ID","dashboardRoot","rootChildId","TABS_TYPE","index","sourceComponent","destinationComponent","ROW_TYPE","findParentId","childId","sourceSet","Set","destinationSet","concat","scope","some","has","isInDifferentFilterScopes","parents","undoLayoutAction","UndoActionCreators","past","maxUndoHistoryExceeded","updatedColorScheme","redoLayoutAction","UPDATE_COMPONENTS_PARENTS_LIST","JSON_KEYS","extractValue","object","keyPath","SET_UNSAVED_CHANGES","ADD_SLICE","REMOVE_SLICE","TOGGLE_FAVE_STAR","toggleFaveStar","isStarred","fetchFaveStar","saveFaveStar","TOGGLE_PUBLISHED","savePublished","isPublished","published","togglePublished","TOGGLE_EXPAND_SLICE","toggleExpandSlice","UPDATE_CSS","updateCss","css","SET_EDIT_MODE","setEditMode","editMode","ON_CHANGE","onChange","ON_SAVE","onSave","lastModifiedTime","SET_REFRESH_FREQUENCY","setRefreshFrequency","refreshFrequency","isPersistent","saveDashboardRequestSuccess","SET_OVERRIDE_CONFIRM","setOverrideConfirm","overwriteConfirmMetadata","SAVE_DASHBOARD_STARTED","SAVE_DASHBOARD_FINISHED","saveDashboardFinished","saveDashboardRequest","saveType","componentId","directPathToFilter","slice","pop","push","serializedFilters","serializeActiveFilterValues","getActiveFilters","serializedFilterScopes","scopesByColumn","column","serializeFilterScopes","certified_by","certification_details","dashboard_title","owners","roles","slug","hasId","item","metadataCrossFiltersEnabled","metadata","cross_filters_enabled","cleanedData","ensureIsArray","o","r","color_namespace","color_scheme","color_scheme_domain","expanded_slices","label_colors","shared_label_colors","refresh_frequency","timed_refresh_immune_slices","isCrossFiltersEnabled","handleChartConfiguration","getCrossFiltersConfiguration","errorText","SAVE_TYPE_OVERWRITE","SAVE_TYPE_OVERWRITE_CONFIRMED","chartConfiguration","globalChartConfiguration","updatedDashboard","json_metadata","default_filters","filter_scopes","chart_configuration","global_chart_configuration","updateDashboard","last_modified_time","dashboardInfoChanged","SAVE_CHART_CONFIG_COMPLETE","native_filter_configuration","SET_FILTER_CONFIG_COMPLETE","filterConfig","history","pushState","event","onUpdateSuccess","overwriteConfirmItems","prev","next","OVERWRITE_INSPECT_FIELDS","oldValue","newValue","updatedAt","changed_on","updatedBy","changed_by_name","LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA","items","positions","copyPayload","duplicate_slices","saveChartConfiguration","onCopySuccess","fetchCharts","chartList","refreshTime","stagger_time","stagger_refresh","delay","i","setTimeout","ON_FILTERS_REFRESH","ON_FILTERS_REFRESH_SUCCESS","onFiltersRefreshSuccess","ON_REFRESH_SUCCESS","ON_REFRESH","onRefresh","refreshCharts","SHOW_BUILDER_PANE","showBuilderPane","addSliceToDashboard","sliceEntities","selectedSlice","slices","newChart","initChart","applyDefaultFormData","fetchDatasourceMetadata","removeSliceFromDashboard","sliceEntity","getSharedLabelColor","removeSlice","SET_COLOR_SCHEME","setColorScheme","colorScheme","SET_DIRECT_PATH","setDirectPathToChild","SET_ACTIVE_TABS","setActiveTabs","prevTabId","SET_FOCUSED_FILTER_FIELD","setFocusedFilterField","UNSET_FOCUSED_FILTER_FIELD","unsetFocusedFilterField","SET_FULL_SIZE_CHART_ID","setFullSizeChartId","SET_MAX_UNDO_HISTORY_EXCEEDED","setMaxUndoHistoryExceeded","maxUndoHistoryToast","historyLength","SET_DATASETS_STATUS","setDatasetsStatus","HYDRATE_DASHBOARD","hydrateDashboard","activeTabs","user","position_data","positionData","regularUrlParams","extractUrlParams","edit","preselectFilters","getUrlParam","URL_PARAMS","updateColorSchema","DASHBOARD_VERSION_KEY","DASHBOARD_ROOT_TYPE","DASHBOARD_GRID_ID","DASHBOARD_GRID_TYPE","chartIdToLayoutId","layoutComponent","CHART_TYPE","parent","findFirstParentContainerId","newSlicesContainer","newSlicesContainerWidth","filterScopes","chartQueries","slicesFromExploreCount","Map","url_params","slice_url","slice_name","description_markeddown","modified","add","GRID_DEFAULT_CHART_WIDTH","GRID_COLUMN_COUNT","newComponentFactory","chartHolder","count","get","set","configs","getFilterConfigsFromFormdata","labels","col","scopesByChartId","scopeSettings","immune","DASHBOARD_FILTER_SCOPE_GLOBAL","dashboardFilter","filterName","isDateFilter","TIME_RANGE","layoutId","sliceName","element","updateComponentParentsList","currentComponent","buildActiveFilters","DASHBOARD_HEADER_TYPE","future","focusedChartId","focusedChartLayoutId","found","params","URLSearchParams","delete","directLinkComponentId","getLocationHash","directPathToChild","nativeFilters","getInitialNativeFilterState","canEdit","canUserEditDashboard","crossFiltersEnabled","initSliceEntities","isLoading","userId","String","dash_edit_perm","dash_save_perm","findPermission","dash_share_perm","superset_can_explore","superset_can_share","superset_can_csv","flash_messages","filterBarOrientation","filter_bar_orientation","FilterBarOrientation","preselectNativeFilters","Array","from","directPathLastUpdated","focusedFilterField","expandedSlices","shouldPersistRefreshFrequency","colorNamespace","dashboardIsSaving","isRefreshing","isFiltersRefreshing","datasetsStatus","ResourceStatus","isInstantFilter","CHANGE_FILTER_VALUE_ACTIONS","dashboardFiltersReducer","actionHandlers","instant_filtering","updatedColumns","allDashboardFiltersScope","updatedFilters","entries","entry","filterKey","getChartIdAndColumnFromFilterKey","deletedFilter","errorMessage","lastUpdated","sliceEntitiesReducer","FETCH_ALL_SLICES_STARTED","ADD_SLICES","SET_SLICES","FETCH_ALL_SLICES_FAILED","allFilterBoxChartIds","activeFilters","appliedFilterValuesByChart","allComponents","isFilterBox","getAppliedFilterValues","filters","applicableFilters","chartIds","getChartIdsInFilterBoxScope","filterScope","traverse","immuneChartIds","child","scopeComponentIds","nonEmptyFilters","isArray","getDashboardFilterKey","dragging","draggingWidth","minimumWidth","minDraggingWidth","getDetailedComponentWidth","destinationWidth","occupiedWidth","draggingOccupiedWidth","destinationCapacity","Number","isNaN","grandparentWidth","grandparentOccupiedWidth","getTotalChildWidth","passedComponent","GRID_MIN_COLUMN_COUNT","COLUMN_TYPE","DYNAMIC_TYPE","MARKDOWN_TYPE","date_filter","filter_configs","show_sqla_time_column","show_sqla_time_granularity","config","defaultValues","FILTER_CONFIG_ATTRIBUTES","defaultValue","vals","TIME_FILTER_MAP","updatedLabels","TIME_FILTER_LABELS","granularity_sqla","typeToDefaultMetaData","background","BACKGROUND_TRANSPARENT","DIVIDER_TYPE","HEADER_TYPE","headerSize","MEDIUM_HEADER","TAB_TYPE","defaultText","placeholder","uuid","entityFactory","entryByChartId","parentsList","logging","ADHOC_FILTER_REGEX","FETCH_DASHBOARDS_SUCCEEDED","fetchDashboardsSucceeded","choices","FETCH_DASHBOARDS_FAILED","fetchDashboardsFailed","SET_SAVE_CHART_MODAL_VISIBILITY","setSaveChartModalVisibility","isVisible","SAVE_SLICE_FAILED","saveSliceFailed","SAVE_SLICE_SUCCESS","saveSliceSuccess","REMOVE_SAVE_MODAL_ALERT","removeSaveModalAlert","extractAddHocFiltersFromFormData","formDataToHandle","acc","test","f","isExtra","getSlicePayload","formDataWithNativeFilters","dashboards","formDataFromSlice","adhocFilters","adhoc_filters","comparator","query_context","addToasts","isNewSlice","addedToDashboard","toasts","new","title","updateSlice","_","createSlice","createDashboard","dashboardName","getSliceDashboards","CheckBoxControlWrapper","styled","theme","colors","grayscale","dark1","gridUnit","CheckboxControl","renderCheckbox","bind","checked","leftNode","onClick","CUSTOM_OPERATIONS","CUSTOM_OPERATORS","op","OPERATOR_ENUM_TO_OPERATOR_TYPE","operation","AdhocFilter","adhocFilter","expressionType","EXPRESSION_TYPES","subject","operator","toUpperCase","operatorId","Operators","indexOf","clause","CLAUSES","sqlExpression","translateToSql","useSimple","isNew","datasourceWarning","filterOptionName","random","substring","duplicateWith","nextFields","equals","isValid","nullCheckOperators","truthCheckOperators","getDefaultLabel","getTooltipTitle","AdhocFilterOption","options","onFilterEdit","onRemoveFilter","partitionColumn","onMoveLabel","onDropLabel","sections","operators","actualTimeRange","useGetTimeRangeLabel","AdhocFilterPopoverTrigger","tooltipTitle","onRemove","DndItemType","withCaret","isRequired","Modal","selectedMetricType","adhocMetricType","adhocFilterType","columnType","savedMetrics","savedMetricType","selectedMetrics","canDelete","isDictionaryForAdhocFilter","AdhocFilterControl","optionsForSelect","onNewFilter","moveLabel","mapOption","getMetricExpression","optionRenderer","option","FilterDefinitionOption","valueRenderer","stopPropagation","componentDidMount","datasource_name","is_sqllab_view","isSqllabView","partitions","cols","UNSAFE_componentWillReceiveProps","nextProps","valuesCopy","splice","prevState","content","newFilter","mappedOption","changedFilter","opts","savedMetricName","savedMetric","metric_name","expression","dragIndex","hoverIndex","newValues","saved_metric_name","AdhocMetric","column_name","metric","sort","a","b","localeCompare","addNewFilterPopoverTrigger","trigger","className","ControlHeader","Icons","iconSize","iconColor","light5","light1","withTheme","SIMPLE","SQL","inferSqlExpressionColumn","adhocMetric","sqlaAutoGeneratedMetricRegex","indexFirstCloseParen","indexPairedOpenParen","lastIndexOf","inferSqlExpressionAggregate","indexFirstOpenParen","inferredColumn","aggregate","hasCustomLabel","optionName","useVerboseName","transformCountDistinct","verbose_name","AGGREGATES","showType","ariaLabel","autoFocus","clearable","disabled","freeForm","multi","isMulti","onFocus","onSelect","onDeselect","default","showHeader","valueKey","filterOption","tokenSeparators","notFoundContent","renderTrigger","validationErrors","rightNode","hovered","tooltipOnClick","danger","SelectControl","getOptions","handleFilterOptions","isEqualArray","val","onChangeVal","v","customLabel","c","is","headerProps","selectProps","allowNewOptions","allowClear","header","loading","sortComparator","currentValue","getValue","spatialTypes","animation","SpatialControl","defaultCol","delimiter","latCol","lonCol","lonlatCol","reverseCheckbox","geohashCol","toggleCheckbox","renderReverseCheckbox","errMsg","setType","renderLabelContent","renderSelect","renderPopoverContent","style","isSelected","gutter","xs","md","placement","initialValue","minLines","maxLines","offerEditInModal","language","aboveEditorSection","readOnly","resize","textAreaStyles","TextAreaControl","onControlChange","target","onAreaEditorChange","renderEditor","inModal","border","minHeight","backgroundColor","editorProps","$blockScrolling","renderModalBody","controlHeader","modalTitle","triggerNode","buttonSize","modalBody","responsive","categoricalSchemeRegistry","getCategoricalSchemeRegistry","sequentialSchemeRegistry","getSequentialSchemeRegistry","D3_FORMAT_OPTIONS","timeColumnOption","groupByControl","includeTime","opt","mapStateToProps","control","newState","groupby","metrics","validators","validateNonEmpty","controls","isEditable","color_picker","g","metric_2","linear_color_scheme","getDefaultKey","schemes","getMap","isLinear","secondary_metric","main_dttm_col","row_limit","legacyValidateInteger","formatSelectOptions","limit","timeseries_limit_metric","series","entity","x","y","size","y_axis_format","showWarning","comparison_type","filterable","s","getChartKey","UNSAVED_CHART_ID","requestCounter","getHostName","currentIndex","availableDomains","URI","pathname","getURIDirectory","mountExploreUrl","extraSearch","uri","directory","standalone","DashboardStandaloneMode","protocol","hostname","port","curUrl","csv","samples","paramNames","hasOwnProperty","vizMetadata","getChartMetadataRegistry","getChartBuildQueryRegistry","buildQueryformData","buildQueryContext","baseQueryObject","result_format","result_type","hooks","exportChart","exploreChart","useDebouncedEffect","effect","deps","callback","useCallback","useEffect","handler","clearTimeout","getSimpleSQLExpression","MULTI_OPERATORS","firstValue","comparatorArray","isString","quote","prefix","suffix","formattedComparators","optionLabel","join","inputFormData","vizType","DEFAULT_VIZ_TYPE","y_axis_zero","y_axis_bounds","handleDeprecatedControls","getAllControlsState","controlPanelConfig","getChartControlPanelRegistry","onInit","controlFormData","getFormDataFromControls","controlName","defaultControls","extractTypes","ANNOTATION_TYPES_METADATA","FORMULA","EVENT","supportNativeSource","INTERVAL","TIME_SERIES","ANNOTATION_TYPES","DEFAULT_ANNOTATION_TYPE","ANNOTATION_SOURCE_TYPES_METADATA","NATIVE","ANNOTATION_SOURCE_TYPES","annotationSourceType","SET_REPORT","fetchUISpecificReport","filterField","creationMethod","resourceId","opr","report","setReport","structureFetchAction","chartArr","ADD_REPORT","addReport","EDIT_REPORT","editReport","toggleActive","isActive","active","finally","DELETE_REPORT","deleteActiveReport","getDatasourceAsSaveableDataset","fDuration","t1","t2","format","diffSec","utc","valueOf","document","getElementById","bootstrapData","getBootstrapData","initFeatureFlags","feature_flags","SUPERSET_WEBSERVER_DOMAINS","hostName","getDomainsConfig","allowCrossDomain","WindowedMenuList","maxHeight","getStyles","cx","innerRef","windowListRef","windowListRef_","windowListInnerRef","defaultWindowListRef","useRef","optionHeight","spacing","baseUnit","lineHeight","detectHeight","totalHeight","lastSelected","isFocused","getLastSelected","current","scrollToItem","ref","outerRef","itemData","itemCount","itemSize","MenuList","DefaultMenuList","defaultComponents","DEFAULT_WINDOW_THRESHOLD","windowThreshold","windowed","SelectComponent","forwardRef","components_","restProps","WindowedSelect","Select","WindowedCreatableSelect","Creatable","WindowedAsyncCreatableSelect","AsyncCreatable","DEFAULT_CLASS_NAME","DEFAULT_CLASS_NAME_PREFIX","primary","success","base","indicator","almostBlack","grayDark","grayLight","light2","gray","grayBg","light4","grayBgDarker","light3","grayBgDarkest","grayHeading","menuHover","lightest","darkest","dark2","grayBorder","grayBorderLight","grayBorderDark","textDefault","textDarkest","dangerLight","DEFAULT_STYLES","container","provider","minWidth","indicatorSeparator","indicatorsContainer","clearIndicator","menuIsOpen","borderRadius","isPseudoFocused","borderColor","menu","zIndex","menuList","isDisabled","fontSize","weights","color","bold","normal","valueContainer","hasValue","multiValueLabel","paddingLeft","paddingRight","input","menuPortal","INPUT_TAG_BASE_STYLES","outline","padding","ClearIndicator","DropdownIndicator","Option","Input","SelectContainer","DEFAULT_COMPONENTS","assistiveText","marginLeft","typography","sizes","innerProps","autoComplete","inputStyle","VALUE_LABELED_STYLES","overflow","singleValue","SortableSelectComponent","SortableContainer","withRef","supersetDefaultComponents","StyledSelect","stateManager","selectRef","labelKey","themeConfig","stylesConfig","valueRenderedAsLabel","valueRenderedAsLabel_","onPaste","sortable","forceOverflow","classNamePrefix","value_","isMulti_","isClearable","isClearable_","minMenuHeight","maxMenuHeight","ignoreAccents","asText","getOptionValue","getOptionLabel","formatOptionLabel","context","flatOptions","flatMap","realVal","findValue","shouldAllowSort","MaybeSortableSelect","MultiValue","SortableElement","onMouseDown","preventDefault","sortableContainerProps","getHelperDimensions","node","getBoundingClientRect","axis","onSortEnd","oldIndex","newIndex","arrayMove","distance","getNewOptionData","inputValue","closeMenuOnScroll","classList","contains","menuPosition","useTheme","instance","refs","wrappedInstance","createFilter","styles","reactSelectTheme","menuGutter","controlHeight","defaultTheme","CreatableSelect","AsyncCreatableSelect","OnPasteSelect","evt","clipboard","clipboardData","getData","regex","separator","RegExp","trim","validator","isValidNewOption","selected","existingOptions","existing","notExists","unshift","selectWrap","noResultsText","StyledNativeSelect","getPopupContainer","parentNode","StyledNativeGraySelect","origSelectedValues","instantFiltering","filtersFields","field","filtersChoices","onFilterMenuOpen","onFilterMenuClose","showDateFilter","showSqlaTimeGrain","showSqlaTimeColumn","StyledFilterContainer","FilterBox","onCloseDateFilterControl","selectedValues","hasChanged","debouncerCache","maxValueCache","onOpenDateFilterControl","getControlData","actions","setControlValue","mapFunc","getKnownMax","d3Max","clickApply","fltr","debounceLoadOptions","loadOptions","SLOW_DEBOUNCE","transformOptions","maxValue","perc","round","backgroundImage","BOOL_TRUE_DISPLAY","BOOL_FALSE_DISPLAY","sortAsc","asc","rawFormData","labelA","textOrder","startsWith","renderDateFilter","DateFilterControl","endpoints","renderDatasourceFilters","datasourceFilters","sqlaFilters","ControlRow","Control","choiceIds","isMultiple","searchAllOptions","cacheOptions","defaultOptions","onMenuOpen","onBlur","onMenuClose","FILTER_OPTIONS_LIMIT","renderFilters","Form","htmlFor","Button","buttonStyle","StyledDiv","certifiedBy","details","metricName","xmlns","enableBackground","viewBox","fill","StyleOverrides","ColumnOption","labelRef","type_generic","hasExpression","tooltipText","setTooltipText","useState","columnTypeTooltipText","setcolumnTypeTooltipText","useLayoutEffect","getColumnTooltipNode","getColumnTypeTooltipNode","align","offset","getColumnLabelText","is_certified","_path","_extends","arguments","prototype","call","apply","fillRule","clipRule","TypeIconWrapper","ColumnTypeLabel","typeIcon","QuestionOutlined","GenericDataType","ClockCircleOutlined","InfoTooltipWithTrigger","tooltip","bsStyle","icon","iconsStyle","iconClass","iconEl","role","tabIndex","cursor","onKeyPress","FlexRowContainer","MetricOption","openInNewWindow","showFormula","shouldShowTooltip","verbose","href","rel","warningMarkdown","warning_markdown","warning_text","getMetricTooltipNode","StyledCalculatorIcon","CalculatorOutlined","SQLPopover","setOptions","highlightActiveLine","highlightGutterLine","wrapEnabled","secondary","maxWidth","arrowPointAtCenter","Tooltip","overlayStyle","defaultColor","mouseLeaveDelay","TooltipSectionWrapper","TooltipSectionLabel","TooltipSection","isLabelTruncated","scrollWidth","clientWidth","COLUMN_NAME_ALIASES","DTTM_ALIAS","DATASET_TIME_COLUMN_OPTION","QUERY_TIME_COLUMN_OPTION","DatasourceType","is_dttm","QueryModeLabel","QueryMode","DEFAULT_SORT_SERIES_DATA","sort_series_type","SortSeriesType","sort_series_ascending","SORT_SERIES_CHOICES","DEFAULT_XAXIS_SORT_SERIES_DATA","required","labelClass","RadioButtonControl","position","top","marginBottom","marginTop","fontWeight","boxShadow","ControlFormRow","display","flexWrap","margin","ControlForm","debouncedOnChange","useMemo","FAST_DEBOUNCE","updatedChildren","row","defaultWidth","debounceDelay","onItemValueChange","fieldValue","textTransform","AntdSelect","creatable","onSearch","dropdownMatchSelectWidth","showSearch","showSearch_","searchValue","setSearchValue","handleSearch","optionsHasSearchValue","optionsHasValue","handleChange","ControlFormItemComponents","Slider","InputNumber","Checkbox","ControlFormItem","controlType","setHovered","setValue","setValidationErrors","isEmptyValue","onMouseEnter","onMouseLeave","d3NumberFormat","D3_FORMAT_DOCS","d3TimeFormat","D3_TIME_FORMAT_DOCS","D3_TIME_FORMAT_OPTIONS","fractionDigits","step","columnWidth","validateNumber","horizontalAlign","FaAlignLeft","FaAlignCenter","FaAlignRight","showCellBars","alignPositiveNegative","colorPositiveNegative","truncateLongCells","SHARED_COLUMN_CONFIG_PROPS","d3SmallNumberFormat","DEFAULT_CONFIG_FORM_LAYOUT","override","ColumnConfigPopover","configFormLayout","caretWidth","alignItems","borderBottom","right","ColumnConfigControl","appliedColumnNames","colnames","_colnames","coltypes","_coltypes","appliedCol","idx","columnConfigs","showAllColumns","setShowAllColumns","getColumnInfo","needShowMoreButton","MAX_NUM_COLS","ColumnConfigItem","validConfigs","fromEntries","setColumnConfig","textAlign","dndGroupByControl","allowAll","promptTextCreator","controlState","commaChoosesOption","dndColumnsControl","dndSeriesControl","dndEntityControl","dndAdhocFilterControl","isDataset","defineSavedMetrics","provideFormDataToProps","datePickerInAdhocFilterMixin","dndAdhocMetricsControl","dndAdhocMetricControl","dndAdhocMetricControl2","dndSortByControl","dndSizeControl","dndXControl","dndYControl","dndSecondaryMetricControl","dndGranularitySqlaControl","temporalColumnMixin","ghostButtonText","dndXAxisControl","xAxisMixin","withDndFallback","DndComponent","FallbackComponent","getAxisLabel","orientation","hasGenericChartAxes","x_axis","getTemporalColumns","temporalColumns","defaultTemporalColumn","isTemporal","flt","temporalColumn","DEFAULT_TIME_FILTER","NO_TIME_RANGE","SERIES_LIMITS","appContainer","getAttribute","datasourceControl","visibility","xAxis","xAxisValue","isAdhocColumn","isPhysicalColumn","order_desc","series_limit","DEFAULT_NUMBER_FORMAT","ComparisonType","x_axis_time_format","DEFAULT_TIME_FORMAT","truncate_metric","show_empty_columns","temporal_columns_lookup","orderby","series_columns","series_limit_metric","legacy_order_by","isStandardizedFormData","standardizedFormData","memorizedFormData","COMPARATOR","MULTIPLE_VALUE_COMPARATORS","BETWEEN","BETWEEN_OR_EQUAL","BETWEEN_OR_LEFT_EQUAL","BETWEEN_OR_RIGHT_EQUAL","isColumnMeta","isSavedExpression","isControlPanelSectionConfig","section","isQueryResponse","D3_NUMBER_FORMAT_DESCRIPTION_VALUES_TEXT","D3_NUMBER_FORMAT_DESCRIPTION_PERCENTAGE_TEXT","d3Formatted","fmt","getNumberFormatter","preview","NumberFormats","smartDateFormatter","DEFAULT_METRICS","expandControlType","sharedControlComponents","expandControlConfig","controlOverrides","sharedControls","getStandardizedControls","makeSingleton","setStandardizedControls","shiftMetric","shift","shiftColumn","popAllMetrics","popAllColumns","clear","rv","isTemporalColumn","columnName","formatSelectOptionsForRange","start","end","ChartBuildQueryRegistry","Registry","overwritePolicy","OverwritePolicy","ChartControlPanelRegistry","ChartMetadataRegistry","Behavior","AppSection","ChartLabel","chartLabelExplanations","DEPRECATED","FEATURED","chartLabelWeight","weight","AxisType","CategoricalColorNamespace","forcedItems","scales","getScale","schemeId","scheme","CategoricalColorScale","setColor","forcedColor","stringifyAndTrim","resetColors","namespaces","DEFAULT_NAMESPACE","getNamespace","newInstance","getColor","namespace","ExtensibleFunction","parentForcedColors","originColors","scale","forcedColors","multiple","scaleOrdinal","range","removeSharedLabelColorFromRange","sharedColorMap","cleanedValue","updatedRange","sharedLabelColor","getColorMap","sharedColor","floor","domain","newRange","getAnalogousColors","newColor","addSlice","colorMap","copy","unknown","newDomain","SharedLabelColorSource","SharedLabelColor","sliceLabelMap","updateColorMap","categoricalNamespace","newColorMap","colorScale","reset","rgbRegex","getContrastingColor","thresholds","matchColor","exec","hex","generatedColors","analogousColors","tinycolor","analogous","toHexString","addAlpha","opacity","htmlSanitization","htmlSchemaOverrides","escapeHtml","rehypePlugins","rehypeRaw","originalSchema","objValue","srcValue","getOverrideHtmlSchema","defaultSchema","rehypeSanitize","remarkPlugins","remarkGfm","skipHtml","modulePromises","withNamespace","defineSharedModule","fetchModule","moduleKey","modulePromise","defineSharedModules","moduleMap","usePrevious","previous","initialRecords","records","DatasourceKey","idStr","typeStr","toObject","WRAP_IN_ARRAY","queryFields","buildQuery","buildQueryObject","post_processing","isXAxisSet","normalizeTimeColumn","sanitizeClause","sanitizedClause","extra_form_data","since","until","row_offset","custom_params","residualFormData","appendAdhocFilters","appendFilters","custom_form_data","numericRowLimit","numericRowOffset","extractQueryFields","extras","applied_time_extras","extract","reservedColumnsToQueryField","__time_range","__time_col","__time_grain","__granularity","extractExtras","extraFilters","filterFormData","extrasAndfilters","where","simpleWhere","freeformWhere","freeformHaving","isSimpleAdhocFilter","filterClause","convertFilter","having","processFilters","queryObject","isQueryFormMetric","normalizeSeriesLimitMetric","overrideFormData","overriddenFormData","overriddenExtras","EXTRA_FORM_DATA_OVERRIDE_REGULAR_MAPPINGS","EXTRA_FORM_DATA_OVERRIDE_EXTRA_KEYS","overrideExtraFormData","EXTRA_FORM_DATA_APPEND_KEYS","time_column","time_grain","EXTRA_FORM_DATA_OVERRIDE_REGULAR_KEYS","EXTRA_FORM_DATA_OVERRIDE_KEYS","isUnaryAdhocFilter","isBinaryAdhocFilter","aliases","queryFieldAliases","all_columns","order_by_cols","query_mode","queryMode","include_time","restFormData","normalizedKey","removeDuplicates","getColumnLabel","getMetricLabel","isSavedMetric","isAdhocMetricSimple","isQueryFormColumn","getXAxisColumn","getXAxisLabel","_columns","_extras","mutatedColumns","axisIdx","timeGrain","newQueryObject","omit","RollingType","NativeFilterType","DataMaskType","isNativeFilter","filterElement","NATIVE_FILTER","isNativeFilterWithDataMask","filterState","isFilterDivider","DIVIDER","isFreeFormAdhocFilter","isUnaryOperator","isBinaryOperator","isSetAdhocFilter","isSetOperator","isAdhocMetricSQL","unaryOperatorSet","binaryOperatorSet","setOperatorSet","ExtensionsRegistry","TypedRegistry","getExtensionsRegistry","feature","featureFlags","xssFilter","FilterXSS","whiteList","getDefaultWhiteList","span","div","img","video","stripIgnoreTag","sanitizeHtml","htmlString","process","isProbablyHTML","sanitizeHtmlIfNeeded","safeHtmlSpan","possiblyHtmlString","dangerouslySetInnerHTML","__html","removeHTMLTags","str","arrA","arrB","every","hash","seen","itemHash","numeric","validateInteger","isFinite","Styles","updateDataset","overrideColumns","UNTITLED","SaveDatasetModal","visible","onHide","buttonTextOnSave","buttonTextOnOverwrite","modalDescription","openWindow","defaultVizType","useSelector","getDefaultDatasetName","datasetName","setDatasetName","newOrOverwrite","setNewOrOverwrite","DatasetRadioState","shouldOverwriteDataset","setShouldOverwriteDataset","datasetToOverwrite","setDatasetToOverwrite","selectedDatasetToOverwrite","setSelectedDatasetToOverwrite","setLoading","getInitialState","useDispatch","createWindow","open","formDataWithDefaults","EXPLORE_CHART_DEFAULT","loadDatasetOverwriteOptions","order_column","order_direction","datasetid","totalCount","disableSaveAndExploreBtn","show","footer","selectedColumns","p","_filters","postFormData","STATE_TYPE_MAP","failed","pending","fetching","running","stopped","STATE_TYPE_MAP_LOCALIZED","STATUS_OPTIONS","STATUS_OPTIONS_LOCALIZED","SQL_EDITOR_GUTTER_HEIGHT","SQL_EDITOR_GUTTER_MARGIN","SQL_TOOLBAR_HEIGHT","SQL_EDITOR_LEFTBAR_WIDTH","SQL_EDITOR_PADDING","INITIAL_NORTH_PERCENT","INITIAL_SOUTH_PERCENT","SET_QUERY_EDITOR_SQL_DEBOUNCE_MS","VALIDATION_DEBOUNCE_MS","WINDOW_RESIZE_THROTTLE_MS","KB_STORAGE","BYTES_PER_CHAR","LOCALSTORAGE_MAX_QUERY_AGE_MS","LOCALSTORAGE_MAX_USAGE_KB","LOCALSTORAGE_MAX_QUERY_RESULTS_KB","LOCALSTORAGE_WARNING_THRESHOLD","LOCALSTORAGE_WARNING_MESSAGE_THROTTLE_MS","SQL_KEYWORD_AUTOCOMPLETE_SCORE","SQL_FUNCTIONS_AUTOCOMPLETE_SCORE","SCHEMA_AUTOCOMPLETE_SCORE","TABLE_AUTOCOMPLETE_SCORE","COLUMN_AUTOCOMPLETE_SCORE","keyword","score","Alert","showIcon","closable","roomBelow","alert","baseColor","AlertIcon","closeText","marginRight","m","aceModuleLoaders","AsyncAceEditor","aceModules","defaultMode","defaultTabSize","fontFamily","AsyncEsmComponent","ReactAceEditor","inferredMode","inferredTheme","keywords","tabSize","completer","getCompletions","editor","session","pos","getMode","$id","acequire","setCompleters","SQLEditor","FullSQLEditor","MarkdownEditor","TextAreaEditor","CssEditor","JsonEditor","ConfigEditor","DefaultPlaceholder","showLoadingForImport","placeholderStyle","loadComponent","promise","waitForPromise","AsyncComponent","setLoaded","isMounted","Component","preload","chartAlert","chartStatus","chartStackTrace","chartUpdateEndTime","chartUpdateStartTime","lastRendered","chartReducer","stacktrace","annotationQuery","abort","annotationData","annotationError","HYDRATE_EXPLORE","DatasourcesAction","CheckboxChecked","CheckboxHalfChecked","CheckboxUnchecked","light","bigger","animateArrows","expandIconPosition","ghost","bordered","Panel","AntdCollapse","CONFIRM_WARNING_MESSAGE","CHANGE_WARNING_MSG","StyledModal","ConfirmModalStyled","StyledSpan","withToasts","onDatasourceSave","setFilter","pageIndex","setPageIndex","sortBy","setSortBy","DATASET_SORT_BY","confirmChange","setConfirmChange","confirmedDataset","setConfirmedDataset","searchRef","resourceCollection","resourceCount","fetchData","useListViewResource","selectDatasource","fetchDatasetPayload","pageSize","DATASET_PAGE_SIZE","focus","onEnterModal","Cell","original","Header","accessor","disableSortBy","FacePile","users","hideFooter","Loading","TableView","initialPageIndex","initialSortBy","onServerPagination","emptyWrapperType","EmptyWrapperType","serverPagination","isPaginationSticky","scrollTable","DatasourceEditor","StyledDatasourceModal","buildExtraJsonObject","certification","currentDatasource","setCurrentDatasource","currency","currencies","setErrors","isSaving","setIsSaving","isEditing","setIsEditing","dialog","modal","contextHolder","onConfirmSave","tableSelector","databaseSelector","filter_select_enabled","fetch_values_predicate","default_endpoint","cache_timeout","metricBody","metric_type","d3format","advanced_data_type","is_active","python_date_format","okButtonProps","showLegacyDatasourceEditor","maskClosable","edit_url","confirm","onOk","okText","cancelText","AntdRangePicker","AntdDatePicker","RangePicker","DatePicker","metadataRegistry","dummyPluginContext","dynamicPlugins","mountedPluginMetadata","fetchAll","PluginContext","usePluginContext","useContext","getRegistryData","pluginContextReducer","plugins","mounting","plugin","pluginApi","makeApi","sharedModules","react","lodash","DynamicPluginProvider","pluginState","useReducer","import","bundle_url","stack","registryListener","addListener","removeListener","Provider","EmptyStateSize","EmptyStateContainer","TextContainer","Title","BigTitle","l","Description","BigDescription","SmallDescription","ActionButton","getImage","image","getImageHeight","Small","Medium","Big","ImageContainer","imageStyle","handleMouseDown","EmptyStateBig","buttonAction","buttonText","EmptyStateMedium","EmptyStateSmall","TRANSLATIONS","NO_DATABASES_MATCH_TITLE","NO_DATABASES_AVAILABLE_TITLE","MANAGE_YOUR_DATABASES_TEXT","HERE_TEXT","emptyStateComponent","emptyResultsWithSearch","DEFAULT_TITLE","ErrorMessageWithStackTrace","fallback","ErrorMessageComponent","getErrorMessageComponentRegistry","level","colorList","customAvatarStyler","StyledAvatar","Avatar","StyledGroup","maxCount","first_name","last_name","sampleValue","charCodes","letter","charCodeAt","len","stringAsciiPRNG","getRandomColor","toLocaleUpperCase","Label","RequiredLabel","FormLabel","StyledLabel","StyledInput","StyledInputPassword","StyledFormGroup","StyledAlignment","StyledFormLabel","iconReset","validationMethods","helpText","hasTooltip","visibilityToggle","InfoTooltip","FormItem","hasError","errorIcon","alertIconStyles","validateTrigger","validateStatus","help","hasFeedback","iconRender","StyledForm","AntdForm","StyledTooltip","StyledTooltipTitle","defaultOverlayStyle","bgColor","AntdInput","AntdInputNumber","TextArea","MenuItem","AntdMenu","transitionTiming","StyledNav","StyledSubMenu","Menu","Item","MainNav","SubMenu","Divider","ItemGroup","showModal","setShowModal","beforeOpen","onExit","isButton","resizable","draggable","modalFooter","destroyOnClose","draggableConfig","resizableConfig","close","Popover","PopoverSection","paddingBottom","mediumHeavy","StyledRadio","AntdRadio","Radio","Group","DASHBOARD_INFO_UPDATED","labelColors","newInfo","SET_FILTER_BAR_ORIENTATION","SET_CROSS_FILTERS_ENABLED","saveFilterBarOrientation","errorObject","getErrorText","saveCrossFiltersSetting","setCrossFiltersEnabled","setDatasources","datasources","SET_DATASOURCES","setDatasource","SET_DATASOURCE","SET_IN_SCOPE_STATUS_OF_FILTERS","SET_FILTER_SETS_COMPLETE","setFilterConfiguration","oldFilters","mergedFilterConfig","oldFilter","setDataMaskForFilterConfigComplete","SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL","setInScopeStatusOfFilters","filtersWithScopes","filterId","chartsInScope","tabsInScope","filterWithScope","getFilterSets","fetchFilterSets","filterSets","ids","createFilterSet","filterSet","postFilterSets","serverFilterSet","owner_type","owner_id","updateFilterSet","deleteFilterSet","filterSetId","deleteFilterSets","SET_FOCUSED_NATIVE_FILTER","UNSET_FOCUSED_NATIVE_FILTER","setFocusedNativeFilter","unsetFocusedNativeFilter","SET_HOVERED_NATIVE_FILTER","UNSET_HOVERED_NATIVE_FILTER","setHoveredNativeFilter","unsetHoveredNativeFilter","UPDATE_CASCADE_PARENT_IDS","updateCascadeParentIds","parentIds","updateSlices","setSlices","fetchSlices","filter_value","sortColumn","page_size","datasource_name_text","datasource_url","changed_on_utc","description_markdown","changed_on_delta_humanized","changed_on_humanized","thumbnail_url","created_by","parseResult","addSlices","errorResponse","fetchAllSlicesFailed","hasCircularDependency","dependencyMap","trace","dependencies","dependency","validateForm","form","currentFilterId","setCurrentFilterId","formValues","validateFields","errorFields","outOfDate","filterError","createHandleSave","filterConfigMap","filterIds","removedFilters","saveForm","newFilterConfig","formInputs","rootPath","excluded","dataset","controlValues","requiredFirst","rf","filterType","targets","defaultDataMask","getInitialDataMask","cascadeParentIds","sortMetric","createHandleRemoveItem","setRemovedFilters","setOrderedFilters","setSaveAlertVisible","timerId","isPending","orderedFilters","completeFilterRemoval","REMOVAL_DELAY_SECS","NATIVE_FILTER_PREFIX","NATIVE_FILTER_DIVIDER_PREFIX","generateFilterId","getFilterIds","getDefaultRowLimit","NATIVE_FILTER_DEFAULT_ROW_LIMIT","getFormData","otherProps","inView","mergeExtraFormData","originalExtra","newExtra","mergedExtra","mergedValues","originalValue","getExtraFormData","filterIdsAppliedOnChart","extraFormData","nativeFilterGate","behaviors","isComponentATab","findTabsWithChartsInScopeHelper","tabIds","tabsToHighlight","visited","findTabsWithChartsInScope","hasTopLevelTabs","PLACEHOLDER_DATASOURCE","uid","column_types","column_formats","currency_formats","verbose_map","MAIN_HEADER_HEIGHT","CLOSED_FILTER_BAR_WIDTH","OPEN_FILTER_BAR_WIDTH","OPEN_FILTER_BAR_MAX_WIDTH","FILTER_BAR_HEADER_HEIGHT","FILTER_BAR_TABS_HEIGHT","BUILDER_SIDEPANEL_WIDTH","DEFAULT_CROSS_FILTER_SCOPING","filterSetsConfig","filtersSet","focusedFilterId","nativeFilterReducer","hoveredFilterId","GLOBAL_SCOPE_POINTER","isCrossFilterScopeGlobal","NEW_COMPONENT_SOURCE_TYPE","NEW_CHART_ID","NEW_COLUMN_ID","NEW_DIVIDER_ID","NEW_HEADER_ID","NEW_MARKDOWN_ID","NEW_ROW_ID","NEW_TAB_ID","NEW_TABS_ID","NEW_DYNAMIC_COMPONENT","DASHBOARD_ROOT_DEPTH","GRID_BASE_UNIT","GRID_GUTTER_SIZE","GRID_MIN_ROW_UNITS","SMALL_HEADER","LARGE_HEADER","BACKGROUND_WHITE","UNDO_LIMIT","SAVE_TYPE_NEWDASHBOARD","DASHBOARD_POSITION_DATA_LIMIT","IN_COMPONENT_ELEMENT_TYPES","ALL_FILTERS_ROOT","layoutItem","crossFilters","getChartIdsInFilterScope","reservedQueryParams","urlParamType","querystring","cache","findParentIdWithCache","structure","lastParent","layoutItems","elementId","filterKeySplitter","isUserWithPermissionsAndRoles","isUser","isUserAdmin","owner","isUserDashboardOwner","canUserAccessSqlLab","CLEAR_DATA_MASK_STATE","UPDATE_DATA_MASK","SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE","isFeatureFlagActive","clearDataMask","clearDataMaskState","moreProps","fillNativeFilters","mergedDataMask","draftDataMask","initialDataMask","currentFilters","areObjectsEqual","ignoreUndefined","produce","draft","cleanState","changeDatasource","newDatasource","prevDatasource","updateFormDataByDatasource","datasourcesActions","saveDataset","UPDATE_FORM_DATA_BY_DATASOURCE","POST_DATASOURCE_STARTED","FETCH_DATASOURCE_SUCCEEDED","fetchDatasourceSucceeded","FETCH_DATASOURCES_STARTED","fetchDatasourcesStarted","FETCH_DATASOURCES_SUCCEEDED","fetchDatasourcesSucceeded","FETCH_FAVE_STAR","SAVE_FAVE_STAR","SET_FIELD_VALUE","SET_EXPLORE_CONTROLS","setExploreControls","SET_FORM_DATA","setFormData","UPDATE_CHART_TITLE","updateChartTitle","SET_SAVE_ACTION","setSaveAction","saveAction","CREATE_NEW_SLICE","createNewSlice","can_add","can_download","can_overwrite","SLICE_UPDATED","sliceUpdated","SET_FORCE_QUERY","setForceQuery","exploreActions","toastActions","ColorSchemeType","hydrateExplore","fallbackSlice","initialSlice","initialFormData","initialDatasource","initialExploreState","initialControls","colorSchemeKey","linearColorSchemeKey","verifyColorScheme","registryDefaultScheme","defaultKey","defaultScheme","currentScheme","colorSchemeExists","CATEGORICAL","SEQUENTIAL","exploreState","isDatasourceMetaLoading","triggerRender","controlsTransferred","applyMapStateToPropsToControl","getDatasourceUid","saveModal","saveModalAlert","CustomListItem","selectable","rest","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","AnnotationLayer","refreshAnnotationData","AnnotationLayerControl","popoverVisible","addedAnnotationIndex","addAnnotationLayer","removeAnnotationLayer","handleVisibleChange","originalAnnotation","newAnnotation","annotations","anno","popoverKey","getSectionContainerElement","setProperty","renderPopover","renderInfo","addedAnnotation","ControlPopover","onVisibleChange","float","destroyTooltipOnHide","themedAnnotationLayerControl","connect","annotationObj","MinInput","MaxInput","parseNumber","BoundsControl","minMax","setMinMax","update","mm","addTooltip","itemGenerator","keyAccessor","isFloat","isInt","SortableListItem","SortableList","List","SortableDragger","SortableHandle","CollectionControl","onAdd","removeItem","ix","renderList","controlMap","useDragHandle","lockAxis","commonProps","flex","swatchCommon","left","bottom","StyledSwatch","checkerboard","ColorPickerControl","rgb","presetColors","colStyle","CLOSE","SAVE_AS_DATASET","OPEN_IN_SQL_LAB","closeModal","viewInSQLLab","openSQL","CHANGE_DATASET","VIEW_IN_SQL_LAB","EDIT_DATASET","datasourceIconLookup","DatasourceControl","timeCol","isGranularitySqalTemporal","isDefaultTemporal","toggleShowDatasource","showDatasource","toggleChangeDatasourceModal","showChangeDatasourceModal","toggleEditDatasourceModal","showEditDatasourceModal","toggleSaveDatasetModal","showSaveDatasetModal","handleMenuItemClick","isMissingDatasource","isMissingParams","allowEdit","canAccessSqlLab","editText","defaultDatasourceMenu","queryDatasourceMenu","ModalTrigger","ViewQuery","health_check_message","healthCheckMessage","titleText","getDatasourceTitle","displayString","renderDatasourceTitle","WarningIconWithTooltip","overlay","ErrorAlert","TitleLabel","isEditDisabled","isHovered","setIsHovered","isEditMode","setIsEditMode","defaultLabel","handleMouseOver","handleMouseOut","handleClick","handleBlur","handleKeyPress","ev","handleInputBlur","onMouseOver","onMouseOut","onClose","onResize","getCurrentTab","getCurrentLabel","savedMetricsOptions","isNewMetric","isLabelModified","noOp","SAVED_TAB_KEY","AdhocMetricEditPopover","defaultActiveTabKey","getDefaultTab","onResetStateAndClose","onColumnChange","onAggregateChange","onSavedMetricChange","onSqlExpressionChange","onDragDown","onMouseMove","onMouseUp","onTabChange","handleAceEditorRef","refreshAceEditor","POPOVER_INITIAL_WIDTH","POPOVER_INITIAL_HEIGHT","addEventListener","componentDidUpdate","prevProps","savedMetricLabel","adhocMetricLabel","componentWillUnmount","removeEventListener","oldMetric","dragStartX","clientX","dragStartY","clientY","dragStartWidth","dragStartHeight","aceEditorRef","renderColumnOption","renderMetricOption","propsAdhocMetric","propsSavedMetric","popoverProps","sqlKeywords","columnValue","columnSelectProps","aggregateSelectProps","AGGREGATES_OPTIONS","savedSelectProps","stateIsValid","Tabs","defaultActiveKey","allowOverflow","EmptyState","handleDatasetModal","disallow_adhoc_metrics","showGutter","enableLiveAutocompletion","cta","AdhocMetricPopoverTrigger","onPopoverResize","onLabelChange","closePopover","togglePopover","currentLabel","labelModified","isTitleEditDisabled","defaultMetricLabel","forceUpdate","newMetric","onMetricEdit","isControlledComponent","overlayContent","popoverTitle","defaultVisible","onRemoveMetric","datasourceWarningMessage","AdhocMetricOption","isFunction","MetricDefinitionValue","metricOptionProps","getOptionsForSavedMetrics","currentMetricValues","currentMetric","isDictionaryForAdhocMetric","coerceAdhocMetrics","emptySavedMetric","MetricsControl","propsValue","prevColumns","prevSavedMetrics","optionValues","onNewMetric","changedMetric","isAddNewMetricDisabled","savedMetricOptions","newAdhocMetric","addNewMetricPopoverTrigger","matchingMetrics","getMetricsMatchingCurrentDataset","controlTypes","FixedOrMetricControl","setFixedValue","setMetric","fixedValue","metricValue","Collapse","showArrow","TextControl","isLabeledValue","arg","dataEndpoint","mutator","colType","timeLag","timeRatio","comparisonType","showYAxis","yAxisBounds","bounds","dateFormat","comparisonTypeOptions","colTypeOptions","StyledRow","Row","StyledCol","Col","ButtonBar","TimeSeriesColumnControl","initialState","onPopoverVisibleChange","onSelectChange","attr","onTextInputChange","onCheckboxChange","onBoundsChange","onYAxisBoundsChange","textSummary","formRow","ttLabel","PARAMS","longitude","latitude","zoom","bearing","pitch","ViewportControl","ctrl","renderTextControl","renderLabel","decimal2sexagesimal","FEATURED_CHARTS","antdIconProps","VizTile","isRendered","vizMeta","onTileClick","chartNameRef","TILE_TRANSITION_TIME","tooltipVisible","setTooltipVisible","isTransitioning","setIsTransitioning","showTooltip","setShowTooltip","chartName","handleTileClick","containerProps","mouseEnterDelay","FastVizSwitcher","currentSelection","currentViz","vizTiles","featuredVizMeta","denyList","VIZ_TYPE_DENYLIST","VizSupportValidation","UnpaddedModal","STYLE_ROW","STYLE_RALIGN","isCheckbox","FormRow","labelAndTooltip","INTEGRAL_TYPES","DECIMAL_TYPES","STYLE_WIDTH","FilterBoxItemControl","typedValue","selectedColumnName","selectedColumn","parseFloat","renderForm","FullWidthInputNumber","JustifyEnd","operatorOptions","NONE","GREATER_THAN","LESS_THAN","GREATER_OR_EQUAL","LESS_OR_EQUAL","EQUAL","NOT_EQUAL","targetValueValidator","compare","rejectMessage","targetValue","compareValue","targetValueLeftValidator","targetValueRightValidator","isOperatorMultiValue","isOperatorNone","rulesRequired","rulesTargetValueLeft","getFieldValue","rulesTargetValueRight","targetValueLeftDeps","targetValueRightDeps","shouldFormItemUpdate","prevValues","currentValues","operatorField","rules","renderOperatorFields","FormattingPopoverContent","onFinish","initialValues","requiredMark","noStyle","shouldUpdate","htmlType","FormattingPopover","setVisible","handleSave","newConfig","FormattersContainer","FormatterContainer","OptionControlContainer","CloseButton","DndSelectLabel","displayGhostButton","accept","valuesRenderer","isOver","canDrop","datasourcePanelDrop","useDrop","drop","onDrop","onDropValue","canDropValue","collect","monitor","getItemType","cancelHover","onClickGhostButton","StyledInfoTooltipWithTrigger","clickClose","onClickClose","OptionLabel","OptionWrapper","onShiftOptions","isDragging","drag","useDrag","hover","hoverBoundingRect","hoverMiddleY","clientOffset","getClientOffset","hoverClientY","LabelContent","transformedCol","getColumnNameOrAdhocColumn","OptionSelector","del","swap","getValues","editedColumn","setDatasetModal","setLabel","initialLabel","initialAdhocColumn","initialCalculatedColumn","initialSimpleColumn","getInitialColumnValues","adhocColumn","setAdhocColumn","selectedCalculatedColumn","setSelectedCalculatedColumn","selectedSimpleColumn","setSelectedSimpleColumn","resizeButton","setWidth","setHeight","setClientX","setClientY","setDragStartX","setDragStartY","setDragStartWidth","setDragStartHeight","setIsDragging","handleResize","throttle","useResizeButton","sqlEditorRef","calculatedColumns","simpleColumns","onCalculatedColumnChange","onSimpleColumnChange","onSqlEditorFocus","setDatasetAndClose","savedExpressionsLabel","simpleColumnsLabel","calculatedColumn","simpleColumn","DndColumnSelectPopoverTitle","onInputBlur","defaultPopoverLabel","onColumnEdit","popoverLabel","setPopoverLabel","setPopoverVisible","setIsTitleEditDisabled","setHasCustomLabel","showDatasetModal","initialPopoverLabel","handleTogglePopover","handleClosePopover","DndColumnSelectWithFallback","newColumnPopoverVisible","setNewColumnPopoverVisible","optionSelector","optionsMap","newColumn","addNewColumnWithPopover","openPopover","labelGhostButtonText","tn","DndAdhocFilterOption","DND_ACCEPTED_TYPES","DndFilterSelectWithFallback","propsValues","setValues","setPartitionColumn","newFilterPopoverVisible","setNewFilterPopoverVisible","droppedItem","setDroppedItem","removeValue","filterOptions","handleClickGhostButton","defaultTimeFilter","useDefaultTimeFilter","handleDrop","requireSave","EMPTY_OBJECT","coerceMetrics","addedMetrics","DndMetricSelectWithFallback","newMetricPopoverVisible","setNewMetricPopoverVisible","newSavedMetricOptions","getSavedMetricOptionsForMetric","handleDropLabel","itemValue","ColorSchemeControl","DndColumnSelectControl","DndColumnSelect","DndFilterSelect","DndMetricSelect","HiddenControl","SelectAsyncControl","SliderControl","VizTypeControl","isModalOpenInit","modalKey","setModalKey","selectedViz","setSelectedViz","openModal","onSubmit","onCancel","primaryButtonName","disablePrimaryButton","onHandledPrimaryAction","MAX_ADVISABLE_VIZ_GALLERY_WIDTH","VizTypeGallery","onDoubleClick","ConditionalFormattingControl","columnOptions","verboseMap","removeIrrelevantConditions","conditionalFormattingConfigs","setConditionalFormattingConfigs","newFormattingConfigs","prevConfigs","onDelete","newConfigs","onEdit","targetValueLeft","targetValueRight","createLabel","XAxisSortControl","shouldReset","StyledControl","hidden","resetOnHide","wasVisible","ControlComponent","warn","iconStyles","hasHadNoErrors","labelColor","isHiddenControl","countableControls","colSize","CellNull","CopyButton","CopyToClipboardButton","prepareCopyToClipboardTabularData","wrapped","copyNode","FilterInput","onChangeHandler","debouncedChangeHandler","debounce","filterText","RowCount","FormatPickerValue","FormatPicker","direction","Formatted","Original","FormatPickerContainer","FormatPickerLabel","DataTableTemporalHeaderCell","onTimeColumnChange","isOriginalTimeColumn","overlayClassName","useFilteredTableData","rowsAsStrings","timeFormatter","getTimeFormatter","TimeFormats","useTableColumns","moreConfigs","allowHTML","originalFormattedTimeColumns","setOriginalFormattedTimeColumns","getTimeColumns","setTimeColumns","originalFormattedTimeColumnIndex","NULL_DISPLAY","colsMap","getItem","LocalStorageKeys","setItem","ExplorePopoverContent","RowCountLabel","limitReached","formattedRowCount","ColorSchemeLabel","labelNameRef","labelColorsRef","colorsList","labelNameElement","labelColorsElement","offsetWidth","scrollHeight","offsetHeight","StyledAlert","CUSTOM_LABEL_ALERT","DASHBOARD_ALERT","hasCustomLabelColors","alertTitle","schemesObject","SUPERSET_DEFAULT","controlChoices","allColorOptions","isValidColorOption","getColors","lastElementChild","getElementYVisibilityRatioOnContainer","containerHeight","innerHeight","nodePositionInViewport","getVisibilityRatio","visibleProp","triggerElementRef","setPlacement","calculatePlacement","visibilityRatio","changeContainerScrollStatus","handleGetPopupContainer","handleOnVisibleChange","handleDocumentKeyDownListener","CommonFrame","commonRange","COMMON_RANGE_SET","COMMON_RANGE_OPTIONS","CalendarFrame","CALENDAR_RANGE_SET","PreviousCalendarWeek","CALENDAR_RANGE_OPTIONS","CustomFrame","customRange","matchedFlag","customTimeRangeDecode","customTimeRangeEncode","sinceDatetime","sinceMode","sinceGrain","sinceGrainValue","untilDatetime","untilMode","untilGrain","untilGrainValue","anchorValue","anchorMode","onGrainValue","localFromFlaskBabel","locale","datePickerLocale","locales","LOCALE_MAPPING","SINCE_MODE_OPTIONS","showTime","dttmToMoment","datetime","MOMENT_FORMAT","abs","onStep","SINCE_GRAIN_OPTIONS","UNTIL_MODE_OPTIONS","UNTIL_GRAIN_OPTIONS","radioValue","MIDNIGHT","TIME_PICKER_HELPER","DateFunctionTooltip","getAdvancedRange","SEPARATOR","AdvancedFrame","advancedRange","ACTIVE_BORDER_COLOR","LabelContainer","isPlaceholder","DateLabel","StyledRangeType","ContentStyleWrapper","medium","IconWrapper","DateFilterLabel","onOpenPopover","onClosePopover","isOverflowingFilterBar","setActualTimeRange","setShow","guessedFrame","guessFrame","frame","setFrame","lastFetchedTimeRange","setLastFetchedTimeRange","timeRangeValue","setTimeRangeValue","validTimeRange","setValidTimeRange","evalResponse","setEvalResponse","setTooltipTitle","labelIsTruncated","useCSSTextTruncation","fetchTimeRange","actualRange","toggleOverlay","FRAME_OPTIONS","popoverContent","modalContent","PreviousCalendarMonth","PreviousCalendarYear","formatDateEndpoint","dttm","isStart","formatTimeRange","timeRange","columnPlaceholder","splitDateRange","COMMON_RANGE_VALUES_SET","CALENDAR_RANGE_VALUES_SET","timeRangeString","GRAIN_OPTIONS","SEVEN_DAYS_AGO","startOf","subtract","en","fr","es","zh","ja","de","pt","pt_BR","ru","ko","sk","sl","nl","DATE_FILTER_TEST_KEY","iso8601","raw","datetimeConstant","grainValue","grain","CUSTOM_RANGE_EXPRESSION","ISO8601_AND_CONSTANT","DATETIME_CONSTANT","defaultCustomRange","SPECIFIC_MODE","dttmToString","sinceCapturedGroup","untilCapturedGroup","sinceDttm","untileDttm","INITIAL_ADVANCED_DATA_TYPES_STATE","parsedAdvancedDataType","advancedDataTypeOperatorList","SelectWithLabel","labelText","onSubjectChange","onOperatorChange","isOperatorRelevant","onComparatorChange","onDatePickerChange","isColumnBoolean","isColumnNumber","isColumnFunction","HAVING_OPERATORS","currentComparator","newComparator","clearOperator","useSimpleTabFilterProps","suggestions","setSuggestions","setComparator","loadingComparatorSuggestions","setLoadingComparatorSuggestions","advancedDataTypesState","subjectAdvancedDataType","fetchAdvancedDataTypeValueCallback","fetchSubjectAdvancedDataType","validHandler","setAdvancedDataTypesState","setSubjectAdvancedDataType","comp","display_value","valid_filter_operators","error_message","useAdvancedDataTypes","isOperatorRelevantWrapper","createSuggestionsPlaceholder","optionsRemaining","valuesFromSuggestionsLength","getOptionsRemaining","subjectSelectProps","operatorSelectProps","OPERATORS_OPTIONS","shouldFocusComparator","comparatorSelectProps","datePicker","useDatePickerInAdhocFilter","filter_select","suggestion","refreshComparatorSuggestions","subjectComponent","operatorsAndOperandComponent","order","activeKey","AdhocFilterEditPopoverSqlTabContent","onSqlExpressionClauseChange","clauseSelectProps","selectOptions","ResizeIcon","FilterPopoverContentContainer","FilterActionsContainer","AdhocFilterEditPopover","onAdhocFilterChange","setSimpleTabIsValid","adjustHeight","isSimpleTabValid","popoverContentRef","heightDifference","propsAdhocFilter","onHeightChange","popoverRef","OPERATORS_TO_SQL","IN","LIKE","ILIKE","REGEX","DragContainer","LabelText","CaretContainer","CloseContainer","HeaderContainer","LabelsContainer","DndLabelsContainer","AddControlLabel","AddIconButton","OptionControlLabel","hasMetricName","getLabelContent","parsedValue","legacyValidateNumber","onChangeWrapper","CopyButtonViewQuery","SyntaxHighlighter","markdownSyntax","htmlSyntax","sqlSyntax","jsonSyntax","StyledSyntaxContainer","StyledSyntaxHighlighter","shouldShowText","github","SECTIONS","DEFAULT_ORDER","typesWithDefaultOrder","OTHER_CATEGORY","ALL_CHARTS","RECOMMENDED_TAGS","VizPickerLayout","isSelectedVizMetadata","SectionTitle","LeftPane","RightPane","SearchWrapper","InputIconAlignment","SelectorLabel","IconsPane","DetailsPane","DetailsPopulated","TagsWrapper","Examples","thumbnailContainerCss","HighlightLabel","ThumbnailLabelWrapper","TitleLabelWrapper","vizSortFactor","Thumbnail","alt","src","thumbnail","ThumbnailGallery","vizEntries","Selector","selector","sectionId","btnRef","queueMicrotask","scrollIntoView","behavior","scrollMode","searchInputRef","searchInputValue","setSearchInputValue","isSearchFocused","setIsSearchFocused","isActivelySearching","selectedVizMetadata","chartMetadata","deprecated","chartsByCategory","category","categories","chartsByTags","tags","tag","sortedMetadata","activeSelector","setActiveSelector","activeSection","setActiveSection","CATEGORY","fuse","Fuse","ignoreLocation","threshold","searchResults","aLabel","bLabel","aOrder","focusSearch","changeSearch","stopSearching","blur","clickSelector","isSelectedVizCompatible","viz","doesVizMatchSelector","sectionMap","selectors","TAGS","labelExplanation","exampleGallery","example","caption","OptionContainer","StyledMetricOption","StyledColumnOption","AVG","COUNT","COUNT_DISTINCT","MAX","MIN","SUM","EQUALS","NOT_EQUALS","LESS_THAN_OR_EQUAL","GREATER_THAN_OR_EQUAL","NOT_IN","IS_NOT_NULL","IS_NULL","LATEST_PARTITION","IS_TRUE","IS_FALSE","TEMPORAL_RANGE","DISABLE_INPUT_OPERATORS","CLEARABLE","DEFAULT_VALUE","MULTIPLE","SEARCH_ALL_OPTIONS","SORT_ASCENDING","SORT_METRIC","datasourceAndVizType","controlSetRows","sqlaTimeSeries","tabOverride","NVD3TimeSeries","getMemoizedSectionsToRender","memoizeOne","sectionOverrides","controlPanelSections","filterControlsForTypes","invalidControls","getSectionsToRender","getMemoizedControlConfig","controlKey","flat","findControlItem","getControlConfig","controlPanelState","processedState","externalValidationErrors","execControlValidator","alteredControl","choiceValues","el","handleMissingChoice","getControlStateFromControlConfig","controlConfig","fieldsetRow","isControlValueCompatibleWithDatasource","getControlValuesCompatibleWithDatasource","compatibleValues","sharedMetricsKey","sharedColumnsKey","publicControls","StandardizedFormData","sourceFormData","sfd","freeze","mfd","getLatestFormData","standardizedControls","serialize","transform","targetVizType","latestFormData","publicFormData","targetControlsState","targetFormData","controlPanel","formDataOverrides","transformed","TEMPORARY_CONTROLS","sanitizeFormData","assembleEndpoint","assemblePayload","chart_id","putFormData","PAGE_SIZE","SORT_BY","desc","PASSWORDS_NEEDED_MESSAGE","CONFIRM_OVERWRITE_MESSAGE","WelcomeTable","GlobalMenuDataOptions","LOADING","useTransformedResource","resource","transformFn","COMPLETE","ERROR","extractInnerResult","responseBody","useApiV1Resource","setResource","cancelRef","cancelled","fetchResource","useApiResourceFullBody","api","createApi","reducerPath","tagTypes","baseQuery","urlParams","transformResponse","errorObj","LOG_ACTIONS_RENDER_CHART","LOG_ACTIONS_HIDE_BROWSER_TAB","LOG_ACTIONS_MOUNT_DASHBOARD","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_SELECT_DASHBOARD_TAB","LOG_ACTIONS_FORCE_REFRESH_CHART","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD","LOG_ACTIONS_FORCE_REFRESH_DASHBOARD","LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD","LOG_ACTIONS_EXPLORE_DASHBOARD_CHART","LOG_ACTIONS_EXPORT_CSV_DASHBOARD_CHART","LOG_ACTIONS_EXPORT_XLSX_DASHBOARD_CHART","LOG_ACTIONS_CHANGE_DASHBOARD_FILTER","LOG_ACTIONS_DATASET_CREATION_EMPTY_CANCELLATION","LOG_ACTIONS_DATASET_CREATION_DATABASE_CANCELLATION","LOG_ACTIONS_DATASET_CREATION_SCHEMA_CANCELLATION","LOG_ACTIONS_DATASET_CREATION_TABLE_CANCELLATION","LOG_ACTIONS_DATASET_CREATION_SUCCESS","LOG_ACTIONS_SPA_NAVIGATION","LOG_ACTIONS_DASHBOARD_DOWNLOAD_AS_IMAGE","LOG_ACTIONS_CHART_DOWNLOAD_AS_IMAGE","LOG_ACTIONS_SQLLAB_WARN_LOCAL_STORAGE_USAGE","LOG_ACTIONS_DRILL_BY_MODAL_OPENED","LOG_ACTIONS_FURTHER_DRILL_BY","LOG_ACTIONS_DRILL_BY_EDIT_CHART","LOG_ACTIONS_DRILL_BY_BREADCRUMB_CLICKED","LOG_ACTIONS_SQLLAB_MONITOR_LOCAL_STORAGE_USAGE","LOG_EVENT_TYPE_TIMING","timeOriginOffset","markTimeOrigin","performance","getTimestamp","LOG_EVENT","eventName","TRANSPORT_POLLING","LOCALSTORAGE_KEY","transport","pollingDelayMs","pollingTimeoutId","listenersByJobId","retriesByJobId","lastReceivedEventId","asyncResponse","jobId","job_id","fn","asyncEvent","result_url","fetchCachedData","parseErrorJson","fetchEvents","processEvents","events","listener","localStorage","setLastId","loadEventsFromApi","eventArgs","last_id","wsConnectTimeout","ws","wsConnectRetries","wsConnect","GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL","WebSocket","readyState","appConfig","GLOBAL_ASYNC_QUERIES_TRANSPORT","GLOBAL_ASYNC_QUERIES_POLLING_DELAY","init","perm","view","permissions","perm_","view_","dangerouslyGetItemDoNotUse","dangerouslySetItemDoNotUse","require","loadModule","urlParam","getUrlParams","excludedParams","append","getUrlParamEntries","urlEntries","getChartUrlParams","excludedUrlParams","RESERVED_CHART_URL_PARAMS","filterBoxFilters","getDashboardUrlParams","RESERVED_DASHBOARD_URL_PARAMS","getPermalink","getChartPermalink","getDashboardPermalink","anchor","externalUrlRegex","isUrlExternal","parseUrl","parsedErrorMessage","resourceLabel","handleErrorMsg","infoEnable","defaultCollectionValue","baseFilters","initialLoadingState","collection","lastFetchDataConfig","bulkSelectEnabled","updateState","currentState","infoJson","createErrorHandler","filterValues","filterExps","lastFetched","toISOString","setResourceCollection","hasPerm","toggleBulkSelect","refreshData","provideConfig","useSingleViewResource","resourceName","path_suffix","resourceID","baseEndpoint","createResource","hideToast","updateResource","clearError","useImportResource","passwordsNeeded","alreadyExists","sshPasswordNeeded","sshPrivateKeyNeeded","sshPrivateKeyPasswordNeeded","importResource","bundle","databasePasswords","sshTunnelPasswords","sshTunnelPrivateKey","sshTunnelPrivateKeyPasswords","overwrite","FormData","RE_EXPORT_TEXT","Accept","hasTerminalValidation","getPasswordsNeeded","getSSHPasswordsNeeded","getSSHPrivateKeysNeeded","getSSHPrivateKeyPasswordsNeeded","getAlreadyExists","favoriteApis","requestType","useFavoriteStatus","favoriteStatus","setFavoriteStatus","updateFavoriteStatus","useChartEditModal","setCharts","sliceCurrentlyEditing","setSliceCurrentlyEditing","handleChartUpdated","edits","newCharts","openChartEditModal","closeChartEditModal","copyQueryLink","copyTextToClipboard","origin","getDatabaseImages","SupersetText","getConnectionAlert","getDatabaseDocumentationLinks","testDatabaseConnection","connection","useAvailableDatabases","availableDbs","setAvailableDbs","useDatabaseValidation","onCreate","db","parameters","ssh","catalog","parsedErrors","invalid","missing","reportSelector","resourceType","reports","TableTab","QueryObjectColumns","risonRef","hi","lo","fromCharCode","not_idchar","not_idstart","idrx","id_ok","next_id","Actions","createFetchResourceMethod","relation","handleError","filterValue","resourceEndpoint","fetchedLoggedUser","loggedUser","firstName","lastName","getParams","getEditedObjects","edited","batch","editedCharts","editedDashboards","editedDash","editedChart","getUserOwnedObjects","res","getRecentActivityObjs","recent","recentsRes","newBatch","chartRes","dashboardRes","other","viewed","createFetchRelated","createFetchDistinct","handleErrorFunc","parsedError","errorsArray","ERRORS","handleChartDelete","chartFilter","handleDashboardDelete","dashboardTitle","shortenSQL","lines","loadingCardCount","mq","bp","CardContainer","showThumbnails","CardStyles","StyledIcon","isNeedsPassword","_schema","isNeedsSSHPassword","isNeedsSSHPrivateKey","isNeedsSSHPrivateKeyPassword","isAlreadyExists","fileName","noIssuesCodes","checkUploadExtensions","cons","uploadUserPerms","csvExt","colExt","excelExt","allowedExt","canUploadCSV","canUploadColumnar","canUploadExcel","canUploadData","getFilterValues","welcomeTable","otherTabFilters","componentIsResizable","typeToWrapChildLookup","shouldWrapChildInRow","parentType","childType","wrapChildLookup","newEntitiesFromDrop","dragType","dropEntity","dropType","newDropChild","wrapChildInRow","newEntities","rowWrapper","tabChild","nextDropChildren","recursivelyDeleteChildren","componentParentId","componentIndex","nextChildren","nextParent","nextEntities","entitiesMap","reordered","list","startIndex","endIndex","removed","reorder","reorderItem","nextWidth","destinationEntity","destinationChildren","newRow","rootComponent","topLevelId","topLevelComponent","draggingTabId","draggingTab","childrenToMove","newEntitiesArray","tabComponent","tabsComponent","topLevelTabs","nextState","undoable","ignoreInitialState","includeAction","logMessageQueue","sizeThreshold","delayThreshold","queue","source_id","navigator","sendBeacon","lastEventId","store","impressionId","logMetadata","impression_id","version","event_name","event_type","trigger_event","event_id","visibilityState","target_id","target_name","noopReducer","USER_LOADED","getMiddleware","getDefaultMiddleware","thunk","logger","reducers","messageToasts","messageToastReducer","dashboardDatasources","exploreDatasources","updatedSliceIds","updatedExpandedSlices","newActiveTabs","fullSizeChartId","reportObject","reportTypeId","creation_method","newFormData","isDatasourcesLoading","new_form_data","old_metrics_data","new_column_config","column_config","rerenderedControls","rerender","hasErrors","isVizSwitch","currentControlsState","setupStore","disableDebugger","rootReducers","configureStore","preloadedState","reducer","middleware","devTools"],"sourceRoot":""}